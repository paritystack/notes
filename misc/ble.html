<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Bluetooth BLE - My Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-ae938929.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex-ef1cd730.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-b765e602.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">My Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="bluetooth-low-energy-ble"><a class="header" href="#bluetooth-low-energy-ble">Bluetooth Low Energy (BLE)</a></h1>
<p>Bluetooth Low Energy (BLE), also known as Bluetooth Smart or Bluetooth 4.0+, is a wireless personal area network technology designed for short-range communication with significantly reduced power consumption compared to Classic Bluetooth. BLE is optimized for applications requiring periodic or burst data transfers, making it ideal for IoT devices, wearables, health monitors, beacons, and smart home applications.</p>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#ble-vs-classic-bluetooth">BLE vs Classic Bluetooth</a></li>
<li><a href="#ble-protocol-architecture">BLE Protocol Architecture</a></li>
<li><a href="#core-concepts">Core Concepts</a></li>
<li><a href="#linuxbluez-implementation">Linux/BlueZ Implementation</a></li>
<li><a href="#development--programming">Development &amp; Programming</a></li>
<li><a href="#security--pairing">Security &amp; Pairing</a></li>
<li><a href="#practical-examples">Practical Examples</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
<li><a href="#references">References</a></li>
</ul>
<hr>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>BLE was introduced in the Bluetooth 4.0 specification in 2010. Unlike Classic Bluetooth, which is designed for continuous streaming applications like audio, BLE focuses on:</p>
<ul>
<li><strong>Ultra-low power consumption</strong>: Devices can run for months or years on coin cell batteries</li>
<li><strong>Fast connections</strong>: Connection setup in milliseconds</li>
<li><strong>Small data transfers</strong>: Optimized for periodic small bursts of data</li>
<li><strong>Simple architecture</strong>: Reduced complexity for easier implementation</li>
<li><strong>Wide platform support</strong>: Native support on iOS, Android, Windows, Linux, and macOS</li>
</ul>
<p><strong>Common Use Cases:</strong></p>
<ul>
<li>Fitness trackers and health monitors</li>
<li>Smart watches and wearables</li>
<li>Proximity sensors and beacons</li>
<li>Smart home devices (lights, locks, thermostats)</li>
<li>Asset tracking and location services</li>
<li>Wireless sensors (temperature, humidity, motion)</li>
<li>Keyboard, mice, and game controllers</li>
</ul>
<hr>
<h2 id="ble-vs-classic-bluetooth"><a class="header" href="#ble-vs-classic-bluetooth">BLE vs Classic Bluetooth</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Feature</th><th>Classic Bluetooth (BR/EDR)</th><th>Bluetooth Low Energy (BLE)</th></tr>
</thead>
<tbody>
<tr><td><strong>Power Consumption</strong></td><td>Higher (continuous use)</td><td>Very low (intermittent use)</td></tr>
<tr><td><strong>Data Rate</strong></td><td>1-3 Mbps</td><td>125 Kbps - 2 Mbps</td></tr>
<tr><td><strong>Range</strong></td><td>~10-100m</td><td>~50-150m (up to 400m with BLE 5.0)</td></tr>
<tr><td><strong>Connection Time</strong></td><td>~6 seconds</td><td>~6 milliseconds</td></tr>
<tr><td><strong>Voice Capable</strong></td><td>Yes</td><td>No (until LE Audio in BT 5.2)</td></tr>
<tr><td><strong>Network Topology</strong></td><td>Point-to-point, piconet</td><td>Star, mesh, broadcast</td></tr>
<tr><td><strong>Primary Use</strong></td><td>Audio streaming, file transfer</td><td>Periodic data, sensors, IoT</td></tr>
<tr><td><strong>Security</strong></td><td>Secure Simple Pairing</td><td>LE Secure Connections</td></tr>
<tr><td><strong>Protocol Stack</strong></td><td>Complex, many profiles</td><td>Simplified, GATT-based</td></tr>
</tbody>
</table>
</div>
<p><strong>Key Architectural Differences:</strong></p>
<ul>
<li>BLE uses a simplified protocol stack</li>
<li>Different radio modulation (Classic uses FHSS, BLE uses simpler frequency hopping)</li>
<li>BLE devices can advertise their presence without pairing</li>
<li>BLE supports connectionless data broadcast (advertising)</li>
<li>Different profiles and services (Classic uses Bluetooth profiles, BLE uses GATT services)</li>
</ul>
<hr>
<h2 id="ble-protocol-architecture"><a class="header" href="#ble-protocol-architecture">BLE Protocol Architecture</a></h2>
<h3 id="protocol-stack-layers"><a class="header" href="#protocol-stack-layers">Protocol Stack Layers</a></h3>
<p>The BLE protocol stack consists of several layers, from physical radio to application:</p>
<pre><code>┌─────────────────────────────────┐
│   Application Layer             │
├─────────────────────────────────┤
│   GAP (Generic Access Profile)  │
│   GATT (Generic Attribute)      │
├─────────────────────────────────┤
│   ATT (Attribute Protocol)      │
├─────────────────────────────────┤
│   L2CAP (Logical Link Control)  │
├─────────────────────────────────┤
│   HCI (Host Controller Interface│
├─────────────────────────────────┤
│   Link Layer                    │
├─────────────────────────────────┤
│   Physical Layer (PHY)          │
└─────────────────────────────────┘
</code></pre>
<h4 id="1-physical-layer-phy"><a class="header" href="#1-physical-layer-phy">1. Physical Layer (PHY)</a></h4>
<ul>
<li><strong>Frequency Band</strong>: 2.4 GHz ISM band (2400-2483.5 MHz)</li>
<li><strong>Channels</strong>: 40 channels, each 2 MHz wide
<ul>
<li>3 advertising channels (37, 38, 39)</li>
<li>37 data channels (0-36)</li>
</ul>
</li>
<li><strong>Modulation</strong>: GFSK (Gaussian Frequency Shift Keying)</li>
<li><strong>Data Rates</strong>:
<ul>
<li>BLE 4.x: 1 Mbps</li>
<li>BLE 5.0: 1 Mbps, 2 Mbps, 125 Kbps, 500 Kbps (coded PHY)</li>
</ul>
</li>
</ul>
<h4 id="2-link-layer"><a class="header" href="#2-link-layer">2. Link Layer</a></h4>
<p>Responsible for:</p>
<ul>
<li>Advertising and scanning</li>
<li>Connection establishment and maintenance</li>
<li>Channel hopping</li>
<li>Packet acknowledgment and retransmission</li>
<li>Encryption at the link level</li>
</ul>
<p><strong>Link Layer States:</strong></p>
<pre><code>Standby → Advertising → Connected
       ↓             ↗
       → Scanning →
       ↓
       → Initiating → Connected
</code></pre>
<h4 id="3-hci-host-controller-interface"><a class="header" href="#3-hci-host-controller-interface">3. HCI (Host Controller Interface)</a></h4>
<ul>
<li>Standardized interface between host (CPU running application) and controller (radio chip)</li>
<li>Allows different host/controller combinations</li>
<li>Communication via UART, USB, SPI, or shared memory</li>
<li>Commonly used for debugging and low-level access</li>
</ul>
<h4 id="4-l2cap-logical-link-control-and-adaptation-protocol"><a class="header" href="#4-l2cap-logical-link-control-and-adaptation-protocol">4. L2CAP (Logical Link Control and Adaptation Protocol)</a></h4>
<ul>
<li>Protocol multiplexing</li>
<li>Packet segmentation and reassembly</li>
<li>Flow control</li>
<li>In BLE, provides Connection-Oriented Channels and credit-based flow control (BLE 4.1+)</li>
</ul>
<h4 id="5-att-attribute-protocol"><a class="header" href="#5-att-attribute-protocol">5. ATT (Attribute Protocol)</a></h4>
<ul>
<li>Defines how data is organized and exchanged</li>
<li>Client-server architecture</li>
<li><strong>Attributes</strong> are the fundamental data entities:
<ul>
<li><strong>Handle</strong>: 16-bit unique identifier</li>
<li><strong>Type</strong>: UUID defining the attribute type</li>
<li><strong>Value</strong>: The actual data</li>
<li><strong>Permissions</strong>: Read, write, notify, etc.</li>
</ul>
</li>
</ul>
<p><strong>ATT Operations:</strong></p>
<ul>
<li><strong>Read</strong>: Client reads attribute value from server</li>
<li><strong>Write</strong>: Client writes value to server</li>
<li><strong>Notify</strong>: Server pushes data to client (no acknowledgment)</li>
<li><strong>Indicate</strong>: Server pushes data to client (with acknowledgment)</li>
</ul>
<h4 id="6-gatt-generic-attribute-profile"><a class="header" href="#6-gatt-generic-attribute-profile">6. GATT (Generic Attribute Profile)</a></h4>
<p>Built on top of ATT, GATT defines the structure for organizing attributes:</p>
<pre><code>Profile
  └── Service (UUID)
       ├── Characteristic (UUID)
       │    ├── Value
       │    └── Descriptors
       │         ├── Client Characteristic Configuration (0x2902)
       │         ├── Characteristic User Description (0x2901)
       │         └── ...
       └── Characteristic (UUID)
            └── ...
</code></pre>
<p><strong>Key Concepts:</strong></p>
<ul>
<li><strong>Service</strong>: Collection of related characteristics (e.g., Heart Rate Service)</li>
<li><strong>Characteristic</strong>: Single data point with properties and value (e.g., Heart Rate Measurement)</li>
<li><strong>Descriptor</strong>: Metadata about a characteristic</li>
<li><strong>UUID</strong>:
<ul>
<li>16-bit for Bluetooth SIG defined services/characteristics</li>
<li>128-bit for custom/vendor-specific services</li>
</ul>
</li>
</ul>
<p><strong>Common Services:</strong></p>
<ul>
<li>Heart Rate Service (0x180D)</li>
<li>Battery Service (0x180F)</li>
<li>Device Information Service (0x180A)</li>
<li>Nordic UART Service (custom)</li>
</ul>
<h4 id="7-gap-generic-access-profile"><a class="header" href="#7-gap-generic-access-profile">7. GAP (Generic Access Profile)</a></h4>
<p>Defines device roles, modes, and procedures for:</p>
<ul>
<li>Device discovery</li>
<li>Connection establishment</li>
<li>Security</li>
<li>Privacy</li>
</ul>
<p><strong>GAP Roles:</strong></p>
<ul>
<li><strong>Broadcaster</strong>: Only advertises (e.g., beacon)</li>
<li><strong>Observer</strong>: Only scans, doesn’t connect</li>
<li><strong>Peripheral</strong>: Advertises and accepts connections (e.g., fitness tracker)</li>
<li><strong>Central</strong>: Scans and initiates connections (e.g., smartphone)</li>
</ul>
<p><strong>GAP Modes:</strong></p>
<ul>
<li><strong>Discoverable</strong>: Device can be discovered by others</li>
<li><strong>Connectable</strong>: Device accepts connection requests</li>
<li><strong>Bondable</strong>: Device can pair and bond</li>
</ul>
<hr>
<h2 id="core-concepts"><a class="header" href="#core-concepts">Core Concepts</a></h2>
<h3 id="advertising"><a class="header" href="#advertising">Advertising</a></h3>
<p>Advertising allows devices to broadcast their presence and data without establishing a connection.</p>
<p><strong>Advertising Packet Structure:</strong></p>
<ul>
<li><strong>Header</strong>: PDU type, flags</li>
<li><strong>MAC Address</strong>: Device identifier</li>
<li><strong>Payload</strong>: Up to 31 bytes of data (extended advertising in BLE 5.0+ allows up to 255 bytes)</li>
</ul>
<p><strong>Advertising Types:</strong></p>
<ol>
<li><strong>ADV_IND</strong>: Connectable and scannable undirected advertising</li>
<li><strong>ADV_DIRECT_IND</strong>: Connectable directed advertising (fast reconnection)</li>
<li><strong>ADV_NONCONN_IND</strong>: Non-connectable undirected advertising (beacons)</li>
<li><strong>ADV_SCAN_IND</strong>: Scannable undirected advertising</li>
</ol>
<p><strong>Advertising Interval:</strong></p>
<ul>
<li>Range: 20ms to 10.24 seconds</li>
<li>Shorter interval = faster discovery but higher power consumption</li>
<li>Recommended: 100ms - 1 second for balance</li>
</ul>
<p><strong>Advertising Data Format:</strong></p>
<pre><code>[Length][Type][Data][Length][Type][Data]...
</code></pre>
<p>Common AD Types:</p>
<ul>
<li>0x01: Flags</li>
<li>0x02/0x03: Incomplete/Complete list of 16-bit UUIDs</li>
<li>0x09: Complete Local Name</li>
<li>0xFF: Manufacturer Specific Data</li>
</ul>
<p><strong>Example Advertising Data:</strong></p>
<pre><code>02 01 06  // Flags: General Discoverable, BR/EDR not supported
09 09 4D 79 44 65 76 69 63 65  // Complete Local Name: "MyDevice"
03 03 0F 18  // Complete list of 16-bit UUIDs: 0x180F (Battery Service)
</code></pre>
<h3 id="scanning"><a class="header" href="#scanning">Scanning</a></h3>
<p>Scanning is the process of listening for advertising packets.</p>
<p><strong>Scan Types:</strong></p>
<ol>
<li><strong>Passive Scanning</strong>: Just listens to advertising packets</li>
<li><strong>Active Scanning</strong>: Sends scan requests to get additional scan response data</li>
</ol>
<p><strong>Scan Parameters:</strong></p>
<ul>
<li><strong>Scan Interval</strong>: How often to scan (e.g., every 100ms)</li>
<li><strong>Scan Window</strong>: How long to scan during each interval (e.g., 50ms)</li>
<li><strong>Duty Cycle</strong>: Scan Window / Scan Interval (e.g., 50%)</li>
</ul>
<h3 id="connections"><a class="header" href="#connections">Connections</a></h3>
<p>Once a central discovers a peripheral, it can initiate a connection.</p>
<p><strong>Connection Parameters:</strong></p>
<ul>
<li><strong>Connection Interval</strong>: Time between connection events (7.5ms - 4s)
<ul>
<li>Shorter = lower latency, higher power</li>
<li>Longer = higher latency, lower power</li>
</ul>
</li>
<li><strong>Slave Latency</strong>: Number of events peripheral can skip (0-499)
<ul>
<li>Allows peripheral to sleep to save power</li>
</ul>
</li>
<li><strong>Supervision Timeout</strong>: Max time before connection is considered lost (100ms - 32s)</li>
</ul>
<p><strong>Connection Process:</strong></p>
<pre><code>Central                    Peripheral
  |                             |
  |------ SCAN_REQ -----------&gt;|
  |&lt;----- SCAN_RSP ------------|
  |                             |
  |------ CONNECT_REQ --------&gt;|
  |&lt;----- Connection Event ---&gt;|
  |&lt;----- Connection Event ---&gt;|
</code></pre>
<p><strong>MTU (Maximum Transmission Unit):</strong></p>
<ul>
<li>Minimum: 23 bytes (default in BLE 4.0/4.1)</li>
<li>Negotiable up to 512 bytes (BLE 4.2+)</li>
<li>Larger MTU = more efficient data transfer</li>
<li>Must be negotiated after connection</li>
</ul>
<h3 id="data-transfer"><a class="header" href="#data-transfer">Data Transfer</a></h3>
<p><strong>Methods:</strong></p>
<ol>
<li><strong>Read</strong>: Client requests data from server</li>
<li><strong>Write</strong>: Client sends data to server
<ul>
<li><strong>Write Command</strong>: No response, faster</li>
<li><strong>Write Request</strong>: With response, reliable</li>
</ul>
</li>
<li><strong>Notify</strong>: Server pushes data to client (no ack)</li>
<li><strong>Indicate</strong>: Server pushes data to client (with ack)</li>
</ol>
<p><strong>Throughput Considerations:</strong></p>
<pre><code>Theoretical Max = (MTU - 3) / Connection_Interval
Practical: 5-20 kB/s typical, up to 100+ kB/s with BLE 5.0 2M PHY
</code></pre>
<hr>
<h2 id="linuxbluez-implementation"><a class="header" href="#linuxbluez-implementation">Linux/BlueZ Implementation</a></h2>
<p>BlueZ is the official Linux Bluetooth protocol stack, supporting both Classic Bluetooth and BLE.</p>
<h3 id="installation"><a class="header" href="#installation">Installation</a></h3>
<p><strong>Ubuntu/Debian:</strong></p>
<pre><code class="language-bash">sudo apt-get update
sudo apt-get install bluez bluez-tools
</code></pre>
<p><strong>Fedora/RHEL:</strong></p>
<pre><code class="language-bash">sudo dnf install bluez bluez-tools
</code></pre>
<p><strong>Arch Linux:</strong></p>
<pre><code class="language-bash">sudo pacman -S bluez bluez-utils
</code></pre>
<h3 id="bluez-architecture"><a class="header" href="#bluez-architecture">BlueZ Architecture</a></h3>
<pre><code>┌─────────────────────────────────┐
│   Applications (gatttool, etc)  │
├─────────────────────────────────┤
│   D-Bus API                     │
├─────────────────────────────────┤
│   bluetoothd (daemon)           │
├─────────────────────────────────┤
│   Kernel Bluetooth Subsystem    │
├─────────────────────────────────┤
│   HCI Driver                    │
├─────────────────────────────────┤
│   Bluetooth Hardware            │
└─────────────────────────────────┘
</code></pre>
<h3 id="essential-tools"><a class="header" href="#essential-tools">Essential Tools</a></h3>
<h4 id="bluetoothctl"><a class="header" href="#bluetoothctl">bluetoothctl</a></h4>
<p>Interactive command-line tool for managing Bluetooth devices.</p>
<p><strong>Basic Usage:</strong></p>
<pre><code class="language-bash"># Start bluetoothctl
bluetoothctl

# Show controller information
[bluetooth]# show

# Power on the controller
[bluetooth]# power on

# Enable scanning
[bluetooth]# scan on

# List discovered devices
[bluetooth]# devices

# Connect to a device
[bluetooth]# connect AA:BB:CC:DD:EE:FF

# Pair with a device
[bluetooth]# pair AA:BB:CC:DD:EE:FF

# Trust a device (auto-connect)
[bluetooth]# trust AA:BB:CC:DD:EE:FF

# Show device info
[bluetooth]# info AA:BB:CC:DD:EE:FF

# Disconnect
[bluetooth]# disconnect AA:BB:CC:DD:EE:FF

# Remove device
[bluetooth]# remove AA:BB:CC:DD:EE:FF
</code></pre>
<p><strong>GATT Operations:</strong></p>
<pre><code class="language-bash"># List services
[bluetooth]# menu gatt
[bluetooth]# list-attributes AA:BB:CC:DD:EE:FF

# Select a characteristic
[bluetooth]# select-attribute /org/bluez/hci0/dev_AA_BB_CC_DD_EE_FF/service0010/char0011

# Read characteristic
[bluetooth]# read

# Write characteristic
[bluetooth]# write 0x01 0x02 0x03

# Enable notifications
[bluetooth]# notify on
</code></pre>
<h4 id="hcitool"><a class="header" href="#hcitool">hcitool</a></h4>
<p>Low-level tool for HCI operations (deprecated but still useful).</p>
<pre><code class="language-bash"># List Bluetooth controllers
hciconfig

# Scan for BLE devices (requires root)
sudo hcitool lescan

# Scan with RSSI values
sudo hcitool lescan --duplicates

# Get device information
hcitool info AA:BB:CC:DD:EE:FF

# Connection info
hcitool conn
</code></pre>
<h4 id="hciconfig"><a class="header" href="#hciconfig">hciconfig</a></h4>
<p>Configure Bluetooth devices.</p>
<pre><code class="language-bash"># Show all controllers
hciconfig

# Bring interface up
sudo hciconfig hci0 up

# Bring interface down
sudo hciconfig hci0 down

# Reset device
sudo hciconfig hci0 reset

# Change device name
sudo hciconfig hci0 name "MyDevice"

# Enable/disable advertising
sudo hciconfig hci0 leadv 0  # Disable
sudo hciconfig hci0 leadv 3  # Enable non-connectable advertising
</code></pre>
<h4 id="gatttool"><a class="header" href="#gatttool">gatttool</a></h4>
<p>GATT client tool (deprecated in favor of bluetoothctl, but still widely used).</p>
<pre><code class="language-bash"># Interactive mode
gatttool -b AA:BB:CC:DD:EE:FF -I

# Connect
[AA:BB:CC:DD:EE:FF][LE]&gt; connect

# Discover primary services
[AA:BB:CC:DD:EE:FF][LE]&gt; primary

# Discover all characteristics
[AA:BB:CC:DD:EE:FF][LE]&gt; characteristics

# Read characteristic by handle
[AA:BB:CC:DD:EE:FF][LE]&gt; char-read-hnd 0x0011

# Read characteristic by UUID
[AA:BB:CC:DD:EE:FF][LE]&gt; char-read-uuid 00002a00-0000-1000-8000-00805f9b34fb

# Write characteristic
[AA:BB:CC:DD:EE:FF][LE]&gt; char-write-req 0x0011 0102

# Write without response
[AA:BB:CC:DD:EE:FF][LE]&gt; char-write-cmd 0x0011 0102

# Listen for notifications
[AA:BB:CC:DD:EE:FF][LE]&gt; char-write-req 0x0012 0100  # Enable notifications (write 0x0001 to CCCD)
</code></pre>
<p><strong>Non-interactive mode:</strong></p>
<pre><code class="language-bash"># Read characteristic
gatttool -b AA:BB:CC:DD:EE:FF --char-read --handle=0x0011

# Write characteristic
gatttool -b AA:BB:CC:DD:EE:FF --char-write-req --handle=0x0011 --value=0102

# Listen for notifications
gatttool -b AA:BB:CC:DD:EE:FF --char-write-req --handle=0x0012 --value=0100 --listen
</code></pre>
<h4 id="btmon"><a class="header" href="#btmon">btmon</a></h4>
<p>Bluetooth monitor - captures and displays HCI traffic in real-time.</p>
<pre><code class="language-bash"># Monitor all Bluetooth traffic
sudo btmon

# Save to file
sudo btmon -w capture.btsnoop

# Filter by HCI index
sudo btmon -i hci0
</code></pre>
<p><strong>Example Output:</strong></p>
<pre><code>&lt; HCI Command: LE Set Scan Parameters (0x08|0x000b) plen 7
        Type: Passive (0x00)
        Interval: 10.000 msec (0x0010)
        Window: 10.000 msec (0x0010)
        Own address type: Public (0x00)
        Filter policy: Accept all advertisement (0x00)
&gt; HCI Event: Command Complete (0x0e) plen 4
        LE Set Scan Parameters (0x08|0x000b) ncmd 1
        Status: Success (0x00)
</code></pre>
<h4 id="bluetoothd"><a class="header" href="#bluetoothd">bluetoothd</a></h4>
<p>Main Bluetooth daemon.</p>
<pre><code class="language-bash"># Check status
sudo systemctl status bluetooth

# Start/stop/restart
sudo systemctl start bluetooth
sudo systemctl stop bluetooth
sudo systemctl restart bluetooth

# Enable at boot
sudo systemctl enable bluetooth

# Run in foreground with debug
sudo bluetoothd -n -d
</code></pre>
<p><strong>Configuration File:</strong> <code>/etc/bluetooth/main.conf</code></p>
<pre><code class="language-ini">[General]
# Device name
Name = MyDevice

# Discoverable timeout (0 = always discoverable)
DiscoverableTimeout = 0

# Pairable timeout (0 = always pairable)
PairableTimeout = 0

# Privacy (rotate MAC address)
Privacy = device

[Policy]
# Auto-enable controllers
AutoEnable = true

[GATT]
# ATT/GATT cache
Cache = always

# Key size for GATT (7-16)
KeySize = 16
</code></pre>
<h3 id="d-bus-api"><a class="header" href="#d-bus-api">D-Bus API</a></h3>
<p>BlueZ exposes its functionality via D-Bus, allowing programmatic access.</p>
<p><strong>List adapters:</strong></p>
<pre><code class="language-bash">dbus-send --system --print-reply --dest=org.bluez / org.freedesktop.DBus.ObjectManager.GetManagedObjects
</code></pre>
<p><strong>Start discovery:</strong></p>
<pre><code class="language-bash">dbus-send --system --print-reply --dest=org.bluez /org/bluez/hci0 org.bluez.Adapter1.StartDiscovery
</code></pre>
<p><strong>Python example using pydbus:</strong></p>
<pre><code class="language-python">from pydbus import SystemBus

bus = SystemBus()
adapter = bus.get('org.bluez', '/org/bluez/hci0')

# Start scanning
adapter.StartDiscovery()

# Get properties
props = adapter.GetAll('org.bluez.Adapter1')
print(f"Address: {props['Address']}")
print(f"Name: {props['Name']}")
</code></pre>
<hr>
<h2 id="development--programming"><a class="header" href="#development--programming">Development &amp; Programming</a></h2>
<h3 id="python-development"><a class="header" href="#python-development">Python Development</a></h3>
<h4 id="using-bleak-recommended"><a class="header" href="#using-bleak-recommended">Using Bleak (Recommended)</a></h4>
<p>Bleak is a cross-platform Python BLE library.</p>
<p><strong>Installation:</strong></p>
<pre><code class="language-bash">pip install bleak
</code></pre>
<p><strong>Scanning for Devices:</strong></p>
<pre><code class="language-python">import asyncio
from bleak import BleakScanner

async def scan():
    devices = await BleakScanner.discover(timeout=5.0)
    for device in devices:
        print(f"{device.address} - {device.name} - RSSI: {device.rssi}")

asyncio.run(scan())
</code></pre>
<p><strong>Scanning with Callback:</strong></p>
<pre><code class="language-python">import asyncio
from bleak import BleakScanner

def detection_callback(device, advertisement_data):
    print(f"Found: {device.address} - {device.name}")
    print(f"  RSSI: {advertisement_data.rssi}")
    print(f"  Service UUIDs: {advertisement_data.service_uuids}")
    print(f"  Manufacturer Data: {advertisement_data.manufacturer_data}")

async def scan():
    scanner = BleakScanner(detection_callback)
    await scanner.start()
    await asyncio.sleep(5.0)
    await scanner.stop()

asyncio.run(scan())
</code></pre>
<p><strong>Connecting and Reading:</strong></p>
<pre><code class="language-python">import asyncio
from bleak import BleakClient

DEVICE_ADDRESS = "AA:BB:CC:DD:EE:FF"
CHARACTERISTIC_UUID = "00002a00-0000-1000-8000-00805f9b34fb"  # Device Name

async def connect_and_read():
    async with BleakClient(DEVICE_ADDRESS) as client:
        print(f"Connected: {client.is_connected}")

        # Read characteristic
        value = await client.read_gatt_char(CHARACTERISTIC_UUID)
        print(f"Device Name: {value.decode()}")

        # List all services and characteristics
        for service in client.services:
            print(f"Service: {service.uuid}")
            for char in service.characteristics:
                print(f"  Characteristic: {char.uuid}")
                print(f"    Properties: {char.properties}")

asyncio.run(connect_and_read())
</code></pre>
<p><strong>Writing to Characteristic:</strong></p>
<pre><code class="language-python">import asyncio
from bleak import BleakClient

DEVICE_ADDRESS = "AA:BB:CC:DD:EE:FF"
CHAR_UUID = "00002a06-0000-1000-8000-00805f9b34fb"

async def write_data():
    async with BleakClient(DEVICE_ADDRESS) as client:
        # Write with response
        await client.write_gatt_char(CHAR_UUID, b"\x01\x02\x03")

        # Write without response (faster)
        await client.write_gatt_char(CHAR_UUID, b"\x01\x02\x03", response=False)

asyncio.run(write_data())
</code></pre>
<p><strong>Receiving Notifications:</strong></p>
<pre><code class="language-python">import asyncio
from bleak import BleakClient

DEVICE_ADDRESS = "AA:BB:CC:DD:EE:FF"
NOTIFY_CHAR_UUID = "00002a37-0000-1000-8000-00805f9b34fb"  # Heart Rate Measurement

def notification_handler(sender, data):
    """Callback for notifications"""
    print(f"Notification from {sender}: {data.hex()}")

async def receive_notifications():
    async with BleakClient(DEVICE_ADDRESS) as client:
        # Start notifications
        await client.start_notify(NOTIFY_CHAR_UUID, notification_handler)

        # Listen for 30 seconds
        await asyncio.sleep(30.0)

        # Stop notifications
        await client.stop_notify(NOTIFY_CHAR_UUID)

asyncio.run(receive_notifications())
</code></pre>
<p><strong>Complete Example - Heart Rate Monitor:</strong></p>
<pre><code class="language-python">import asyncio
from bleak import BleakClient, BleakScanner

HEART_RATE_SERVICE_UUID = "0000180d-0000-1000-8000-00805f9b34fb"
HEART_RATE_MEASUREMENT_UUID = "00002a37-0000-1000-8000-00805f9b34fb"

def parse_heart_rate(data):
    """Parse heart rate measurement data"""
    flags = data[0]
    hr_format = flags &amp; 0x01

    if hr_format == 0:
        # uint8
        heart_rate = data[1]
    else:
        # uint16
        heart_rate = int.from_bytes(data[1:3], byteorder='little')

    return heart_rate

def notification_handler(sender, data):
    heart_rate = parse_heart_rate(data)
    print(f"Heart Rate: {heart_rate} bpm")

async def main():
    # Find heart rate monitor
    print("Scanning for heart rate monitors...")
    devices = await BleakScanner.discover(
        timeout=5.0,
        service_uuids=[HEART_RATE_SERVICE_UUID]
    )

    if not devices:
        print("No heart rate monitor found")
        return

    device = devices[0]
    print(f"Connecting to {device.name} ({device.address})...")

    async with BleakClient(device.address) as client:
        print("Connected!")

        # Start receiving heart rate notifications
        await client.start_notify(HEART_RATE_MEASUREMENT_UUID, notification_handler)

        print("Monitoring heart rate... (Press Ctrl+C to stop)")
        try:
            while True:
                await asyncio.sleep(1)
        except KeyboardInterrupt:
            print("\nStopping...")

        await client.stop_notify(HEART_RATE_MEASUREMENT_UUID)

asyncio.run(main())
</code></pre>
<h4 id="creating-a-gatt-server-with-bleak"><a class="header" href="#creating-a-gatt-server-with-bleak">Creating a GATT Server with Bleak</a></h4>
<p>Note: Bleak primarily focuses on central/client role. For peripheral/server role on Linux, use BlueZ D-Bus API directly.</p>
<p><strong>Simple GATT Server using D-Bus (Python):</strong></p>
<pre><code class="language-python">#!/usr/bin/env python3
import dbus
import dbus.mainloop.glib
from gi.repository import GLib
from dbus.service import Object, method
import array

# Define UUIDs
SERVICE_UUID = "12345678-1234-5678-1234-56789abcdef0"
CHAR_UUID = "12345678-1234-5678-1234-56789abcdef1"

dbus.mainloop.glib.DBusGMainLoop(set_as_default=True)

class Characteristic(Object):
    def __init__(self, bus, index, uuid, flags, service):
        self.path = service.path + '/char' + str(index)
        self.uuid = uuid
        self.flags = flags
        self.service = service
        self.value = []

        Object.__init__(self, bus, self.path)

    def get_properties(self):
        return {
            'org.bluez.GattCharacteristic1': {
                'Service': self.service.path,
                'UUID': self.uuid,
                'Flags': self.flags
            }
        }

    @method('org.bluez.GattCharacteristic1', out_signature='ay')
    def ReadValue(self, options):
        print('ReadValue called')
        return self.value

    @method('org.bluez.GattCharacteristic1', in_signature='ay')
    def WriteValue(self, value, options):
        print(f'WriteValue called: {bytes(value)}')
        self.value = value

class Service(Object):
    def __init__(self, bus, index, uuid, primary):
        self.path = '/org/bluez/example/service' + str(index)
        self.uuid = uuid
        self.primary = primary
        self.characteristics = []

        Object.__init__(self, bus, self.path)

    def get_properties(self):
        return {
            'org.bluez.GattService1': {
                'UUID': self.uuid,
                'Primary': self.primary,
                'Characteristics': [char.path for char in self.characteristics]
            }
        }

    def add_characteristic(self, char):
        self.characteristics.append(char)

class Application(Object):
    def __init__(self, bus):
        self.path = '/org/bluez/example'
        self.services = []
        Object.__init__(self, bus, self.path)

    @method('org.freedesktop.DBus.ObjectManager', out_signature='a{oa{sa{sv}}}')
    def GetManagedObjects(self):
        response = {}

        for service in self.services:
            response[service.path] = service.get_properties()
            for char in service.characteristics:
                response[char.path] = char.get_properties()

        return response

    def add_service(self, service):
        self.services.append(service)

def main():
    bus = dbus.SystemBus()

    # Create application
    app = Application(bus)

    # Create service
    service = Service(bus, 0, SERVICE_UUID, True)
    app.add_service(service)

    # Create characteristic
    char = Characteristic(bus, 0, CHAR_UUID, ['read', 'write'], service)
    char.value = array.array('B', b'Hello BLE').tolist()
    service.add_characteristic(char)

    # Register application
    adapter = bus.get_object('org.bluez', '/org/bluez/hci0')
    gatt_manager = dbus.Interface(adapter, 'org.bluez.GattManager1')

    gatt_manager.RegisterApplication(app.path, {})
    print('GATT application registered')

    # Start advertising
    # (Advertising setup code omitted for brevity - use BlueZ advertising API)

    mainloop = GLib.MainLoop()
    mainloop.run()

if __name__ == '__main__':
    main()
</code></pre>
<h3 id="cc-development"><a class="header" href="#cc-development">C/C++ Development</a></h3>
<h4 id="using-bluez-c-api"><a class="header" href="#using-bluez-c-api">Using BlueZ C API</a></h4>
<p><strong>Basic Scanner (C):</strong></p>
<pre><code class="language-c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;bluetooth/bluetooth.h&gt;
#include &lt;bluetooth/hci.h&gt;
#include &lt;bluetooth/hci_lib.h&gt;

int main(int argc, char **argv) {
    int dev_id, sock, len, flags;
    int i, num_rsp;
    char addr[19] = {0};
    char name[248] = {0};
    inquiry_info *info = NULL;

    // Get default Bluetooth adapter
    dev_id = hci_get_route(NULL);
    if (dev_id &lt; 0) {
        perror("No Bluetooth adapter found");
        exit(1);
    }

    // Open HCI socket
    sock = hci_open_dev(dev_id);
    if (sock &lt; 0) {
        perror("Failed to open HCI socket");
        exit(1);
    }

    // Perform inquiry
    len = 8;  // Inquiry length (1.28 * len seconds)
    num_rsp = 255;  // Max number of responses
    flags = IREQ_CACHE_FLUSH;

    info = (inquiry_info*)malloc(num_rsp * sizeof(inquiry_info));

    printf("Scanning for devices...\n");
    num_rsp = hci_inquiry(dev_id, len, num_rsp, NULL, &amp;info, flags);
    if (num_rsp &lt; 0) {
        perror("Inquiry failed");
        exit(1);
    }

    printf("Found %d device(s)\n", num_rsp);

    // Get device info
    for (i = 0; i &lt; num_rsp; i++) {
        ba2str(&amp;(info + i)-&gt;bdaddr, addr);
        memset(name, 0, sizeof(name));

        if (hci_read_remote_name(sock, &amp;(info + i)-&gt;bdaddr, sizeof(name), name, 0) &lt; 0)
            strcpy(name, "[unknown]");

        printf("%s  %s\n", addr, name);
    }

    free(info);
    close(sock);

    return 0;
}
</code></pre>
<p><strong>Compile:</strong></p>
<pre><code class="language-bash">gcc -o scanner scanner.c -lbluetooth
</code></pre>
<p><strong>BLE Scanner (C):</strong></p>
<pre><code class="language-c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/ioctl.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;bluetooth/bluetooth.h&gt;
#include &lt;bluetooth/hci.h&gt;
#include &lt;bluetooth/hci_lib.h&gt;

int main() {
    int dev_id, sock;
    uint8_t scan_type = 0x01;  // Active scanning
    uint16_t interval = htobs(0x0010);  // 10ms
    uint16_t window = htobs(0x0010);    // 10ms
    uint8_t own_type = 0x00;  // Public address
    uint8_t filter_policy = 0x00;  // Accept all

    // Get default adapter
    dev_id = hci_get_route(NULL);
    if (dev_id &lt; 0) {
        perror("No adapter found");
        return 1;
    }

    // Open HCI socket
    sock = hci_open_dev(dev_id);
    if (sock &lt; 0) {
        perror("Could not open device");
        return 1;
    }

    // Set scan parameters
    if (hci_le_set_scan_parameters(sock, scan_type, interval, window,
                                   own_type, filter_policy, 1000) &lt; 0) {
        perror("Set scan parameters failed");
        return 1;
    }

    // Enable scanning
    if (hci_le_set_scan_enable(sock, 0x01, 1, 1000) &lt; 0) {
        perror("Enable scan failed");
        return 1;
    }

    printf("Scanning for BLE devices...\n");
    sleep(10);

    // Disable scanning
    hci_le_set_scan_enable(sock, 0x00, 1, 1000);

    hci_close_dev(sock);
    return 0;
}
</code></pre>
<hr>
<h2 id="security--pairing"><a class="header" href="#security--pairing">Security &amp; Pairing</a></h2>
<h3 id="ble-security-levels"><a class="header" href="#ble-security-levels">BLE Security Levels</a></h3>
<p>BLE supports four security levels:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Level</th><th>Encryption</th><th>Authentication</th><th>Name</th></tr>
</thead>
<tbody>
<tr><td><strong>Level 1</strong></td><td>No</td><td>No</td><td>No Security</td></tr>
<tr><td><strong>Level 2</strong></td><td>Yes</td><td>No</td><td>Unauthenticated pairing with encryption</td></tr>
<tr><td><strong>Level 3</strong></td><td>Yes</td><td>Yes</td><td>Authenticated pairing with encryption</td></tr>
<tr><td><strong>Level 4</strong></td><td>Yes</td><td>Yes</td><td>LE Secure Connections (BLE 4.2+)</td></tr>
</tbody>
</table>
</div>
<h3 id="security-modes"><a class="header" href="#security-modes">Security Modes</a></h3>
<p><strong>Security Mode 1:</strong></p>
<ul>
<li>Level 1: No security (no encryption, no authentication)</li>
<li>Level 2: Unauthenticated pairing with encryption</li>
<li>Level 3: Authenticated pairing with encryption</li>
<li>Level 4: LE Secure Connections with 128-bit strength</li>
</ul>
<p><strong>Security Mode 2:</strong></p>
<ul>
<li>Data signing (authentication without encryption)</li>
<li>Less commonly used</li>
</ul>
<h3 id="pairing-methods"><a class="header" href="#pairing-methods">Pairing Methods</a></h3>
<h4 id="1-just-works"><a class="header" href="#1-just-works">1. Just Works</a></h4>
<ul>
<li>No user interaction required</li>
<li>No MITM (Man-in-the-Middle) protection</li>
<li>Used when neither device has display or keyboard</li>
<li><strong>Security</strong>: Vulnerable to passive eavesdropping and MITM attacks</li>
</ul>
<p><strong>Process:</strong></p>
<pre><code>Device A          Device B
   |                  |
   |--- Pairing Req -&gt;|
   |&lt;-- Pairing Rsp --|
   |                  |
   | (Exchange random values)
   |                  |
   |&lt;-- Encrypted --&gt;|
</code></pre>
<h4 id="2-passkey-entry"><a class="header" href="#2-passkey-entry">2. Passkey Entry</a></h4>
<ul>
<li>User enters same 6-digit PIN on both devices</li>
<li>MITM protection</li>
<li>Requires at least one device with keyboard/display</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Display + Keyboard: User sees PIN on one, enters on other</li>
<li>Keyboard + Keyboard: User enters same PIN on both</li>
<li>Display + Display: Devices show same PIN, user confirms</li>
</ul>
<p><strong>Process:</strong></p>
<ol>
<li>Devices exchange capabilities</li>
<li>One device displays 6-digit passkey</li>
<li>User enters passkey on other device</li>
<li>Devices verify and establish encrypted connection</li>
</ol>
<h4 id="3-numeric-comparison-le-secure-connections"><a class="header" href="#3-numeric-comparison-le-secure-connections">3. Numeric Comparison (LE Secure Connections)</a></h4>
<ul>
<li>Both devices display 6-digit number</li>
<li>User confirms if numbers match</li>
<li>MITM protection</li>
<li>Requires both devices to have displays</li>
</ul>
<h4 id="4-out-of-band-oob"><a class="header" href="#4-out-of-band-oob">4. Out of Band (OOB)</a></h4>
<ul>
<li>Pairing data exchanged via alternative channel (NFC, QR code, etc.)</li>
<li>Highest security</li>
<li>Requires additional hardware/technology</li>
</ul>
<p><strong>Example:</strong> Scan QR code to get pairing information</p>
<h3 id="bonding"><a class="header" href="#bonding">Bonding</a></h3>
<p><strong>Bonding</strong> is the process of storing pairing information for future reconnections.</p>
<p><strong>Bonded Information:</strong></p>
<ul>
<li>Long Term Key (LTK)</li>
<li>Identity Resolving Key (IRK)</li>
<li>Connection Signature Resolving Key (CSRK)</li>
<li>Device addresses</li>
</ul>
<p><strong>BlueZ Bonding:</strong></p>
<pre><code class="language-bash">bluetoothctl

# Trust device (allows auto-reconnect)
[bluetooth]# trust AA:BB:CC:DD:EE:FF

# List paired devices
[bluetooth]# paired-devices

# Remove bonding
[bluetooth]# remove AA:BB:CC:DD:EE:FF
</code></pre>
<h3 id="privacy-features"><a class="header" href="#privacy-features">Privacy Features</a></h3>
<h4 id="address-resolution"><a class="header" href="#address-resolution">Address Resolution</a></h4>
<p>BLE supports private addresses that change periodically to prevent tracking.</p>
<p><strong>Address Types:</strong></p>
<ol>
<li><strong>Public</strong>: Fixed, similar to MAC address</li>
<li><strong>Random Static</strong>: Random but doesn’t change</li>
<li><strong>Private Resolvable</strong>: Changes periodically, can be resolved by bonded devices</li>
<li><strong>Private Non-Resolvable</strong>: Changes periodically, cannot be resolved</li>
</ol>
<p><strong>Enable Privacy in BlueZ:</strong>
Edit <code>/etc/bluetooth/main.conf</code>:</p>
<pre><code class="language-ini">[General]
Privacy = device
</code></pre>
<h4 id="le-secure-connections-ble-42"><a class="header" href="#le-secure-connections-ble-42">LE Secure Connections (BLE 4.2+)</a></h4>
<p>Improvements over legacy pairing:</p>
<ul>
<li>ECDH (Elliptic Curve Diffie-Hellman) key exchange</li>
<li>Stronger MITM protection</li>
<li>Numeric Comparison pairing method</li>
<li>Mandatory for Security Level 4</li>
</ul>
<h3 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h3>
<ol>
<li><strong>Always Use Encryption</strong>: Require Security Level 2 or higher for sensitive data</li>
<li><strong>Implement Bonding</strong>: Store keys for trusted devices</li>
<li><strong>Use LE Secure Connections</strong>: When both devices support BLE 4.2+</li>
<li><strong>Implement Application-Level Security</strong>: Don’t rely solely on BLE security
<ul>
<li>Use TLS/DTLS for critical data</li>
<li>Implement authentication tokens</li>
</ul>
</li>
<li><strong>Validate Data</strong>: Always validate received data</li>
<li><strong>Use Appropriate Pairing Method</strong>:
<ul>
<li>Just Works: Only for non-sensitive applications</li>
<li>Passkey Entry or Numeric Comparison: For sensitive applications</li>
</ul>
</li>
<li><strong>Enable Privacy</strong>: Use resolvable private addresses to prevent tracking</li>
<li><strong>Update Firmware</strong>: Keep BLE devices updated to patch vulnerabilities</li>
<li><strong>Implement Timeouts</strong>: Disconnect idle connections</li>
<li><strong>Limit Permissions</strong>: Only allow necessary operations (read vs write)</li>
</ol>
<p><strong>Setting Permissions in GATT Characteristic:</strong></p>
<pre><code class="language-python"># Example characteristic permissions
permissions = [
    'read',           # Allow read
    'write',          # Allow write (requires response)
    'encrypt-read',   # Require encryption for read
    'encrypt-write',  # Require encryption for write
    'secure-read',    # Require authenticated encryption
    'secure-write',   # Require authenticated encryption
]
</code></pre>
<hr>
<h2 id="practical-examples"><a class="header" href="#practical-examples">Practical Examples</a></h2>
<h3 id="example-1-ble-thermometer-reader"><a class="header" href="#example-1-ble-thermometer-reader">Example 1: BLE Thermometer Reader</a></h3>
<pre><code class="language-python">#!/usr/bin/env python3
"""
Read temperature from a BLE thermometer
Assumes Health Thermometer Service (0x1809)
"""
import asyncio
import struct
from bleak import BleakClient, BleakScanner

HEALTH_THERMOMETER_SERVICE = "00001809-0000-1000-8000-00805f9b34fb"
TEMPERATURE_MEASUREMENT_CHAR = "00002a1c-0000-1000-8000-00805f9b34fb"

def parse_temperature(data):
    """Parse temperature measurement characteristic"""
    flags = data[0]

    # Check if Fahrenheit (bit 0)
    unit = "°F" if flags &amp; 0x01 else "°C"

    # Temperature is IEEE-11073 32-bit float
    temp_bytes = data[1:5]

    # IEEE-11073 format: mantissa (24-bit) + exponent (8-bit)
    mantissa = int.from_bytes(temp_bytes[0:3], byteorder='little', signed=True)
    exponent = struct.unpack('b', bytes([temp_bytes[3]]))[0]  # signed 8-bit

    temperature = mantissa * (10 ** exponent)

    return temperature, unit

def notification_handler(sender, data):
    temp, unit = parse_temperature(data)
    print(f"Temperature: {temp:.1f} {unit}")

async def main():
    print("Scanning for thermometers...")

    devices = await BleakScanner.discover(
        timeout=5.0,
        service_uuids=[HEALTH_THERMOMETER_SERVICE]
    )

    if not devices:
        print("No thermometer found")
        return

    device = devices[0]
    print(f"Found thermometer: {device.name} ({device.address})")

    async with BleakClient(device.address) as client:
        print("Connected! Waiting for temperature measurements...")

        await client.start_notify(TEMPERATURE_MEASUREMENT_CHAR, notification_handler)

        # Listen for 60 seconds
        await asyncio.sleep(60)

        await client.stop_notify(TEMPERATURE_MEASUREMENT_CHAR)

if __name__ == "__main__":
    asyncio.run(main())
</code></pre>
<h3 id="example-2-ibeacon-scanner"><a class="header" href="#example-2-ibeacon-scanner">Example 2: iBeacon Scanner</a></h3>
<pre><code class="language-python">#!/usr/bin/env python3
"""
Scan for iBeacons and parse their data
"""
import asyncio
from bleak import BleakScanner

def parse_ibeacon(manufacturer_data):
    """Parse iBeacon advertisement data"""
    # iBeacon: Company ID (0x004C = Apple) + iBeacon prefix (0x02 0x15)
    for company_id, data in manufacturer_data.items():
        if company_id == 0x004C and len(data) &gt;= 23:
            if data[0:2] == bytes([0x02, 0x15]):
                # iBeacon format:
                # 0-15: UUID (16 bytes)
                # 16-17: Major (2 bytes)
                # 18-19: Minor (2 bytes)
                # 20: TX Power (1 byte, signed)

                uuid = data[2:18].hex()
                uuid_formatted = f"{uuid[0:8]}-{uuid[8:12]}-{uuid[12:16]}-{uuid[16:20]}-{uuid[20:32]}"
                major = int.from_bytes(data[18:20], byteorder='big')
                minor = int.from_bytes(data[20:22], byteorder='big')
                tx_power = struct.unpack('b', bytes([data[22]]))[0]

                return {
                    'uuid': uuid_formatted,
                    'major': major,
                    'minor': minor,
                    'tx_power': tx_power
                }
    return None

def detection_callback(device, advertisement_data):
    beacon_data = parse_ibeacon(advertisement_data.manufacturer_data)

    if beacon_data:
        print(f"\niBeacon detected:")
        print(f"  Address: {device.address}")
        print(f"  UUID: {beacon_data['uuid']}")
        print(f"  Major: {beacon_data['major']}")
        print(f"  Minor: {beacon_data['minor']}")
        print(f"  TX Power: {beacon_data['tx_power']} dBm")
        print(f"  RSSI: {advertisement_data.rssi} dBm")

        # Estimate distance (very rough)
        if advertisement_data.rssi:
            ratio = advertisement_data.rssi / beacon_data['tx_power']
            if ratio &lt; 1.0:
                distance = ratio ** 10
            else:
                distance = (0.89976) * (ratio ** 7.7095) + 0.111
            print(f"  Estimated distance: {distance:.2f} m")

async def main():
    print("Scanning for iBeacons... (Press Ctrl+C to stop)")

    scanner = BleakScanner(detection_callback)
    await scanner.start()

    try:
        while True:
            await asyncio.sleep(1)
    except KeyboardInterrupt:
        print("\nStopping scan...")

    await scanner.stop()

if __name__ == "__main__":
    import struct
    asyncio.run(main())
</code></pre>
<h3 id="example-3-nordic-uart-service-nus"><a class="header" href="#example-3-nordic-uart-service-nus">Example 3: Nordic UART Service (NUS)</a></h3>
<p>Nordic UART Service provides simple serial-like communication over BLE.</p>
<pre><code class="language-python">#!/usr/bin/env python3
"""
Nordic UART Service (NUS) example
Allows bidirectional serial communication over BLE
"""
import asyncio
from bleak import BleakClient, BleakScanner

# Nordic UART Service UUIDs
NUS_SERVICE_UUID = "6e400001-b5a3-f393-e0a9-e50e24dcca9e"
NUS_RX_CHAR_UUID = "6e400002-b5a3-f393-e0a9-e50e24dcca9e"  # Write to this
NUS_TX_CHAR_UUID = "6e400003-b5a3-f393-e0a9-e50e24dcca9e"  # Receive from this

def notification_handler(sender, data):
    """Handle incoming data"""
    try:
        message = data.decode('utf-8')
        print(f"Received: {message}")
    except:
        print(f"Received (hex): {data.hex()}")

async def main():
    print("Scanning for devices with Nordic UART Service...")

    devices = await BleakScanner.discover(
        timeout=5.0,
        service_uuids=[NUS_SERVICE_UUID]
    )

    if not devices:
        print("No device with NUS found")
        return

    device = devices[0]
    print(f"Connecting to {device.name} ({device.address})...")

    async with BleakClient(device.address) as client:
        print("Connected!")

        # Enable notifications for RX
        await client.start_notify(NUS_TX_CHAR_UUID, notification_handler)

        # Send data
        message = "Hello from Python!\n"
        await client.write_gatt_char(NUS_RX_CHAR_UUID, message.encode('utf-8'))
        print(f"Sent: {message}")

        # Listen for responses
        await asyncio.sleep(10)

        await client.stop_notify(NUS_TX_CHAR_UUID)

if __name__ == "__main__":
    asyncio.run(main())
</code></pre>
<h3 id="example-4-battery-level-monitor"><a class="header" href="#example-4-battery-level-monitor">Example 4: Battery Level Monitor</a></h3>
<pre><code class="language-python">#!/usr/bin/env python3
"""
Monitor battery level from BLE device
"""
import asyncio
from bleak import BleakClient

BATTERY_SERVICE_UUID = "0000180f-0000-1000-8000-00805f9b34fb"
BATTERY_LEVEL_CHAR_UUID = "00002a19-0000-1000-8000-00805f9b34fb"

async def read_battery(address):
    async with BleakClient(address) as client:
        # Check if battery service exists
        services = client.services

        battery_service = services.get_service(BATTERY_SERVICE_UUID)
        if not battery_service:
            print("Device does not have Battery Service")
            return

        # Read battery level
        battery_level = await client.read_gatt_char(BATTERY_LEVEL_CHAR_UUID)
        level = int.from_bytes(battery_level, byteorder='little')

        print(f"Battery Level: {level}%")

        # Check if notifications are supported
        char = battery_service.get_characteristic(BATTERY_LEVEL_CHAR_UUID)
        if 'notify' in char.properties:
            print("Battery notifications supported")

            def battery_notification_handler(sender, data):
                level = int.from_bytes(data, byteorder='little')
                print(f"Battery Level Updated: {level}%")

            await client.start_notify(BATTERY_LEVEL_CHAR_UUID, battery_notification_handler)
            print("Listening for battery updates... (30 seconds)")
            await asyncio.sleep(30)
            await client.stop_notify(BATTERY_LEVEL_CHAR_UUID)

if __name__ == "__main__":
    import sys

    if len(sys.argv) &lt; 2:
        print("Usage: python battery_monitor.py &lt;device_address&gt;")
        sys.exit(1)

    address = sys.argv[1]
    asyncio.run(read_battery(address))
</code></pre>
<hr>
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<h3 id="common-issues"><a class="header" href="#common-issues">Common Issues</a></h3>
<h4 id="1-device-not-found-during-scanning"><a class="header" href="#1-device-not-found-during-scanning">1. Device Not Found During Scanning</a></h4>
<p><strong>Symptoms:</strong> <code>hcitool lescan</code> or BleakScanner returns no devices</p>
<p><strong>Possible Causes &amp; Solutions:</strong></p>
<ul>
<li>
<p><strong>Bluetooth is off:</strong></p>
<pre><code class="language-bash">sudo hciconfig hci0 up
# or
bluetoothctl power on
</code></pre>
</li>
<li>
<p><strong>Insufficient permissions:</strong></p>
<pre><code class="language-bash"># Run with sudo
sudo hcitool lescan

# Or add capabilities to Python
sudo setcap cap_net_raw,cap_net_admin+eip $(which python3)
</code></pre>
</li>
<li>
<p><strong>Device is not advertising:</strong></p>
<ul>
<li>Check if device is in pairing/discoverable mode</li>
<li>Verify device battery level</li>
<li>Check device is within range</li>
</ul>
</li>
<li>
<p><strong>RF interference:</strong></p>
<ul>
<li>Move away from WiFi routers, microwaves</li>
<li>Try different physical location</li>
<li>Check for other Bluetooth devices</li>
</ul>
</li>
</ul>
<h4 id="2-connection-failures"><a class="header" href="#2-connection-failures">2. Connection Failures</a></h4>
<p><strong>Symptoms:</strong> Cannot establish connection to device</p>
<p><strong>Solutions:</strong></p>
<ul>
<li>
<p><strong>Reset Bluetooth adapter:</strong></p>
<pre><code class="language-bash">sudo hciconfig hci0 reset
sudo systemctl restart bluetooth
</code></pre>
</li>
<li>
<p><strong>Remove old pairing:</strong></p>
<pre><code class="language-bash">bluetoothctl remove AA:BB:CC:DD:EE:FF
</code></pre>
</li>
<li>
<p><strong>Check connection parameters:</strong></p>
<ul>
<li>Some devices require specific connection intervals</li>
<li>Try increasing supervision timeout</li>
</ul>
</li>
<li>
<p><strong>Verify device is connectable:</strong></p>
<ul>
<li>Some beacons only advertise, don’t accept connections</li>
</ul>
</li>
</ul>
<h4 id="3-gatt-operations-fail"><a class="header" href="#3-gatt-operations-fail">3. GATT Operations Fail</a></h4>
<p><strong>Symptoms:</strong> Cannot read/write characteristics</p>
<p><strong>Solutions:</strong></p>
<ul>
<li>
<p><strong>Check permissions:</strong></p>
<pre><code class="language-bash"># In bluetoothctl, check characteristic flags
bluetoothctl
[bluetooth]# menu gatt
[bluetooth]# list-attributes &lt;device&gt;
</code></pre>
</li>
<li>
<p><strong>Enable notifications on CCCD:</strong></p>
<pre><code class="language-python"># For notifications, ensure CCCD is written
CCCD_UUID = "00002902-0000-1000-8000-00805f9b34fb"
await client.write_gatt_char(CCCD_UUID, b"\x01\x00")
</code></pre>
</li>
<li>
<p><strong>Increase MTU:</strong></p>
<pre><code class="language-python"># Request larger MTU for better throughput
await client.exchange_mtu(512)
</code></pre>
</li>
</ul>
<h4 id="4-pairing-issues"><a class="header" href="#4-pairing-issues">4. Pairing Issues</a></h4>
<p><strong>Symptoms:</strong> Pairing fails or doesn’t complete</p>
<p><strong>Solutions:</strong></p>
<ul>
<li>
<p><strong>Use bluetoothctl for pairing:</strong></p>
<pre><code class="language-bash">bluetoothctl
[bluetooth]# agent on
[bluetooth]# default-agent
[bluetooth]# pair AA:BB:CC:DD:EE:FF
</code></pre>
</li>
<li>
<p><strong>Check agent is running:</strong></p>
<pre><code class="language-bash"># Ensure bluetooth-agent or bluetoothctl agent is active
ps aux | grep agent
</code></pre>
</li>
<li>
<p><strong>Clear previous pairing:</strong></p>
<pre><code class="language-bash">bluetoothctl remove AA:BB:CC:DD:EE:FF
# Then pair again
</code></pre>
</li>
</ul>
<h4 id="5-disconnections"><a class="header" href="#5-disconnections">5. Disconnections</a></h4>
<p><strong>Symptoms:</strong> Device disconnects frequently</p>
<p><strong>Solutions:</strong></p>
<ul>
<li>
<p><strong>Check signal strength:</strong></p>
<pre><code class="language-bash"># In bluetoothctl
[bluetooth]# info AA:BB:CC:DD:EE:FF
# Look for RSSI value
</code></pre>
</li>
<li>
<p><strong>Adjust connection parameters:</strong></p>
<ul>
<li>Increase supervision timeout</li>
<li>Reduce connection interval</li>
<li>Some devices need specific parameters</li>
</ul>
</li>
<li>
<p><strong>Check for interference:</strong></p>
<ul>
<li>Verify no physical obstructions</li>
<li>Check for WiFi on same 2.4 GHz band</li>
<li>Try different channels</li>
</ul>
</li>
<li>
<p><strong>Update firmware:</strong></p>
<ul>
<li>Check for Bluetooth adapter firmware updates</li>
<li>Update device firmware</li>
</ul>
</li>
</ul>
<h4 id="6-high-latency"><a class="header" href="#6-high-latency">6. High Latency</a></h4>
<p><strong>Symptoms:</strong> Slow response to commands</p>
<p><strong>Solutions:</strong></p>
<ul>
<li>
<p><strong>Reduce connection interval:</strong></p>
<ul>
<li>Shorter interval = lower latency, higher power</li>
<li>Some devices allow negotiating connection parameters</li>
</ul>
</li>
<li>
<p><strong>Use write without response:</strong></p>
<pre><code class="language-python">await client.write_gatt_char(uuid, data, response=False)
</code></pre>
</li>
<li>
<p><strong>Increase MTU:</strong></p>
<pre><code class="language-python">await client.exchange_mtu(512)
</code></pre>
</li>
</ul>
<h3 id="debugging-tools"><a class="header" href="#debugging-tools">Debugging Tools</a></h3>
<h4 id="btmon---packet-capture"><a class="header" href="#btmon---packet-capture">btmon - Packet Capture</a></h4>
<pre><code class="language-bash"># Capture all Bluetooth traffic
sudo btmon

# Save to file for analysis
sudo btmon -w capture.btsnoop

# Analyze with Wireshark
wireshark capture.btsnoop
</code></pre>
<h4 id="hcidump"><a class="header" href="#hcidump">hcidump</a></h4>
<pre><code class="language-bash"># Dump HCI data
sudo hcidump -X
</code></pre>
<h4 id="check-bluez-version"><a class="header" href="#check-bluez-version">Check BlueZ Version</a></h4>
<pre><code class="language-bash">bluetoothctl --version
</code></pre>
<h4 id="check-kernel-module"><a class="header" href="#check-kernel-module">Check Kernel Module</a></h4>
<pre><code class="language-bash"># Check if Bluetooth modules loaded
lsmod | grep bluetooth

# Reload modules
sudo modprobe -r btusb
sudo modprobe btusb
</code></pre>
<h4 id="dmesg-logs"><a class="header" href="#dmesg-logs">dmesg Logs</a></h4>
<pre><code class="language-bash"># Check for Bluetooth errors
dmesg | grep -i bluetooth
</code></pre>
<h3 id="performance-optimization"><a class="header" href="#performance-optimization">Performance Optimization</a></h3>
<h4 id="maximize-throughput"><a class="header" href="#maximize-throughput">Maximize Throughput</a></h4>
<ol>
<li>
<p><strong>Use largest MTU possible:</strong></p>
<pre><code class="language-python">await client.exchange_mtu(512)
</code></pre>
</li>
<li>
<p><strong>Use write without response:</strong></p>
<pre><code class="language-python">await client.write_gatt_char(uuid, data, response=False)
</code></pre>
</li>
<li>
<p><strong>Minimize connection interval:</strong></p>
<ul>
<li>Negotiate shortest interval device supports</li>
<li>Typically 7.5ms minimum</li>
</ul>
</li>
<li>
<p><strong>Use BLE 5.0 2M PHY (if supported):</strong></p>
<ul>
<li>Doubles data rate to 2 Mbps</li>
<li>Requires BLE 5.0 hardware on both sides</li>
</ul>
</li>
</ol>
<h4 id="minimize-power-consumption"><a class="header" href="#minimize-power-consumption">Minimize Power Consumption</a></h4>
<ol>
<li>
<p><strong>Increase connection interval:</strong></p>
<ul>
<li>Longer interval = less power</li>
<li>Trade-off with latency</li>
</ul>
</li>
<li>
<p><strong>Use slave latency:</strong></p>
<ul>
<li>Allows peripheral to skip connection events</li>
<li>Peripheral can sleep more</li>
</ul>
</li>
<li>
<p><strong>Reduce advertising frequency:</strong></p>
<ul>
<li>Longer advertising interval</li>
<li>Only advertise when needed</li>
</ul>
</li>
<li>
<p><strong>Use non-connectable advertising:</strong></p>
<ul>
<li>For broadcast-only applications (beacons)</li>
</ul>
</li>
</ol>
<hr>
<h2 id="references"><a class="header" href="#references">References</a></h2>
<h3 id="official-specifications"><a class="header" href="#official-specifications">Official Specifications</a></h3>
<ul>
<li><a href="https://www.bluetooth.com/specifications/bluetooth-core-specification/">Bluetooth Core Specification</a></li>
<li><a href="https://www.bluetooth.com/specifications/specs/gatt-specification-supplement/">GATT Specifications</a></li>
<li><a href="https://www.bluetooth.com/specifications/assigned-numbers/">Assigned Numbers (UUIDs, Company IDs)</a></li>
</ul>
<h3 id="bluez-documentation"><a class="header" href="#bluez-documentation">BlueZ Documentation</a></h3>
<ul>
<li><a href="http://www.bluez.org/">BlueZ Official Site</a></li>
<li><a href="https://github.com/bluez/bluez">BlueZ Git Repository</a></li>
<li><a href="https://git.kernel.org/pub/scm/bluetooth/bluez.git/tree/doc">BlueZ D-Bus API</a></li>
</ul>
<h3 id="tools--libraries"><a class="header" href="#tools--libraries">Tools &amp; Libraries</a></h3>
<ul>
<li><a href="https://github.com/hbldh/bleak">Bleak (Python)</a></li>
<li><a href="https://github.com/pybluez/pybluez">PyBluez (Python)</a></li>
<li><a href="https://github.com/abandonware/noble">noble (Node.js)</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Bluetooth_API">Web Bluetooth API</a></li>
</ul>
<h3 id="learning-resources"><a class="header" href="#learning-resources">Learning Resources</a></h3>
<ul>
<li><a href="https://www.bluetooth.com/blog/bluetooth-low-energy-the-developers-handbook/">Bluetooth Low Energy: The Developer’s Handbook</a></li>
<li><a href="https://learn.adafruit.com/introduction-to-bluetooth-low-energy/introduction">Introduction to BLE</a></li>
<li><a href="https://devzone.nordicsemi.com/">Nordic Semiconductor Developer Zone</a></li>
</ul>
<h3 id="related-topics"><a class="header" href="#related-topics">Related Topics</a></h3>
<ul>
<li><a href="./bluetooth.html">Bluetooth Classic</a></li>
<li><a href="../linux/networking.html">Linux Networking</a></li>
<li><a href="./iot.html">IoT Protocols</a></li>
<li><a href="./wireless.html">Wireless Communication</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../misc/blockchain.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../misc/operating_systems.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../misc/blockchain.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../misc/operating_systems.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-c2a407aa.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>

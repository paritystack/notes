<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Eap - My Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-ae938929.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex-4bbf961e.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-e85e57c5.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">My Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="eap-extensible-authentication-protocol"><a class="header" href="#eap-extensible-authentication-protocol">EAP (Extensible Authentication Protocol)</a></h1>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p><strong>EAP (Extensible Authentication Protocol)</strong> is an authentication framework, not a specific authentication mechanism. Defined in RFC 3748, EAP provides a flexible framework that supports multiple authentication methods, allowing networks to choose the most appropriate authentication mechanism for their security requirements.</p>
<h3 id="purpose-and-history"><a class="header" href="#purpose-and-history">Purpose and History</a></h3>
<ul>
<li><strong>Created</strong>: Originally designed for PPP (Point-to-Point Protocol) authentication</li>
<li><strong>Evolution</strong>: Extended to support 802.1X port-based network access control</li>
<li><strong>Primary Use</strong>: WiFi WPA2/WPA3-Enterprise authentication (see <a href="security.html">security.md</a>)</li>
<li><strong>Flexibility</strong>: Allows new authentication methods without changing the underlying framework</li>
</ul>
<h3 id="why-eap-exists"><a class="header" href="#why-eap-exists">Why EAP Exists</a></h3>
<p>Traditional authentication protocols were rigid and method-specific. EAP solves this by:</p>
<ol>
<li><strong>Method Independence</strong>: Separates authentication framework from specific methods</li>
<li><strong>Extensibility</strong>: New methods can be added without protocol changes</li>
<li><strong>Transport Independence</strong>: Works over various link layers (LAN, PPP, etc.)</li>
<li><strong>Centralized Authentication</strong>: Enables RADIUS/AAA server integration</li>
</ol>
<h3 id="key-use-cases"><a class="header" href="#key-use-cases">Key Use Cases</a></h3>
<ul>
<li><strong>WiFi Enterprise Networks</strong>: WPA2/WPA3-Enterprise with 802.1X</li>
<li><strong>Network Access Control</strong>: Port-based authentication (802.1X)</li>
<li><strong>VPN Authentication</strong>: Some VPN solutions use EAP</li>
<li><strong>Cellular Networks</strong>: EAP-SIM and EAP-AKA for mobile authentication</li>
</ul>
<hr>
<h2 id="eap-framework-architecture"><a class="header" href="#eap-framework-architecture">EAP Framework Architecture</a></h2>
<p>EAP operates in a three-party model:</p>
<pre><code class="language-mermaid">graph LR
    A[Peer&lt;br/&gt;Supplicant] &lt;--&gt; B[Authenticator&lt;br/&gt;NAS]
    B &lt;--&gt; C[Authentication&lt;br/&gt;Server]

    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#e8f5e9
</code></pre>
<h3 id="three-party-model"><a class="header" href="#three-party-model">Three-Party Model</a></h3>
<ol>
<li>
<p><strong>Peer (Supplicant)</strong></p>
<ul>
<li>Device requesting network access (laptop, phone, IoT device)</li>
<li>Runs EAP supplicant software (e.g., wpa_supplicant)</li>
<li>Responds to authentication challenges</li>
</ul>
</li>
<li>
<p><strong>Authenticator (NAS - Network Access Server)</strong></p>
<ul>
<li>Network device controlling access (WiFi AP, switch, VPN gateway)</li>
<li>Passes EAP messages between peer and server</li>
<li>Enforces port-based access control</li>
<li>Does NOT make authentication decisions</li>
</ul>
</li>
<li>
<p><strong>Authentication Server</strong></p>
<ul>
<li>Makes authentication decisions (typically RADIUS server)</li>
<li>Stores credentials and policies</li>
<li>Runs EAP method implementations</li>
<li>Issues Access-Accept or Access-Reject</li>
</ul>
</li>
</ol>
<h3 id="architecture-principles"><a class="header" href="#architecture-principles">Architecture Principles</a></h3>
<ul>
<li><strong>Pass-through</strong>: Authenticator relays EAP messages without interpretation</li>
<li><strong>Method Negotiation</strong>: Peer and server agree on authentication method</li>
<li><strong>Backend Protocol</strong>: RADIUS carries EAP between authenticator and server</li>
<li><strong>Key Derivation</strong>: Successful auth generates session keys (MSK, EMSK)</li>
</ul>
<hr>
<h2 id="eap-packet-format"><a class="header" href="#eap-packet-format">EAP Packet Format</a></h2>
<p>EAP packets have a simple, consistent structure:</p>
<pre><code> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Code      |  Identifier   |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |  Type-Data ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</code></pre>
<h3 id="field-descriptions"><a class="header" href="#field-descriptions">Field Descriptions</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Field</th><th>Size</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><strong>Code</strong></td><td>1 byte</td><td>Message type (1=Request, 2=Response, 3=Success, 4=Failure)</td></tr>
<tr><td><strong>Identifier</strong></td><td>1 byte</td><td>Matches requests with responses (0-255, wraps around)</td></tr>
<tr><td><strong>Length</strong></td><td>2 bytes</td><td>Total packet length including header (big-endian)</td></tr>
<tr><td><strong>Type</strong></td><td>1 byte</td><td>EAP method type (only in Request/Response packets)</td></tr>
<tr><td><strong>Type-Data</strong></td><td>Variable</td><td>Method-specific data (format depends on Type field)</td></tr>
</tbody>
</table>
</div>
<h3 id="eap-code-values"><a class="header" href="#eap-code-values">EAP Code Values</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Code</th><th>Name</th><th>Direction</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>1</td><td>Request</td><td>Server → Peer</td><td>Authentication challenge or request</td></tr>
<tr><td>2</td><td>Response</td><td>Peer → Server</td><td>Response to authentication request</td></tr>
<tr><td>3</td><td>Success</td><td>Server → Peer</td><td>Authentication successful</td></tr>
<tr><td>4</td><td>Failure</td><td>Server → Peer</td><td>Authentication failed</td></tr>
</tbody>
</table>
</div>
<h3 id="eap-type-values-common-methods"><a class="header" href="#eap-type-values-common-methods">EAP Type Values (Common Methods)</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Type</th><th>Method</th><th>RFC</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>1</td><td>Identity</td><td>3748</td><td>Identity request/response</td></tr>
<tr><td>4</td><td>MD5-Challenge</td><td>3748</td><td>MD5 hash (deprecated, insecure)</td></tr>
<tr><td>13</td><td>EAP-TLS</td><td>5216</td><td>TLS-based mutual authentication</td></tr>
<tr><td>21</td><td>EAP-TTLS</td><td>5281</td><td>Tunneled TLS with flexible inner auth</td></tr>
<tr><td>25</td><td>PEAP</td><td>Draft</td><td>Protected EAP (tunneled)</td></tr>
<tr><td>26</td><td>EAP-MSCHAPv2</td><td>Draft</td><td>Microsoft Challenge-Handshake v2</td></tr>
<tr><td>18</td><td>EAP-SIM</td><td>4186</td><td>GSM SIM authentication</td></tr>
<tr><td>23</td><td>EAP-AKA</td><td>4187</td><td>UMTS authentication</td></tr>
<tr><td>52</td><td>EAP-PWD</td><td>5931</td><td>Password-based authentication</td></tr>
<tr><td>43</td><td>EAP-FAST</td><td>4851</td><td>Flexible Authentication via Secure Tunneling</td></tr>
</tbody>
</table>
</div>
<hr>
<h2 id="eap-message-flow"><a class="header" href="#eap-message-flow">EAP Message Flow</a></h2>
<h3 id="basic-eap-exchange"><a class="header" href="#basic-eap-exchange">Basic EAP Exchange</a></h3>
<pre><code class="language-mermaid">sequenceDiagram
    participant P as Peer
    participant A as Authenticator
    participant S as Auth Server

    A-&gt;&gt;P: EAPol-Start (optional)
    P-&gt;&gt;A: EAP-Response/Identity
    A-&gt;&gt;S: RADIUS Access-Request (EAP Identity)

    S-&gt;&gt;A: RADIUS Access-Challenge (EAP Request/Method)
    A-&gt;&gt;P: EAP-Request/Method
    P-&gt;&gt;A: EAP-Response/Method
    A-&gt;&gt;S: RADIUS Access-Request (EAP Response)

    Note over P,S: Multiple exchanges may occur

    S-&gt;&gt;A: RADIUS Access-Accept (EAP Success + Keys)
    A-&gt;&gt;P: EAP-Success

    Note over P,A: Port authorized, traffic flows
</code></pre>
<h3 id="eap-state-machine"><a class="header" href="#eap-state-machine">EAP State Machine</a></h3>
<pre><code class="language-mermaid">stateDiagram-v2
    [*] --&gt; Disabled
    Disabled --&gt; Initialize: Port enabled
    Initialize --&gt; Idle: Start
    Idle --&gt; Select_Method: Identity received
    Select_Method --&gt; Method: Method selected
    Method --&gt; Method: Exchange continues
    Method --&gt; Success: Auth succeeds
    Method --&gt; Failure: Auth fails
    Method --&gt; Select_Method: Method change
    Success --&gt; Authenticated
    Failure --&gt; Disconnected
    Authenticated --&gt; Idle: Timeout/Reauthentication
    Disconnected --&gt; [*]
</code></pre>
<h3 id="typical-exchange-pattern"><a class="header" href="#typical-exchange-pattern">Typical Exchange Pattern</a></h3>
<ol>
<li><strong>Identity Request</strong>: Server asks peer to identify itself</li>
<li><strong>Identity Response</strong>: Peer sends username/NAI (Network Access Identifier)</li>
<li><strong>Method Selection</strong>: Server chooses EAP method based on policy</li>
<li><strong>Authentication Exchange</strong>: Method-specific messages (varies by method)</li>
<li><strong>Result</strong>: Server sends Success or Failure</li>
<li><strong>Key Distribution</strong>: On success, MSK delivered to authenticator</li>
</ol>
<hr>
<h2 id="eap-methods-comparison"><a class="header" href="#eap-methods-comparison">EAP Methods Comparison</a></h2>
<h3 id="overview-of-common-methods"><a class="header" href="#overview-of-common-methods">Overview of Common Methods</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Method</th><th>Security</th><th>Credentials</th><th>Mutual Auth</th><th>Tunnel</th><th>Complexity</th><th>Use Case</th></tr>
</thead>
<tbody>
<tr><td><strong>EAP-TLS</strong></td><td>Highest</td><td>Certificates (both)</td><td>Yes</td><td>Yes</td><td>High</td><td>High security, PKI infrastructure</td></tr>
<tr><td><strong>EAP-TTLS</strong></td><td>High</td><td>Server cert + various</td><td>Yes</td><td>Yes</td><td>Medium</td><td>Flexible, password or cert inner auth</td></tr>
<tr><td><strong>PEAP</strong></td><td>High</td><td>Server cert + password</td><td>Yes</td><td>Yes</td><td>Medium</td><td>Common in corporate WiFi</td></tr>
<tr><td><strong>EAP-MSCHAPv2</strong></td><td>Low</td><td>Password</td><td>No</td><td>No</td><td>Low</td><td>Used inside PEAP/TTLS only</td></tr>
<tr><td><strong>EAP-SIM</strong></td><td>Medium</td><td>SIM card</td><td>Yes</td><td>No</td><td>Medium</td><td>Cellular operator WiFi</td></tr>
<tr><td><strong>EAP-AKA</strong></td><td>Medium</td><td>USIM/AKA</td><td>Yes</td><td>No</td><td>Medium</td><td>3G/4G cellular authentication</td></tr>
<tr><td><strong>EAP-PWD</strong></td><td>Medium</td><td>Password</td><td>Yes</td><td>No</td><td>Medium</td><td>Password without certificates</td></tr>
<tr><td><strong>EAP-FAST</strong></td><td>Medium</td><td>PAC + password</td><td>Yes</td><td>Yes</td><td>Medium</td><td>Cisco deployments</td></tr>
<tr><td><strong>EAP-MD5</strong></td><td>Very Low</td><td>Password</td><td>No</td><td>No</td><td>Very Low</td><td>Deprecated, insecure</td></tr>
</tbody>
</table>
</div>
<h3 id="method-selection-guide"><a class="header" href="#method-selection-guide">Method Selection Guide</a></h3>
<p><strong>When to use EAP-TLS:</strong></p>
<ul>
<li>Maximum security required</li>
<li>PKI infrastructure available</li>
<li>Device management supports certificate deployment</li>
<li>Mutual authentication essential</li>
<li>Examples: Government, healthcare, financial institutions</li>
</ul>
<p><strong>When to use PEAP:</strong></p>
<ul>
<li>Certificate deployment challenging (only server needs cert)</li>
<li>Active Directory integration desired</li>
<li>Windows-heavy environment</li>
<li>User password authentication acceptable</li>
<li>Examples: Corporate WiFi, universities</li>
</ul>
<p><strong>When to use EAP-TTLS:</strong></p>
<ul>
<li>More flexibility than PEAP needed</li>
<li>Support for legacy inner methods required</li>
<li>Non-Windows environments</li>
<li>Mixed authentication methods</li>
<li>Examples: Linux/Unix environments, ISPs</li>
</ul>
<p><strong>When to use EAP-SIM/AKA:</strong></p>
<ul>
<li>Cellular operator providing WiFi</li>
<li>SIM-based authentication required</li>
<li>Mobile device environment</li>
<li>Examples: Carrier WiFi offload, hotspots</li>
</ul>
<hr>
<h2 id="eap-tls-deep-dive"><a class="header" href="#eap-tls-deep-dive">EAP-TLS Deep Dive</a></h2>
<p><strong>EAP-TLS</strong> (RFC 5216) is the most secure EAP method, using TLS for mutual authentication with certificates.</p>
<h3 id="key-features"><a class="header" href="#key-features">Key Features</a></h3>
<ul>
<li><strong>Mutual Authentication</strong>: Both client and server prove identity with certificates</li>
<li><strong>Strong Cryptography</strong>: Leverages TLS 1.2/1.3 security</li>
<li><strong>Key Derivation</strong>: Generates strong session keys (MSK/EMSK)</li>
<li><strong>No Password</strong>: Certificate-based, resistant to dictionary attacks</li>
<li><strong>Industry Standard</strong>: Widely supported, well-tested</li>
</ul>
<h3 id="eap-tls-authentication-flow"><a class="header" href="#eap-tls-authentication-flow">EAP-TLS Authentication Flow</a></h3>
<pre><code class="language-mermaid">sequenceDiagram
    participant P as Peer
    participant A as Authenticator
    participant S as Auth Server

    P-&gt;&gt;A: EAPOL-Start
    A-&gt;&gt;P: EAP-Request/Identity
    P-&gt;&gt;A: EAP-Response/Identity (user@realm)
    A-&gt;&gt;S: RADIUS Access-Request

    S-&gt;&gt;A: RADIUS Access-Challenge
    A-&gt;&gt;P: EAP-Request/TLS (Start)

    P-&gt;&gt;A: EAP-Response/TLS (ClientHello)
    A-&gt;&gt;S: RADIUS Access-Request

    S-&gt;&gt;A: RADIUS Access-Challenge
    A-&gt;&gt;P: EAP-Request/TLS (ServerHello, Certificate, CertRequest, Done)

    P-&gt;&gt;A: EAP-Response/TLS (Certificate, ClientKeyExchange, CertVerify, Finished)
    A-&gt;&gt;S: RADIUS Access-Request

    S-&gt;&gt;A: RADIUS Access-Challenge
    A-&gt;&gt;P: EAP-Request/TLS (ChangeCipherSpec, Finished)

    P-&gt;&gt;A: EAP-Response/TLS (ACK)
    A-&gt;&gt;S: RADIUS Access-Request

    Note over S: Derives MSK from TLS session

    S-&gt;&gt;A: RADIUS Access-Accept (EAP-Success, MSK, MPPE-Keys)
    A-&gt;&gt;P: EAP-Success

    Note over P,A: PMK = MSK[0:256 bits]
    Note over P,A: 4-Way Handshake for PTK/GTK
</code></pre>
<h3 id="certificate-requirements"><a class="header" href="#certificate-requirements">Certificate Requirements</a></h3>
<p><strong>Server Certificate:</strong></p>
<ul>
<li>Must be signed by trusted CA (peer must have CA certificate)</li>
<li>Common Name (CN) or SAN should match server identity</li>
<li>Extended Key Usage: Server Authentication (1.3.6.1.5.5.7.3.1)</li>
<li>Valid date range (not expired)</li>
</ul>
<p><strong>Client Certificate:</strong></p>
<ul>
<li>Must be signed by trusted CA (server must have CA certificate)</li>
<li>Common Name (CN) typically contains username</li>
<li>Extended Key Usage: Client Authentication (1.3.6.1.5.5.7.3.2)</li>
<li>Private key must be accessible to supplicant</li>
</ul>
<h3 id="key-derivation"><a class="header" href="#key-derivation">Key Derivation</a></h3>
<p>EAP-TLS derives keys from the TLS master secret:</p>
<pre><code>TLS Master Secret (48 bytes)
        ↓
    PRF-256
        ↓
    ┌───────────────┐
    │  Key Block    │
    └───────────────┘
         ↓
    ┌────┴────┐
    ↓         ↓
   MSK      EMSK
(64 bytes) (64 bytes)
    ↓
  PMK (first 256 bits of MSK)
    ↓
4-Way Handshake
    ↓
  PTK, GTK
</code></pre>
<h3 id="configuration-example-wpa_supplicant"><a class="header" href="#configuration-example-wpa_supplicant">Configuration Example (wpa_supplicant)</a></h3>
<pre><code class="language-bash">network={
    ssid="Enterprise-WiFi"
    key_mgmt=WPA-EAP
    eap=TLS
    identity="user@example.com"

    # Client certificate and key
    client_cert="/etc/certs/client.crt"
    private_key="/etc/certs/client.key"
    private_key_passwd="keypassword"

    # CA certificate (validates server)
    ca_cert="/etc/certs/ca.crt"

    # Optional: Verify server certificate CN
    domain_suffix_match="radius.example.com"

    # TLS version
    phase1="tls_disable_tlsv1_0=1 tls_disable_tlsv1_1=1"
}
</code></pre>
<h3 id="configuration-example-hostapdradius"><a class="header" href="#configuration-example-hostapdradius">Configuration Example (hostapd/RADIUS)</a></h3>
<p><strong>hostapd.conf:</strong></p>
<pre><code class="language-bash"># Basic settings
interface=wlan0
ssid=Enterprise-WiFi
auth_algs=1
wpa=2
wpa_key_mgmt=WPA-EAP
rsn_pairwise=CCMP

# 802.1X settings
ieee8021x=1
eapol_version=2

# RADIUS server
auth_server_addr=192.168.1.10
auth_server_port=1812
auth_server_shared_secret=radiussecret
</code></pre>
<p><strong>FreeRADIUS eap.conf:</strong></p>
<pre><code class="language-bash">eap {
    default_eap_type = tls

    tls-config tls-common {
        # Server certificate
        private_key_file = /etc/raddb/certs/server.key
        certificate_file = /etc/raddb/certs/server.crt
        ca_file = /etc/raddb/certs/ca.crt

        # Client certificate validation
        ca_path = /etc/raddb/certs/
        cipher_list = "HIGH"
        cipher_server_preference = no
        tls_min_version = "1.2"

        # Certificate verification
        check_cert_cn = %{User-Name}
    }

    tls {
        tls = tls-common
    }
}
</code></pre>
<hr>
<h2 id="peap-deep-dive"><a class="header" href="#peap-deep-dive">PEAP Deep Dive</a></h2>
<p><strong>PEAP (Protected EAP)</strong> creates a TLS tunnel to protect weaker authentication methods. Developed by Microsoft, Cisco, and RSA Security.</p>
<h3 id="key-features-1"><a class="header" href="#key-features-1">Key Features</a></h3>
<ul>
<li><strong>Two-Phase Authentication</strong>: Outer TLS tunnel, inner method authentication</li>
<li><strong>Server-Only Certificate</strong>: Client doesn’t need certificate</li>
<li><strong>Protected Identity</strong>: Username sent in encrypted tunnel (outer identity can be anonymous)</li>
<li><strong>Common Inner Methods</strong>: EAP-MSCHAPv2 (most common), EAP-GTC</li>
<li><strong>Windows Integration</strong>: Native support in Windows</li>
</ul>
<h3 id="peap-architecture"><a class="header" href="#peap-architecture">PEAP Architecture</a></h3>
<pre><code>┌─────────────────────────────────────────┐
│         TLS Tunnel (Phase 1)            │
│  ┌───────────────────────────────────┐  │
│  │   Inner EAP Method (Phase 2)      │  │
│  │                                   │  │
│  │   EAP-MSCHAPv2 / EAP-GTC /etc    │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
         Server Certificate Required
         Client Certificate Optional
</code></pre>
<h3 id="peap-authentication-flow"><a class="header" href="#peap-authentication-flow">PEAP Authentication Flow</a></h3>
<pre><code class="language-mermaid">sequenceDiagram
    participant P as Peer
    participant A as Authenticator
    participant S as Auth Server

    Note over P,S: Phase 0: Identity Exchange
    A-&gt;&gt;P: EAP-Request/Identity
    P-&gt;&gt;A: EAP-Response/Identity (anonymous@realm)
    A-&gt;&gt;S: RADIUS Access-Request

    Note over P,S: Phase 1: TLS Tunnel Establishment
    S-&gt;&gt;A: RADIUS Access-Challenge
    A-&gt;&gt;P: EAP-Request/PEAP (Start)
    P-&gt;&gt;A: EAP-Response/PEAP (ClientHello)
    A-&gt;&gt;S: RADIUS Access-Request

    S-&gt;&gt;A: RADIUS Access-Challenge
    A-&gt;&gt;P: EAP-Request/PEAP (ServerHello, Certificate, Done)

    Note over P: Validates server certificate

    P-&gt;&gt;A: EAP-Response/PEAP (ClientKeyExchange, ChangeCipherSpec, Finished)
    A-&gt;&gt;S: RADIUS Access-Request

    S-&gt;&gt;A: RADIUS Access-Challenge
    A-&gt;&gt;P: EAP-Request/PEAP (ChangeCipherSpec, Finished)

    Note over P,S: TLS Tunnel Established
    Note over P,S: Phase 2: Inner Authentication (in TLS tunnel)

    S-&gt;&gt;A: RADIUS Access-Challenge
    A-&gt;&gt;P: EAP-Request/PEAP [EAP-Request/Identity]
    P-&gt;&gt;A: EAP-Response/PEAP [EAP-Response/Identity (actualuser)]
    A-&gt;&gt;S: RADIUS Access-Request

    S-&gt;&gt;A: RADIUS Access-Challenge
    A-&gt;&gt;P: EAP-Request/PEAP [EAP-Request/MSCHAPv2 Challenge]
    P-&gt;&gt;A: EAP-Response/PEAP [EAP-Response/MSCHAPv2 Response]
    A-&gt;&gt;S: RADIUS Access-Request

    S-&gt;&gt;A: RADIUS Access-Challenge
    A-&gt;&gt;P: EAP-Request/PEAP [EAP-Request/MSCHAPv2 Success]
    P-&gt;&gt;A: EAP-Response/PEAP [EAP-Response/MSCHAPv2 Ack]
    A-&gt;&gt;S: RADIUS Access-Request

    Note over S: Phase 2 successful, derive keys

    S-&gt;&gt;A: RADIUS Access-Accept (EAP-Success, MSK)
    A-&gt;&gt;P: EAP-Success
</code></pre>
<h3 id="peap-versions"><a class="header" href="#peap-versions">PEAP Versions</a></h3>
<p><strong>PEAPv0 (EAP-MSCHAPv2):</strong></p>
<ul>
<li>Most common implementation</li>
<li>Inner method: EAP-MSCHAPv2</li>
<li>Supported by Windows, most vendors</li>
</ul>
<p><strong>PEAPv1 (EAP-GTC):</strong></p>
<ul>
<li>Less common</li>
<li>Inner method: EAP-GTC (Generic Token Card)</li>
<li>Used for OTP, token-based auth</li>
</ul>
<h3 id="configuration-example-wpa_supplicant-1"><a class="header" href="#configuration-example-wpa_supplicant-1">Configuration Example (wpa_supplicant)</a></h3>
<pre><code class="language-bash">network={
    ssid="Corporate-WiFi"
    key_mgmt=WPA-EAP
    eap=PEAP

    # Outer identity (can be anonymous)
    identity="anonymous@example.com"

    # Inner identity (actual username)
    password="userpassword"

    # Phase 2 (inner) authentication
    phase2="auth=MSCHAPV2"

    # CA certificate to validate server
    ca_cert="/etc/certs/ca.crt"

    # Optional: Verify server certificate
    domain_suffix_match="radius.example.com"

    # PEAP version (0 = PEAPv0, 1 = PEAPv1)
    phase1="peapver=0"

    # Anonymous identity for outer tunnel
    anonymous_identity="anonymous@example.com"
}
</code></pre>
<h3 id="configuration-example-freeradius"><a class="header" href="#configuration-example-freeradius">Configuration Example (FreeRADIUS)</a></h3>
<pre><code class="language-bash">eap {
    default_eap_type = peap

    peap {
        tls = tls-common
        default_eap_type = mschapv2
        copy_request_to_tunnel = yes
        use_tunneled_reply = yes
        virtual_server = "inner-tunnel"
    }

    mschapv2 {
        # MSCHAPv2 settings
        with_ntdomain_hack = no
    }
}
</code></pre>
<p><strong>sites-enabled/inner-tunnel:</strong></p>
<pre><code class="language-bash">server inner-tunnel {
    authorize {
        filter_username
        chap
        mschap
        eap {
            ok = return
        }
        files
        -sql
        -ldap
    }

    authenticate {
        Auth-Type EAP {
            eap
        }
        mschap
    }
}
</code></pre>
<h3 id="key-derivation-in-peap"><a class="header" href="#key-derivation-in-peap">Key Derivation in PEAP</a></h3>
<pre><code>TLS Master Secret
        ↓
   TLS PRF (outer)
        ↓
    PEAP Keys
        ↓
  ┌─────┴─────┐
  ↓           ↓
Inner     Outer
Method    Keys
  ↓
MSCHAPv2
Response
  ↓
MSK (combined from TLS + MSCHAPv2)
</code></pre>
<hr>
<h2 id="eap-ttls-deep-dive"><a class="header" href="#eap-ttls-deep-dive">EAP-TTLS Deep Dive</a></h2>
<p><strong>EAP-TTLS (Tunneled TLS)</strong> - RFC 5281. Similar to PEAP but more flexible with inner authentication methods.</p>
<h3 id="key-features-2"><a class="header" href="#key-features-2">Key Features</a></h3>
<ul>
<li><strong>Flexible Inner Methods</strong>: Supports both EAP and non-EAP methods</li>
<li><strong>AVPs (Attribute-Value Pairs)</strong>: Uses DIAMETER-style attributes</li>
<li><strong>Server-Only Certificate</strong>: Like PEAP, only server needs certificate</li>
<li><strong>Protected Identity</strong>: True identity sent in encrypted tunnel</li>
<li><strong>Non-EAP Support</strong>: Can tunnel PAP, CHAP, MS-CHAP, MS-CHAPv2</li>
</ul>
<h3 id="peap-vs-eap-ttls"><a class="header" href="#peap-vs-eap-ttls">PEAP vs EAP-TTLS</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Feature</th><th>PEAP</th><th>EAP-TTLS</th></tr>
</thead>
<tbody>
<tr><td><strong>Inner Methods</strong></td><td>EAP only</td><td>EAP and non-EAP</td></tr>
<tr><td><strong>Protocol</strong></td><td>TLS + EAP</td><td>TLS + AVPs (DIAMETER)</td></tr>
<tr><td><strong>Common Inner</strong></td><td>EAP-MSCHAPv2, EAP-GTC</td><td>PAP, CHAP, MSCHAPv2, EAP-*</td></tr>
<tr><td><strong>Standardization</strong></td><td>Draft (Microsoft/Cisco)</td><td>RFC 5281</td></tr>
<tr><td><strong>Windows Support</strong></td><td>Native</td><td>Requires client software</td></tr>
<tr><td><strong>Flexibility</strong></td><td>Lower</td><td>Higher</td></tr>
</tbody>
</table>
</div>
<h3 id="supported-inner-methods"><a class="header" href="#supported-inner-methods">Supported Inner Methods</a></h3>
<p><strong>Non-EAP Methods (Phase 2):</strong></p>
<ul>
<li><strong>PAP</strong>: Clear-text password (protected by TLS tunnel)</li>
<li><strong>CHAP</strong>: Challenge-Handshake Authentication Protocol</li>
<li><strong>MS-CHAP</strong>: Microsoft CHAP</li>
<li><strong>MS-CHAPv2</strong>: Microsoft CHAP version 2</li>
<li><strong>EAP-</strong>*: Any EAP method (EAP-MSCHAPv2, EAP-GTC, etc.)</li>
</ul>
<h3 id="eap-ttls-authentication-flow"><a class="header" href="#eap-ttls-authentication-flow">EAP-TTLS Authentication Flow</a></h3>
<pre><code class="language-mermaid">sequenceDiagram
    participant P as Peer
    participant A as Authenticator
    participant S as Auth Server

    Note over P,S: Phase 1: TLS Tunnel Setup
    A-&gt;&gt;P: EAP-Request/Identity
    P-&gt;&gt;A: EAP-Response/Identity (anonymous@realm)
    A-&gt;&gt;S: RADIUS Access-Request

    S-&gt;&gt;A: RADIUS Access-Challenge
    A-&gt;&gt;P: EAP-Request/TTLS (Start)

    Note over P,S: TLS Handshake (similar to PEAP)

    P-&gt;&gt;A: EAP-Response/TTLS (ClientHello)
    A-&gt;&gt;S: RADIUS Access-Request
    S-&gt;&gt;A: RADIUS Access-Challenge
    A-&gt;&gt;P: EAP-Request/TTLS (ServerHello, Cert, Done)
    P-&gt;&gt;A: EAP-Response/TTLS (ClientKeyExchange, Finished)
    A-&gt;&gt;S: RADIUS Access-Request

    Note over P,S: TLS Tunnel Established
    Note over P,S: Phase 2: Inner Auth (AVP-based)

    S-&gt;&gt;A: RADIUS Access-Challenge
    A-&gt;&gt;P: EAP-Request/TTLS [AVP: User-Name?]
    P-&gt;&gt;A: EAP-Response/TTLS [AVP: User-Name="alice"]
    A-&gt;&gt;S: RADIUS Access-Request

    S-&gt;&gt;A: RADIUS Access-Challenge
    A-&gt;&gt;P: EAP-Request/TTLS [AVP: MS-CHAP-Challenge]
    P-&gt;&gt;A: EAP-Response/TTLS [AVP: MS-CHAP-Response]
    A-&gt;&gt;S: RADIUS Access-Request

    Note over S: Validates credentials

    S-&gt;&gt;A: RADIUS Access-Accept (MSK)
    A-&gt;&gt;P: EAP-Success
</code></pre>
<h3 id="avp-structure"><a class="header" href="#avp-structure">AVP Structure</a></h3>
<p>EAP-TTLS uses DIAMETER AVPs for inner authentication:</p>
<pre><code> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           AVP Code                            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|V M P r r r r r|                AVP Length                     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Vendor-ID (opt)                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           Data ...                            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</code></pre>
<p><strong>Common AVPs:</strong></p>
<ul>
<li><code>User-Name</code> (1): Username</li>
<li><code>User-Password</code> (2): Password (for PAP)</li>
<li><code>CHAP-Password</code> (3): CHAP response</li>
<li><code>MS-CHAP-Challenge</code> (11): Microsoft CHAP challenge</li>
<li><code>MS-CHAP2-Response</code> (25): MSCHAPv2 response</li>
</ul>
<h3 id="configuration-example-wpa_supplicant-2"><a class="header" href="#configuration-example-wpa_supplicant-2">Configuration Example (wpa_supplicant)</a></h3>
<p><strong>EAP-TTLS with PAP:</strong></p>
<pre><code class="language-bash">network={
    ssid="TTLS-Network"
    key_mgmt=WPA-EAP
    eap=TTLS

    # Outer identity (anonymous)
    anonymous_identity="anonymous@example.com"

    # Inner identity and password
    identity="alice@example.com"
    password="userpassword"

    # Phase 2: Use PAP (password in clear, but encrypted by TLS)
    phase2="auth=PAP"

    # CA certificate
    ca_cert="/etc/certs/ca.crt"
    domain_suffix_match="radius.example.com"
}
</code></pre>
<p><strong>EAP-TTLS with MSCHAPv2:</strong></p>
<pre><code class="language-bash">network={
    ssid="TTLS-Network"
    key_mgmt=WPA-EAP
    eap=TTLS
    anonymous_identity="anonymous@example.com"
    identity="bob@example.com"
    password="bobpassword"

    # Phase 2: Use MSCHAPv2
    phase2="auth=MSCHAPV2"

    ca_cert="/etc/certs/ca.crt"
}
</code></pre>
<p><strong>EAP-TTLS with EAP-MSCHAPv2 (nested EAP):</strong></p>
<pre><code class="language-bash">network={
    ssid="TTLS-Network"
    key_mgmt=WPA-EAP
    eap=TTLS
    anonymous_identity="anonymous@example.com"
    identity="carol@example.com"
    password="carolpassword"

    # Phase 2: Use EAP-MSCHAPv2 (EAP method inside TTLS)
    phase2="autheap=MSCHAPV2"

    ca_cert="/etc/certs/ca.crt"
}
</code></pre>
<h3 id="configuration-example-freeradius-1"><a class="header" href="#configuration-example-freeradius-1">Configuration Example (FreeRADIUS)</a></h3>
<pre><code class="language-bash">eap {
    default_eap_type = ttls

    ttls {
        tls = tls-common
        default_eap_type = mschapv2
        copy_request_to_tunnel = yes
        use_tunneled_reply = yes
        virtual_server = "inner-tunnel"

        # Support non-EAP methods
        require_client_cert = no
    }
}
</code></pre>
<hr>
<h2 id="eapol-eap-over-lan"><a class="header" href="#eapol-eap-over-lan">EAPOL (EAP over LAN)</a></h2>
<p><strong>EAPOL (EAP over LAN)</strong> - IEEE 802.1X defines how EAP packets are encapsulated for LAN environments.</p>
<h3 id="eapol-frame-format"><a class="header" href="#eapol-frame-format">EAPOL Frame Format</a></h3>
<pre><code> Ethernet Frame
┌────────────────────────────────────────────────────────┐
│ Dest MAC │ Src MAC │ EtherType │ EAPOL Packet │  FCS  │
│  6 bytes │ 6 bytes │  0x888E   │   Variable   │4 bytes│
└────────────────────────────────────────────────────────┘
                           ↓
                    EAPOL Packet
         ┌──────────────────────────────────────┐
         │ Ver │ Type │ Length │ Packet Body    │
         │  1  │  1   │   2    │   Variable     │
         └──────────────────────────────────────┘
                                  ↓
                          (If Type = EAP-Packet)
                           EAP Packet Format
                   ┌─────────────────────────────┐
                   │ Code│ Id │Len │Type│ Data  │
                   └─────────────────────────────┘
</code></pre>
<h3 id="eapol-packet-structure"><a class="header" href="#eapol-packet-structure">EAPOL Packet Structure</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Field</th><th>Size</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><strong>Protocol Version</strong></td><td>1 byte</td><td>EAPOL version (1, 2, or 3)</td></tr>
<tr><td><strong>Packet Type</strong></td><td>1 byte</td><td>Type of EAPOL packet</td></tr>
<tr><td><strong>Packet Body Length</strong></td><td>2 bytes</td><td>Length of packet body (big-endian)</td></tr>
<tr><td><strong>Packet Body</strong></td><td>Variable</td><td>Content depends on Packet Type</td></tr>
</tbody>
</table>
</div>
<h3 id="eapol-packet-types"><a class="header" href="#eapol-packet-types">EAPOL Packet Types</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Type</th><th>Name</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>0</td><td>EAP-Packet</td><td>Carries EAP messages</td></tr>
<tr><td>1</td><td>EAPOL-Start</td><td>Supplicant initiates authentication</td></tr>
<tr><td>2</td><td>EAPOL-Logoff</td><td>Supplicant logging off</td></tr>
<tr><td>3</td><td>EAPOL-Key</td><td>Key exchange messages (WPA/WPA2 4-way handshake)</td></tr>
<tr><td>4</td><td>EAPOL-Encapsulated-ASF-Alert</td><td>Alert messages</td></tr>
<tr><td>5</td><td>EAPOL-MKA</td><td>MACsec Key Agreement</td></tr>
</tbody>
</table>
</div>
<h3 id="eapol-versions"><a class="header" href="#eapol-versions">EAPOL Versions</a></h3>
<ul>
<li><strong>EAPOL v1</strong>: Original 802.1X-2001</li>
<li><strong>EAPOL v2</strong>: 802.1X-2004 (most common for WiFi)</li>
<li><strong>EAPOL v3</strong>: 802.1X-2010 (added features for MACsec)</li>
</ul>
<h3 id="eapol-multicast-address"><a class="header" href="#eapol-multicast-address">EAPOL Multicast Address</a></h3>
<p>EAPOL frames are sent to a special multicast MAC address:</p>
<ul>
<li><strong>PAE Group Address</strong>: <code>01:80:C2:00:00:03</code></li>
<li>Used when supplicant doesn’t know authenticator’s address</li>
<li>Ensures EAPOL frames aren’t forwarded by bridges</li>
</ul>
<h3 id="eapol-exchange-example"><a class="header" href="#eapol-exchange-example">EAPOL Exchange Example</a></h3>
<pre><code class="language-mermaid">sequenceDiagram
    participant S as Supplicant
    participant A as Authenticator

    Note over A: Port is unauthorized
    Note over A: Only EAPOL traffic allowed

    S-&gt;&gt;A: EAPOL-Start (Type=1)
    Note over S: "I want to authenticate"

    A-&gt;&gt;S: EAP-Request/Identity (Type=0, EAP packet)
    S-&gt;&gt;A: EAP-Response/Identity (Type=0, EAP packet)

    Note over A,S: Multiple EAP exchanges...

    A-&gt;&gt;S: EAP-Success (Type=0, EAP packet)

    Note over A: Port authorized
    Note over A: All traffic now allowed

    A-&gt;&gt;S: EAPOL-Key (Type=3) - 4-Way Handshake Message 1
    S-&gt;&gt;A: EAPOL-Key (Type=3) - 4-Way Handshake Message 2
    A-&gt;&gt;S: EAPOL-Key (Type=3) - 4-Way Handshake Message 3
    S-&gt;&gt;A: EAPOL-Key (Type=3) - 4-Way Handshake Message 4

    Note over S,A: Encrypted data traffic begins
</code></pre>
<hr>
<h2 id="eap-with-8021x"><a class="header" href="#eap-with-8021x">EAP with 802.1X</a></h2>
<p><strong>802.1X</strong> provides port-based network access control using EAP authentication.</p>
<h3 id="8021x-architecture"><a class="header" href="#8021x-architecture">802.1X Architecture</a></h3>
<pre><code class="language-mermaid">graph TB
    subgraph "Supplicant (Client Device)"
        S[EAP Supplicant&lt;br/&gt;wpa_supplicant]
    end

    subgraph "Authenticator (WiFi AP / Switch)"
        A[802.1X PAE&lt;br/&gt;Port Access Entity]
        P[Controlled Port&lt;br/&gt;Unauth/Auth]
    end

    subgraph "Authentication Server"
        R[RADIUS Server&lt;br/&gt;FreeRADIUS]
    end

    S &lt;--&gt;|EAPOL| A
    A &lt;--&gt;|RADIUS| R
    A --&gt; P

    style S fill:#e1f5ff
    style A fill:#fff4e1
    style R fill:#e8f5e9
    style P fill:#ffe1e1
</code></pre>
<h3 id="port-states"><a class="header" href="#port-states">Port States</a></h3>
<p><strong>Uncontrolled Port:</strong></p>
<ul>
<li>Always open for EAPOL traffic</li>
<li>Allows authentication messages</li>
<li>Used for EAP exchange</li>
</ul>
<p><strong>Controlled Port:</strong></p>
<ul>
<li>Initially blocked (unauthorized state)</li>
<li>Opens after successful authentication (authorized state)</li>
<li>Carries normal data traffic</li>
</ul>
<h3 id="8021x-with-wifi-wpa2-enterprise"><a class="header" href="#8021x-with-wifi-wpa2-enterprise">802.1X with WiFi (WPA2-Enterprise)</a></h3>
<pre><code class="language-mermaid">sequenceDiagram
    participant C as Client (Supplicant)
    participant AP as Access Point (Authenticator)
    participant R as RADIUS Server

    Note over C,AP: Association (Open)
    C-&gt;&gt;AP: Association Request
    AP-&gt;&gt;C: Association Response
    Note over C,AP: Associated, but not authenticated

    Note over C,R: 802.1X / EAP Authentication
    C-&gt;&gt;AP: EAPOL-Start
    AP-&gt;&gt;C: EAP-Request/Identity
    C-&gt;&gt;AP: EAP-Response/Identity
    AP-&gt;&gt;R: RADIUS Access-Request (Identity)

    R-&gt;&gt;AP: RADIUS Access-Challenge (EAP-TLS Start)
    AP-&gt;&gt;C: EAP-Request/TLS (Start)

    Note over C,R: TLS Handshake (multiple round trips)

    R-&gt;&gt;AP: RADIUS Access-Accept (EAP-Success, MSK, MPPE-Keys)
    AP-&gt;&gt;C: EAP-Success

    Note over C,AP: Derive PMK from MSK
    Note over C,AP: PMK = MSK[0:256 bits]

    Note over C,AP: 4-Way Handshake (EAPOL-Key)
    AP-&gt;&gt;C: Message 1 (ANonce)
    C-&gt;&gt;AP: Message 2 (SNonce, MIC)
    AP-&gt;&gt;C: Message 3 (GTK, MIC)
    C-&gt;&gt;AP: Message 4 (MIC)

    Note over C,AP: PTK and GTK installed
    Note over C,AP: Encrypted data traffic begins
</code></pre>
<h3 id="key-hierarchy-with-8021x"><a class="header" href="#key-hierarchy-with-8021x">Key Hierarchy with 802.1X</a></h3>
<pre><code>             EAP Authentication
                     ↓
        MSK (Master Session Key)
              64 bytes
                     ↓
        PMK = MSK[0:31] (first 256 bits)
     (Pairwise Master Key)
                     ↓
           4-Way Handshake
         (uses ANonce, SNonce)
                     ↓
        PTK (Pairwise Transient Key)
              384/512 bits
                     ↓
    ┌────────┬────────┬────────┬────────┐
    │  KCK   │  KEK   │  TK    │ (MIC)  │
    │(16B)   │(16B)   │(16B)   │        │
    └────────┴────────┴────────┴────────┘

    GTK (Group Temporal Key)
    ← Encrypted with KEK in Msg 3
</code></pre>
<p><strong>Key Definitions:</strong></p>
<ul>
<li><strong>MSK</strong>: Master Session Key (from EAP method)</li>
<li><strong>PMK</strong>: Pairwise Master Key (derived from MSK)</li>
<li><strong>PTK</strong>: Pairwise Transient Key (per-session encryption key)
<ul>
<li><strong>KCK</strong>: Key Confirmation Key (protects 4-way handshake)</li>
<li><strong>KEK</strong>: Key Encryption Key (encrypts GTK)</li>
<li><strong>TK</strong>: Temporal Key (encrypts unicast data)</li>
</ul>
</li>
<li><strong>GTK</strong>: Group Temporal Key (encrypts multicast/broadcast)</li>
</ul>
<h3 id="8021x-state-machine-simplified"><a class="header" href="#8021x-state-machine-simplified">802.1X State Machine (Simplified)</a></h3>
<pre><code class="language-mermaid">stateDiagram-v2
    [*] --&gt; Disconnected
    Disconnected --&gt; Connecting: Link Up
    Connecting --&gt; Authenticating: Association Success
    Authenticating --&gt; Authenticating: EAP Exchange
    Authenticating --&gt; Authenticated: EAP Success + 4-Way Success
    Authenticating --&gt; Held: EAP Failure
    Authenticated --&gt; Reauthenticating: Timeout / Policy
    Reauthenticating --&gt; Authenticated: Success
    Reauthenticating --&gt; Held: Failure
    Held --&gt; Disconnected: Timeout
    Authenticated --&gt; Disconnected: Disassociation
</code></pre>
<hr>
<h2 id="eap-over-radius"><a class="header" href="#eap-over-radius">EAP over RADIUS</a></h2>
<p>RADIUS (Remote Authentication Dial-In User Service) is the transport protocol that carries EAP between authenticator and authentication server.</p>
<h3 id="radius-with-eap-attributes"><a class="header" href="#radius-with-eap-attributes">RADIUS with EAP Attributes</a></h3>
<p><strong>Key RADIUS Attributes for EAP:</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Attribute</th><th>Type</th><th>Direction</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><strong>EAP-Message</strong></td><td>79</td><td>Both</td><td>Carries EAP packets (can be fragmented)</td></tr>
<tr><td><strong>Message-Authenticator</strong></td><td>80</td><td>Both</td><td>HMAC-MD5 integrity check (required for EAP)</td></tr>
<tr><td><strong>State</strong></td><td>24</td><td>Server→NAS</td><td>Session state (opaque to NAS, returned in next request)</td></tr>
<tr><td><strong>MS-MPPE-Recv-Key</strong></td><td>17 (Vendor)</td><td>Server→NAS</td><td>First 32 bytes of MSK</td></tr>
<tr><td><strong>MS-MPPE-Send-Key</strong></td><td>16 (Vendor)</td><td>Server→NAS</td><td>Second 32 bytes of MSK</td></tr>
</tbody>
</table>
</div>
<h3 id="radius-packet-flow-with-eap"><a class="header" href="#radius-packet-flow-with-eap">RADIUS Packet Flow with EAP</a></h3>
<pre><code class="language-mermaid">sequenceDiagram
    participant P as Peer
    participant N as NAS (Authenticator)
    participant R as RADIUS Server

    Note over P,N: EAPOL Exchange
    P-&gt;&gt;N: EAPOL EAP-Response/Identity

    Note over N,R: RADIUS Exchange
    N-&gt;&gt;R: Access-Request&lt;br/&gt;[EAP-Message: Identity]&lt;br/&gt;[Message-Authenticator]

    R-&gt;&gt;N: Access-Challenge&lt;br/&gt;[EAP-Message: Request/TLS]&lt;br/&gt;[State]&lt;br/&gt;[Message-Authenticator]

    N-&gt;&gt;P: EAPOL EAP-Request/TLS
    P-&gt;&gt;N: EAPOL EAP-Response/TLS

    N-&gt;&gt;R: Access-Request&lt;br/&gt;[EAP-Message: Response/TLS]&lt;br/&gt;[State]&lt;br/&gt;[Message-Authenticator]

    Note over R: Multiple round trips...

    R-&gt;&gt;N: Access-Accept&lt;br/&gt;[EAP-Message: Success]&lt;br/&gt;[MS-MPPE-Recv-Key]&lt;br/&gt;[MS-MPPE-Send-Key]&lt;br/&gt;[Message-Authenticator]

    N-&gt;&gt;P: EAPOL EAP-Success
</code></pre>
<h3 id="radius-packet-structure-with-eap"><a class="header" href="#radius-packet-structure-with-eap">RADIUS Packet Structure with EAP</a></h3>
<p><strong>Access-Request:</strong></p>
<pre><code>Code: 1 (Access-Request)
Identifier: 42
Length: 234
Authenticator: [16 bytes random]
Attributes:
  User-Name: "alice@example.com"
  NAS-IP-Address: 192.168.1.1
  NAS-Port: 0
  Called-Station-Id: "00-11-22-33-44-55:Corp-WiFi"
  Calling-Station-Id: "aa-bb-cc-dd-ee-ff"
  NAS-Port-Type: 19 (Wireless-802.11)
  EAP-Message: [EAP packet data]
  Message-Authenticator: [16 bytes HMAC-MD5]
  State: [server state from previous response]
</code></pre>
<p><strong>Access-Challenge:</strong></p>
<pre><code>Code: 11 (Access-Challenge)
Identifier: 42 (matches request)
Length: 156
Authenticator: [16 bytes response]
Attributes:
  EAP-Message: [EAP packet data]
  State: [opaque session state]
  Message-Authenticator: [16 bytes HMAC-MD5]
</code></pre>
<p><strong>Access-Accept:</strong></p>
<pre><code>Code: 2 (Access-Accept)
Identifier: 42
Length: 189
Authenticator: [16 bytes response]
Attributes:
  EAP-Message: [EAP-Success]
  MS-MPPE-Recv-Key: [encrypted, first 32 bytes of MSK]
  MS-MPPE-Send-Key: [encrypted, second 32 bytes of MSK]
  Message-Authenticator: [16 bytes HMAC-MD5]
  Session-Timeout: 3600
</code></pre>
<h3 id="eap-fragmentation-in-radius"><a class="header" href="#eap-fragmentation-in-radius">EAP Fragmentation in RADIUS</a></h3>
<p>EAP packets can be large (especially with certificates). RADIUS has a 4096-byte packet limit.</p>
<p><strong>Fragmentation Strategy:</strong></p>
<ul>
<li>Split EAP packet into multiple <code>EAP-Message</code> attributes</li>
<li>Each attribute ≤ 253 bytes</li>
<li>Reassembled at receiver</li>
<li>Multiple <code>EAP-Message</code> attributes in single RADIUS packet</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code>Access-Request:
  EAP-Message[1]: [253 bytes]
  EAP-Message[2]: [253 bytes]
  EAP-Message[3]: [253 bytes]
  EAP-Message[4]: [100 bytes]
  Message-Authenticator: [16 bytes]
</code></pre>
<h3 id="msk-distribution"><a class="header" href="#msk-distribution">MSK Distribution</a></h3>
<p>After successful EAP authentication, the RADIUS server sends the MSK to the NAS:</p>
<p><strong>Microsoft MPPE Keys (most common):</strong></p>
<pre><code>MS-MPPE-Recv-Key = Salt + Encrypted(MSK[0:31])
MS-MPPE-Send-Key = Salt + Encrypted(MSK[32:63])

Encryption uses:
  Key = MD5(RADIUS-Secret + Request-Authenticator)
</code></pre>
<p><strong>RADIUS Tunnel-Password Attribute (alternative):</strong></p>
<pre><code>Tag = 0
Salt = [2 bytes random]
Encrypted-Data = Encrypted(MSK[0:63])
</code></pre>
<hr>
<h2 id="key-derivation-1"><a class="header" href="#key-derivation-1">Key Derivation</a></h2>
<p>EAP methods derive cryptographic keys used for subsequent encryption and integrity protection.</p>
<h3 id="key-types"><a class="header" href="#key-types">Key Types</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Key</th><th>Size</th><th>Source</th><th>Purpose</th></tr>
</thead>
<tbody>
<tr><td><strong>MSK</strong> (Master Session Key)</td><td>512 bits (64 bytes)</td><td>EAP method</td><td>Distributed to authenticator, derives PMK</td></tr>
<tr><td><strong>EMSK</strong> (Extended MSK)</td><td>512 bits (64 bytes)</td><td>EAP method</td><td>Reserved for future use, not distributed</td></tr>
<tr><td><strong>PMK</strong> (Pairwise Master Key)</td><td>256 bits (32 bytes)</td><td>First 256 bits of MSK</td><td>Input to 4-way handshake</td></tr>
<tr><td><strong>PTK</strong> (Pairwise Transient Key)</td><td>384-512 bits</td><td>4-way handshake</td><td>Per-session encryption keys</td></tr>
<tr><td><strong>GTK</strong> (Group Temporal Key)</td><td>128-256 bits</td><td>AP generated</td><td>Multicast/broadcast encryption</td></tr>
</tbody>
</table>
</div>
<h3 id="key-derivation-hierarchy"><a class="header" href="#key-derivation-hierarchy">Key Derivation Hierarchy</a></h3>
<pre><code>                    EAP Method
                   (TLS, TTLS, PEAP, etc.)
                          ↓
         ┌────────────────┴────────────────┐
         ↓                                 ↓
    MSK (64 bytes)                    EMSK (64 bytes)
    Distributed to NAS                Not distributed
         ↓                             (Future use)
    PMK = MSK[0:31]
    (First 256 bits)
         ↓
    ──────────────────
    4-Way Handshake
    ──────────────────
    Inputs:
      - PMK
      - ANonce (AP random)
      - SNonce (STA random)
      - AA (AP MAC)
      - SA (STA MAC)
         ↓
    PTK = PRF-X(PMK, "Pairwise key expansion",
                Min(AA,SA) || Max(AA,SA) ||
                Min(ANonce,SNonce) || Max(ANonce,SNonce))
         ↓
    ┌─────────┬─────────┬─────────┬─────────┐
    │   KCK   │   KEK   │    TK   │ (MIC Key│
    │ 16 bytes│ 16 bytes│ 16 bytes│  if WPA)│
    │ Confirm │ Encrypt │ Data    │         │
    │ 4-Way   │  GTK    │ Encrypt │         │
    └─────────┴─────────┴─────────┴─────────┘
</code></pre>
<h3 id="eap-tls-key-derivation"><a class="header" href="#eap-tls-key-derivation">EAP-TLS Key Derivation</a></h3>
<pre><code>TLS Master Secret (48 bytes)
        ↓
TLS PRF (Pseudo-Random Function)
        ↓
Key Material = TLS-PRF(master_secret,
                       "client EAP encryption",
                       client_random || server_random)
        ↓
    ┌───────┴────────┐
    ↓                ↓
MSK (64 bytes)   EMSK (64 bytes)
</code></pre>
<h3 id="peapttls-key-derivation"><a class="header" href="#peapttls-key-derivation">PEAP/TTLS Key Derivation</a></h3>
<p>PEAP and TTLS derive keys from both the TLS tunnel and inner method:</p>
<pre><code>TLS Master Secret (from Phase 1)
        ↓
TLS PRF → Intermediate Keys
        ↓
Inner Method (Phase 2)
  (e.g., MSCHAPv2)
        ↓
    Response Hash
        ↓
Combined PRF (TLS keys + Inner keys)
        ↓
    ┌───────┴────────┐
    ↓                ↓
MSK (64 bytes)   EMSK (64 bytes)
</code></pre>
<h3 id="pmk-caching-fast-roaming"><a class="header" href="#pmk-caching-fast-roaming">PMK Caching (Fast Roaming)</a></h3>
<p>To speed up roaming, PMK can be cached:</p>
<p><strong>PMK-R0 (802.11r FT):</strong></p>
<pre><code>PMK-R0 = KDF(MSK, "FT-R0", SSID || MDID || R0KH-ID || S0KH-ID)
</code></pre>
<p><strong>PMK-R1 (per-AP):</strong></p>
<pre><code>PMK-R1 = KDF(PMK-R0, "FT-R1", R1KH-ID || S1KH-ID)
</code></pre>
<p>See <a href="roaming.html">roaming.md</a> for 802.11r details.</p>
<h3 id="key-lifetimes"><a class="header" href="#key-lifetimes">Key Lifetimes</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Key</th><th>Typical Lifetime</th><th>Refresh Method</th></tr>
</thead>
<tbody>
<tr><td><strong>MSK</strong></td><td>Until session ends</td><td>Full re-authentication</td></tr>
<tr><td><strong>PMK</strong></td><td>Hours to days</td><td>Re-authentication or cached</td></tr>
<tr><td><strong>PTK</strong></td><td>Session (until roam/disconnect)</td><td>4-way handshake</td></tr>
<tr><td><strong>GTK</strong></td><td>Minutes to hours</td><td>Group key handshake (2-way)</td></tr>
</tbody>
</table>
</div>
<hr>
<h2 id="security-considerations"><a class="header" href="#security-considerations">Security Considerations</a></h2>
<h3 id="eap-method-security-comparison"><a class="header" href="#eap-method-security-comparison">EAP Method Security Comparison</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Method</th><th>MitM Protection</th><th>Dictionary Attack Resistance</th><th>Certificate Requirement</th><th>Vulnerabilities</th></tr>
</thead>
<tbody>
<tr><td><strong>EAP-TLS</strong></td><td>✓✓✓ Strong</td><td>✓✓✓ Immune</td><td>Both client &amp; server</td><td>Cert management complexity</td></tr>
<tr><td><strong>PEAP</strong></td><td>✓✓ Good</td><td>✓✓ Good (tunneled)</td><td>Server only</td><td>Inner method weaknesses</td></tr>
<tr><td><strong>EAP-TTLS</strong></td><td>✓✓ Good</td><td>✓✓ Good (tunneled)</td><td>Server only</td><td>Inner method weaknesses</td></tr>
<tr><td><strong>EAP-MSCHAPv2</strong></td><td>✗ None</td><td>✗ Vulnerable</td><td>None</td><td>DES, dictionary attacks</td></tr>
<tr><td><strong>EAP-PWD</strong></td><td>✓✓ Good</td><td>✓✓ Good</td><td>None</td><td>Implementation bugs</td></tr>
<tr><td><strong>EAP-SIM/AKA</strong></td><td>✓ Moderate</td><td>✓✓ Good</td><td>None</td><td>SIM cloning risk</td></tr>
<tr><td><strong>EAP-FAST</strong></td><td>✓ Moderate</td><td>✓ Moderate</td><td>None (uses PAC)</td><td>PAC provisioning risk</td></tr>
<tr><td><strong>EAP-MD5</strong></td><td>✗ None</td><td>✗ Vulnerable</td><td>None</td><td>Deprecated, insecure</td></tr>
</tbody>
</table>
</div>
<h3 id="common-vulnerabilities"><a class="header" href="#common-vulnerabilities">Common Vulnerabilities</a></h3>
<p><strong>1. EAP-MSCHAPv2 (when used alone - not tunneled):</strong></p>
<ul>
<li><strong>DES encryption</strong>: Uses deprecated DES algorithm</li>
<li><strong>Dictionary attacks</strong>: Password can be brute-forced</li>
<li><strong>No server authentication</strong>: Client doesn’t verify server identity</li>
<li><strong>Mitigation</strong>: Only use inside PEAP/TTLS tunnel</li>
</ul>
<p><strong>2. Certificate Validation Failures:</strong></p>
<ul>
<li><strong>Problem</strong>: Client doesn’t validate server certificate</li>
<li><strong>Risk</strong>: MitM attack with rogue AP and fake RADIUS</li>
<li><strong>Mitigation</strong>: Configure <code>ca_cert</code>, <code>domain_suffix_match</code>, <code>domain_match</code></li>
</ul>
<p><strong>3. Anonymous Identity Leakage:</strong></p>
<ul>
<li><strong>Problem</strong>: Real identity sent in outer (unencrypted) identity</li>
<li><strong>Risk</strong>: Username disclosure before tunnel established</li>
<li><strong>Mitigation</strong>: Use <code>anonymous_identity</code> for outer, real identity for inner</li>
</ul>
<p><strong>4. EAP Method Downgrade:</strong></p>
<ul>
<li><strong>Problem</strong>: Attacker forces client to use weaker method</li>
<li><strong>Risk</strong>: Authentication with less secure method</li>
<li><strong>Mitigation</strong>: Configure specific EAP method(s), don’t allow negotiation</li>
</ul>
<p><strong>5. Rogue AP Attacks:</strong></p>
<ul>
<li><strong>Problem</strong>: Fake AP with captive RADIUS server</li>
<li><strong>Risk</strong>: Credential theft, MitM</li>
<li><strong>Mitigation</strong>: Server certificate validation, certificate pinning</li>
</ul>
<h3 id="best-practices-for-security"><a class="header" href="#best-practices-for-security">Best Practices for Security</a></h3>
<p><strong>Server Certificate Validation:</strong></p>
<pre><code class="language-bash"># Minimum secure configuration
network={
    # ... other settings ...

    # Validate server certificate
    ca_cert="/etc/certs/ca.crt"

    # Verify server name (strongest protection)
    domain_suffix_match="radius.example.com"
    # OR
    domain_match="radius.example.com"

    # Optional: Pin specific certificate
    # ca_cert="/etc/certs/radius-server.crt"
}
</code></pre>
<p><strong>Anonymous Identity:</strong></p>
<pre><code class="language-bash"># Protect real username
anonymous_identity="anonymous@example.com"
identity="alice@example.com"  # Sent in encrypted tunnel
</code></pre>
<p><strong>Disable Weak Methods:</strong></p>
<pre><code class="language-bash"># Only allow strong methods
eap=TLS
# OR for tunneled:
eap=TTLS
phase2="autheap=MSCHAPV2"  # MSCHAPv2 inside tunnel is OK
</code></pre>
<p><strong>TLS Version:</strong></p>
<pre><code class="language-bash"># Disable old TLS versions
phase1="tls_disable_tlsv1_0=1 tls_disable_tlsv1_1=1"
</code></pre>
<h3 id="known-attacks-and-mitigations"><a class="header" href="#known-attacks-and-mitigations">Known Attacks and Mitigations</a></h3>
<p><strong>1. MS-CHAPv2 Hash Cracking (Moxie Marlinspike, 2012):</strong></p>
<ul>
<li><strong>Attack</strong>: DES keys derived from password can be cracked in ~23 hours</li>
<li><strong>Affected</strong>: EAP-MSCHAPv2 (unencrypted)</li>
<li><strong>Mitigation</strong>: Use MSCHAPv2 only inside PEAP/TTLS tunnel</li>
</ul>
<p><strong>2. PEAP/PEAP (Double PEAP Attack):</strong></p>
<ul>
<li><strong>Attack</strong>: Nested PEAP tunnels can bypass authentication</li>
<li><strong>Affected</strong>: Misconfigured PEAP</li>
<li><strong>Mitigation</strong>: Proper RADIUS server configuration, validate inner identity</li>
</ul>
<p><strong>3. EAP-TLS Fragmentation Attack:</strong></p>
<ul>
<li><strong>Attack</strong>: Memory exhaustion with fragmented packets</li>
<li><strong>Affected</strong>: Some implementations</li>
<li><strong>Mitigation</strong>: Update to patched versions, implement fragment limits</li>
</ul>
<p><strong>4. Credential Forwarding (Evil Twin):</strong></p>
<ul>
<li><strong>Attack</strong>: Rogue AP forwards credentials to legitimate network</li>
<li><strong>Affected</strong>: Methods without server authentication</li>
<li><strong>Mitigation</strong>: Mutual authentication (EAP-TLS, PEAP, TTLS with cert validation)</li>
</ul>
<hr>
<h2 id="configuration-examples"><a class="header" href="#configuration-examples">Configuration Examples</a></h2>
<h3 id="complete-wpa_supplicant-examples"><a class="header" href="#complete-wpa_supplicant-examples">Complete wpa_supplicant Examples</a></h3>
<p><strong>EAP-TLS (Maximum Security):</strong></p>
<pre><code class="language-bash"># /etc/wpa_supplicant/wpa_supplicant.conf

ctrl_interface=/var/run/wpa_supplicant
ctrl_interface_group=wheel
update_config=1
country=US

network={
    ssid="Corporate-Secure"
    key_mgmt=WPA-EAP
    eap=TLS

    # Client identity (often from certificate CN)
    identity="alice@corp.example.com"

    # Client certificate and private key
    client_cert="/etc/certs/alice.crt"
    private_key="/etc/certs/alice.key"
    private_key_passwd="keypassword"

    # CA certificate (validate server)
    ca_cert="/etc/certs/corp-ca.crt"

    # Server certificate validation (CRITICAL for security)
    domain_suffix_match="radius.corp.example.com"

    # Optional: Check specific certificate fields
    # altsubject_match="DNS:radius.corp.example.com"

    # TLS settings
    phase1="tls_disable_tlsv1_0=1 tls_disable_tlsv1_1=1"

    # Optional: Specify cipher suites
    # openssl_ciphers="ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256"

    # Priority (higher = preferred)
    priority=10
}
</code></pre>
<p><strong>PEAP with EAP-MSCHAPv2 (Common Corporate):</strong></p>
<pre><code class="language-bash">network={
    ssid="Corp-WiFi"
    key_mgmt=WPA-EAP
    eap=PEAP

    # Outer identity (anonymous for privacy)
    anonymous_identity="anonymous@corp.example.com"

    # Inner identity and password
    identity="alice@corp.example.com"
    password="SecurePassword123!"

    # Phase 2 (inner authentication)
    phase2="auth=MSCHAPV2"

    # PEAP version (0 is most common)
    phase1="peapver=0"

    # Server certificate validation (CRITICAL)
    ca_cert="/etc/certs/corp-ca.crt"
    domain_suffix_match="radius.corp.example.com"

    priority=5
}
</code></pre>
<p><strong>EAP-TTLS with PAP (Flexible):</strong></p>
<pre><code class="language-bash">network={
    ssid="University-WiFi"
    key_mgmt=WPA-EAP
    eap=TTLS

    # Anonymous outer identity
    anonymous_identity="guest@uni.edu"

    # Real credentials (sent in encrypted tunnel)
    identity="student123@uni.edu"
    password="StudentPass456"

    # Phase 2: PAP (simple password, but encrypted in TLS tunnel)
    phase2="auth=PAP"

    # Server validation
    ca_cert="/etc/certs/uni-ca.crt"
    domain_match="radius.uni.edu"

    priority=5
}
</code></pre>
<p><strong>EAP-TTLS with EAP-MSCHAPv2 (Nested EAP):</strong></p>
<pre><code class="language-bash">network={
    ssid="Enterprise-Network"
    key_mgmt=WPA-EAP
    eap=TTLS

    anonymous_identity="anon@example.com"
    identity="bob@example.com"
    password="BobPassword789"

    # Note: "autheap" (not "auth") for EAP inner method
    phase2="autheap=MSCHAPV2"

    ca_cert="/etc/certs/ca.crt"
    domain_suffix_match="radius.example.com"
}
</code></pre>
<h3 id="complete-hostapd-configuration"><a class="header" href="#complete-hostapd-configuration">Complete hostapd Configuration</a></h3>
<p><strong>hostapd.conf for WPA2-Enterprise:</strong></p>
<pre><code class="language-bash"># Interface
interface=wlan0
driver=nl80211
bridge=br0

# SSID and basic settings
ssid=Corporate-WiFi
hw_mode=g
channel=6
country_code=US

# Security settings
auth_algs=1
wpa=2
wpa_key_mgmt=WPA-EAP
rsn_pairwise=CCMP
wpa_pairwise=CCMP

# 802.1X settings
ieee8021x=1
eapol_version=2
eapol_key_index_workaround=0

# RADIUS server configuration
auth_server_addr=192.168.1.100
auth_server_port=1812
auth_server_shared_secret=SuperSecretRADIUSPassword123

# Optional: Secondary RADIUS server (failover)
auth_server_addr=192.168.1.101
auth_server_port=1812
auth_server_shared_secret=SuperSecretRADIUSPassword123

# Optional: Accounting server
acct_server_addr=192.168.1.100
acct_server_port=1813
acct_server_shared_secret=SuperSecretRADIUSPassword123

# Optional: Dynamic VLAN assignment
dynamic_vlan=1
vlan_file=/etc/hostapd/hostapd.vlan

# PMK caching for fast roaming
rsn_preauth=1
rsn_preauth_interfaces=wlan0
pmk_r1_push=1
ft_over_ds=1
ft_psk_generate_local=1

# Logging
logger_syslog=-1
logger_syslog_level=2
logger_stdout=-1
logger_stdout_level=2
</code></pre>
<p><strong>hostapd.vlan (Dynamic VLAN):</strong></p>
<pre><code class="language-bash"># Format: VLAN_ID VLAN_interface
1       vlan1
10      vlan10
20      vlan20
100     vlan100
*       vlan999  # Default VLAN for unknown users
</code></pre>
<h3 id="freeradius-configuration"><a class="header" href="#freeradius-configuration">FreeRADIUS Configuration</a></h3>
<p><strong>clients.conf:</strong></p>
<pre><code class="language-bash"># Define NAS (Network Access Server) - your APs
client wifi-ap-1 {
    ipaddr = 192.168.1.50
    secret = SuperSecretRADIUSPassword123
    shortname = ap-building-a
    nas_type = other
}

client wifi-controllers {
    ipaddr = 192.168.1.0/24
    secret = ControllerSecret456
    shortname = wlc-network
}
</code></pre>
<p><strong>eap.conf:</strong></p>
<pre><code class="language-bash">eap {
    # Default EAP type for outer authentication
    default_eap_type = peap

    # Timer settings
    timer_expire = 60
    ignore_unknown_eap_types = no

    # Common TLS configuration
    tls-config tls-common {
        # Server certificate and key
        private_key_file = /etc/raddb/certs/server.key
        certificate_file = /etc/raddb/certs/server.crt
        ca_file = /etc/raddb/certs/ca.crt

        # Certificate chain (if intermediate CAs)
        ca_path = /etc/raddb/certs/

        # Cipher configuration
        cipher_list = "HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4"
        cipher_server_preference = yes

        # TLS version
        tls_min_version = "1.2"
        tls_max_version = "1.3"

        # Disable weak protocols
        disable_tlsv1 = yes
        disable_tlsv1_1 = yes

        # Certificate verification
        check_cert_cn = %{User-Name}
        check_cert_issuer = "/C=US/ST=CA/O=Example Corp/CN=Example CA"

        # DH parameters
        dh_file = /etc/raddb/certs/dh2048.pem

        # OCSP settings (optional)
        # ocsp {
        #     enable = yes
        #     override_cert_url = yes
        #     url = "http://ocsp.example.com"
        # }
    }

    # EAP-TLS configuration
    tls {
        tls = tls-common

        # Require client certificate
        require_client_cert = yes
    }

    # PEAP configuration
    peap {
        tls = tls-common
        default_eap_type = mschapv2
        copy_request_to_tunnel = yes
        use_tunneled_reply = yes
        virtual_server = "inner-tunnel"

        # PEAP version
        # peap_version = 0
    }

    # EAP-TTLS configuration
    ttls {
        tls = tls-common
        default_eap_type = mschapv2
        copy_request_to_tunnel = yes
        use_tunneled_reply = yes
        virtual_server = "inner-tunnel"

        # Support non-EAP inner methods
        require_client_cert = no
    }

    # MSCHAPv2 (for use inside PEAP/TTLS)
    mschapv2 {
        with_ntdomain_hack = no
    }
}
</code></pre>
<p><strong>users file (simple file-based auth):</strong></p>
<pre><code class="language-bash"># EAP-TLS: Check certificate attributes
alice@corp.example.com   Cleartext-Password := "unused"
    Reply-Message = "Welcome Alice",
    Tunnel-Type = VLAN,
    Tunnel-Medium-Type = IEEE-802,
    Tunnel-Private-Group-ID = 10

# PEAP/MSCHAPv2: Password authentication
bob@corp.example.com     Cleartext-Password := "BobPassword123"
    Reply-Message = "Welcome Bob",
    Tunnel-Private-Group-ID = 20

# Default user (deny)
DEFAULT         Auth-Type := Reject
                Reply-Message = "Authentication failed"
</code></pre>
<p><strong>sites-enabled/default (outer server):</strong></p>
<pre><code class="language-bash">server default {
    authorize {
        filter_username
        preprocess

        # EAP authorization
        eap {
            ok = return
        }

        # Check files, SQL, LDAP, etc.
        files
        -sql
        -ldap
    }

    authenticate {
        Auth-Type EAP {
            eap
        }
    }

    post-auth {
        # Reply attributes
        reply

        # Post-auth actions
        Post-Auth-Type REJECT {
            attr_filter.access_reject
        }
    }
}
</code></pre>
<p><strong>sites-enabled/inner-tunnel (for PEAP/TTLS phase 2):</strong></p>
<pre><code class="language-bash">server inner-tunnel {
    authorize {
        filter_username

        # Inner EAP
        eap {
            ok = return
        }

        # Check credentials
        files
        -sql
        -ldap

        # MSCHAPv2
        mschap

        # PAP
        pap
    }

    authenticate {
        Auth-Type EAP {
            eap
        }

        Auth-Type MS-CHAP {
            mschap
        }

        Auth-Type PAP {
            pap
        }
    }

    post-auth {
        Post-Auth-Type REJECT {
            attr_filter.access_reject
        }
    }
}
</code></pre>
<h3 id="certificate-generation-for-testing"><a class="header" href="#certificate-generation-for-testing">Certificate Generation (for testing)</a></h3>
<p><strong>Generate CA certificate:</strong></p>
<pre><code class="language-bash"># CA private key
openssl genrsa -out ca.key 4096

# CA certificate (self-signed)
openssl req -new -x509 -days 3650 -key ca.key -out ca.crt \
    -subj "/C=US/ST=California/L=San Francisco/O=Example Corp/CN=Example CA"
</code></pre>
<p><strong>Generate server certificate:</strong></p>
<pre><code class="language-bash"># Server private key
openssl genrsa -out server.key 2048

# Server certificate signing request
openssl req -new -key server.key -out server.csr \
    -subj "/C=US/ST=CA/L=SF/O=Example Corp/CN=radius.example.com"

# Sign with CA
openssl x509 -req -days 365 -in server.csr -CA ca.crt -CAkey ca.key \
    -set_serial 01 -out server.crt \
    -extfile &lt;(echo "extendedKeyUsage=serverAuth")
</code></pre>
<p><strong>Generate client certificate:</strong></p>
<pre><code class="language-bash"># Client private key
openssl genrsa -out alice.key 2048

# Client CSR
openssl req -new -key alice.key -out alice.csr \
    -subj "/C=US/ST=CA/O=Example Corp/CN=alice@example.com"

# Sign with CA
openssl x509 -req -days 365 -in alice.csr -CA ca.crt -CAkey ca.key \
    -set_serial 02 -out alice.crt \
    -extfile &lt;(echo "extendedKeyUsage=clientAuth")
</code></pre>
<hr>
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<h3 id="common-issues-and-solutions"><a class="header" href="#common-issues-and-solutions">Common Issues and Solutions</a></h3>
<p><strong>1. EAP authentication failing immediately</strong></p>
<p><strong>Symptoms:</strong></p>
<pre><code>CTRL-EVENT-EAP-FAILURE EAP authentication failed
</code></pre>
<p><strong>Possible causes:</strong></p>
<ul>
<li>Incorrect password</li>
<li>Server not receiving requests</li>
<li>RADIUS shared secret mismatch</li>
</ul>
<p><strong>Debug:</strong></p>
<pre><code class="language-bash"># Enable wpa_supplicant debug logging
wpa_supplicant -Dnl80211 -iwlan0 -c/etc/wpa_supplicant.conf -dd

# Check RADIUS server logs
tail -f /var/log/freeradius/radius.log

# Test RADIUS connectivity
radtest username password radius-server:1812 0 sharedsecret
</code></pre>
<p><strong>2. Certificate validation failures</strong></p>
<p><strong>Symptoms:</strong></p>
<pre><code>SSL: SSL3 alert: write (local SSL3 detected an error):fatal:unknown CA
</code></pre>
<p><strong>Causes:</strong></p>
<ul>
<li>CA certificate not trusted</li>
<li>Server certificate expired</li>
<li><code>domain_suffix_match</code> doesn’t match server certificate CN/SAN</li>
</ul>
<p><strong>Debug:</strong></p>
<pre><code class="language-bash"># Check server certificate
openssl s_client -connect radius.example.com:1812 -showcerts

# Verify certificate chain
openssl verify -CAfile ca.crt server.crt

# Check certificate dates
openssl x509 -in server.crt -noout -dates

# Check certificate subject/SAN
openssl x509 -in server.crt -noout -text | grep -A1 "Subject Alternative Name"
</code></pre>
<p><strong>Fix:</strong></p>
<pre><code class="language-bash"># Option 1: Use correct CA certificate
ca_cert="/path/to/correct/ca.crt"

# Option 2: Disable validation (INSECURE - testing only)
# ca_cert="/etc/ssl/certs/ca-certificates.crt"
# phase1="tls_disable_time_checks=1"
</code></pre>
<p><strong>3. Phase 2 (inner) authentication failing</strong></p>
<p><strong>Symptoms:</strong></p>
<pre><code>CTRL-EVENT-EAP-SUCCESS (outer)
...
CTRL-EVENT-EAP-FAILURE (overall)
</code></pre>
<p><strong>Causes:</strong></p>
<ul>
<li>Incorrect inner username/password</li>
<li>Phase 2 method mismatch</li>
<li>RADIUS inner-tunnel misconfigured</li>
</ul>
<p><strong>Debug:</strong></p>
<pre><code class="language-bash"># Check phase 2 configuration
grep phase2 /etc/wpa_supplicant/wpa_supplicant.conf

# RADIUS server debug (shows phase 2)
radiusd -X
</code></pre>
<p><strong>Fix:</strong></p>
<pre><code class="language-bash"># Verify phase 2 method matches server
phase2="auth=MSCHAPV2"  # For PEAP
# OR
phase2="autheap=MSCHAPV2"  # For TTLS with EAP inner

# Verify credentials
identity="correctuser@example.com"
password="correctpassword"
</code></pre>
<p><strong>4. Anonymous identity issues</strong></p>
<p><strong>Symptoms:</strong></p>
<ul>
<li>Real username visible in RADIUS logs before tunnel</li>
<li>Authentication fails with anonymous identity</li>
</ul>
<p><strong>Fix:</strong></p>
<pre><code class="language-bash"># Use anonymous for outer, real for inner
anonymous_identity="anonymous@example.com"
identity="realuser@example.com"
</code></pre>
<p><strong>5. RADIUS server timeout</strong></p>
<p><strong>Symptoms:</strong></p>
<pre><code>RADIUS No response from server
</code></pre>
<p><strong>Causes:</strong></p>
<ul>
<li>RADIUS server down</li>
<li>Firewall blocking UDP 1812/1813</li>
<li>Incorrect IP address</li>
</ul>
<p><strong>Debug:</strong></p>
<pre><code class="language-bash"># Test network connectivity
ping radius-server-ip

# Check firewall
sudo iptables -L -n | grep 1812
sudo ufw status

# Capture RADIUS traffic
sudo tcpdump -i any -n port 1812 or port 1813

# Test with radtest
echo "User-Name = test" | radclient radius-server:1812 auth sharedsecret
</code></pre>
<p><strong>6. 4-Way Handshake failure after EAP success</strong></p>
<p><strong>Symptoms:</strong></p>
<pre><code>CTRL-EVENT-EAP-SUCCESS
...
WPA: 4-Way Handshake failed
</code></pre>
<p><strong>Causes:</strong></p>
<ul>
<li>MSK not delivered to NAS</li>
<li>PMK derivation mismatch</li>
<li>RADIUS Access-Accept missing MPPE keys</li>
</ul>
<p><strong>Debug:</strong></p>
<pre><code class="language-bash"># Check RADIUS Access-Accept includes MS-MPPE keys
radiusd -X  # Look for MS-MPPE-Send-Key and MS-MPPE-Recv-Key

# Verify in hostapd
hostapd_cli -i wlan0 all_sta  # Check for PMK
</code></pre>
<p><strong>Fix:</strong></p>
<pre><code class="language-bash"># In FreeRADIUS, ensure eap module returns success
# In sites-enabled/default:
post-auth {
    # Ensure MPPE keys are included
    reply
}
</code></pre>
<h3 id="debugging-commands"><a class="header" href="#debugging-commands">Debugging Commands</a></h3>
<p><strong>wpa_supplicant:</strong></p>
<pre><code class="language-bash"># Interactive control
wpa_cli -i wlan0

# Useful wpa_cli commands:
wpa_cli status                    # Connection status
wpa_cli reassociate               # Reconnect
wpa_cli reconfigure               # Reload config
wpa_cli log_level DEBUG           # Increase verbosity
wpa_cli bss &lt;BSSID&gt;               # AP information
wpa_cli list_networks             # Configured networks

# Debug logging to file
wpa_supplicant -Dnl80211 -iwlan0 -c/etc/wpa_supplicant.conf \
    -dd -f /tmp/wpa_debug.log

# Test EAP with eapol_test (useful for RADIUS testing)
eapol_test -c peap.conf -s radiussecret -a 192.168.1.100
</code></pre>
<p><strong>hostapd:</strong></p>
<pre><code class="language-bash"># Interactive control
hostapd_cli -i wlan0

# Useful commands:
hostapd_cli status                # AP status
hostapd_cli all_sta               # All connected stations
hostapd_cli deauthenticate &lt;MAC&gt;  # Kick client (triggers reauth)
hostapd_cli help                  # All commands

# Debug mode
hostapd -dd /etc/hostapd/hostapd.conf
</code></pre>
<p><strong>FreeRADIUS:</strong></p>
<pre><code class="language-bash"># Debug mode (extremely verbose)
radiusd -X

# Debug specific module
radiusd -Xxd eap

# Test authentication
radtest alice password 127.0.0.1:1812 0 testing123

# EAP test
eapol_test -c test.conf -s secret -a 127.0.0.1

# Check certificate
radtest -t eap-tls alice "" 127.0.0.1:1812 0 secret
</code></pre>
<p><strong>Network capture:</strong></p>
<pre><code class="language-bash"># Capture EAPOL traffic
sudo tcpdump -i wlan0 -e ether proto 0x888e -w eapol.pcap

# Capture RADIUS traffic
sudo tcpdump -i eth0 port 1812 or port 1813 -w radius.pcap

# Wireshark display filters:
# eapol
# radius
# eap
# tls
</code></pre>
<p><strong>Certificate inspection:</strong></p>
<pre><code class="language-bash"># View certificate details
openssl x509 -in cert.crt -text -noout

# Check expiration
openssl x509 -in cert.crt -noout -enddate

# Verify certificate chain
openssl verify -CAfile ca.crt -untrusted intermediate.crt server.crt

# Test TLS connection
openssl s_client -connect server:port -CAfile ca.crt -cert client.crt -key client.key
</code></pre>
<hr>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<h3 id="deployment-recommendations"><a class="header" href="#deployment-recommendations">Deployment Recommendations</a></h3>
<p><strong>1. Method Selection:</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Environment</th><th>Recommended Method</th><th>Rationale</th></tr>
</thead>
<tbody>
<tr><td><strong>High Security</strong></td><td>EAP-TLS</td><td>Strongest, certificate-based mutual auth</td></tr>
<tr><td><strong>Corporate (Windows)</strong></td><td>PEAP-MSCHAPv2</td><td>Native support, AD integration</td></tr>
<tr><td><strong>Mixed Environment</strong></td><td>EAP-TTLS-MSCHAPv2</td><td>Flexible, good security</td></tr>
<tr><td><strong>Carrier WiFi</strong></td><td>EAP-SIM/AKA</td><td>SIM-based, seamless for mobile users</td></tr>
<tr><td><strong>Education</strong></td><td>PEAP or TTLS</td><td>Balance of security and usability</td></tr>
</tbody>
</table>
</div>
<p><strong>2. Certificate Management:</strong></p>
<ul>
<li><strong>Use internal CA</strong> for Enterprise WiFi (don’t use self-signed certs in production)</li>
<li><strong>Set reasonable expiration</strong>: 1-2 years for server certs, 1 year for client certs</li>
<li><strong>Automate renewal</strong>: Use certbot, ACME, or MDM for certificate distribution</li>
<li><strong>Monitor expiration</strong>: Alert before certificates expire</li>
<li><strong>Use strong keys</strong>: 2048-bit RSA minimum, 4096-bit preferred, or ECDSA P-256+</li>
<li><strong>Implement CRL/OCSP</strong>: For certificate revocation checking</li>
</ul>
<p><strong>3. RADIUS Server:</strong></p>
<ul>
<li><strong>Deploy redundant servers</strong>: At least 2 RADIUS servers for HA</li>
<li><strong>Use separate inner-tunnel virtual server</strong> for PEAP/TTLS</li>
<li><strong>Enable logging</strong>: Audit authentication attempts</li>
<li><strong>Implement rate limiting</strong>: Prevent brute force attacks</li>
<li><strong>Backend integration</strong>: Use LDAP/AD instead of flat files</li>
<li><strong>Network segmentation</strong>: RADIUS server on management VLAN</li>
</ul>
<p><strong>4. Access Point Configuration:</strong></p>
<ul>
<li><strong>Use strong shared secret</strong>: 20+ character random string for RADIUS</li>
<li><strong>Enable 802.11w (PMF)</strong>: Management frame protection</li>
<li><strong>Disable WPA (use WPA2/WPA3 only)</strong></li>
<li><strong>Enable RADIUS accounting</strong>: Track user sessions</li>
<li><strong>Configure fail-open policy</strong>: Define behavior when RADIUS unreachable</li>
<li><strong>Dynamic VLAN assignment</strong>: Segment users by role/group</li>
</ul>
<p><strong>5. Client Configuration:</strong></p>
<pre><code class="language-bash"># Recommended wpa_supplicant settings
network={
    ssid="SecureNetwork"
    key_mgmt=WPA-EAP
    eap=PEAP

    # Use anonymous outer identity
    anonymous_identity="guest@example.com"
    identity="user@example.com"

    # Strong server validation (CRITICAL)
    ca_cert="/etc/certs/ca.crt"
    domain_suffix_match="radius.example.com"

    # Modern TLS only
    phase1="peapver=0 tls_disable_tlsv1_0=1 tls_disable_tlsv1_1=1"

    # Strong phase 2
    phase2="auth=MSCHAPV2"

    # Enable 802.11w
    ieee80211w=2  # Required
}
</code></pre>
<p><strong>6. Security Hardening:</strong></p>
<ul>
<li><strong>Validate server certificates</strong>: Always configure <code>ca_cert</code> and <code>domain_suffix_match</code></li>
<li><strong>Use anonymous identity</strong>: Protect username privacy</li>
<li><strong>Disable weak methods</strong>: No EAP-MD5, no bare MSCHAPv2</li>
<li><strong>Enforce TLS 1.2+</strong>: Disable TLS 1.0 and 1.1</li>
<li><strong>Implement 802.1X timeouts</strong>: Prevent hung sessions</li>
<li><strong>Enable reauthentication</strong>: Periodic re-authentication (e.g., every 8 hours)</li>
</ul>
<p><strong>7. Monitoring and Maintenance:</strong></p>
<ul>
<li><strong>Log authentication events</strong>: Success and failures</li>
<li><strong>Alert on anomalies</strong>: Unusual failure rates, new devices</li>
<li><strong>Regular security audits</strong>: Review configurations, certificates</li>
<li><strong>Update regularly</strong>: Patch RADIUS, hostapd, wpa_supplicant</li>
<li><strong>Test failover</strong>: Verify redundant RADIUS servers work</li>
</ul>
<p><strong>8. User Experience:</strong></p>
<ul>
<li><strong>Pre-provision certificates</strong>: Use MDM for automatic cert deployment</li>
<li><strong>Provide clear instructions</strong>: User guides for manual configuration</li>
<li><strong>Support helpdesk</strong>: Train staff on EAP troubleshooting</li>
<li><strong>Test with all client types</strong>: Windows, macOS, Linux, iOS, Android</li>
<li><strong>Implement captive portal fallback</strong>: For guest access</li>
</ul>
<h3 id="performance-optimization"><a class="header" href="#performance-optimization">Performance Optimization</a></h3>
<p><strong>1. PMK Caching:</strong></p>
<pre><code class="language-bash"># In hostapd.conf
rsn_preauth=1
okc=1  # Opportunistic Key Caching
</code></pre>
<p><strong>2. Fast Roaming (802.11r):</strong></p>
<ul>
<li>Enables PMK-R0/R1 key hierarchy</li>
<li>Reduces roam time to ~50ms</li>
<li>See <a href="roaming.html">roaming.md</a></li>
</ul>
<p><strong>3. RADIUS Load Balancing:</strong></p>
<ul>
<li>Multiple RADIUS servers with load distribution</li>
<li>Failover on timeout (not failure for better UX)</li>
</ul>
<p><strong>4. Session Timeout:</strong></p>
<pre><code class="language-bash"># In FreeRADIUS users file
Session-Timeout = 28800  # 8 hours
</code></pre>
<hr>
<h2 id="references"><a class="header" href="#references">References</a></h2>
<h3 id="rfcs-and-standards"><a class="header" href="#rfcs-and-standards">RFCs and Standards</a></h3>
<ul>
<li><strong>RFC 3748</strong>: Extensible Authentication Protocol (EAP)</li>
<li><strong>RFC 5216</strong>: EAP-TLS Authentication Protocol</li>
<li><strong>RFC 5281</strong>: EAP-TTLS (Tunneled Transport Layer Security)</li>
<li><strong>RFC 5247</strong>: EAP Key Management Framework</li>
<li><strong>RFC 4186</strong>: EAP-SIM (GSM Subscriber Identity)</li>
<li><strong>RFC 4187</strong>: EAP-AKA (UMTS Authentication and Key Agreement)</li>
<li><strong>RFC 5931</strong>: EAP-PWD (Password-Based Authentication)</li>
<li><strong>RFC 4851</strong>: EAP-FAST (Flexible Authentication via Secure Tunneling)</li>
<li><strong>IEEE 802.1X-2020</strong>: Port-Based Network Access Control</li>
<li><strong>IEEE 802.11-2020</strong>: WiFi standard (includes RSN/WPA2/WPA3)</li>
<li><strong>Draft-josefsson-pppext-eap-tls-eap-13</strong>: PEAP specification</li>
</ul>
<h3 id="related-documentation"><a class="header" href="#related-documentation">Related Documentation</a></h3>
<ul>
<li><a href="security.html">security.md</a>: WiFi security protocols (WEP, WPA, WPA2, WPA3)</li>
<li><a href="roaming.html">roaming.md</a>: Fast roaming (802.11r/k/v/w) with EAP integration</li>
<li><a href="../tools/hostapd.html">tools/hostapd.md</a>: hostapd configuration and examples</li>
<li><a href="../tools/wpa_supplicant.html">tools/wpa_supplicant.md</a>: wpa_supplicant usage</li>
<li><a href="basics.html">basics.md</a>: WiFi fundamentals</li>
</ul>
<h3 id="tools-and-software"><a class="header" href="#tools-and-software">Tools and Software</a></h3>
<ul>
<li><strong>wpa_supplicant</strong>: https://w1.fi/wpa_supplicant/</li>
<li><strong>hostapd</strong>: https://w1.fi/hostapd/</li>
<li><strong>FreeRADIUS</strong>: https://freeradius.org/</li>
<li><strong>eapol_test</strong>: Testing tool (part of wpa_supplicant)</li>
<li><strong>radtest</strong>: RADIUS testing tool</li>
<li><strong>Wireshark</strong>: Protocol analyzer with EAP/EAPOL/RADIUS support</li>
</ul>
<h3 id="further-reading"><a class="header" href="#further-reading">Further Reading</a></h3>
<ul>
<li>Wi-Fi Alliance: WPA2/WPA3 specifications</li>
<li>FreeRADIUS Wiki: https://wiki.freeradius.org/</li>
<li>Microsoft EAP Documentation: https://docs.microsoft.com/en-us/windows-server/networking/technologies/extensible-authentication-protocol/network-access</li>
<li>NIST SP 800-97: Establishing Wireless Robust Security Networks</li>
</ul>
<hr>
<p><strong>Last Updated</strong>: 2025
<strong>Maintainer</strong>: Network Documentation Team
<strong>Related Topics</strong>: <a href="security.html">WiFi Security</a> | <a href="roaming.html">802.11r Roaming</a> | <a href="../tools/hostapd.html">hostapd</a> | <a href="../tools/wpa_supplicant.html">wpa_supplicant</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../wifi/qos_management.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../wifi/ofdma.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../wifi/qos_management.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../wifi/ofdma.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-c2a407aa.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>

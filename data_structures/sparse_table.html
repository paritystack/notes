<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Sparse Table - My Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-ae938929.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex-c8cb17df.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-b1a7955d.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">My Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="sparse-tables"><a class="header" href="#sparse-tables">Sparse Tables</a></h1>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#the-problem-it-solves">The Problem It Solves</a></li>
<li><a href="#how-it-works">How It Works</a></li>
<li><a href="#key-concepts">Key Concepts</a></li>
<li><a href="#structure-and-properties">Structure and Properties</a></li>
<li><a href="#core-operations">Core Operations</a>
<ul>
<li><a href="#build-operation">Build</a></li>
<li><a href="#query-operation">Query</a></li>
</ul>
</li>
<li><a href="#time-and-space-complexity">Time and Space Complexity</a></li>
<li><a href="#implementation">Implementation</a>
<ul>
<li><a href="#python-implementation">Python Implementation</a></li>
<li><a href="#javascript-implementation">JavaScript Implementation</a></li>
</ul>
</li>
<li><a href="#variations">Variations</a></li>
<li><a href="#applications">Applications</a></li>
<li><a href="#common-problems">Common Problems</a></li>
<li><a href="#comparison-with-other-structures">Comparison with Other Structures</a></li>
<li><a href="#interview-patterns">Interview Patterns</a></li>
<li><a href="#advanced-topics">Advanced Topics</a></li>
</ul>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>A <strong>Sparse Table</strong> is a data structure that answers <strong>static range queries</strong> in O(1) time after O(n log n) preprocessing. It’s particularly efficient for <strong>idempotent operations</strong> like minimum, maximum, GCD, and LCM.</p>
<h3 id="key-characteristics"><a class="header" href="#key-characteristics">Key Characteristics</a></h3>
<ul>
<li><strong>Static</strong>: Array doesn’t change after construction</li>
<li><strong>Fast queries</strong>: O(1) query time</li>
<li><strong>Preprocessing</strong>: O(n log n) build time</li>
<li><strong>Space</strong>: O(n log n) memory</li>
<li><strong>Idempotent operations</strong>: Works best with min, max, GCD, etc.</li>
<li><strong>No updates</strong>: Cannot modify array after building</li>
</ul>
<h3 id="why-sparse-tables"><a class="header" href="#why-sparse-tables">Why Sparse Tables?</a></h3>
<p><strong>Best for:</strong></p>
<ul>
<li>Range Minimum Query (RMQ) / Range Maximum Query</li>
<li>Static arrays with many queries</li>
<li>When O(1) query time is critical</li>
<li>Operations where overlapping ranges are okay</li>
</ul>
<p><strong>Advantages:</strong></p>
<ul>
<li>Faster queries than segment tree (O(1) vs O(log n))</li>
<li>Simpler than segment tree for RMQ</li>
<li>No updates means no balancing needed</li>
</ul>
<p><strong>Real-world usage:</strong></p>
<ul>
<li>Lowest Common Ancestor (LCA) in trees</li>
<li>Range statistics on static data</li>
<li>Computational geometry</li>
<li>Database query optimization</li>
</ul>
<h2 id="the-problem-it-solves"><a class="header" href="#the-problem-it-solves">The Problem It Solves</a></h2>
<h3 id="range-query-problem"><a class="header" href="#range-query-problem">Range Query Problem</a></h3>
<p><strong>Given:</strong></p>
<ul>
<li>Static array A of n elements</li>
<li>Many range queries: find min/max/GCD of A[L..R]</li>
</ul>
<p><strong>Approaches:</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Approach</th><th>Build</th><th>Query</th><th>Update</th><th>Space</th></tr>
</thead>
<tbody>
<tr><td>Naive</td><td>O(1)</td><td>O(n)</td><td>O(1)</td><td>O(n)</td></tr>
<tr><td>Segment Tree</td><td>O(n)</td><td>O(log n)</td><td>O(log n)</td><td>O(n)</td></tr>
<tr><td><strong>Sparse Table</strong></td><td><strong>O(n log n)</strong></td><td><strong>O(1)</strong></td><td><strong>N/A</strong></td><td><strong>O(n log n)</strong></td></tr>
</tbody>
</table>
</div>
<p><strong>Key insight</strong>: If array is static, we can precompute all useful range information!</p>
<h3 id="example-problem"><a class="header" href="#example-problem">Example Problem</a></h3>
<p><strong>Range Minimum Query (RMQ):</strong></p>
<pre><code>Array: [3, 1, 4, 1, 5, 9, 2, 6]

Query RMQ(2, 5): min of [4, 1, 5, 9] = 1
Query RMQ(0, 7): min of [3, 1, 4, 1, 5, 9, 2, 6] = 1
Query RMQ(4, 6): min of [5, 9, 2] = 2
</code></pre>
<p><strong>With sparse table</strong>: All queries answered in O(1)!</p>
<h2 id="how-it-works"><a class="header" href="#how-it-works">How It Works</a></h2>
<h3 id="the-core-idea"><a class="header" href="#the-core-idea">The Core Idea</a></h3>
<p><strong>Key observation</strong>: Any range [L, R] can be covered by at most 2 overlapping ranges of length 2^k.</p>
<pre><code>For range [L, R]:
- Find k where 2^k ≤ (R - L + 1) &lt; 2^(k+1)
- Split into: [L, L+2^k-1] and [R-2^k+1, R]
- These ranges overlap, but that's okay for min/max!

Example: RMQ(1, 6) with length 6
k = 2 (since 2^2 = 4 ≤ 6 &lt; 8 = 2^3)
Range 1: [1, 4] (length 4)
Range 2: [3, 6] (length 4)
min([1,4]) and min([3,6]) = overall min
</code></pre>
<h3 id="preprocessing-table"><a class="header" href="#preprocessing-table">Preprocessing Table</a></h3>
<p>Build 2D table where:</p>
<pre><code>table[i][j] = result of operation on range [i, i + 2^j - 1]

Example for min operation:
table[0][0] = A[0]           (range [0, 0], length 1)
table[0][1] = min(A[0], A[1]) (range [0, 1], length 2)
table[0][2] = min(A[0..3])    (range [0, 3], length 4)
table[0][3] = min(A[0..7])    (range [0, 7], length 8)
</code></pre>
<h3 id="visual-example"><a class="header" href="#visual-example">Visual Example</a></h3>
<pre><code>Array: [3, 1, 4, 1, 5, 9, 2, 6]

Sparse Table (minimum):

j=0 (length 1):  [3, 1, 4, 1, 5, 9, 2, 6]
j=1 (length 2):  [1, 1, 1, 1, 5, 2, 2]
j=2 (length 4):  [1, 1, 1, 1, 2]
j=3 (length 8):  [1]

table[i][j] = minimum of range [i, i+2^j-1]

Example:
table[0][0] = 3           (min of [3])
table[0][1] = min(3,1)=1  (min of [3,1])
table[0][2] = min(3,1,4,1)=1 (min of [3,1,4,1])
table[2][1] = min(4,1)=1  (min of [4,1])
</code></pre>
<h2 id="key-concepts"><a class="header" href="#key-concepts">Key Concepts</a></h2>
<h3 id="1-power-of-2-ranges"><a class="header" href="#1-power-of-2-ranges">1. Power of 2 Ranges</a></h3>
<p><strong>Why powers of 2?</strong></p>
<ul>
<li>Any number can be represented as sum of powers of 2 (binary)</li>
<li>Any range can be covered by at most 2 ranges of length 2^k</li>
<li>Enables O(1) queries through precomputation</li>
</ul>
<h3 id="2-idempotent-operations"><a class="header" href="#2-idempotent-operations">2. Idempotent Operations</a></h3>
<p><strong>Definition</strong>: Operation f is idempotent if f(a, a) = a</p>
<p><strong>Examples:</strong></p>
<ul>
<li>min(a, a) = a ✓</li>
<li>max(a, a) = a ✓</li>
<li>gcd(a, a) = a ✓</li>
<li>sum(a, a) = 2a ✗ (not idempotent)</li>
</ul>
<p><strong>Why important?</strong></p>
<ul>
<li>Overlapping ranges okay for idempotent operations</li>
<li>Enables O(1) query by using 2 precomputed ranges</li>
</ul>
<h3 id="3-range-decomposition"><a class="header" href="#3-range-decomposition">3. Range Decomposition</a></h3>
<p><strong>Key formula for query [L, R]:</strong></p>
<pre><code>k = floor(log₂(R - L + 1))
result = operation(table[L][k], table[R - 2^k + 1][k])
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>Query RMQ(2, 7):
Length = 7 - 2 + 1 = 6
k = floor(log₂(6)) = 2  (2^2 = 4)

min([2, 7]) = min(table[2][2], table[4][2])
            = min(min([2,5]), min([4,7]))
            = min(1, 2) = 1
</code></pre>
<h3 id="4-logarithm-precomputation"><a class="header" href="#4-logarithm-precomputation">4. Logarithm Precomputation</a></h3>
<p>For fast queries, precompute log₂ values:</p>
<pre><code class="language-python">log_table = [0] * (n + 1)
for i in range(2, n + 1):
    log_table[i] = log_table[i // 2] + 1
</code></pre>
<p>Avoids expensive log computation during queries.</p>
<h2 id="structure-and-properties"><a class="header" href="#structure-and-properties">Structure and Properties</a></h2>
<h3 id="table-structure"><a class="header" href="#table-structure">Table Structure</a></h3>
<p><strong>2D Array:</strong></p>
<pre><code>table[i][j] = operation result for range [i, i + 2^j - 1]

Dimensions:
- i: 0 to n-1 (starting position)
- j: 0 to log₂(n) (power of 2)

Size: O(n log n)
</code></pre>
<h3 id="mathematical-properties"><a class="header" href="#mathematical-properties">Mathematical Properties</a></h3>
<p><strong>Recurrence relation:</strong></p>
<pre><code>table[i][0] = A[i]  (base case: single element)

table[i][j] = operation(table[i][j-1], table[i + 2^(j-1)][j-1])

Explanation:
Range [i, i+2^j-1] splits into:
- Left half: [i, i+2^(j-1)-1]
- Right half: [i+2^(j-1), i+2^j-1]
</code></pre>
<h3 id="example-construction"><a class="header" href="#example-construction">Example Construction</a></h3>
<pre><code>Array: [3, 1, 4, 1, 5]

Step 1: j=0 (base case)
table[0][0] = 3
table[1][0] = 1
table[2][0] = 4
table[3][0] = 1
table[4][0] = 5

Step 2: j=1 (length 2)
table[0][1] = min(table[0][0], table[1][0]) = min(3, 1) = 1
table[1][1] = min(table[1][0], table[2][0]) = min(1, 4) = 1
table[2][1] = min(table[2][0], table[3][0]) = min(4, 1) = 1
table[3][1] = min(table[3][0], table[4][0]) = min(1, 5) = 1

Step 3: j=2 (length 4)
table[0][2] = min(table[0][1], table[2][1]) = min(1, 1) = 1
table[1][2] = min(table[1][1], table[3][1]) = min(1, 1) = 1
</code></pre>
<h2 id="core-operations"><a class="header" href="#core-operations">Core Operations</a></h2>
<h3 id="build-operation"><a class="header" href="#build-operation">Build Operation</a></h3>
<p><strong>Goal</strong>: Construct sparse table from array</p>
<p><strong>Algorithm:</strong></p>
<pre><code class="language-python">def build_sparse_table(arr):
    n = len(arr)
    max_log = int(math.log2(n)) + 1

    # Initialize table
    table = [[0] * max_log for _ in range(n)]

    # Base case: j = 0 (single elements)
    for i in range(n):
        table[i][0] = arr[i]

    # Fill table using DP
    j = 1
    while (1 &lt;&lt; j) &lt;= n:  # 2^j &lt;= n
        i = 0
        while (i + (1 &lt;&lt; j)) &lt;= n:  # i + 2^j &lt;= n
            table[i][j] = min(
                table[i][j - 1],
                table[i + (1 &lt;&lt; (j - 1))][j - 1]
            )
            i += 1
        j += 1

    return table
</code></pre>
<p><strong>Step-by-step:</strong></p>
<ol>
<li>Determine maximum power of 2 needed: ⌊log₂(n)⌋</li>
<li>Initialize 2D table: table[n][log n]</li>
<li>Fill base case: copy array elements</li>
<li>Fill using DP: combine two halves for each range</li>
</ol>
<p><strong>Time Complexity</strong>: O(n log n)</p>
<ul>
<li>Outer loop: O(log n) levels</li>
<li>Inner loop: O(n) per level</li>
<li>Total: O(n log n)</li>
</ul>
<p><strong>Space Complexity</strong>: O(n log n)</p>
<h3 id="query-operation"><a class="header" href="#query-operation">Query Operation</a></h3>
<p><strong>Goal</strong>: Answer range query [L, R] in O(1)</p>
<p><strong>Algorithm:</strong></p>
<pre><code class="language-python">def query(table, log_table, L, R):
    # Find k where 2^k ≤ (R - L + 1)
    k = log_table[R - L + 1]

    # Query two overlapping ranges
    return min(
        table[L][k],
        table[R - (1 &lt;&lt; k) + 1][k]
    )
</code></pre>
<p><strong>Visualization:</strong></p>
<pre><code>Query RMQ(2, 7):
        0   1   2   3   4   5   6   7
Array: [3,  1,  4,  1,  5,  9,  2,  6]
                    L           R

Length = 7 - 2 + 1 = 6
k = floor(log₂(6)) = 2

Range 1: [2, 5] (start at L, length 4)
Range 2: [4, 7] (end at R, length 4)

           [2, 3, 4, 5]
                   [4, 5, 6, 7]
                ^^^^^^^ overlap

min(table[2][2], table[4][2])
= min(min([2,5]), min([4,7]))
= min(1, 2) = 1
</code></pre>
<p><strong>Time Complexity</strong>: O(1)</p>
<ul>
<li>Logarithm lookup: O(1) (precomputed)</li>
<li>Two array accesses: O(1)</li>
<li>Min operation: O(1)</li>
</ul>
<h2 id="time-and-space-complexity"><a class="header" href="#time-and-space-complexity">Time and Space Complexity</a></h2>
<h3 id="summary-table"><a class="header" href="#summary-table">Summary Table</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Operation</th><th>Time</th><th>Space</th><th>Notes</th></tr>
</thead>
<tbody>
<tr><td>Build</td><td>O(n log n)</td><td>O(n log n)</td><td>One-time preprocessing</td></tr>
<tr><td>Query</td><td>O(1)</td><td>-</td><td>Idempotent operations only</td></tr>
<tr><td>Update</td><td>N/A</td><td>-</td><td>Static structure</td></tr>
<tr><td>Space</td><td>-</td><td>O(n log n)</td><td>~n × log₂(n) cells</td></tr>
</tbody>
</table>
</div>
<h3 id="space-breakdown"><a class="header" href="#space-breakdown">Space Breakdown</a></h3>
<p>For array of size n:</p>
<ul>
<li>Rows: n</li>
<li>Columns: ⌊log₂(n)⌋ + 1</li>
<li>Total cells: n × (⌊log₂(n)⌋ + 1)</li>
</ul>
<p><strong>Examples:</strong></p>
<ul>
<li>n = 100: 100 × 7 = 700 cells</li>
<li>n = 1,000: 1,000 × 10 = 10,000 cells</li>
<li>n = 1,000,000: 1,000,000 × 20 = 20,000,000 cells</li>
</ul>
<p><strong>Memory:</strong></p>
<ul>
<li>With int (4 bytes): ~4n log n bytes</li>
<li>n = 100,000: ~8 MB</li>
</ul>
<h2 id="implementation"><a class="header" href="#implementation">Implementation</a></h2>
<h3 id="python-implementation"><a class="header" href="#python-implementation">Python Implementation</a></h3>
<p><strong>Complete Sparse Table for RMQ:</strong></p>
<pre><code class="language-python">import math

class SparseTable:
    """
    Sparse Table for Range Minimum Query (RMQ).

    Supports:
    - O(n log n) build time
    - O(1) query time
    - Static array (no updates)

    Can be adapted for max, GCD, LCM by changing operation.
    """

    def __init__(self, arr):
        """
        Build sparse table from array.

        Args:
            arr (list): Input array

        Time: O(n log n)
        Space: O(n log n)
        """
        self.n = len(arr)
        self.max_log = int(math.log2(self.n)) + 1

        # Build table
        self.table = [[0] * self.max_log for _ in range(self.n)]
        self._build(arr)

        # Precompute logarithms for O(1) query
        self.log_table = self._build_log_table()

    def _build(self, arr):
        """Build sparse table using dynamic programming"""
        # Base case: single elements
        for i in range(self.n):
            self.table[i][0] = arr[i]

        # Build table level by level
        j = 1
        while (1 &lt;&lt; j) &lt;= self.n:  # 2^j &lt;= n
            i = 0
            while (i + (1 &lt;&lt; j)) &lt;= self.n:
                # Combine two halves
                left = self.table[i][j - 1]
                right = self.table[i + (1 &lt;&lt; (j - 1))][j - 1]
                self.table[i][j] = min(left, right)  # Change to max for RMaxQ
                i += 1
            j += 1

    def _build_log_table(self):
        """Precompute floor(log2(i)) for all i"""
        log_table = [0] * (self.n + 1)
        for i in range(2, self.n + 1):
            log_table[i] = log_table[i // 2] + 1
        return log_table

    def query(self, left, right):
        """
        Get minimum value in range [left, right].

        Args:
            left (int): Left boundary (inclusive)
            right (int): Right boundary (inclusive)

        Returns:
            Minimum value in range

        Time: O(1)
        """
        # Find k where 2^k &lt;= length
        length = right - left + 1
        k = self.log_table[length]

        # Query two overlapping ranges
        left_min = self.table[left][k]
        right_min = self.table[right - (1 &lt;&lt; k) + 1][k]

        return min(left_min, right_min)

    def __str__(self):
        """String representation for debugging"""
        result = "Sparse Table:\n"
        for j in range(self.max_log):
            if (1 &lt;&lt; j) &gt; self.n:
                break
            result += f"j={j} (length {1 &lt;&lt; j}): "
            for i in range(self.n):
                if i + (1 &lt;&lt; j) &lt;= self.n:
                    result += f"{self.table[i][j]} "
            result += "\n"
        return result


# Example usage
if __name__ == "__main__":
    arr = [3, 1, 4, 1, 5, 9, 2, 6, 5, 3]

    st = SparseTable(arr)

    print("Original array:", arr)
    print("\n" + str(st))

    # Test queries
    queries = [(0, 4), (2, 7), (5, 9), (1, 8)]

    for left, right in queries:
        result = st.query(left, right)
        actual = min(arr[left:right+1])
        print(f"RMQ({left}, {right}): {result} (expected: {actual})")
</code></pre>
<p><strong>Sparse Table for Range Maximum Query:</strong></p>
<pre><code class="language-python">class SparseTableMax:
    """Sparse Table for Range Maximum Query"""

    def __init__(self, arr):
        self.n = len(arr)
        self.max_log = int(math.log2(self.n)) + 1
        self.table = [[0] * self.max_log for _ in range(self.n)]
        self.log_table = [0] * (self.n + 1)

        # Build log table
        for i in range(2, self.n + 1):
            self.log_table[i] = self.log_table[i // 2] + 1

        # Build sparse table
        for i in range(self.n):
            self.table[i][0] = arr[i]

        j = 1
        while (1 &lt;&lt; j) &lt;= self.n:
            for i in range(self.n - (1 &lt;&lt; j) + 1):
                left = self.table[i][j - 1]
                right = self.table[i + (1 &lt;&lt; (j - 1))][j - 1]
                self.table[i][j] = max(left, right)  # Max instead of min
            j += 1

    def query(self, left, right):
        """Get maximum value in range [left, right]"""
        k = self.log_table[right - left + 1]
        return max(
            self.table[left][k],
            self.table[right - (1 &lt;&lt; k) + 1][k]
        )
</code></pre>
<p><strong>Sparse Table for GCD:</strong></p>
<pre><code class="language-python">import math

class SparseTableGCD:
    """Sparse Table for Range GCD Query"""

    def __init__(self, arr):
        self.n = len(arr)
        self.max_log = int(math.log2(self.n)) + 1
        self.table = [[0] * self.max_log for _ in range(self.n)]
        self.log_table = [0] * (self.n + 1)

        # Build log table
        for i in range(2, self.n + 1):
            self.log_table[i] = self.log_table[i // 2] + 1

        # Build sparse table
        for i in range(self.n):
            self.table[i][0] = arr[i]

        j = 1
        while (1 &lt;&lt; j) &lt;= self.n:
            for i in range(self.n - (1 &lt;&lt; j) + 1):
                left = self.table[i][j - 1]
                right = self.table[i + (1 &lt;&lt; (j - 1))][j - 1]
                self.table[i][j] = math.gcd(left, right)
            j += 1

    def query(self, left, right):
        """Get GCD of range [left, right]"""
        k = self.log_table[right - left + 1]
        return math.gcd(
            self.table[left][k],
            self.table[right - (1 &lt;&lt; k) + 1][k]
        )


# Example
arr = [12, 18, 24, 36, 6]
st_gcd = SparseTableGCD(arr)
print(st_gcd.query(0, 4))  # GCD of [12, 18, 24, 36, 6] = 6
print(st_gcd.query(0, 2))  # GCD of [12, 18, 24] = 6
</code></pre>
<h3 id="javascript-implementation"><a class="header" href="#javascript-implementation">JavaScript Implementation</a></h3>
<pre><code class="language-javascript">class SparseTable {
    constructor(arr) {
        this.n = arr.length;
        this.maxLog = Math.floor(Math.log2(this.n)) + 1;

        // Build table
        this.table = Array.from({length: this.n}, () =&gt;
            new Array(this.maxLog).fill(0)
        );
        this.build(arr);

        // Build log table
        this.logTable = new Array(this.n + 1).fill(0);
        for (let i = 2; i &lt;= this.n; i++) {
            this.logTable[i] = this.logTable[Math.floor(i / 2)] + 1;
        }
    }

    build(arr) {
        // Base case
        for (let i = 0; i &lt; this.n; i++) {
            this.table[i][0] = arr[i];
        }

        // Fill table
        for (let j = 1; (1 &lt;&lt; j) &lt;= this.n; j++) {
            for (let i = 0; i + (1 &lt;&lt; j) &lt;= this.n; i++) {
                const left = this.table[i][j - 1];
                const right = this.table[i + (1 &lt;&lt; (j - 1))][j - 1];
                this.table[i][j] = Math.min(left, right);
            }
        }
    }

    query(left, right) {
        const k = this.logTable[right - left + 1];
        const leftMin = this.table[left][k];
        const rightMin = this.table[right - (1 &lt;&lt; k) + 1][k];
        return Math.min(leftMin, rightMin);
    }
}

// Example usage
const arr = [3, 1, 4, 1, 5, 9, 2, 6, 5, 3];
const st = new SparseTable(arr);

console.log(`RMQ(2, 7): ${st.query(2, 7)}`);  // 1
console.log(`RMQ(0, 4): ${st.query(0, 4)}`);  // 1
console.log(`RMQ(5, 9): ${st.query(5, 9)}`);  // 2
</code></pre>
<h2 id="variations"><a class="header" href="#variations">Variations</a></h2>
<h3 id="1-2d-sparse-table"><a class="header" href="#1-2d-sparse-table">1. 2D Sparse Table</a></h3>
<p><strong>For 2D range queries</strong> (rectangle minimum):</p>
<pre><code class="language-python">class SparseTable2D:
    """2D Sparse Table for rectangle minimum queries"""

    def __init__(self, matrix):
        self.rows = len(matrix)
        self.cols = len(matrix[0])
        self.log_r = int(math.log2(self.rows)) + 1
        self.log_c = int(math.log2(self.cols)) + 1

        # 4D table: [row][col][log_row][log_col]
        self.table = [[[[0 for _ in range(self.log_c)]
                        for _ in range(self.log_r)]
                       for _ in range(self.cols)]
                      for _ in range(self.rows)]

        self._build(matrix)

    def _build(self, matrix):
        """Build 2D sparse table"""
        # Base case: single cells
        for i in range(self.rows):
            for j in range(self.cols):
                self.table[i][j][0][0] = matrix[i][j]

        # Fill for different rectangle sizes
        for log_r in range(self.log_r):
            for log_c in range(self.log_c):
                if log_r == 0 and log_c == 0:
                    continue

                h = 1 &lt;&lt; log_r
                w = 1 &lt;&lt; log_c

                for i in range(self.rows - h + 1):
                    for j in range(self.cols - w + 1):
                        # Combine 4 sub-rectangles
                        if log_c &gt; 0:
                            left = self.table[i][j][log_r][log_c - 1]
                            right = self.table[i][j + (w // 2)][log_r][log_c - 1]
                            self.table[i][j][log_r][log_c] = min(left, right)
                        else:
                            top = self.table[i][j][log_r - 1][log_c]
                            bottom = self.table[i + (h // 2)][j][log_r - 1][log_c]
                            self.table[i][j][log_r][log_c] = min(top, bottom)

    def query(self, r1, c1, r2, c2):
        """Query minimum in rectangle (r1,c1) to (r2,c2)"""
        log_r = int(math.log2(r2 - r1 + 1))
        log_c = int(math.log2(c2 - c1 + 1))

        # Query 4 overlapping rectangles
        tl = self.table[r1][c1][log_r][log_c]
        tr = self.table[r1][c2 - (1 &lt;&lt; log_c) + 1][log_r][log_c]
        bl = self.table[r2 - (1 &lt;&lt; log_r) + 1][c1][log_r][log_c]
        br = self.table[r2 - (1 &lt;&lt; log_r) + 1][c2 - (1 &lt;&lt; log_c) + 1][log_r][log_c]

        return min(tl, tr, bl, br)
</code></pre>
<h3 id="2-sparse-table-with-index"><a class="header" href="#2-sparse-table-with-index">2. Sparse Table with Index</a></h3>
<p><strong>Return both value and index:</strong></p>
<pre><code class="language-python">class SparseTableWithIndex:
    """Sparse table that returns minimum value and its index"""

    def __init__(self, arr):
        self.n = len(arr)
        self.arr = arr
        self.max_log = int(math.log2(self.n)) + 1
        # Store indices instead of values
        self.table = [[0] * self.max_log for _ in range(self.n)]
        self.log_table = [0] * (self.n + 1)

        # Build
        for i in range(2, self.n + 1):
            self.log_table[i] = self.log_table[i // 2] + 1

        for i in range(self.n):
            self.table[i][0] = i  # Store index

        j = 1
        while (1 &lt;&lt; j) &lt;= self.n:
            for i in range(self.n - (1 &lt;&lt; j) + 1):
                left_idx = self.table[i][j - 1]
                right_idx = self.table[i + (1 &lt;&lt; (j - 1))][j - 1]

                # Store index of minimum
                if arr[left_idx] &lt;= arr[right_idx]:
                    self.table[i][j] = left_idx
                else:
                    self.table[i][j] = right_idx
            j += 1

    def query(self, left, right):
        """Return (min_value, min_index)"""
        k = self.log_table[right - left + 1]

        left_idx = self.table[left][k]
        right_idx = self.table[right - (1 &lt;&lt; k) + 1][k]

        if self.arr[left_idx] &lt;= self.arr[right_idx]:
            min_idx = left_idx
        else:
            min_idx = right_idx

        return self.arr[min_idx], min_idx
</code></pre>
<h3 id="3-disjoint-sparse-table"><a class="header" href="#3-disjoint-sparse-table">3. Disjoint Sparse Table</a></h3>
<p><strong>Better cache locality, same complexity:</strong></p>
<p>Divide array into disjoint blocks and build sparse table within each.</p>
<h2 id="applications"><a class="header" href="#applications">Applications</a></h2>
<h3 id="1-range-minimummaximum-query"><a class="header" href="#1-range-minimummaximum-query">1. Range Minimum/Maximum Query</a></h3>
<p><strong>Classic application:</strong></p>
<pre><code class="language-python">def solve_rmq_queries(arr, queries):
    """
    Answer multiple RMQ queries efficiently.

    Args:
        arr: Static array
        queries: List of (left, right) range queries

    Returns:
        List of minimum values for each query

    Time: O(n log n + q) where q = number of queries
    """
    st = SparseTable(arr)

    results = []
    for left, right in queries:
        results.append(st.query(left, right))

    return results
</code></pre>
<h3 id="2-lowest-common-ancestor-lca"><a class="header" href="#2-lowest-common-ancestor-lca">2. Lowest Common Ancestor (LCA)</a></h3>
<p><strong>Using Euler tour + RMQ:</strong></p>
<pre><code class="language-python">class LCA:
    """
    Lowest Common Ancestor using sparse table.
    Convert tree LCA to RMQ problem.
    """

    def __init__(self, tree, root):
        """
        Build LCA structure.

        Args:
            tree: Adjacency list representation
            root: Root node
        """
        self.tree = tree
        self.n = len(tree)

        # Euler tour: nodes visited in DFS
        self.euler = []
        # First occurrence of each node in euler tour
        self.first = [-1] * self.n
        # Depth of each node in tour
        self.depth = []

        # Run DFS to build euler tour
        self._dfs(root, -1, 0)

        # Build sparse table on depths
        self.st = SparseTableWithIndex(self.depth)

    def _dfs(self, node, parent, d):
        """DFS to build Euler tour"""
        self.first[node] = len(self.euler)
        self.euler.append(node)
        self.depth.append(d)

        for child in self.tree[node]:
            if child != parent:
                self._dfs(child, node, d + 1)
                self.euler.append(node)
                self.depth.append(d)

    def query(self, u, v):
        """
        Find LCA of nodes u and v.

        Time: O(1) after O(n log n) preprocessing
        """
        left = min(self.first[u], self.first[v])
        right = max(self.first[u], self.first[v])

        _, min_idx = self.st.query(left, right)
        return self.euler[min_idx]


# Example usage
tree = {
    0: [1, 2],
    1: [0, 3, 4],
    2: [0, 5],
    3: [1],
    4: [1],
    5: [2]
}

lca = LCA(tree, root=0)
print(f"LCA(3, 4): {lca.query(3, 4)}")  # 1
print(f"LCA(3, 5): {lca.query(3, 5)}")  # 0
</code></pre>
<h3 id="3-sliding-window-minimummaximum"><a class="header" href="#3-sliding-window-minimummaximum">3. Sliding Window Minimum/Maximum</a></h3>
<p><strong>Fixed-size window queries:</strong></p>
<pre><code class="language-python">def sliding_window_minimum(arr, k):
    """
    Find minimum in each window of size k.

    Args:
        arr: Input array
        k: Window size

    Returns:
        List of minimums for each window

    Time: O(n log n + n) = O(n log n)
    """
    st = SparseTable(arr)

    result = []
    for i in range(len(arr) - k + 1):
        result.append(st.query(i, i + k - 1))

    return result


# Example
arr = [1, 3, -1, -3, 5, 3, 6, 7]
k = 3
print(sliding_window_minimum(arr, k))  # [-1, -3, -3, -3, 3, 3]
</code></pre>
<h3 id="4-range-gcd-queries"><a class="header" href="#4-range-gcd-queries">4. Range GCD Queries</a></h3>
<pre><code class="language-python">def range_gcd_queries(arr, queries):
    """Answer multiple range GCD queries"""
    st = SparseTableGCD(arr)

    results = []
    for left, right in queries:
        results.append(st.query(left, right))

    return results
</code></pre>
<h3 id="5-longest-increasing-subsequence-lis-queries"><a class="header" href="#5-longest-increasing-subsequence-lis-queries">5. Longest Increasing Subsequence (LIS) Queries</a></h3>
<p><strong>Query LIS in subarray [L, R]:</strong></p>
<p>Combine sparse table with additional preprocessing.</p>
<h2 id="common-problems"><a class="header" href="#common-problems">Common Problems</a></h2>
<h3 id="leetcode-problems"><a class="header" href="#leetcode-problems">LeetCode Problems</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Problem</th><th>Difficulty</th><th>Technique</th></tr>
</thead>
<tbody>
<tr><td><a href="https://leetcode.com/problems/find-servers-that-handled-most-number-of-requests/">1606. Find Servers That Handled Most Number of Requests</a></td><td>Hard</td><td>Range queries</td></tr>
<tr><td><a href="https://leetcode.com/problems/minimum-interval-to-include-each-query/">1851. Minimum Interval to Include Each Query</a></td><td>Hard</td><td>Sparse table + sorting</td></tr>
<tr><td><a href="https://leetcode.com/problems/maximum-genetic-difference-query/">1938. Maximum Genetic Difference Query</a></td><td>Hard</td><td>Tree queries</td></tr>
</tbody>
</table>
</div>
<h3 id="competitive-programming"><a class="header" href="#competitive-programming">Competitive Programming</a></h3>
<p>Common patterns:</p>
<ol>
<li><strong>Static RMQ with many queries</strong></li>
<li><strong>LCA in trees</strong></li>
<li><strong>2D matrix minimum in rectangles</strong></li>
<li><strong>Range GCD/LCM queries</strong></li>
</ol>
<h2 id="comparison-with-other-structures"><a class="header" href="#comparison-with-other-structures">Comparison with Other Structures</a></h2>
<h3 id="sparse-table-vs-segment-tree"><a class="header" href="#sparse-table-vs-segment-tree">Sparse Table vs Segment Tree</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Feature</th><th>Sparse Table</th><th>Segment Tree</th></tr>
</thead>
<tbody>
<tr><td><strong>Query time</strong></td><td>O(1)</td><td>O(log n)</td></tr>
<tr><td><strong>Build time</strong></td><td>O(n log n)</td><td>O(n)</td></tr>
<tr><td><strong>Update</strong></td><td>N/A (static)</td><td>O(log n)</td></tr>
<tr><td><strong>Space</strong></td><td>O(n log n)</td><td>O(n)</td></tr>
<tr><td><strong>Operations</strong></td><td>Idempotent only</td><td>Any associative</td></tr>
<tr><td><strong>Implementation</strong></td><td>Simpler</td><td>More complex</td></tr>
<tr><td><strong>Use when</strong></td><td>Static data</td><td>Dynamic data</td></tr>
</tbody>
</table>
</div>
<p><strong>Choose Sparse Table when:</strong></p>
<ul>
<li>Array is static (no updates)</li>
<li>Need O(1) queries</li>
<li>Operation is idempotent</li>
<li>Space O(n log n) acceptable</li>
</ul>
<p><strong>Choose Segment Tree when:</strong></p>
<ul>
<li>Need updates</li>
<li>Non-idempotent operations (sum)</li>
<li>Space is limited</li>
<li>O(log n) query acceptable</li>
</ul>
<h3 id="sparse-table-vs-square-root-decomposition"><a class="header" href="#sparse-table-vs-square-root-decomposition">Sparse Table vs Square Root Decomposition</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Feature</th><th>Sparse Table</th><th>Sqrt Decomposition</th></tr>
</thead>
<tbody>
<tr><td><strong>Query</strong></td><td>O(1)</td><td>O(√n)</td></tr>
<tr><td><strong>Build</strong></td><td>O(n log n)</td><td>O(n)</td></tr>
<tr><td><strong>Space</strong></td><td>O(n log n)</td><td>O(n)</td></tr>
<tr><td><strong>Update</strong></td><td>N/A</td><td>O(1) or O(√n)</td></tr>
<tr><td><strong>Simplicity</strong></td><td>Moderate</td><td>Very simple</td></tr>
</tbody>
</table>
</div>
<h3 id="sparse-table-vs-prefix-arrays"><a class="header" href="#sparse-table-vs-prefix-arrays">Sparse Table vs Prefix Arrays</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Feature</th><th>Sparse Table</th><th>Prefix Sum</th></tr>
</thead>
<tbody>
<tr><td><strong>Query</strong></td><td>O(1)</td><td>O(1)</td></tr>
<tr><td><strong>Build</strong></td><td>O(n log n)</td><td>O(n)</td></tr>
<tr><td><strong>Operations</strong></td><td>Min, max, GCD</td><td>Sum (invertible)</td></tr>
<tr><td><strong>Space</strong></td><td>O(n log n)</td><td>O(n)</td></tr>
</tbody>
</table>
</div>
<p><strong>Use prefix arrays</strong> for sum queries (simpler).
<strong>Use sparse table</strong> for min/max/GCD queries.</p>
<h2 id="interview-patterns"><a class="header" href="#interview-patterns">Interview Patterns</a></h2>
<h3 id="pattern-1-static-rmq"><a class="header" href="#pattern-1-static-rmq">Pattern 1: Static RMQ</a></h3>
<pre><code class="language-python">def solve_static_rmq(arr, queries):
    """
    Multiple queries on static array.
    Build once, query many times.
    """
    st = SparseTable(arr)
    return [st.query(l, r) for l, r in queries]
</code></pre>
<h3 id="pattern-2-lca-problems"><a class="header" href="#pattern-2-lca-problems">Pattern 2: LCA Problems</a></h3>
<p>Convert tree problems to RMQ using Euler tour technique.</p>
<h3 id="pattern-3-sliding-window-optimization"><a class="header" href="#pattern-3-sliding-window-optimization">Pattern 3: Sliding Window Optimization</a></h3>
<p>Use sparse table when window queries are complex.</p>
<h2 id="advanced-topics"><a class="header" href="#advanced-topics">Advanced Topics</a></h2>
<h3 id="binary-lifting"><a class="header" href="#binary-lifting">Binary Lifting</a></h3>
<p><strong>Related technique</strong> for tree problems:</p>
<ul>
<li>Similar idea of power-of-2 jumps</li>
<li>Used in LCA, kth ancestor queries</li>
</ul>
<h3 id="range-mode-query"><a class="header" href="#range-mode-query">Range Mode Query</a></h3>
<p><strong>Harder problem</strong>: Most frequent element in range</p>
<ul>
<li>Cannot use sparse table directly (not idempotent)</li>
<li>Need modified approach</li>
</ul>
<h3 id="fractional-cascading"><a class="header" href="#fractional-cascading">Fractional Cascading</a></h3>
<p><strong>Optimization</strong> for multiple sparse tables:</p>
<ul>
<li>Share common structure</li>
<li>Speed up queries further</li>
</ul>
<h2 id="key-takeaways"><a class="header" href="#key-takeaways">Key Takeaways</a></h2>
<ol>
<li><strong>Sparse tables = O(1) RMQ</strong> on static arrays</li>
<li><strong>Precompute power-of-2 ranges</strong> in O(n log n)</li>
<li><strong>Overlap okay for idempotent</strong> operations (min, max, GCD)</li>
<li><strong>Not for sum</strong> (not idempotent - overlaps count twice)</li>
<li><strong>Space O(n log n)</strong> but queries O(1)</li>
<li><strong>Classic application: LCA</strong> using Euler tour</li>
<li><strong>Better than segment tree</strong> when no updates needed</li>
<li><strong>Simple to implement</strong> (~50-60 lines)</li>
</ol>
<h2 id="when-to-use-sparse-tables"><a class="header" href="#when-to-use-sparse-tables">When to Use Sparse Tables</a></h2>
<p>✅ <strong>Use when:</strong></p>
<ul>
<li>Array is static (no updates)</li>
<li>Many range queries needed</li>
<li>Operation is idempotent (min, max, GCD, LCM)</li>
<li>O(1) query time required</li>
<li>LCA queries in trees</li>
</ul>
<p>❌ <strong>Don’t use when:</strong></p>
<ul>
<li>Need updates (use segment tree)</li>
<li>Operation not idempotent like sum (use prefix sums or segment tree)</li>
<li>Space O(n log n) too large</li>
<li>Few queries (not worth preprocessing)</li>
</ul>
<hr>
<p><strong>Time to Implement</strong>: 20-30 minutes</p>
<p><strong>Space Complexity</strong>: O(n log n)</p>
<p><strong>Most Common Interview Uses</strong>:</p>
<ul>
<li>Range minimum/maximum queries</li>
<li>Lowest common ancestor (LCA)</li>
<li>Static range statistics</li>
<li>Competitive programming RMQ</li>
</ul>
<p><strong>Pro Tip</strong>: Sparse tables are perfect when you need blazing-fast queries on static data. Remember: overlapping ranges are okay only for idempotent operations! For sum queries, use prefix sums instead. Master the O(1) query technique - it’s a game-changer for many problems!</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../data_structures/skip_lists.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../data_structures/spatial_structures.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../data_structures/skip_lists.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../data_structures/spatial_structures.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-c2a407aa.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>

<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Express.js - My Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-ae938929.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex-5e706ac8.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-82510463.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">My Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="expressjs"><a class="header" href="#expressjs">Express.js</a></h1>
<p>Express.js is a minimal and flexible Node.js web application framework that provides a robust set of features for building web and mobile applications. It’s the de facto standard server framework for Node.js and is widely used for building RESTful APIs and web applications.</p>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#installation-and-setup">Installation and Setup</a></li>
<li><a href="#basic-application">Basic Application</a></li>
<li><a href="#routing">Routing</a></li>
<li><a href="#middleware">Middleware</a></li>
<li><a href="#request-and-response">Request and Response</a></li>
<li><a href="#error-handling">Error Handling</a></li>
<li><a href="#template-engines">Template Engines</a></li>
<li><a href="#static-files">Static Files</a></li>
<li><a href="#database-integration">Database Integration</a></li>
<li><a href="#authentication">Authentication</a></li>
<li><a href="#restful-api">RESTful API</a></li>
<li><a href="#file-uploads">File Uploads</a></li>
<li><a href="#security-best-practices">Security Best Practices</a></li>
<li><a href="#testing">Testing</a></li>
<li><a href="#production-deployment">Production Deployment</a></li>
</ul>
<hr>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p><strong>Key Features:</strong></p>
<ul>
<li>Minimal and unopinionated framework</li>
<li>Robust routing system</li>
<li>Focus on high performance</li>
<li>Super-high test coverage</li>
<li>HTTP helpers (redirection, caching, etc.)</li>
<li>View system with 14+ template engines</li>
<li>Content negotiation</li>
<li>Executable for generating applications quickly</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>RESTful APIs</li>
<li>Web applications</li>
<li>Microservices</li>
<li>Real-time applications (with Socket.io)</li>
<li>Server-side rendering</li>
<li>Proxy servers</li>
</ul>
<hr>
<h2 id="installation-and-setup"><a class="header" href="#installation-and-setup">Installation and Setup</a></h2>
<h3 id="create-new-project"><a class="header" href="#create-new-project">Create New Project</a></h3>
<pre><code class="language-bash"># Create project directory
mkdir my-express-app
cd my-express-app

# Initialize npm project
npm init -y

# Install Express
npm install express

# Install development dependencies
npm install --save-dev nodemon typescript @types/node @types/express
</code></pre>
<h3 id="typescript-setup"><a class="header" href="#typescript-setup">TypeScript Setup</a></h3>
<pre><code class="language-bash"># Initialize TypeScript
npx tsc --init
</code></pre>
<p><strong>tsconfig.json:</strong></p>
<pre><code class="language-json">{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules"]
}
</code></pre>
<p><strong>package.json scripts:</strong></p>
<pre><code class="language-json">{
  "scripts": {
    "build": "tsc",
    "start": "node dist/index.js",
    "dev": "nodemon --exec ts-node src/index.ts",
    "watch": "tsc --watch"
  }
}
</code></pre>
<hr>
<h2 id="basic-application"><a class="header" href="#basic-application">Basic Application</a></h2>
<h3 id="minimal-express-app"><a class="header" href="#minimal-express-app">Minimal Express App</a></h3>
<pre><code class="language-javascript">const express = require('express');
const app = express();
const PORT = 3000;

app.get('/', (req, res) =&gt; {
  res.send('Hello World!');
});

app.listen(PORT, () =&gt; {
  console.log(`Server running on http://localhost:${PORT}`);
});
</code></pre>
<h3 id="typescript-version"><a class="header" href="#typescript-version">TypeScript Version</a></h3>
<pre><code class="language-typescript">import express, { Express, Request, Response } from 'express';

const app: Express = express();
const PORT = process.env.PORT || 3000;

app.get('/', (req: Request, res: Response) =&gt; {
  res.send('Hello World!');
});

app.listen(PORT, () =&gt; {
  console.log(`Server running on http://localhost:${PORT}`);
});
</code></pre>
<h3 id="application-structure"><a class="header" href="#application-structure">Application Structure</a></h3>
<pre><code>my-express-app/
├── src/
│   ├── index.ts              # Entry point
│   ├── config/
│   │   ├── database.ts       # Database configuration
│   │   └── environment.ts    # Environment variables
│   ├── controllers/          # Route controllers
│   │   └── userController.ts
│   ├── middleware/           # Custom middleware
│   │   ├── auth.ts
│   │   └── errorHandler.ts
│   ├── models/               # Data models
│   │   └── User.ts
│   ├── routes/               # Route definitions
│   │   └── userRoutes.ts
│   ├── services/             # Business logic
│   │   └── userService.ts
│   └── utils/                # Utility functions
│       └── validators.ts
├── tests/                    # Test files
├── dist/                     # Compiled JavaScript
├── node_modules/
├── package.json
├── tsconfig.json
└── .env
</code></pre>
<hr>
<h2 id="routing"><a class="header" href="#routing">Routing</a></h2>
<h3 id="basic-routes"><a class="header" href="#basic-routes">Basic Routes</a></h3>
<pre><code class="language-typescript">import express from 'express';
const app = express();

// GET request
app.get('/users', (req, res) =&gt; {
  res.json({ message: 'Get all users' });
});

// POST request
app.post('/users', (req, res) =&gt; {
  res.json({ message: 'Create user' });
});

// PUT request
app.put('/users/:id', (req, res) =&gt; {
  res.json({ message: `Update user ${req.params.id}` });
});

// DELETE request
app.delete('/users/:id', (req, res) =&gt; {
  res.json({ message: `Delete user ${req.params.id}` });
});

// PATCH request
app.patch('/users/:id', (req, res) =&gt; {
  res.json({ message: `Partially update user ${req.params.id}` });
});
</code></pre>
<h3 id="route-parameters"><a class="header" href="#route-parameters">Route Parameters</a></h3>
<pre><code class="language-typescript">// Single parameter
app.get('/users/:id', (req, res) =&gt; {
  const userId = req.params.id;
  res.json({ userId });
});

// Multiple parameters
app.get('/users/:userId/posts/:postId', (req, res) =&gt; {
  const { userId, postId } = req.params;
  res.json({ userId, postId });
});

// Optional parameters (using regex)
app.get('/users/:id(\\d+)?', (req, res) =&gt; {
  res.json({ id: req.params.id || 'all' });
});
</code></pre>
<h3 id="query-parameters"><a class="header" href="#query-parameters">Query Parameters</a></h3>
<pre><code class="language-typescript">// GET /search?q=express&amp;limit=10
app.get('/search', (req, res) =&gt; {
  const { q, limit = 10 } = req.query;
  res.json({ query: q, limit });
});
</code></pre>
<h3 id="route-handlers"><a class="header" href="#route-handlers">Route Handlers</a></h3>
<pre><code class="language-typescript">// Single callback
app.get('/example1', (req, res) =&gt; {
  res.send('Single callback');
});

// Multiple callbacks
app.get('/example2',
  (req, res, next) =&gt; {
    console.log('First handler');
    next();
  },
  (req, res) =&gt; {
    res.send('Second handler');
  }
);

// Array of callbacks
const cb1 = (req, res, next) =&gt; {
  console.log('CB1');
  next();
};

const cb2 = (req, res, next) =&gt; {
  console.log('CB2');
  next();
};

app.get('/example3', [cb1, cb2], (req, res) =&gt; {
  res.send('Array of callbacks');
});
</code></pre>
<h3 id="express-router"><a class="header" href="#express-router">Express Router</a></h3>
<pre><code class="language-typescript">// routes/userRoutes.ts
import { Router } from 'express';
import * as userController from '../controllers/userController';

const router = Router();

router.get('/', userController.getAllUsers);
router.get('/:id', userController.getUserById);
router.post('/', userController.createUser);
router.put('/:id', userController.updateUser);
router.delete('/:id', userController.deleteUser);

export default router;

// index.ts
import userRoutes from './routes/userRoutes';
app.use('/api/users', userRoutes);
</code></pre>
<h3 id="route-chaining"><a class="header" href="#route-chaining">Route Chaining</a></h3>
<pre><code class="language-typescript">app.route('/users')
  .get((req, res) =&gt; {
    res.json({ message: 'Get all users' });
  })
  .post((req, res) =&gt; {
    res.json({ message: 'Create user' });
  });

app.route('/users/:id')
  .get((req, res) =&gt; {
    res.json({ message: 'Get user' });
  })
  .put((req, res) =&gt; {
    res.json({ message: 'Update user' });
  })
  .delete((req, res) =&gt; {
    res.json({ message: 'Delete user' });
  });
</code></pre>
<hr>
<h2 id="middleware"><a class="header" href="#middleware">Middleware</a></h2>
<p>Middleware functions have access to request, response, and the next middleware function in the application’s request-response cycle.</p>
<h3 id="built-in-middleware"><a class="header" href="#built-in-middleware">Built-in Middleware</a></h3>
<pre><code class="language-typescript">import express from 'express';
const app = express();

// Parse JSON bodies
app.use(express.json());

// Parse URL-encoded bodies
app.use(express.urlencoded({ extended: true }));

// Serve static files
app.use(express.static('public'));
</code></pre>
<h3 id="application-level-middleware"><a class="header" href="#application-level-middleware">Application-Level Middleware</a></h3>
<pre><code class="language-typescript">// Executed for every request
app.use((req, res, next) =&gt; {
  console.log(`${req.method} ${req.url}`);
  next();
});

// Executed for specific path
app.use('/api', (req, res, next) =&gt; {
  console.log('API request');
  next();
});
</code></pre>
<h3 id="router-level-middleware"><a class="header" href="#router-level-middleware">Router-Level Middleware</a></h3>
<pre><code class="language-typescript">const router = express.Router();

router.use((req, res, next) =&gt; {
  console.log('Router middleware');
  next();
});

router.get('/users', (req, res) =&gt; {
  res.json({ message: 'Users' });
});

app.use('/api', router);
</code></pre>
<h3 id="custom-middleware"><a class="header" href="#custom-middleware">Custom Middleware</a></h3>
<pre><code class="language-typescript">// Logger middleware
const logger = (req: Request, res: Response, next: NextFunction) =&gt; {
  const timestamp = new Date().toISOString();
  console.log(`[${timestamp}] ${req.method} ${req.path}`);
  next();
};

// Request timing middleware
const requestTimer = (req: Request, res: Response, next: NextFunction) =&gt; {
  const start = Date.now();

  res.on('finish', () =&gt; {
    const duration = Date.now() - start;
    console.log(`Request took ${duration}ms`);
  });

  next();
};

// Auth middleware
const authenticate = (req: Request, res: Response, next: NextFunction) =&gt; {
  const token = req.headers.authorization;

  if (!token) {
    return res.status(401).json({ error: 'No token provided' });
  }

  try {
    // Verify token
    const decoded = verifyToken(token);
    req.user = decoded;
    next();
  } catch (error) {
    res.status(401).json({ error: 'Invalid token' });
  }
};

// Usage
app.use(logger);
app.use(requestTimer);
app.use('/api/protected', authenticate);
</code></pre>
<h3 id="third-party-middleware"><a class="header" href="#third-party-middleware">Third-Party Middleware</a></h3>
<pre><code class="language-typescript">// CORS
import cors from 'cors';
app.use(cors({
  origin: 'http://localhost:3000',
  credentials: true
}));

// Helmet (security headers)
import helmet from 'helmet';
app.use(helmet());

// Compression
import compression from 'compression';
app.use(compression());

// Cookie parser
import cookieParser from 'cookie-parser';
app.use(cookieParser());

// Morgan (HTTP request logger)
import morgan from 'morgan';
app.use(morgan('combined'));

// Express validator
import { body, validationResult } from 'express-validator';

app.post('/users',
  body('email').isEmail(),
  body('password').isLength({ min: 6 }),
  (req, res) =&gt; {
    const errors = validationResult(req);
    if (!errors.isEmpty()) {
      return res.status(400).json({ errors: errors.array() });
    }
    // Process request
  }
);
</code></pre>
<hr>
<h2 id="request-and-response"><a class="header" href="#request-and-response">Request and Response</a></h2>
<h3 id="request-object"><a class="header" href="#request-object">Request Object</a></h3>
<pre><code class="language-typescript">app.post('/example', (req: Request, res: Response) =&gt; {
  // Request body (requires body-parser or express.json())
  console.log(req.body);

  // URL parameters
  console.log(req.params);

  // Query parameters
  console.log(req.query);

  // Headers
  console.log(req.headers);
  console.log(req.get('Content-Type'));

  // Cookies (requires cookie-parser)
  console.log(req.cookies);
  console.log(req.signedCookies);

  // Request URL info
  console.log(req.protocol);      // http or https
  console.log(req.hostname);      // Host name
  console.log(req.path);          // Path part of URL
  console.log(req.originalUrl);   // Original URL
  console.log(req.baseUrl);       // Base URL

  // Request method
  console.log(req.method);        // GET, POST, etc.

  // IP address
  console.log(req.ip);
  console.log(req.ips);

  // Check content type
  console.log(req.is('json'));
  console.log(req.is('html'));

  res.send('OK');
});
</code></pre>
<h3 id="response-object"><a class="header" href="#response-object">Response Object</a></h3>
<pre><code class="language-typescript">app.get('/response-examples', (req: Request, res: Response) =&gt; {
  // Send text
  res.send('Hello World');

  // Send JSON
  res.json({ message: 'Success', data: [] });

  // Set status code and send
  res.status(201).json({ message: 'Created' });

  // Send file
  res.sendFile('/path/to/file.pdf');

  // Download file
  res.download('/path/to/file.pdf', 'filename.pdf');

  // Redirect
  res.redirect('/new-url');
  res.redirect(301, '/permanent-redirect');

  // Set headers
  res.set('Content-Type', 'text/html');
  res.set({
    'Content-Type': 'text/html',
    'X-Custom-Header': 'value'
  });

  // Set cookies
  res.cookie('name', 'value', {
    maxAge: 900000,
    httpOnly: true,
    secure: true
  });

  // Clear cookie
  res.clearCookie('name');

  // Render view (requires template engine)
  res.render('index', { title: 'Home' });

  // End response
  res.end();

  // Send status with message
  res.sendStatus(404); // Sends "Not Found"
});
</code></pre>
<h3 id="response-status-codes"><a class="header" href="#response-status-codes">Response Status Codes</a></h3>
<pre><code class="language-typescript">// Success
res.status(200).json({ message: 'OK' });
res.status(201).json({ message: 'Created' });
res.status(204).send(); // No Content

// Client Errors
res.status(400).json({ error: 'Bad Request' });
res.status(401).json({ error: 'Unauthorized' });
res.status(403).json({ error: 'Forbidden' });
res.status(404).json({ error: 'Not Found' });
res.status(422).json({ error: 'Unprocessable Entity' });

// Server Errors
res.status(500).json({ error: 'Internal Server Error' });
res.status(503).json({ error: 'Service Unavailable' });
</code></pre>
<hr>
<h2 id="error-handling"><a class="header" href="#error-handling">Error Handling</a></h2>
<h3 id="basic-error-handling"><a class="header" href="#basic-error-handling">Basic Error Handling</a></h3>
<pre><code class="language-typescript">// Synchronous error
app.get('/sync-error', (req, res) =&gt; {
  throw new Error('Synchronous error');
});

// Asynchronous error (must use next)
app.get('/async-error', (req, res, next) =&gt; {
  setTimeout(() =&gt; {
    try {
      throw new Error('Async error');
    } catch (err) {
      next(err);
    }
  }, 100);
});

// Promise rejection
app.get('/promise-error', async (req, res, next) =&gt; {
  try {
    await someAsyncOperation();
    res.json({ success: true });
  } catch (err) {
    next(err);
  }
});
</code></pre>
<h3 id="error-handling-middleware"><a class="header" href="#error-handling-middleware">Error Handling Middleware</a></h3>
<pre><code class="language-typescript">// Error handler (must have 4 parameters)
app.use((err: Error, req: Request, res: Response, next: NextFunction) =&gt; {
  console.error(err.stack);
  res.status(500).json({
    error: {
      message: err.message,
      stack: process.env.NODE_ENV === 'development' ? err.stack : undefined
    }
  });
});
</code></pre>
<h3 id="custom-error-classes"><a class="header" href="#custom-error-classes">Custom Error Classes</a></h3>
<pre><code class="language-typescript">// errors/AppError.ts
export class AppError extends Error {
  statusCode: number;
  isOperational: boolean;

  constructor(message: string, statusCode: number) {
    super(message);
    this.statusCode = statusCode;
    this.isOperational = true;

    Error.captureStackTrace(this, this.constructor);
  }
}

export class ValidationError extends AppError {
  constructor(message: string) {
    super(message, 400);
  }
}

export class NotFoundError extends AppError {
  constructor(message: string = 'Resource not found') {
    super(message, 404);
  }
}

export class UnauthorizedError extends AppError {
  constructor(message: string = 'Unauthorized') {
    super(message, 401);
  }
}

// Usage in controllers
import { NotFoundError } from '../errors/AppError';

app.get('/users/:id', async (req, res, next) =&gt; {
  try {
    const user = await findUserById(req.params.id);
    if (!user) {
      throw new NotFoundError('User not found');
    }
    res.json(user);
  } catch (err) {
    next(err);
  }
});

// Error handler
app.use((err: Error | AppError, req: Request, res: Response, next: NextFunction) =&gt; {
  if (err instanceof AppError) {
    return res.status(err.statusCode).json({
      error: {
        message: err.message,
        statusCode: err.statusCode
      }
    });
  }

  // Unknown error
  console.error('Unknown error:', err);
  res.status(500).json({
    error: {
      message: 'Internal server error'
    }
  });
});
</code></pre>
<h3 id="async-error-wrapper"><a class="header" href="#async-error-wrapper">Async Error Wrapper</a></h3>
<pre><code class="language-typescript">// utils/asyncHandler.ts
export const asyncHandler = (fn: Function) =&gt; {
  return (req: Request, res: Response, next: NextFunction) =&gt; {
    Promise.resolve(fn(req, res, next)).catch(next);
  };
};

// Usage
app.get('/users', asyncHandler(async (req: Request, res: Response) =&gt; {
  const users = await User.find();
  res.json(users);
}));
</code></pre>
<h3 id="404-handler"><a class="header" href="#404-handler">404 Handler</a></h3>
<pre><code class="language-typescript">// Catch 404 and forward to error handler
app.use((req, res, next) =&gt; {
  res.status(404).json({
    error: {
      message: 'Route not found',
      path: req.originalUrl
    }
  });
});
</code></pre>
<hr>
<h2 id="template-engines"><a class="header" href="#template-engines">Template Engines</a></h2>
<h3 id="ejs-embedded-javascript"><a class="header" href="#ejs-embedded-javascript">EJS (Embedded JavaScript)</a></h3>
<pre><code class="language-bash">npm install ejs
</code></pre>
<pre><code class="language-typescript">import express from 'express';
const app = express();

// Set view engine
app.set('view engine', 'ejs');
app.set('views', './views');

// Render template
app.get('/', (req, res) =&gt; {
  res.render('index', {
    title: 'Home Page',
    user: { name: 'John' }
  });
});
</code></pre>
<p><strong>views/index.ejs:</strong></p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;&lt;%= title %&gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;h1&gt;Welcome, &lt;%= user.name %&gt;!&lt;/h1&gt;

  &lt;% if (user.isAdmin) { %&gt;
    &lt;p&gt;Admin panel&lt;/p&gt;
  &lt;% } %&gt;

  &lt;ul&gt;
    &lt;% ['Item 1', 'Item 2', 'Item 3'].forEach(item =&gt; { %&gt;
      &lt;li&gt;&lt;%= item %&gt;&lt;/li&gt;
    &lt;% }); %&gt;
  &lt;/ul&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h3 id="pug-formerly-jade"><a class="header" href="#pug-formerly-jade">Pug (formerly Jade)</a></h3>
<pre><code class="language-bash">npm install pug
</code></pre>
<pre><code class="language-typescript">app.set('view engine', 'pug');
app.set('views', './views');

app.get('/', (req, res) =&gt; {
  res.render('index', { title: 'Home', message: 'Hello Pug!' });
});
</code></pre>
<p><strong>views/index.pug:</strong></p>
<pre><code class="language-pug">html
  head
    title= title
  body
    h1= message
    ul
      each item in ['Item 1', 'Item 2', 'Item 3']
        li= item
</code></pre>
<h3 id="handlebars"><a class="header" href="#handlebars">Handlebars</a></h3>
<pre><code class="language-bash">npm install express-handlebars
</code></pre>
<pre><code class="language-typescript">import { engine } from 'express-handlebars';

app.engine('handlebars', engine());
app.set('view engine', 'handlebars');
app.set('views', './views');

app.get('/', (req, res) =&gt; {
  res.render('home', {
    title: 'Home',
    items: ['Item 1', 'Item 2', 'Item 3']
  });
});
</code></pre>
<hr>
<h2 id="static-files"><a class="header" href="#static-files">Static Files</a></h2>
<h3 id="serving-static-files"><a class="header" href="#serving-static-files">Serving Static Files</a></h3>
<pre><code class="language-typescript">// Serve from 'public' directory
app.use(express.static('public'));

// Now you can access:
// http://localhost:3000/images/logo.png
// http://localhost:3000/css/style.css
// http://localhost:3000/js/app.js

// Multiple static directories
app.use(express.static('public'));
app.use(express.static('files'));

// Virtual path prefix
app.use('/static', express.static('public'));
// Now: http://localhost:3000/static/images/logo.png

// Absolute path
import path from 'path';
app.use('/static', express.static(path.join(__dirname, 'public')));
</code></pre>
<h3 id="static-file-options"><a class="header" href="#static-file-options">Static File Options</a></h3>
<pre><code class="language-typescript">app.use(express.static('public', {
  maxAge: '1d',           // Cache for 1 day
  dotfiles: 'ignore',     // Ignore dotfiles
  index: 'index.html',    // Directory index file
  extensions: ['html'],   // File extension fallbacks
  setHeaders: (res, path) =&gt; {
    res.set('X-Custom-Header', 'value');
  }
}));
</code></pre>
<hr>
<h2 id="database-integration"><a class="header" href="#database-integration">Database Integration</a></h2>
<h3 id="mongodb-with-mongoose"><a class="header" href="#mongodb-with-mongoose">MongoDB with Mongoose</a></h3>
<pre><code class="language-bash">npm install mongoose
</code></pre>
<pre><code class="language-typescript">// config/database.ts
import mongoose from 'mongoose';

export const connectDatabase = async () =&gt; {
  try {
    await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/myapp');
    console.log('MongoDB connected');
  } catch (error) {
    console.error('MongoDB connection error:', error);
    process.exit(1);
  }
};

// models/User.ts
import mongoose, { Document, Schema } from 'mongoose';

export interface IUser extends Document {
  name: string;
  email: string;
  password: string;
  createdAt: Date;
}

const UserSchema = new Schema({
  name: { type: String, required: true },
  email: { type: String, required: true, unique: true },
  password: { type: String, required: true },
  createdAt: { type: Date, default: Date.now }
});

export default mongoose.model&lt;IUser&gt;('User', UserSchema);

// controllers/userController.ts
import User from '../models/User';

export const getAllUsers = async (req: Request, res: Response) =&gt; {
  try {
    const users = await User.find().select('-password');
    res.json(users);
  } catch (error) {
    res.status(500).json({ error: 'Server error' });
  }
};

export const createUser = async (req: Request, res: Response) =&gt; {
  try {
    const user = new User(req.body);
    await user.save();
    res.status(201).json(user);
  } catch (error) {
    res.status(400).json({ error: 'Invalid data' });
  }
};

// index.ts
import { connectDatabase } from './config/database';

connectDatabase();
</code></pre>
<h3 id="postgresql-with-sequelize"><a class="header" href="#postgresql-with-sequelize">PostgreSQL with Sequelize</a></h3>
<pre><code class="language-bash">npm install sequelize pg pg-hstore
</code></pre>
<pre><code class="language-typescript">// config/database.ts
import { Sequelize } from 'sequelize';

export const sequelize = new Sequelize(
  process.env.DB_NAME || 'myapp',
  process.env.DB_USER || 'postgres',
  process.env.DB_PASSWORD || 'password',
  {
    host: process.env.DB_HOST || 'localhost',
    dialect: 'postgres',
    logging: false
  }
);

export const connectDatabase = async () =&gt; {
  try {
    await sequelize.authenticate();
    console.log('PostgreSQL connected');
    await sequelize.sync();
  } catch (error) {
    console.error('Database connection error:', error);
  }
};

// models/User.ts
import { DataTypes, Model } from 'sequelize';
import { sequelize } from '../config/database';

export class User extends Model {
  public id!: number;
  public name!: string;
  public email!: string;
  public readonly createdAt!: Date;
}

User.init(
  {
    id: {
      type: DataTypes.INTEGER,
      autoIncrement: true,
      primaryKey: true
    },
    name: {
      type: DataTypes.STRING,
      allowNull: false
    },
    email: {
      type: DataTypes.STRING,
      allowNull: false,
      unique: true
    }
  },
  {
    sequelize,
    tableName: 'users'
  }
);
</code></pre>
<h3 id="mysql-with-mysql2"><a class="header" href="#mysql-with-mysql2">MySQL with mysql2</a></h3>
<pre><code class="language-bash">npm install mysql2
</code></pre>
<pre><code class="language-typescript">import mysql from 'mysql2/promise';

const pool = mysql.createPool({
  host: 'localhost',
  user: 'root',
  password: 'password',
  database: 'myapp',
  waitForConnections: true,
  connectionLimit: 10,
  queueLimit: 0
});

app.get('/users', async (req, res) =&gt; {
  try {
    const [rows] = await pool.query('SELECT * FROM users');
    res.json(rows);
  } catch (error) {
    res.status(500).json({ error: 'Database error' });
  }
});
</code></pre>
<hr>
<h2 id="authentication"><a class="header" href="#authentication">Authentication</a></h2>
<h3 id="jwt-authentication"><a class="header" href="#jwt-authentication">JWT Authentication</a></h3>
<pre><code class="language-bash">npm install jsonwebtoken bcryptjs
npm install --save-dev @types/jsonwebtoken @types/bcryptjs
</code></pre>
<pre><code class="language-typescript">import jwt from 'jsonwebtoken';
import bcrypt from 'bcryptjs';

const JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key';

// Register
app.post('/auth/register', async (req, res) =&gt; {
  try {
    const { email, password, name } = req.body;

    // Check if user exists
    const existingUser = await User.findOne({ email });
    if (existingUser) {
      return res.status(400).json({ error: 'User already exists' });
    }

    // Hash password
    const hashedPassword = await bcrypt.hash(password, 10);

    // Create user
    const user = new User({
      email,
      password: hashedPassword,
      name
    });

    await user.save();

    // Generate token
    const token = jwt.sign(
      { userId: user.id, email: user.email },
      JWT_SECRET,
      { expiresIn: '7d' }
    );

    res.status(201).json({ token, user: { id: user.id, email, name } });
  } catch (error) {
    res.status(500).json({ error: 'Registration failed' });
  }
});

// Login
app.post('/auth/login', async (req, res) =&gt; {
  try {
    const { email, password } = req.body;

    // Find user
    const user = await User.findOne({ email });
    if (!user) {
      return res.status(401).json({ error: 'Invalid credentials' });
    }

    // Verify password
    const isValidPassword = await bcrypt.compare(password, user.password);
    if (!isValidPassword) {
      return res.status(401).json({ error: 'Invalid credentials' });
    }

    // Generate token
    const token = jwt.sign(
      { userId: user.id, email: user.email },
      JWT_SECRET,
      { expiresIn: '7d' }
    );

    res.json({
      token,
      user: { id: user.id, email: user.email, name: user.name }
    });
  } catch (error) {
    res.status(500).json({ error: 'Login failed' });
  }
});

// Auth middleware
interface AuthRequest extends Request {
  user?: any;
}

const authenticate = (req: AuthRequest, res: Response, next: NextFunction) =&gt; {
  try {
    const token = req.headers.authorization?.split(' ')[1];

    if (!token) {
      return res.status(401).json({ error: 'No token provided' });
    }

    const decoded = jwt.verify(token, JWT_SECRET);
    req.user = decoded;
    next();
  } catch (error) {
    res.status(401).json({ error: 'Invalid token' });
  }
};

// Protected route
app.get('/profile', authenticate, async (req: AuthRequest, res) =&gt; {
  try {
    const user = await User.findById(req.user.userId).select('-password');
    res.json(user);
  } catch (error) {
    res.status(500).json({ error: 'Server error' });
  }
});
</code></pre>
<h3 id="session-based-authentication"><a class="header" href="#session-based-authentication">Session-Based Authentication</a></h3>
<pre><code class="language-bash">npm install express-session connect-mongo
</code></pre>
<pre><code class="language-typescript">import session from 'express-session';
import MongoStore from 'connect-mongo';

app.use(session({
  secret: process.env.SESSION_SECRET || 'your-secret',
  resave: false,
  saveUninitialized: false,
  store: MongoStore.create({
    mongoUrl: process.env.MONGODB_URI
  }),
  cookie: {
    secure: process.env.NODE_ENV === 'production',
    httpOnly: true,
    maxAge: 1000 * 60 * 60 * 24 * 7 // 7 days
  }
}));

// Login
app.post('/login', async (req, res) =&gt; {
  const { email, password } = req.body;

  const user = await User.findOne({ email });
  if (!user || !(await bcrypt.compare(password, user.password))) {
    return res.status(401).json({ error: 'Invalid credentials' });
  }

  req.session.userId = user.id;
  res.json({ message: 'Logged in successfully' });
});

// Logout
app.post('/logout', (req, res) =&gt; {
  req.session.destroy((err) =&gt; {
    if (err) {
      return res.status(500).json({ error: 'Logout failed' });
    }
    res.clearCookie('connect.sid');
    res.json({ message: 'Logged out successfully' });
  });
});

// Auth middleware
const requireAuth = (req: Request, res: Response, next: NextFunction) =&gt; {
  if (!req.session.userId) {
    return res.status(401).json({ error: 'Unauthorized' });
  }
  next();
};
</code></pre>
<hr>
<h2 id="restful-api"><a class="header" href="#restful-api">RESTful API</a></h2>
<h3 id="complete-rest-api-example"><a class="header" href="#complete-rest-api-example">Complete REST API Example</a></h3>
<pre><code class="language-typescript">// routes/api/users.ts
import { Router } from 'express';
import {
  getAllUsers,
  getUserById,
  createUser,
  updateUser,
  deleteUser
} from '../../controllers/userController';
import { authenticate } from '../../middleware/auth';
import { validateUser } from '../../middleware/validation';

const router = Router();

// GET /api/users - Get all users
router.get('/', authenticate, getAllUsers);

// GET /api/users/:id - Get user by ID
router.get('/:id', authenticate, getUserById);

// POST /api/users - Create new user
router.post('/', validateUser, createUser);

// PUT /api/users/:id - Update user
router.put('/:id', authenticate, validateUser, updateUser);

// DELETE /api/users/:id - Delete user
router.delete('/:id', authenticate, deleteUser);

export default router;

// controllers/userController.ts
import { Request, Response } from 'express';
import User from '../models/User';

export const getAllUsers = async (req: Request, res: Response) =&gt; {
  try {
    const page = parseInt(req.query.page as string) || 1;
    const limit = parseInt(req.query.limit as string) || 10;
    const skip = (page - 1) * limit;

    const users = await User.find()
      .select('-password')
      .limit(limit)
      .skip(skip);

    const total = await User.countDocuments();

    res.json({
      users,
      pagination: {
        page,
        limit,
        total,
        pages: Math.ceil(total / limit)
      }
    });
  } catch (error) {
    res.status(500).json({ error: 'Server error' });
  }
};

export const getUserById = async (req: Request, res: Response) =&gt; {
  try {
    const user = await User.findById(req.params.id).select('-password');

    if (!user) {
      return res.status(404).json({ error: 'User not found' });
    }

    res.json(user);
  } catch (error) {
    res.status(500).json({ error: 'Server error' });
  }
};

export const createUser = async (req: Request, res: Response) =&gt; {
  try {
    const user = new User(req.body);
    await user.save();

    const userResponse = user.toObject();
    delete userResponse.password;

    res.status(201).json(userResponse);
  } catch (error) {
    res.status(400).json({ error: 'Invalid data' });
  }
};

export const updateUser = async (req: Request, res: Response) =&gt; {
  try {
    const user = await User.findByIdAndUpdate(
      req.params.id,
      req.body,
      { new: true, runValidators: true }
    ).select('-password');

    if (!user) {
      return res.status(404).json({ error: 'User not found' });
    }

    res.json(user);
  } catch (error) {
    res.status(400).json({ error: 'Invalid data' });
  }
};

export const deleteUser = async (req: Request, res: Response) =&gt; {
  try {
    const user = await User.findByIdAndDelete(req.params.id);

    if (!user) {
      return res.status(404).json({ error: 'User not found' });
    }

    res.status(204).send();
  } catch (error) {
    res.status(500).json({ error: 'Server error' });
  }
};
</code></pre>
<h3 id="api-versioning"><a class="header" href="#api-versioning">API Versioning</a></h3>
<pre><code class="language-typescript">// v1 routes
import v1Router from './routes/v1';
app.use('/api/v1', v1Router);

// v2 routes
import v2Router from './routes/v2';
app.use('/api/v2', v2Router);
</code></pre>
<h3 id="rate-limiting"><a class="header" href="#rate-limiting">Rate Limiting</a></h3>
<pre><code class="language-bash">npm install express-rate-limit
</code></pre>
<pre><code class="language-typescript">import rateLimit from 'express-rate-limit';

const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutes
  max: 100, // Limit each IP to 100 requests per windowMs
  message: 'Too many requests from this IP'
});

app.use('/api/', limiter);

// Different limits for different routes
const authLimiter = rateLimit({
  windowMs: 15 * 60 * 1000,
  max: 5,
  message: 'Too many login attempts'
});

app.use('/api/auth/login', authLimiter);
</code></pre>
<hr>
<h2 id="file-uploads"><a class="header" href="#file-uploads">File Uploads</a></h2>
<h3 id="multer-for-file-uploads"><a class="header" href="#multer-for-file-uploads">Multer for File Uploads</a></h3>
<pre><code class="language-bash">npm install multer
npm install --save-dev @types/multer
</code></pre>
<pre><code class="language-typescript">import multer from 'multer';
import path from 'path';

// Storage configuration
const storage = multer.diskStorage({
  destination: (req, file, cb) =&gt; {
    cb(null, 'uploads/');
  },
  filename: (req, file, cb) =&gt; {
    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);
    cb(null, file.fieldname + '-' + uniqueSuffix + path.extname(file.originalname));
  }
});

// File filter
const fileFilter = (req: Request, file: Express.Multer.File, cb: multer.FileFilterCallback) =&gt; {
  const allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];

  if (allowedTypes.includes(file.mimetype)) {
    cb(null, true);
  } else {
    cb(new Error('Invalid file type'));
  }
};

const upload = multer({
  storage: storage,
  limits: {
    fileSize: 5 * 1024 * 1024 // 5MB
  },
  fileFilter: fileFilter
});

// Single file upload
app.post('/upload', upload.single('avatar'), (req, res) =&gt; {
  if (!req.file) {
    return res.status(400).json({ error: 'No file uploaded' });
  }

  res.json({
    message: 'File uploaded successfully',
    file: {
      filename: req.file.filename,
      path: req.file.path,
      size: req.file.size
    }
  });
});

// Multiple files
app.post('/upload-multiple', upload.array('photos', 5), (req, res) =&gt; {
  res.json({
    message: 'Files uploaded successfully',
    files: req.files
  });
});

// Multiple fields
app.post('/upload-fields',
  upload.fields([
    { name: 'avatar', maxCount: 1 },
    { name: 'gallery', maxCount: 5 }
  ]),
  (req, res) =&gt; {
    res.json({
      message: 'Files uploaded successfully',
      files: req.files
    });
  }
);
</code></pre>
<hr>
<h2 id="security-best-practices"><a class="header" href="#security-best-practices">Security Best Practices</a></h2>
<h3 id="essential-security-packages"><a class="header" href="#essential-security-packages">Essential Security Packages</a></h3>
<pre><code class="language-bash">npm install helmet cors express-rate-limit express-validator
npm install --save-dev @types/cors
</code></pre>
<pre><code class="language-typescript">import helmet from 'helmet';
import cors from 'cors';
import rateLimit from 'express-rate-limit';

// Helmet - Set security headers
app.use(helmet());

// CORS configuration
app.use(cors({
  origin: process.env.ALLOWED_ORIGINS?.split(',') || 'http://localhost:3000',
  credentials: true,
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH'],
  allowedHeaders: ['Content-Type', 'Authorization']
}));

// Rate limiting
const limiter = rateLimit({
  windowMs: 15 * 60 * 1000,
  max: 100
});
app.use(limiter);

// Prevent parameter pollution
import hpp from 'hpp';
app.use(hpp());

// Sanitize data
import mongoSanitize from 'express-mongo-sanitize';
app.use(mongoSanitize());

// XSS protection
import xss from 'xss-clean';
app.use(xss());
</code></pre>
<h3 id="input-validation"><a class="header" href="#input-validation">Input Validation</a></h3>
<pre><code class="language-typescript">import { body, param, validationResult } from 'express-validator';

app.post('/users',
  body('email').isEmail().normalizeEmail(),
  body('password').isLength({ min: 8 }).matches(/\d/).matches(/[a-zA-Z]/),
  body('name').trim().isLength({ min: 2, max: 50 }),
  (req, res) =&gt; {
    const errors = validationResult(req);
    if (!errors.isEmpty()) {
      return res.status(400).json({ errors: errors.array() });
    }

    // Process request
  }
);
</code></pre>
<h3 id="sql-injection-prevention"><a class="header" href="#sql-injection-prevention">SQL Injection Prevention</a></h3>
<pre><code class="language-typescript">// Use parameterized queries
const [rows] = await pool.query(
  'SELECT * FROM users WHERE email = ?',
  [email]
);

// Use ORM/ODM
const user = await User.findOne({ email }); // Mongoose
</code></pre>
<h3 id="https-enforcement"><a class="header" href="#https-enforcement">HTTPS Enforcement</a></h3>
<pre><code class="language-typescript">// Redirect HTTP to HTTPS
app.use((req, res, next) =&gt; {
  if (req.header('x-forwarded-proto') !== 'https' &amp;&amp; process.env.NODE_ENV === 'production') {
    res.redirect(`https://${req.header('host')}${req.url}`);
  } else {
    next();
  }
});
</code></pre>
<hr>
<h2 id="testing"><a class="header" href="#testing">Testing</a></h2>
<h3 id="jest-and-supertest"><a class="header" href="#jest-and-supertest">Jest and Supertest</a></h3>
<pre><code class="language-bash">npm install --save-dev jest supertest @types/jest @types/supertest ts-jest
</code></pre>
<p><strong>jest.config.js:</strong></p>
<pre><code class="language-javascript">module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'node',
  testMatch: ['**/__tests__/**/*.ts', '**/?(*.)+(spec|test).ts'],
  collectCoverageFrom: ['src/**/*.ts', '!src/**/*.d.ts']
};
</code></pre>
<p><strong>tests/app.test.ts:</strong></p>
<pre><code class="language-typescript">import request from 'supertest';
import app from '../src/app';

describe('User API', () =&gt; {
  it('GET /api/users should return all users', async () =&gt; {
    const response = await request(app)
      .get('/api/users')
      .expect('Content-Type', /json/)
      .expect(200);

    expect(response.body).toHaveProperty('users');
    expect(Array.isArray(response.body.users)).toBe(true);
  });

  it('POST /api/users should create a user', async () =&gt; {
    const newUser = {
      name: 'John Doe',
      email: 'john@example.com',
      password: 'password123'
    };

    const response = await request(app)
      .post('/api/users')
      .send(newUser)
      .expect('Content-Type', /json/)
      .expect(201);

    expect(response.body).toHaveProperty('id');
    expect(response.body.email).toBe(newUser.email);
  });

  it('GET /api/users/:id should return a user', async () =&gt; {
    const response = await request(app)
      .get('/api/users/1')
      .expect(200);

    expect(response.body).toHaveProperty('id');
    expect(response.body).toHaveProperty('name');
  });

  it('PUT /api/users/:id should update a user', async () =&gt; {
    const updates = { name: 'Jane Doe' };

    const response = await request(app)
      .put('/api/users/1')
      .send(updates)
      .expect(200);

    expect(response.body.name).toBe(updates.name);
  });

  it('DELETE /api/users/:id should delete a user', async () =&gt; {
    await request(app)
      .delete('/api/users/1')
      .expect(204);
  });
});

describe('Authentication', () =&gt; {
  it('POST /auth/register should register a user', async () =&gt; {
    const user = {
      name: 'Test User',
      email: 'test@example.com',
      password: 'password123'
    };

    const response = await request(app)
      .post('/auth/register')
      .send(user)
      .expect(201);

    expect(response.body).toHaveProperty('token');
    expect(response.body).toHaveProperty('user');
  });

  it('POST /auth/login should login a user', async () =&gt; {
    const credentials = {
      email: 'test@example.com',
      password: 'password123'
    };

    const response = await request(app)
      .post('/auth/login')
      .send(credentials)
      .expect(200);

    expect(response.body).toHaveProperty('token');
  });
});
</code></pre>
<hr>
<h2 id="production-deployment"><a class="header" href="#production-deployment">Production Deployment</a></h2>
<h3 id="environment-variables"><a class="header" href="#environment-variables">Environment Variables</a></h3>
<p><strong>.env:</strong></p>
<pre><code>NODE_ENV=production
PORT=3000
DATABASE_URL=mongodb://localhost:27017/myapp
JWT_SECRET=your-jwt-secret
SESSION_SECRET=your-session-secret
ALLOWED_ORIGINS=https://yourdomain.com
</code></pre>
<h3 id="process-manager-pm2"><a class="header" href="#process-manager-pm2">Process Manager (PM2)</a></h3>
<pre><code class="language-bash">npm install -g pm2

# Start application
pm2 start dist/index.js --name "my-app"

# Start with cluster mode
pm2 start dist/index.js -i max --name "my-app"

# Save configuration
pm2 save

# Startup script
pm2 startup
</code></pre>
<p><strong>ecosystem.config.js:</strong></p>
<pre><code class="language-javascript">module.exports = {
  apps: [{
    name: 'my-app',
    script: './dist/index.js',
    instances: 'max',
    exec_mode: 'cluster',
    env: {
      NODE_ENV: 'production',
      PORT: 3000
    },
    error_file: './logs/error.log',
    out_file: './logs/out.log',
    log_date_format: 'YYYY-MM-DD HH:mm:ss'
  }]
};
</code></pre>
<h3 id="docker-deployment"><a class="header" href="#docker-deployment">Docker Deployment</a></h3>
<p><strong>Dockerfile:</strong></p>
<pre><code class="language-dockerfile">FROM node:18-alpine

WORKDIR /app

COPY package*.json ./

RUN npm ci --only=production

COPY . .

RUN npm run build

EXPOSE 3000

CMD ["node", "dist/index.js"]
</code></pre>
<p><strong>docker-compose.yml:</strong></p>
<pre><code class="language-yaml">version: '3.8'

services:
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=mongodb://mongo:27017/myapp
    depends_on:
      - mongo

  mongo:
    image: mongo:6
    volumes:
      - mongo-data:/data/db
    ports:
      - "27017:27017"

volumes:
  mongo-data:
</code></pre>
<h3 id="nginx-reverse-proxy"><a class="header" href="#nginx-reverse-proxy">Nginx Reverse Proxy</a></h3>
<pre><code class="language-nginx">server {
    listen 80;
    server_name yourdomain.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
</code></pre>
<h3 id="performance-optimization"><a class="header" href="#performance-optimization">Performance Optimization</a></h3>
<pre><code class="language-typescript">// Compression
import compression from 'compression';
app.use(compression());

// Response caching
import apicache from 'apicache';
const cache = apicache.middleware;

app.get('/api/users', cache('5 minutes'), getAllUsers);

// Database connection pooling
mongoose.connect(uri, {
  maxPoolSize: 10,
  minPoolSize: 5
});

// Clustering
import cluster from 'cluster';
import os from 'os';

if (cluster.isPrimary) {
  const cpuCount = os.cpus().length;

  for (let i = 0; i &lt; cpuCount; i++) {
    cluster.fork();
  }

  cluster.on('exit', (worker) =&gt; {
    console.log(`Worker ${worker.process.pid} died`);
    cluster.fork();
  });
} else {
  app.listen(PORT);
}
</code></pre>
<hr>
<h2 id="resources"><a class="header" href="#resources">Resources</a></h2>
<ul>
<li><strong>Official Documentation</strong>: <a href="https://expressjs.com/">https://expressjs.com/</a></li>
<li><strong>GitHub Repository</strong>: <a href="https://github.com/expressjs/express">https://github.com/expressjs/express</a></li>
<li><strong>Express Generator</strong>: <a href="https://expressjs.com/en/starter/generator.html">https://expressjs.com/en/starter/generator.html</a></li>
<li><strong>Best Practices</strong>: <a href="https://expressjs.com/en/advanced/best-practice-performance.html">https://expressjs.com/en/advanced/best-practice-performance.html</a></li>
</ul>
<hr>
<p>Express.js remains the most popular Node.js framework due to its simplicity, flexibility, and robust ecosystem. Its minimalist approach allows developers to structure applications as they see fit, making it suitable for everything from small APIs to large-scale enterprise applications.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../web_development/tailwind.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../web_development/nestjs.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../web_development/tailwind.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../web_development/nestjs.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-c2a407aa.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>

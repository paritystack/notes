<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Docker - My Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-ae938929.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex-4f415ad0.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-0d1c689c.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">My Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="docker"><a class="header" href="#docker">Docker</a></h1>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>Docker packages applications into containers - lightweight, isolated environments with all dependencies. Build once, run anywhere.</p>
<h2 id="core-concepts"><a class="header" href="#core-concepts">Core Concepts</a></h2>
<h3 id="images-vs-containers"><a class="header" href="#images-vs-containers">Images vs Containers</a></h3>
<ul>
<li><strong>Image</strong>: Blueprint (read-only template)</li>
<li><strong>Container</strong>: Running instance of image</li>
</ul>
<pre><code class="language-bash"># Build image
docker build -t myapp:1.0 .

# Run container from image
docker run myapp:1.0
</code></pre>
<h3 id="dockerfile"><a class="header" href="#dockerfile">Dockerfile</a></h3>
<pre><code class="language-dockerfile"># Base image
FROM python:3.9-slim

# Set working directory
WORKDIR /app

# Copy files
COPY requirements.txt .

# Install dependencies
RUN pip install -r requirements.txt

# Copy application
COPY . .

# Expose port
EXPOSE 5000

# Run command
CMD ["python", "app.py"]
</code></pre>
<h3 id="multi-stage-builds"><a class="header" href="#multi-stage-builds">Multi-stage Builds</a></h3>
<p>Multi-stage builds reduce image size by separating build and runtime environments:</p>
<pre><code class="language-dockerfile"># Stage 1: Build
FROM node:18 AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

# Stage 2: Production
FROM node:18-alpine
WORKDIR /app
COPY --from=builder /app/dist ./dist
COPY --from=builder /app/node_modules ./node_modules
COPY package*.json ./
USER node
EXPOSE 3000
CMD ["node", "dist/index.js"]
</code></pre>
<p><strong>Benefits</strong>:</p>
<ul>
<li>Smaller final image (only runtime dependencies)</li>
<li>Build tools not in production image</li>
<li>Better security (fewer attack surfaces)</li>
</ul>
<p><strong>Advanced Example</strong> (Go application):</p>
<pre><code class="language-dockerfile"># Build stage
FROM golang:1.21-alpine AS builder
WORKDIR /build
COPY go.mod go.sum ./
RUN go mod download
COPY . .
RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o app .

# Final stage
FROM alpine:latest
RUN apk --no-cache add ca-certificates
WORKDIR /root/
COPY --from=builder /build/app .
EXPOSE 8080
CMD ["./app"]
</code></pre>
<p><strong>Using Build Arguments</strong>:</p>
<pre><code class="language-dockerfile">FROM node:${NODE_VERSION:-18}-alpine AS base
ARG BUILD_ENV=production

FROM base AS builder
WORKDIR /app
COPY . .
RUN npm ci --only=${BUILD_ENV}
RUN npm run build

FROM base AS production
COPY --from=builder /app/dist ./dist
CMD ["node", "dist/server.js"]
</code></pre>
<pre><code class="language-bash"># Build with custom arguments
docker build --build-arg NODE_VERSION=20 --build-arg BUILD_ENV=development -t myapp:dev .
</code></pre>
<h2 id="docker-commands"><a class="header" href="#docker-commands">Docker Commands</a></h2>
<pre><code class="language-bash"># Build
docker build -t myapp:1.0 .

# Run
docker run -p 8000:5000 myapp:1.0
docker run -d -p 8000:5000 myapp:1.0  # Detached

# View containers
docker ps          # Running
docker ps -a       # All

# View images
docker images

# Logs
docker logs container_id

# Stop container
docker stop container_id

# Remove
docker rm container_id
docker rmi image_name

# Execute command in running container
docker exec -it container_id /bin/bash
docker exec container_id ls /app

# Copy files to/from container
docker cp ./file.txt container_id:/app/
docker cp container_id:/app/logs.txt ./

# Inspect container details
docker inspect container_id
docker inspect --format='{{.NetworkSettings.IPAddress}}' container_id

# View container resource usage
docker stats
docker stats container_id

# Create image from container
docker commit container_id myimage:tag

# Save/load images
docker save myimage:tag &gt; image.tar
docker load &lt; image.tar

# Export/import containers
docker export container_id &gt; container.tar
docker import container.tar myimage:tag

# Prune unused resources
docker system prune       # Remove unused data
docker system prune -a    # Remove all unused images
docker volume prune       # Remove unused volumes
docker network prune      # Remove unused networks
</code></pre>
<h2 id="docker-compose"><a class="header" href="#docker-compose">Docker Compose</a></h2>
<p>Multiple containers together:</p>
<pre><code class="language-yaml">version: '3.8'

services:
  web:
    build: .
    ports:
      - "8000:5000"
    environment:
      DATABASE_URL: postgres://db:5432/mydb
    depends_on:
      - db

  db:
    image: postgres:13
    environment:
      POSTGRES_PASSWORD: secret
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:
</code></pre>
<pre><code class="language-bash">docker-compose up         # Start all services
docker-compose up -d      # Start in detached mode
docker-compose down       # Stop all services
docker-compose logs -f    # Follow logs
docker-compose ps         # List containers
docker-compose exec web bash  # Execute command in service
docker-compose build      # Build or rebuild services
docker-compose restart    # Restart services
docker-compose scale web=3    # Scale service (deprecated, use --scale)
docker-compose up --scale web=3  # Scale service
</code></pre>
<h3 id="advanced-docker-compose"><a class="header" href="#advanced-docker-compose">Advanced Docker Compose</a></h3>
<p><strong>Environment Files</strong>:</p>
<pre><code class="language-yaml"># docker-compose.yml
services:
  web:
    build: .
    env_file:
      - .env
      - .env.production
    environment:
      - NODE_ENV=production
      - API_KEY=${API_KEY}  # From .env file
</code></pre>
<p><strong>Profiles</strong> (selective service startup):</p>
<pre><code class="language-yaml">services:
  web:
    image: nginx
    profiles: ["frontend"]

  api:
    image: node:18
    # Always starts (no profile)

  debug:
    image: busybox
    profiles: ["debug"]
</code></pre>
<pre><code class="language-bash"># Start only services without profiles
docker-compose up

# Start with specific profile
docker-compose --profile frontend up
docker-compose --profile debug up
</code></pre>
<p><strong>Override Files</strong> (environment-specific configs):</p>
<pre><code class="language-yaml"># docker-compose.override.yml (auto-loaded in development)
services:
  web:
    volumes:
      - ./src:/app/src  # Hot reload in dev
    environment:
      - DEBUG=true
</code></pre>
<pre><code class="language-yaml"># docker-compose.prod.yml
services:
  web:
    restart: always
    deploy:
      replicas: 3
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
</code></pre>
<pre><code class="language-bash"># Use specific override
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up
</code></pre>
<p><strong>Depends On with Health Checks</strong>:</p>
<pre><code class="language-yaml">services:
  db:
    image: postgres:15
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 5

  web:
    build: .
    depends_on:
      db:
        condition: service_healthy  # Wait for healthy status
</code></pre>
<p><strong>Networks in Compose</strong>:</p>
<pre><code class="language-yaml">services:
  frontend:
    networks:
      - frontend-net

  backend:
    networks:
      - frontend-net
      - backend-net

  database:
    networks:
      - backend-net  # Isolated from frontend

networks:
  frontend-net:
    driver: bridge
  backend-net:
    driver: bridge
    internal: true  # No external access
</code></pre>
<h2 id="docker-networking"><a class="header" href="#docker-networking">Docker Networking</a></h2>
<h3 id="network-types"><a class="header" href="#network-types">Network Types</a></h3>
<p><strong>Bridge Network</strong> (default, isolated):</p>
<pre><code class="language-bash"># Create custom bridge network
docker network create my-network

# Run containers on same network
docker run -d --name db --network my-network postgres
docker run -d --name app --network my-network myapp

# Containers can communicate via container names
# app can connect to: postgres://db:5432
</code></pre>
<p><strong>Host Network</strong> (share host’s network stack):</p>
<pre><code class="language-bash"># No port mapping needed, uses host ports directly
docker run --network host nginx
# nginx now accessible on host's port 80
</code></pre>
<p><strong>None Network</strong> (no networking):</p>
<pre><code class="language-bash">docker run --network none myapp
# Completely isolated, no network access
</code></pre>
<p><strong>Overlay Network</strong> (multi-host, Docker Swarm):</p>
<pre><code class="language-bash">docker network create --driver overlay my-overlay
# Enables container communication across multiple Docker hosts
</code></pre>
<h3 id="network-operations"><a class="header" href="#network-operations">Network Operations</a></h3>
<pre><code class="language-bash"># List networks
docker network ls

# Inspect network
docker network inspect my-network

# Connect running container to network
docker network connect my-network container_id

# Disconnect from network
docker network disconnect my-network container_id

# Remove network
docker network rm my-network
</code></pre>
<h3 id="service-discovery"><a class="header" href="#service-discovery">Service Discovery</a></h3>
<p>Containers on same network can resolve each other by name:</p>
<pre><code class="language-bash"># Start containers
docker network create app-net
docker run -d --name redis --network app-net redis
docker run -d --name web --network app-net myapp

# Inside 'web' container:
# ping redis  # Works!
# curl http://redis:6379  # Works!
</code></pre>
<h3 id="network-aliases"><a class="header" href="#network-aliases">Network Aliases</a></h3>
<pre><code class="language-bash">docker run -d --network my-net --network-alias db1 --network-alias database postgres
# Accessible as 'db1' or 'database' from other containers
</code></pre>
<h3 id="port-publishing-modes"><a class="header" href="#port-publishing-modes">Port Publishing Modes</a></h3>
<pre><code class="language-bash"># Publish to specific host port
docker run -p 8080:80 nginx

# Publish to random host port
docker run -p 80 nginx

# Publish all exposed ports to random ports
docker run -P nginx

# Publish to specific interface
docker run -p 127.0.0.1:8080:80 nginx

# UDP ports
docker run -p 53:53/udp dns-server
</code></pre>
<h2 id="resource-management"><a class="header" href="#resource-management">Resource Management</a></h2>
<h3 id="cpu-and-memory-limits"><a class="header" href="#cpu-and-memory-limits">CPU and Memory Limits</a></h3>
<p><strong>Container Resource Constraints</strong>:</p>
<pre><code class="language-bash"># Limit memory
docker run -m 512m nginx  # Max 512MB RAM
docker run --memory=1g --memory-reservation=750m myapp

# Limit CPU
docker run --cpus=1.5 myapp  # Max 1.5 CPU cores
docker run --cpu-shares=512 myapp  # Relative weight (default 1024)

# Combine limits
docker run -m 1g --cpus=2 --name myapp myimage
</code></pre>
<p><strong>Docker Compose Resource Limits</strong>:</p>
<pre><code class="language-yaml">services:
  web:
    image: nginx
    deploy:
      resources:
        limits:
          cpus: '0.50'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M
</code></pre>
<h3 id="storage-limits"><a class="header" href="#storage-limits">Storage Limits</a></h3>
<pre><code class="language-bash"># Limit container disk usage
docker run --storage-opt size=10G myapp

# Set read/write limits (bytes per second)
docker run --device-read-bps /dev/sda:1mb myapp
docker run --device-write-bps /dev/sda:1mb myapp
</code></pre>
<h3 id="process-and-file-descriptor-limits"><a class="header" href="#process-and-file-descriptor-limits">Process and File Descriptor Limits</a></h3>
<pre><code class="language-bash"># Limit number of processes
docker run --pids-limit 100 myapp

# Limit file descriptors
docker run --ulimit nofile=1024:2048 myapp

# Multiple ulimits
docker run \
  --ulimit nofile=1024:2048 \
  --ulimit nproc=512:1024 \
  myapp
</code></pre>
<h3 id="restart-policies"><a class="header" href="#restart-policies">Restart Policies</a></h3>
<pre><code class="language-bash"># No restart (default)
docker run --restart=no myapp

# Always restart
docker run --restart=always myapp

# Restart on failure only
docker run --restart=on-failure:5 myapp  # Max 5 retries

# Restart unless explicitly stopped
docker run --restart=unless-stopped myapp
</code></pre>
<p><strong>In Docker Compose</strong>:</p>
<pre><code class="language-yaml">services:
  web:
    image: nginx
    restart: unless-stopped

  worker:
    image: myworker
    restart: on-failure
</code></pre>
<h3 id="health-checks"><a class="header" href="#health-checks">Health Checks</a></h3>
<p><strong>Dockerfile</strong>:</p>
<pre><code class="language-dockerfile">FROM nginx
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost/ || exit 1
</code></pre>
<p><strong>Docker Run</strong>:</p>
<pre><code class="language-bash">docker run \
  --health-cmd="curl -f http://localhost/ || exit 1" \
  --health-interval=30s \
  --health-timeout=3s \
  --health-retries=3 \
  nginx
</code></pre>
<p><strong>Docker Compose</strong>:</p>
<pre><code class="language-yaml">services:
  web:
    image: nginx
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 40s
</code></pre>
<p><strong>Check Health Status</strong>:</p>
<pre><code class="language-bash">docker ps  # Shows (healthy), (unhealthy), (health: starting)
docker inspect --format='{{.State.Health.Status}}' container_id
</code></pre>
<h2 id="security-patterns"><a class="header" href="#security-patterns">Security Patterns</a></h2>
<h3 id="running-as-non-root-user"><a class="header" href="#running-as-non-root-user">Running as Non-Root User</a></h3>
<p><strong>Dockerfile</strong>:</p>
<pre><code class="language-dockerfile">FROM node:18-alpine

# Create app user
RUN addgroup -g 1001 -S nodejs &amp;&amp; \
    adduser -S nodejs -u 1001

WORKDIR /app
COPY --chown=nodejs:nodejs . .

# Switch to non-root user
USER nodejs

EXPOSE 3000
CMD ["node", "server.js"]
</code></pre>
<p><strong>At Runtime</strong>:</p>
<pre><code class="language-bash">docker run --user 1001:1001 myapp
docker run --user nobody myapp
</code></pre>
<h3 id="secrets-management"><a class="header" href="#secrets-management">Secrets Management</a></h3>
<p><strong>Docker Secrets</strong> (Swarm mode):</p>
<pre><code class="language-bash"># Create secret
echo "my-secret-password" | docker secret create db_password -

# Use in service
docker service create \
  --secret db_password \
  --name myapp \
  myimage

# Inside container, secret available at:
# /run/secrets/db_password
</code></pre>
<p><strong>Docker Compose with Secrets</strong>:</p>
<pre><code class="language-yaml">version: '3.8'

services:
  db:
    image: postgres
    secrets:
      - db_password
    environment:
      POSTGRES_PASSWORD_FILE: /run/secrets/db_password

secrets:
  db_password:
    file: ./secrets/db_password.txt
</code></pre>
<p><strong>Build Secrets</strong> (BuildKit):</p>
<pre><code class="language-dockerfile"># syntax=docker/dockerfile:1
FROM alpine

# Mount secret during build only (not in final image)
RUN --mount=type=secret,id=github_token \
    TOKEN=$(cat /run/secrets/github_token) &amp;&amp; \
    git clone https://$TOKEN@github.com/private/repo.git
</code></pre>
<pre><code class="language-bash">docker build --secret id=github_token,src=./token.txt -t myapp .
</code></pre>
<h3 id="read-only-root-filesystem"><a class="header" href="#read-only-root-filesystem">Read-only Root Filesystem</a></h3>
<pre><code class="language-bash">docker run --read-only --tmpfs /tmp myapp
</code></pre>
<pre><code class="language-yaml">services:
  web:
    image: nginx
    read_only: true
    tmpfs:
      - /tmp
      - /var/run
</code></pre>
<h3 id="security-options"><a class="header" href="#security-options">Security Options</a></h3>
<pre><code class="language-bash"># Drop all capabilities, add only needed ones
docker run \
  --cap-drop=ALL \
  --cap-add=NET_BIND_SERVICE \
  nginx

# Disable privilege escalation
docker run --security-opt=no-new-privileges:true myapp

# AppArmor profile
docker run --security-opt apparmor=docker-default myapp

# Seccomp profile
docker run --security-opt seccomp=profile.json myapp
</code></pre>
<h3 id="image-scanning"><a class="header" href="#image-scanning">Image Scanning</a></h3>
<pre><code class="language-bash"># Scan image for vulnerabilities (requires Docker Scout)
docker scout cve myimage:latest

# Using Trivy (third-party)
docker run aquasec/trivy image myimage:latest

# Scan during build in CI/CD
docker build -t myapp .
docker scout cve myapp
</code></pre>
<h3 id="best-practices-summary"><a class="header" href="#best-practices-summary">Best Practices Summary</a></h3>
<p><strong>Security Checklist</strong>:</p>
<ul>
<li>✓ Use official base images</li>
<li>✓ Run as non-root user</li>
<li>✓ Use specific image tags (not :latest)</li>
<li>✓ Scan images for vulnerabilities</li>
<li>✓ Use secrets management (never hardcode)</li>
<li>✓ Minimize attack surface (multi-stage builds)</li>
<li>✓ Keep images updated</li>
<li>✓ Use read-only filesystems where possible</li>
<li>✓ Limit container capabilities</li>
</ul>
<h2 id="image-optimization"><a class="header" href="#image-optimization">Image Optimization</a></h2>
<h3 id="layer-caching-strategy"><a class="header" href="#layer-caching-strategy">Layer Caching Strategy</a></h3>
<p>Order Dockerfile commands by change frequency (least to most):</p>
<pre><code class="language-dockerfile"># Anti-pattern: Cache invalidated on any code change
FROM node:18
WORKDIR /app
COPY . .                    # ❌ Copies everything first
RUN npm install             # ❌ Reinstalls on any file change

# Best practice: Maximize cache reuse
FROM node:18
WORKDIR /app
COPY package*.json ./       # ✓ Only dependencies
RUN npm ci                  # ✓ Cached unless package.json changes
COPY . .                    # ✓ Code copied last
RUN npm run build           # ✓ Only rebuilds if code changed
</code></pre>
<h3 id="minimize-image-size"><a class="header" href="#minimize-image-size">Minimize Image Size</a></h3>
<p><strong>Use Minimal Base Images</strong>:</p>
<pre><code class="language-dockerfile"># Large: 1.1GB
FROM ubuntu:22.04

# Medium: 350MB
FROM node:18

# Small: 180MB
FROM node:18-slim

# Smallest: 120MB
FROM node:18-alpine
</code></pre>
<p><strong>Remove Build Dependencies</strong>:</p>
<pre><code class="language-dockerfile"># Install and cleanup in single layer
FROM alpine:3.18
RUN apk add --no-cache --virtual .build-deps \
        gcc \
        musl-dev \
        postgresql-dev \
    &amp;&amp; pip install --no-cache-dir psycopg2 \
    &amp;&amp; apk del .build-deps  # Remove build tools
</code></pre>
<p><strong>Combine Commands</strong>:</p>
<pre><code class="language-dockerfile"># Bad: Creates 3 layers
RUN apt-get update
RUN apt-get install -y curl
RUN rm -rf /var/lib/apt/lists/*

# Good: Single layer
RUN apt-get update &amp;&amp; \
    apt-get install -y curl &amp;&amp; \
    rm -rf /var/lib/apt/lists/*
</code></pre>
<p><strong>Use .dockerignore</strong>:</p>
<pre><code class="language-dockerignore"># .dockerignore
node_modules
npm-debug.log
.git
.env
*.md
.vscode
dist
coverage
.pytest_cache
__pycache__
</code></pre>
<h3 id="buildkit-optimizations"><a class="header" href="#buildkit-optimizations">BuildKit Optimizations</a></h3>
<p>Enable BuildKit for better performance:</p>
<pre><code class="language-bash">export DOCKER_BUILDKIT=1
docker build .
</code></pre>
<p><strong>Cache Mounts</strong> (don’t include in final image):</p>
<pre><code class="language-dockerfile"># syntax=docker/dockerfile:1
FROM node:18

WORKDIR /app
COPY package*.json ./

# Mount npm cache, faster rebuilds
RUN --mount=type=cache,target=/root/.npm \
    npm ci

COPY . .
RUN npm run build
</code></pre>
<p><strong>Parallel Builds</strong>:</p>
<pre><code class="language-dockerfile"># syntax=docker/dockerfile:1
FROM alpine AS fetch-deps
RUN apk add --no-cache curl
RUN curl -O https://example.com/file1.tar.gz

FROM alpine AS build
COPY --from=fetch-deps /file1.tar.gz .
RUN tar -xzf file1.tar.gz &amp;&amp; make

FROM alpine
COPY --from=build /app .
</code></pre>
<h3 id="analyzing-image-size"><a class="header" href="#analyzing-image-size">Analyzing Image Size</a></h3>
<pre><code class="language-bash"># View image layers and sizes
docker history myimage:latest

# Show layer details
docker history --no-trunc myimage:latest

# Use dive for interactive analysis
docker run --rm -it \
    -v /var/run/docker.sock:/var/run/docker.sock \
    wagoodman/dive:latest myimage:latest
</code></pre>
<h2 id="debugging--troubleshooting"><a class="header" href="#debugging--troubleshooting">Debugging &amp; Troubleshooting</a></h2>
<h3 id="debugging-containers"><a class="header" href="#debugging-containers">Debugging Containers</a></h3>
<p><strong>Access Running Container</strong>:</p>
<pre><code class="language-bash"># Interactive shell
docker exec -it container_id /bin/sh
docker exec -it container_id /bin/bash

# Run specific command
docker exec container_id ps aux
docker exec container_id cat /var/log/app.log
</code></pre>
<p><strong>Debug Non-Starting Container</strong>:</p>
<pre><code class="language-bash"># Override entrypoint to investigate
docker run -it --entrypoint /bin/sh myimage

# Check why container exited
docker logs container_id
docker inspect container_id --format='{{.State.ExitCode}}'
</code></pre>
<p><strong>Copy Files for Analysis</strong>:</p>
<pre><code class="language-bash"># Copy logs out
docker cp container_id:/var/log/app.log ./app.log

# Copy config file in
docker cp ./new-config.yml container_id:/etc/config.yml
</code></pre>
<h3 id="build-debugging"><a class="header" href="#build-debugging">Build Debugging</a></h3>
<p><strong>Show Build Output</strong>:</p>
<pre><code class="language-bash"># No cache, show all output
docker build --no-cache --progress=plain .

# Stop at specific stage for debugging
docker build --target builder -t debug-image .
docker run -it debug-image /bin/sh
</code></pre>
<p><strong>Check Build Context</strong>:</p>
<pre><code class="language-bash"># See what's being sent to Docker daemon
docker build --no-cache . 2&gt;&amp;1 | grep "Sending build context"
</code></pre>
<h3 id="common-issues"><a class="header" href="#common-issues">Common Issues</a></h3>
<p><strong>Issue: Container Exits Immediately</strong></p>
<pre><code class="language-bash"># Check logs
docker logs container_id

# Common causes:
# 1. Main process exits (use tail -f, or proper daemon)
# 2. Command not found
# 3. Permission issues

# Debug:
docker run -it myimage /bin/sh  # Override CMD
</code></pre>
<p><strong>Issue: Cannot Connect to Container</strong></p>
<pre><code class="language-bash"># Check if port is published
docker port container_id

# Check if service is listening
docker exec container_id netstat -tlnp

# Check network
docker inspect container_id --format='{{.NetworkSettings.IPAddress}}'
</code></pre>
<p><strong>Issue: Out of Disk Space</strong></p>
<pre><code class="language-bash"># Check Docker disk usage
docker system df

# Detailed view
docker system df -v

# Clean up
docker system prune -a  # Remove all unused
docker volume prune     # Remove unused volumes
docker image prune -a   # Remove unused images
</code></pre>
<p><strong>Issue: DNS Resolution Fails</strong></p>
<pre><code class="language-bash"># Test DNS in container
docker exec container_id nslookup google.com
docker exec container_id cat /etc/resolv.conf

# Set custom DNS
docker run --dns 8.8.8.8 --dns 8.8.4.4 myimage
</code></pre>
<h3 id="monitoring-and-logs"><a class="header" href="#monitoring-and-logs">Monitoring and Logs</a></h3>
<p><strong>Real-time Logs</strong>:</p>
<pre><code class="language-bash"># Follow logs
docker logs -f container_id

# Last 100 lines
docker logs --tail 100 container_id

# Since specific time
docker logs --since 2024-01-01T00:00:00 container_id

# Multiple containers
docker-compose logs -f web db
</code></pre>
<p><strong>Resource Monitoring</strong>:</p>
<pre><code class="language-bash"># Real-time stats
docker stats

# Single container
docker stats container_id

# No streaming (snapshot)
docker stats --no-stream

# Custom format
docker stats --format "table {{.Name}}\t{{.CPUPerc}}\t{{.MemUsage}}"
</code></pre>
<p><strong>Events</strong>:</p>
<pre><code class="language-bash"># Watch Docker events
docker events

# Filter events
docker events --filter type=container
docker events --filter event=start
</code></pre>
<h3 id="performance-troubleshooting"><a class="header" href="#performance-troubleshooting">Performance Troubleshooting</a></h3>
<p><strong>Slow Container</strong>:</p>
<pre><code class="language-bash"># Check resource usage
docker stats container_id

# Check if CPU/memory limited
docker inspect container_id --format='{{.HostConfig.Memory}}'
docker inspect container_id --format='{{.HostConfig.CpuShares}}'

# Check I/O
docker exec container_id iostat
</code></pre>
<p><strong>Slow Build</strong>:</p>
<pre><code class="language-bash"># Enable BuildKit for better performance
export DOCKER_BUILDKIT=1

# Use build cache from registry
docker build --cache-from myregistry/myapp:latest .

# Parallel builds
docker build --parallel .
</code></pre>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<ol>
<li><strong>Small images</strong>: Use minimal base images (alpine)</li>
<li><strong>Layer caching</strong>: Order commands by change frequency</li>
<li><strong>Security</strong>: Don’t run as root, use secrets</li>
<li><strong>Health checks</strong>: Monitor container health</li>
<li><strong>Resource limits</strong>: Always set memory/CPU limits in production</li>
<li><strong>Logging</strong>: Use structured logging, log to stdout/stderr</li>
<li><strong>Secrets</strong>: Never hardcode, use Docker secrets or env vars</li>
<li><strong>Single process</strong>: One process per container</li>
<li><strong>Immutable infrastructure</strong>: Rebuild images, don’t modify running containers</li>
</ol>
<pre><code class="language-dockerfile"># Good: Optimized production image
FROM python:3.9-slim

# Non-root user
RUN useradd -m -u 1000 appuser

WORKDIR /app

# Dependencies first (caching)
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Application code
COPY --chown=appuser:appuser . .

# Switch to non-root
USER appuser

# Health check
HEALTHCHECK --interval=30s --timeout=3s \
    CMD python -c "import requests; requests.get('http://localhost:8000/health')"

EXPOSE 8000
CMD ["gunicorn", "-b", "0.0.0.0:8000", "app:app"]
</code></pre>
<h2 id="volumes"><a class="header" href="#volumes">Volumes</a></h2>
<h3 id="volume-types"><a class="header" href="#volume-types">Volume Types</a></h3>
<p><strong>Named Volumes</strong> (managed by Docker):</p>
<pre><code class="language-bash"># Create named volume
docker volume create my-data

# Use volume
docker run -v my-data:/app/data myapp

# Inspect volume
docker volume inspect my-data

# List volumes
docker volume ls

# Remove volume
docker volume rm my-data
</code></pre>
<p><strong>Bind Mounts</strong> (host filesystem):</p>
<pre><code class="language-bash"># Mount host directory (absolute path required)
docker run -v /host/path:/container/path myapp

# Read-only mount
docker run -v /host/path:/container/path:ro myapp

# Use with relative path (requires pwd)
docker run -v "$(pwd)":/app myapp
</code></pre>
<p><strong>tmpfs Mounts</strong> (in-memory, temporary):</p>
<pre><code class="language-bash"># Temporary in-memory storage
docker run --tmpfs /tmp myapp

# With size limit
docker run --tmpfs /tmp:rw,size=100m myapp
</code></pre>
<h3 id="volume-operations"><a class="header" href="#volume-operations">Volume Operations</a></h3>
<pre><code class="language-bash"># Create with driver options
docker volume create --driver local \
    --opt type=nfs \
    --opt o=addr=192.168.1.1,rw \
    --opt device=:/path/to/dir \
    my-nfs-volume

# Copy data between volumes
docker run --rm \
    -v old-volume:/from \
    -v new-volume:/to \
    alpine sh -c "cp -av /from/* /to/"

# Backup volume
docker run --rm \
    -v my-volume:/data \
    -v $(pwd):/backup \
    alpine tar czf /backup/backup.tar.gz -C /data .

# Restore volume
docker run --rm \
    -v my-volume:/data \
    -v $(pwd):/backup \
    alpine sh -c "rm -rf /data/* &amp;&amp; tar xzf /backup/backup.tar.gz -C /data"
</code></pre>
<h3 id="volumes-in-docker-compose"><a class="header" href="#volumes-in-docker-compose">Volumes in Docker Compose</a></h3>
<pre><code class="language-yaml">version: '3.8'

services:
  db:
    image: postgres:15
    volumes:
      # Named volume
      - postgres-data:/var/lib/postgresql/data
      # Bind mount
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql:ro
      # Anonymous volume
      - /var/lib/postgresql

  app:
    build: .
    volumes:
      # Development: hot reload
      - ./src:/app/src
      # Don't overwrite node_modules
      - /app/node_modules

volumes:
  postgres-data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /data/postgres
</code></pre>
<h3 id="volume-backup-strategies"><a class="header" href="#volume-backup-strategies">Volume Backup Strategies</a></h3>
<p><strong>Automated Backup Script</strong>:</p>
<pre><code class="language-bash">#!/bin/bash
VOLUME_NAME="postgres-data"
BACKUP_DIR="/backups"
DATE=$(date +%Y%m%d_%H%M%S)

docker run --rm \
    -v $VOLUME_NAME:/source:ro \
    -v $BACKUP_DIR:/backup \
    alpine tar czf /backup/${VOLUME_NAME}_${DATE}.tar.gz -C /source .

# Keep only last 7 backups
find $BACKUP_DIR -name "${VOLUME_NAME}_*.tar.gz" -mtime +7 -delete
</code></pre>
<p><strong>Database-Specific Backups</strong>:</p>
<pre><code class="language-bash"># PostgreSQL dump
docker exec postgres_container pg_dump -U user dbname &gt; backup.sql

# MySQL dump
docker exec mysql_container mysqldump -u user -p dbname &gt; backup.sql

# MongoDB dump
docker exec mongo_container mongodump --out /backup
</code></pre>
<h2 id="cicd-integration"><a class="header" href="#cicd-integration">CI/CD Integration</a></h2>
<h3 id="building-images-in-pipelines"><a class="header" href="#building-images-in-pipelines">Building Images in Pipelines</a></h3>
<p><strong>GitHub Actions</strong>:</p>
<pre><code class="language-yaml">name: Docker Build and Push

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      - name: Login to Docker Hub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      - name: Build and push
        uses: docker/build-push-action@v4
        with:
          context: .
          push: true
          tags: |
            myorg/myapp:latest
            myorg/myapp:${{ github.sha }}
          cache-from: type=registry,ref=myorg/myapp:latest
          cache-to: type=inline
</code></pre>
<p><strong>GitLab CI</strong>:</p>
<pre><code class="language-yaml"># .gitlab-ci.yml
stages:
  - build
  - test
  - deploy

variables:
  DOCKER_DRIVER: overlay2
  DOCKER_TLS_CERTDIR: "/certs"

build:
  stage: build
  image: docker:latest
  services:
    - docker:dind
  before_script:
    - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
  script:
    - docker build -t $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA .
    - docker tag $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA $CI_REGISTRY_IMAGE:latest
    - docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
    - docker push $CI_REGISTRY_IMAGE:latest
</code></pre>
<p><strong>Jenkins Pipeline</strong>:</p>
<pre><code class="language-groovy">pipeline {
    agent any

    environment {
        DOCKER_IMAGE = "myorg/myapp"
        DOCKER_TAG = "${env.BUILD_NUMBER}"
    }

    stages {
        stage('Build') {
            steps {
                script {
                    docker.build("${DOCKER_IMAGE}:${DOCKER_TAG}")
                }
            }
        }

        stage('Test') {
            steps {
                script {
                    docker.image("${DOCKER_IMAGE}:${DOCKER_TAG}").inside {
                        sh 'npm test'
                    }
                }
            }
        }

        stage('Push') {
            steps {
                script {
                    docker.withRegistry('https://registry.hub.docker.com', 'docker-credentials') {
                        docker.image("${DOCKER_IMAGE}:${DOCKER_TAG}").push()
                        docker.image("${DOCKER_IMAGE}:${DOCKER_TAG}").push('latest')
                    }
                }
            }
        }
    }
}
</code></pre>
<h3 id="registry-operations"><a class="header" href="#registry-operations">Registry Operations</a></h3>
<p><strong>Docker Hub</strong>:</p>
<pre><code class="language-bash"># Login
docker login

# Tag image
docker tag myapp:latest myusername/myapp:1.0

# Push to Docker Hub
docker push myusername/myapp:1.0

# Pull from Docker Hub
docker pull myusername/myapp:1.0
</code></pre>
<p><strong>Private Registry</strong>:</p>
<pre><code class="language-bash"># Run private registry
docker run -d -p 5000:5000 --name registry registry:2

# Tag for private registry
docker tag myapp localhost:5000/myapp:1.0

# Push to private registry
docker push localhost:5000/myapp:1.0

# Pull from private registry
docker pull localhost:5000/myapp:1.0
</code></pre>
<p><strong>Amazon ECR</strong>:</p>
<pre><code class="language-bash"># Login to ECR
aws ecr get-login-password --region us-east-1 | \
    docker login --username AWS --password-stdin \
    123456789.dkr.ecr.us-east-1.amazonaws.com

# Tag and push
docker tag myapp:latest 123456789.dkr.ecr.us-east-1.amazonaws.com/myapp:latest
docker push 123456789.dkr.ecr.us-east-1.amazonaws.com/myapp:latest
</code></pre>
<p><strong>Google Container Registry (GCR)</strong>:</p>
<pre><code class="language-bash"># Configure Docker for GCR
gcloud auth configure-docker

# Tag and push
docker tag myapp gcr.io/project-id/myapp:latest
docker push gcr.io/project-id/myapp:latest
</code></pre>
<h3 id="multi-platform-builds"><a class="header" href="#multi-platform-builds">Multi-platform Builds</a></h3>
<pre><code class="language-bash"># Create builder
docker buildx create --name multiplatform --use

# Build for multiple platforms
docker buildx build \
    --platform linux/amd64,linux/arm64,linux/arm/v7 \
    -t myorg/myapp:latest \
    --push .
</code></pre>
<h3 id="container-deployment-patterns"><a class="header" href="#container-deployment-patterns">Container Deployment Patterns</a></h3>
<p><strong>Blue-Green Deployment</strong>:</p>
<pre><code class="language-bash"># Deploy new version (green)
docker run -d --name app-green -p 8081:8080 myapp:v2

# Test green deployment
curl http://localhost:8081/health

# Switch traffic (update load balancer or swap ports)
docker stop app-blue
docker rm app-blue
docker run -d --name app-blue -p 8080:8080 myapp:v2
docker stop app-green
docker rm app-green
</code></pre>
<p><strong>Rolling Update with Docker Swarm</strong>:</p>
<pre><code class="language-bash"># Initialize swarm
docker swarm init

# Create service
docker service create \
    --name myapp \
    --replicas 3 \
    --update-parallelism 1 \
    --update-delay 10s \
    myapp:v1

# Update service (rolling update)
docker service update --image myapp:v2 myapp
</code></pre>
<h2 id="development-workflows"><a class="header" href="#development-workflows">Development Workflows</a></h2>
<h3 id="hot-reload-development"><a class="header" href="#hot-reload-development">Hot Reload Development</a></h3>
<p><strong>Node.js with Nodemon</strong>:</p>
<pre><code class="language-dockerfile"># Dockerfile.dev
FROM node:18
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
CMD ["npm", "run", "dev"]  # Uses nodemon
</code></pre>
<pre><code class="language-yaml"># docker-compose.dev.yml
services:
  web:
    build:
      context: .
      dockerfile: Dockerfile.dev
    volumes:
      - ./src:/app/src  # Hot reload on changes
      - /app/node_modules  # Don't overwrite
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=development
</code></pre>
<p><strong>Python with Flask</strong>:</p>
<pre><code class="language-dockerfile"># Dockerfile.dev
FROM python:3.9
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
CMD ["flask", "run", "--host=0.0.0.0", "--reload"]
</code></pre>
<pre><code class="language-yaml">services:
  api:
    build:
      context: .
      dockerfile: Dockerfile.dev
    volumes:
      - ./app:/app  # Hot reload
    environment:
      - FLASK_ENV=development
      - FLASK_DEBUG=1
</code></pre>
<h3 id="debugging-in-containers"><a class="header" href="#debugging-in-containers">Debugging in Containers</a></h3>
<p><strong>Node.js Debugging</strong>:</p>
<pre><code class="language-yaml">services:
  web:
    build: .
    ports:
      - "9229:9229"  # Debug port
    command: node --inspect=0.0.0.0:9229 server.js
    volumes:
      - ./src:/app/src
</code></pre>
<p><strong>Python Debugging (pdb)</strong>:</p>
<pre><code class="language-yaml">services:
  api:
    build: .
    stdin_open: true  # Enable interactive mode
    tty: true
    command: python -m pdb app.py
</code></pre>
<p><strong>Remote Debugging with VS Code</strong>:</p>
<pre><code class="language-json">// .vscode/launch.json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Docker: Attach to Node",
      "type": "node",
      "request": "attach",
      "port": 9229,
      "address": "localhost",
      "localRoot": "${workspaceFolder}",
      "remoteRoot": "/app",
      "protocol": "inspector"
    }
  ]
}
</code></pre>
<h3 id="local-development-environment"><a class="header" href="#local-development-environment">Local Development Environment</a></h3>
<p><strong>Complete Dev Stack</strong>:</p>
<pre><code class="language-yaml"># docker-compose.yml
version: '3.8'

services:
  # Frontend
  frontend:
    build: ./frontend
    volumes:
      - ./frontend/src:/app/src
      - /app/node_modules
    ports:
      - "3000:3000"
    environment:
      - REACT_APP_API_URL=http://localhost:4000

  # Backend API
  backend:
    build: ./backend
    volumes:
      - ./backend/src:/app/src
      - /app/node_modules
    ports:
      - "4000:4000"
      - "9229:9229"  # Debug port
    environment:
      - NODE_ENV=development
      - DATABASE_URL=postgres://user:pass@db:5432/mydb
      - REDIS_URL=redis://redis:6379
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_started

  # PostgreSQL
  db:
    image: postgres:15-alpine
    volumes:
      - postgres-data:/var/lib/postgresql/data
      - ./db/init.sql:/docker-entrypoint-initdb.d/init.sql
    environment:
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=pass
      - POSTGRES_DB=mydb
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U user"]
      interval: 5s
      timeout: 5s
      retries: 5

  # Redis
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data

  # Nginx (reverse proxy)
  nginx:
    image: nginx:alpine
    volumes:
      - ./nginx/dev.conf:/etc/nginx/nginx.conf:ro
    ports:
      - "80:80"
    depends_on:
      - frontend
      - backend

volumes:
  postgres-data:
  redis-data:
</code></pre>
<h3 id="testing-workflows"><a class="header" href="#testing-workflows">Testing Workflows</a></h3>
<p><strong>Run Tests in Container</strong>:</p>
<pre><code class="language-bash"># Run tests
docker-compose run --rm backend npm test

# Run specific test
docker-compose run --rm backend npm test -- user.test.js

# Run with coverage
docker-compose run --rm backend npm run test:coverage
</code></pre>
<p><strong>Integration Tests</strong>:</p>
<pre><code class="language-yaml"># docker-compose.test.yml
services:
  test:
    build: .
    command: npm test
    environment:
      - NODE_ENV=test
      - DATABASE_URL=postgres://test:test@test-db:5432/testdb
    depends_on:
      - test-db

  test-db:
    image: postgres:15-alpine
    environment:
      - POSTGRES_USER=test
      - POSTGRES_PASSWORD=test
      - POSTGRES_DB=testdb
    tmpfs:
      - /var/lib/postgresql/data  # In-memory for speed
</code></pre>
<pre><code class="language-bash"># Run integration tests
docker-compose -f docker-compose.test.yml up --abort-on-container-exit
</code></pre>
<h2 id="real-world-example-full-stack-application"><a class="header" href="#real-world-example-full-stack-application">Real-World Example: Full-Stack Application</a></h2>
<h3 id="project-structure"><a class="header" href="#project-structure">Project Structure</a></h3>
<pre><code>myapp/
├── frontend/
│   ├── Dockerfile
│   ├── Dockerfile.dev
│   └── src/
├── backend/
│   ├── Dockerfile
│   ├── Dockerfile.dev
│   └── src/
├── nginx/
│   ├── nginx.conf
│   └── ssl/
├── docker-compose.yml
├── docker-compose.prod.yml
└── docker-compose.dev.yml
</code></pre>
<h3 id="frontend-dockerfile-react"><a class="header" href="#frontend-dockerfile-react">Frontend Dockerfile (React)</a></h3>
<pre><code class="language-dockerfile"># Build stage
FROM node:18-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
RUN npm run build

# Production stage
FROM nginx:alpine
COPY --from=builder /app/build /usr/share/nginx/html
COPY nginx/default.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
</code></pre>
<h3 id="backend-dockerfile-nodejs-api"><a class="header" href="#backend-dockerfile-nodejs-api">Backend Dockerfile (Node.js API)</a></h3>
<pre><code class="language-dockerfile"># Dependencies stage
FROM node:18-alpine AS deps
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

# Build stage
FROM node:18-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

# Production stage
FROM node:18-alpine
RUN addgroup -g 1001 -S nodejs &amp;&amp; \
    adduser -S nodejs -u 1001
WORKDIR /app
COPY --from=deps --chown=nodejs:nodejs /app/node_modules ./node_modules
COPY --from=builder --chown=nodejs:nodejs /app/dist ./dist
COPY --chown=nodejs:nodejs package*.json ./
USER nodejs
EXPOSE 4000
CMD ["node", "dist/index.js"]
</code></pre>
<h3 id="production-docker-compose"><a class="header" href="#production-docker-compose">Production Docker Compose</a></h3>
<pre><code class="language-yaml"># docker-compose.prod.yml
version: '3.8'

services:
  frontend:
    image: myorg/frontend:${VERSION:-latest}
    restart: unless-stopped
    networks:
      - frontend-net

  backend:
    image: myorg/backend:${VERSION:-latest}
    restart: unless-stopped
    environment:
      - NODE_ENV=production
      - DATABASE_URL_FILE=/run/secrets/db_url
      - JWT_SECRET_FILE=/run/secrets/jwt_secret
    secrets:
      - db_url
      - jwt_secret
    depends_on:
      - db
      - redis
    networks:
      - frontend-net
      - backend-net
    deploy:
      replicas: 3
      resources:
        limits:
          cpus: '0.5'
          memory: 512M

  db:
    image: postgres:15-alpine
    restart: unless-stopped
    environment:
      - POSTGRES_PASSWORD_FILE=/run/secrets/db_password
    secrets:
      - db_password
    volumes:
      - postgres-data:/var/lib/postgresql/data
    networks:
      - backend-net
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 1G

  redis:
    image: redis:7-alpine
    restart: unless-stopped
    volumes:
      - redis-data:/data
    networks:
      - backend-net

  nginx:
    image: nginx:alpine
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/prod.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/ssl:/etc/nginx/ssl:ro
      - nginx-cache:/var/cache/nginx
    depends_on:
      - frontend
      - backend
    networks:
      - frontend-net

networks:
  frontend-net:
  backend-net:
    internal: true

volumes:
  postgres-data:
  redis-data:
  nginx-cache:

secrets:
  db_url:
    file: ./secrets/db_url.txt
  db_password:
    file: ./secrets/db_password.txt
  jwt_secret:
    file: ./secrets/jwt_secret.txt
</code></pre>
<h3 id="deployment-commands"><a class="header" href="#deployment-commands">Deployment Commands</a></h3>
<pre><code class="language-bash"># Build images
docker-compose -f docker-compose.prod.yml build

# Tag for registry
docker tag myapp_frontend:latest myorg/frontend:1.0.0
docker tag myapp_backend:latest myorg/backend:1.0.0

# Push to registry
docker push myorg/frontend:1.0.0
docker push myorg/backend:1.0.0

# Deploy to production
VERSION=1.0.0 docker-compose -f docker-compose.prod.yml up -d

# Scale services
docker-compose -f docker-compose.prod.yml up -d --scale backend=5

# View logs
docker-compose -f docker-compose.prod.yml logs -f backend

# Rollback
VERSION=0.9.0 docker-compose -f docker-compose.prod.yml up -d
</code></pre>
<h2 id="eli10"><a class="header" href="#eli10">ELI10</a></h2>
<p>Docker is like shipping containers for code:</p>
<ul>
<li>Package everything needed (dependencies, code, config)</li>
<li>Send it anywhere (laptop, server, cloud)</li>
<li>Runs the same everywhere!</li>
</ul>
<p>No more “it works on my machine” problems!</p>
<h2 id="further-resources"><a class="header" href="#further-resources">Further Resources</a></h2>
<ul>
<li><a href="https://docs.docker.com/">Docker Documentation</a></li>
<li><a href="https://hub.docker.com/">Docker Hub Images</a></li>
<li><a href="https://docs.docker.com/develop/dev-best-practices/">Docker Best Practices</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../devops/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../devops/kubernetes.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../devops/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../devops/kubernetes.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-c2a407aa.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>

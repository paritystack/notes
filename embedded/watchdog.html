<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Watchdog - My Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-ae938929.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex-ae735e64.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-4d483330.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">My Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="watchdog-timers"><a class="header" href="#watchdog-timers">Watchdog Timers</a></h1>
<p>A Watchdog Timer (WDT) is a hardware or software timer that is used to detect and recover from computer malfunctions. During normal operation, the system regularly resets the watchdog timer to prevent it from elapsing, or “timing out.” If the system fails to reset the watchdog timer, it is assumed to be malfunctioning, and corrective actions are taken, such as resetting the system.</p>
<h2 id="key-concepts"><a class="header" href="#key-concepts">Key Concepts</a></h2>
<ul>
<li><strong>Timeout Period</strong>: The duration for which the watchdog timer runs before it times out. If the timer is not reset within this period, it triggers a system reset or other corrective actions.</li>
<li><strong>Reset Mechanism</strong>: The action taken when the watchdog timer times out. This is typically a system reset, but it can also include other actions like logging an error or entering a safe state.</li>
<li><strong>Feeding the Watchdog</strong>: The process of regularly resetting the watchdog timer to prevent it from timing out. This is also known as “kicking” or “patting” the watchdog.</li>
</ul>
<h2 id="hardware-implementation"><a class="header" href="#hardware-implementation">Hardware Implementation</a></h2>
<h3 id="architecture"><a class="header" href="#architecture">Architecture</a></h3>
<p>A typical hardware watchdog timer consists of:</p>
<ol>
<li><strong>Counter/Timer</strong>: A down-counter that decrements at a fixed rate</li>
<li><strong>Prescaler</strong>: Divides the system clock to create longer timeout periods</li>
<li><strong>Control Registers</strong>: Configure timeout period, enable/disable, and operating modes</li>
<li><strong>Reset Circuit</strong>: Generates reset signal when counter reaches zero</li>
</ol>
<h3 id="common-hardware-configurations"><a class="header" href="#common-hardware-configurations">Common Hardware Configurations</a></h3>
<p><strong>STM32 Independent Watchdog (IWDG)</strong></p>
<ul>
<li>Free-running down-counter clocked by independent LSI oscillator</li>
<li>Prescaler range: 4 to 256</li>
<li>12-bit reload register (timeout from ~100μs to ~32s)</li>
<li>Once started, cannot be stopped except by reset</li>
<li>Key register: IWDG_KR (0xCCCC to start, 0xAAAA to reload)</li>
</ul>
<p><strong>AVR Watchdog Timer</strong></p>
<ul>
<li>Built-in oscillator running at approximately 128 kHz</li>
<li>Timeout periods: 15ms to 8s (configurable via WDTCSR register)</li>
<li>Supports both interrupt and reset modes</li>
<li>Can be disabled by fuse bits (WDTON fuse)</li>
</ul>
<p><strong>ESP32 Watchdog</strong></p>
<ul>
<li>Two-level watchdog: Task WDT and Interrupt WDT</li>
<li>Task WDT monitors FreeRTOS tasks</li>
<li>Interrupt WDT monitors ISRs and critical sections</li>
<li>Configurable through esp_task_wdt_* APIs</li>
</ul>
<h3 id="register-operations"><a class="header" href="#register-operations">Register Operations</a></h3>
<p>Typical register operations include:</p>
<ol>
<li><strong>Enable/Start</strong>: Write specific key value to start counter</li>
<li><strong>Reload/Feed</strong>: Write reload value to reset counter to maximum</li>
<li><strong>Configure Timeout</strong>: Set prescaler and reload values</li>
<li><strong>Status Check</strong>: Read flags to determine if reset was WDT-triggered</li>
</ol>
<h2 id="software-implementation-examples"><a class="header" href="#software-implementation-examples">Software Implementation Examples</a></h2>
<h3 id="bare-metal-microcontroller-stm32"><a class="header" href="#bare-metal-microcontroller-stm32">Bare-Metal Microcontroller (STM32)</a></h3>
<pre><code class="language-c">#include "stm32f4xx.h"

void IWDG_Init(uint32_t timeout_ms) {
    // Enable write access to IWDG_PR and IWDG_RLR registers
    IWDG-&gt;KR = 0x5555;

    // Set prescaler to 32 (LSI/32)
    IWDG-&gt;PR = IWDG_PR_PR_2;

    // Set reload value (timeout_ms * 32000 / 32 / 1000)
    IWDG-&gt;RLR = (timeout_ms * 1000) / 1000;

    // Reload counter
    IWDG-&gt;KR = 0xAAAA;

    // Enable IWDG
    IWDG-&gt;KR = 0xCCCC;
}

void IWDG_Feed(void) {
    IWDG-&gt;KR = 0xAAAA;  // Reload watchdog counter
}

int main(void) {
    IWDG_Init(1000);  // 1 second timeout

    while(1) {
        // Perform application tasks
        do_work();

        // Feed watchdog periodically
        IWDG_Feed();

        HAL_Delay(500);  // Delay less than timeout
    }
}
</code></pre>
<h3 id="esp32-with-freertos"><a class="header" href="#esp32-with-freertos">ESP32 with FreeRTOS</a></h3>
<pre><code class="language-c">#include "esp_task_wdt.h"

#define WDT_TIMEOUT_S 5

void critical_task(void *pvParameters) {
    // Subscribe this task to the watchdog
    esp_task_wdt_add(NULL);

    while(1) {
        // Perform critical operations
        process_data();
        read_sensors();

        // Reset watchdog for this task
        esp_task_wdt_reset();

        vTaskDelay(pdMS_TO_TICKS(1000));
    }
}

void app_main(void) {
    // Initialize Task Watchdog Timer
    esp_task_wdt_init(WDT_TIMEOUT_S, true);

    xTaskCreate(critical_task, "critical", 2048, NULL, 5, NULL);
}
</code></pre>
<h3 id="linux-userspace"><a class="header" href="#linux-userspace">Linux Userspace</a></h3>
<pre><code class="language-c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/ioctl.h&gt;
#include &lt;linux/watchdog.h&gt;

int main(void) {
    int fd;
    int timeout = 10;  // seconds

    // Open watchdog device
    fd = open("/dev/watchdog", O_WRONLY);
    if (fd &lt; 0) {
        perror("Failed to open watchdog");
        exit(1);
    }

    // Set timeout
    ioctl(fd, WDIOC_SETTIMEOUT, &amp;timeout);

    while(1) {
        // Perform application tasks
        do_application_work();

        // Feed the watchdog
        ioctl(fd, WDIOC_KEEPALIVE, 0);

        sleep(5);  // Sleep less than timeout
    }

    // Close watchdog (triggers reset on some systems)
    close(fd);

    return 0;
}
</code></pre>
<h3 id="freertos-task-monitor"><a class="header" href="#freertos-task-monitor">FreeRTOS Task Monitor</a></h3>
<pre><code class="language-c">#include "FreeRTOS.h"
#include "task.h"

TaskHandle_t xTask1Handle = NULL;
TaskHandle_t xTask2Handle = NULL;

void vTask1(void *pvParameters) {
    while(1) {
        // Task 1 work
        perform_task1();

        // Notify watchdog task that we're alive
        xTaskNotifyGive(xWatchdogTaskHandle);

        vTaskDelay(pdMS_TO_TICKS(100));
    }
}

void vWatchdogTask(void *pvParameters) {
    uint32_t ulNotificationValue;
    const TickType_t xMaxExpectedBlockTime = pdMS_TO_TICKS(500);

    while(1) {
        // Wait for notifications from monitored tasks
        ulNotificationValue = ulTaskNotifyTake(pdTRUE, xMaxExpectedBlockTime);

        if(ulNotificationValue &gt; 0) {
            // Tasks are running, feed hardware watchdog
            HAL_IWDG_Refresh(&amp;hiwdg);
        } else {
            // Timeout - tasks are stuck, allow WDT reset
            // Do not feed the watchdog
        }
    }
}
</code></pre>
<h2 id="advanced-concepts"><a class="header" href="#advanced-concepts">Advanced Concepts</a></h2>
<h3 id="window-watchdog-timer"><a class="header" href="#window-watchdog-timer">Window Watchdog Timer</a></h3>
<p>A window watchdog enforces both minimum and maximum refresh intervals, preventing both hung systems and runaway code that refreshes too quickly.</p>
<p><strong>Characteristics:</strong></p>
<ul>
<li>Has both upper and lower time bounds</li>
<li>Generates reset if refreshed too early or too late</li>
<li>Useful for detecting timing violations in periodic tasks</li>
</ul>
<p><strong>STM32 WWDG Example:</strong></p>
<pre><code class="language-c">void WWDG_Init(void) {
    __HAL_RCC_WWDG_CLK_ENABLE();

    hwwdg.Instance = WWDG;
    hwwdg.Init.Prescaler = WWDG_PRESCALER_8;
    hwwdg.Init.Window = 127;    // Upper bound
    hwwdg.Init.Counter = 127;   // Start value
    hwwdg.Init.EWIMode = WWDG_EWI_DISABLE;

    HAL_WWDG_Init(&amp;hwwdg);
}

void WWDG_Refresh(void) {
    // Refresh only when counter falls below window
    HAL_WWDG_Refresh(&amp;hwwdg);
}
</code></pre>
<h3 id="cascaded-watchdog-systems"><a class="header" href="#cascaded-watchdog-systems">Cascaded Watchdog Systems</a></h3>
<p>Multiple watchdog layers provide defense in depth:</p>
<ol>
<li><strong>Hardware WDT</strong>: Final safety net, cannot be disabled by software</li>
<li><strong>Software WDT</strong>: Monitors task health, can trigger controlled recovery</li>
<li><strong>Application Monitor</strong>: Checks data validity and logical correctness</li>
</ol>
<pre><code>Application Tasks → Software Monitor → Hardware WDT → Reset
                         ↓
                   Graceful Recovery
</code></pre>
<h3 id="interrupt-driven-watchdog"><a class="header" href="#interrupt-driven-watchdog">Interrupt-Driven Watchdog</a></h3>
<p>Some watchdogs can generate interrupts before reset, allowing cleanup:</p>
<pre><code class="language-c">void WWDG_IRQHandler(void) {
    if(__HAL_WWDG_GET_FLAG(&amp;hwwdg, WWDG_FLAG_EWIF)) {
        // Early warning interrupt
        // Last chance to save critical data
        save_critical_state();
        log_error("Watchdog about to reset");

        __HAL_WWDG_CLEAR_FLAG(&amp;hwwdg, WWDG_FLAG_EWIF);

        // System will reset shortly if not refreshed
    }
}
</code></pre>
<h3 id="watchdog-in-low-power-modes"><a class="header" href="#watchdog-in-low-power-modes">Watchdog in Low-Power Modes</a></h3>
<p>Watchdog behavior during sleep/standby modes:</p>
<ul>
<li><strong>Independent WDT (STM32 IWDG)</strong>: Continues running in all power modes</li>
<li><strong>Window WDT (STM32 WWDG)</strong>: Stops in Stop/Standby modes</li>
<li><strong>ESP32</strong>: Task WDT can be suspended during light sleep</li>
</ul>
<p><strong>Considerations:</strong></p>
<ul>
<li>Choose appropriate watchdog type for power profile</li>
<li>Account for sleep duration in timeout calculations</li>
<li>May need to disable/reconfigure WDT before entering deep sleep</li>
</ul>
<h2 id="troubleshooting--best-practices"><a class="header" href="#troubleshooting--best-practices">Troubleshooting &amp; Best Practices</a></h2>
<h3 id="common-pitfalls"><a class="header" href="#common-pitfalls">Common Pitfalls</a></h3>
<ol>
<li>
<p><strong>Timeout Too Short</strong></p>
<ul>
<li>Symptom: System resets during legitimate long operations</li>
<li>Solution: Profile worst-case execution time, add margin</li>
</ul>
</li>
<li>
<p><strong>Timeout Too Long</strong></p>
<ul>
<li>Symptom: System hangs go undetected too long</li>
<li>Solution: Break long operations into chunks with WDT refreshes</li>
</ul>
</li>
<li>
<p><strong>Feeding Too Frequently</strong></p>
<ul>
<li>Symptom: Stuck in tight loop but still feeding watchdog</li>
<li>Solution: Use window watchdog or structured feeding points</li>
</ul>
</li>
<li>
<p><strong>Feeding in Interrupt</strong></p>
<ul>
<li>Symptom: Interrupt runs, main code hung, but WDT still fed</li>
<li>Solution: Feed only from main application flow, not ISRs</li>
</ul>
</li>
<li>
<p><strong>Forgetting Clock Source</strong></p>
<ul>
<li>Symptom: Timeout period incorrect or unstable</li>
<li>Solution: Account for RC oscillator accuracy (±10-40%)</li>
</ul>
</li>
</ol>
<h3 id="debugging-strategies"><a class="header" href="#debugging-strategies">Debugging Strategies</a></h3>
<p><strong>Detect Watchdog Resets:</strong></p>
<pre><code class="language-c">void check_reset_source(void) {
    if(__HAL_RCC_GET_FLAG(RCC_FLAG_IWDGRST)) {
        // System was reset by Independent Watchdog
        log_error("WDT Reset detected");
        __HAL_RCC_CLEAR_RESET_FLAGS();
    }
}
</code></pre>
<p><strong>Add Instrumentation:</strong></p>
<pre><code class="language-c">volatile uint32_t wdt_feed_counter = 0;
uint32_t last_feed_timestamp = 0;

void IWDG_Feed_Debug(void) {
    wdt_feed_counter++;
    last_feed_timestamp = HAL_GetTick();
    IWDG_Feed();
}
</code></pre>
<p><strong>Simulate Failures:</strong></p>
<pre><code class="language-c">#ifdef DEBUG_WDT
void test_watchdog_reset(void) {
    // Deliberately stop feeding to test WDT
    while(1) {
        // Wait for reset
    }
}
#endif
</code></pre>
<h3 id="design-patterns"><a class="header" href="#design-patterns">Design Patterns</a></h3>
<p><strong>Centralized Feeding:</strong></p>
<pre><code class="language-c">void system_health_monitor(void) {
    if(check_all_tasks_healthy()) {
        IWDG_Feed();
    }
    // If unhealthy, don't feed - allow reset
}
</code></pre>
<p><strong>Distributed Feeding with Health Tokens:</strong></p>
<pre><code class="language-c">typedef struct {
    bool task1_alive;
    bool task2_alive;
    bool task3_alive;
} health_status_t;

health_status_t system_health = {0};

void watchdog_manager_task(void) {
    while(1) {
        if(system_health.task1_alive &amp;&amp;
           system_health.task2_alive &amp;&amp;
           system_health.task3_alive) {
            IWDG_Feed();
        }

        // Reset health flags
        system_health.task1_alive = false;
        system_health.task2_alive = false;
        system_health.task3_alive = false;

        vTaskDelay(pdMS_TO_TICKS(100));
    }
}
</code></pre>
<p><strong>Graceful Degradation:</strong></p>
<pre><code class="language-c">typedef enum {
    MODE_NORMAL,
    MODE_SAFE,
    MODE_EMERGENCY
} system_mode_t;

system_mode_t current_mode = MODE_NORMAL;

void main_loop(void) {
    switch(current_mode) {
        case MODE_NORMAL:
            execute_all_features();
            break;
        case MODE_SAFE:
            execute_critical_features_only();
            break;
        case MODE_EMERGENCY:
            minimal_operation();
            break;
    }

    if(system_healthy()) {
        IWDG_Feed();
    }
}
</code></pre>
<h3 id="testing-strategies"><a class="header" href="#testing-strategies">Testing Strategies</a></h3>
<ol>
<li>
<p><strong>Unit Test Timeout Calculations</strong></p>
<ul>
<li>Verify timeout math accounts for clock accuracy</li>
<li>Test prescaler and reload value calculations</li>
</ul>
</li>
<li>
<p><strong>Integration Test Reset Recovery</strong></p>
<ul>
<li>Deliberately trigger WDT reset</li>
<li>Verify system recovers to known safe state</li>
</ul>
</li>
<li>
<p><strong>Stress Test Under Load</strong></p>
<ul>
<li>Run worst-case scenarios</li>
<li>Measure maximum time between feeds</li>
</ul>
</li>
<li>
<p><strong>Power Cycle Testing</strong></p>
<ul>
<li>Verify WDT behavior across power transitions</li>
<li>Test brownout conditions</li>
</ul>
</li>
<li>
<p><strong>Long-Term Reliability Testing</strong></p>
<ul>
<li>Run for extended periods (days/weeks)</li>
<li>Monitor for unexpected resets</li>
</ul>
</li>
</ol>
<h2 id="example-usage"><a class="header" href="#example-usage">Example Usage</a></h2>
<ol>
<li><strong>Embedded Systems</strong>: Watchdog timers are commonly used in embedded systems to ensure that the system can recover from unexpected failures. For example, if a microcontroller stops responding, the watchdog timer can reset it to restore normal operation.</li>
<li><strong>Safety-Critical Applications</strong>: In applications where safety is paramount, such as automotive or medical devices, watchdog timers help ensure that the system can recover from faults and continue to operate safely.</li>
<li><strong>Industrial Control Systems</strong>: PLCs and SCADA systems use watchdogs to maintain continuous operation and automatically recover from transient faults.</li>
<li><strong>IoT Devices</strong>: Remote devices use watchdogs to recover from network issues or software hangs without manual intervention.</li>
</ol>
<h2 id="conclusion"><a class="header" href="#conclusion">Conclusion</a></h2>
<p>Watchdog timers are essential components in many systems, providing a mechanism to detect and recover from malfunctions. Proper implementation requires understanding hardware architecture, choosing appropriate timeout periods, implementing robust feeding strategies, and thorough testing. A well-designed watchdog system provides reliable fault detection while avoiding false resets, balancing safety with system stability. Whether implementing a simple independent watchdog or a sophisticated multi-level monitoring system, the key is to match the watchdog strategy to the specific reliability requirements and failure modes of your application.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../embedded/timers.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../embedded/power_management.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../embedded/timers.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../embedded/power_management.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-c2a407aa.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>

<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Yocto - My Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-ae938929.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex-4bbf961e.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-e85e57c5.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">My Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="yocto-project"><a class="header" href="#yocto-project">Yocto Project</a></h1>
<p>A comprehensive guide to the Yocto Project build system, covering BitBake, layers, recipes, image customization, BSP development, and advanced build system techniques.</p>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ol>
<li><a href="#overview">Overview</a></li>
<li><a href="#getting-started">Getting Started</a>
<ul>
<li><a href="#system-requirements">System Requirements</a></li>
<li><a href="#installing-dependencies">Installing Dependencies</a></li>
<li><a href="#downloading-poky">Downloading Poky</a></li>
<li><a href="#first-build">First Build</a></li>
</ul>
</li>
<li><a href="#core-architecture">Core Architecture</a>
<ul>
<li><a href="#yocto-project-components">Yocto Project Components</a></li>
<li><a href="#bitbake-build-engine">BitBake Build Engine</a></li>
<li><a href="#metadata-and-layers">Metadata and Layers</a></li>
<li><a href="#openembedded-core">OpenEmbedded Core</a></li>
</ul>
</li>
<li><a href="#build-system-workflow">Build System Workflow</a>
<ul>
<li><a href="#build-process-overview">Build Process Overview</a></li>
<li><a href="#task-execution">Task Execution</a></li>
<li><a href="#dependency-management">Dependency Management</a></li>
<li><a href="#shared-state-cache">Shared State Cache</a></li>
</ul>
</li>
<li><a href="#recipes">Recipes</a>
<ul>
<li><a href="#recipe-basics">Recipe Basics</a></li>
<li><a href="#recipe-syntax">Recipe Syntax</a></li>
<li><a href="#common-variables">Common Variables</a></li>
<li><a href="#fetchers-and-source-retrieval">Fetchers and Source Retrieval</a></li>
<li><a href="#tasks-in-recipes">Tasks in Recipes</a></li>
<li><a href="#recipe-examples">Recipe Examples</a></li>
</ul>
</li>
<li><a href="#recipe-development">Recipe Development</a>
<ul>
<li><a href="#creating-recipes-with-recipetool">Creating Recipes with recipetool</a></li>
<li><a href="#writing-custom-recipes">Writing Custom Recipes</a></li>
<li><a href="#using-bbappend-files">Using .bbappend Files</a></li>
<li><a href="#applying-patches">Applying Patches</a></li>
<li><a href="#recipe-inheritance">Recipe Inheritance</a></li>
</ul>
</li>
<li><a href="#layers">Layers</a>
<ul>
<li><a href="#layer-structure">Layer Structure</a></li>
<li><a href="#layer-configuration">Layer Configuration</a></li>
<li><a href="#creating-custom-layers">Creating Custom Layers</a></li>
<li><a href="#layer-priorities">Layer Priorities</a></li>
<li><a href="#bbpath-and-bbfiles">BBPATH and BBFILES</a></li>
<li><a href="#layer-dependencies">Layer Dependencies</a></li>
</ul>
</li>
<li><a href="#images">Images</a>
<ul>
<li><a href="#image-recipes">Image Recipes</a></li>
<li><a href="#image-features">Image Features</a></li>
<li><a href="#package-groups">Package Groups</a></li>
<li><a href="#customizing-images">Customizing Images</a></li>
<li><a href="#root-filesystem-customization">Root Filesystem Customization</a></li>
</ul>
</li>
<li><a href="#bsp-development">BSP Development</a>
<ul>
<li><a href="#machine-configuration">Machine Configuration</a></li>
<li><a href="#kernel-configuration">Kernel Configuration</a></li>
<li><a href="#bootloader-integration">Bootloader Integration</a></li>
<li><a href="#device-tree-integration">Device Tree Integration</a></li>
<li><a href="#creating-a-bsp-layer">Creating a BSP Layer</a></li>
</ul>
</li>
<li><a href="#package-management">Package Management</a>
<ul>
<li><a href="#package-formats">Package Formats</a></li>
<li><a href="#package-feeds">Package Feeds</a></li>
<li><a href="#runtime-package-management">Runtime Package Management</a></li>
<li><a href="#package-dependencies">Package Dependencies</a></li>
</ul>
</li>
<li><a href="#configuration-system">Configuration System</a>
<ul>
<li><a href="#configuration-files">Configuration Files</a></li>
<li><a href="#localconf">local.conf</a></li>
<li><a href="#bblayersconf">bblayers.conf</a></li>
<li><a href="#distribution-configuration">Distribution Configuration</a></li>
<li><a href="#machine-configuration-files">Machine Configuration Files</a></li>
<li><a href="#variable-assignment">Variable Assignment</a></li>
<li><a href="#important-variables">Important Variables</a></li>
</ul>
</li>
<li><a href="#advanced-features">Advanced Features</a>
<ul>
<li><a href="#sdk-generation">SDK Generation</a></li>
<li><a href="#esdk-extensible-sdk">eSDK (Extensible SDK)</a></li>
<li><a href="#devtool">devtool</a></li>
<li><a href="#multiconfig-builds">Multiconfig Builds</a></li>
<li><a href="#sstate-and-build-acceleration">SSTATE and Build Acceleration</a></li>
<li><a href="#template-layer">Template Layer</a></li>
</ul>
</li>
<li><a href="#debugging-and-troubleshooting">Debugging and Troubleshooting</a>
<ul>
<li><a href="#bitbake-debug-options">BitBake Debug Options</a></li>
<li><a href="#build-failures">Build Failures</a></li>
<li><a href="#dependency-issues">Dependency Issues</a></li>
<li><a href="#task-debugging">Task Debugging</a></li>
<li><a href="#common-problems">Common Problems</a></li>
</ul>
</li>
<li><a href="#best-practices">Best Practices</a>
<ul>
<li><a href="#layer-design">Layer Design</a></li>
<li><a href="#recipe-patterns">Recipe Patterns</a></li>
<li><a href="#version-management">Version Management</a></li>
<li><a href="#build-reproducibility">Build Reproducibility</a></li>
</ul>
</li>
<li><a href="#command-reference">Command Reference</a>
<ul>
<li><a href="#bitbake-commands">BitBake Commands</a></li>
<li><a href="#devtool-commands">devtool Commands</a></li>
<li><a href="#recipetool-commands">recipetool Commands</a></li>
<li><a href="#common-workflows">Common Workflows</a></li>
</ul>
</li>
<li><a href="#resources">Resources</a></li>
</ol>
<hr>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>The <strong>Yocto Project</strong> is an open-source collaboration project that provides templates, tools, and methods to create custom Linux-based systems for embedded products regardless of the hardware architecture. It’s not a Linux distribution but a build system that creates custom Linux distributions.</p>
<h3 id="key-benefits"><a class="header" href="#key-benefits">Key Benefits</a></h3>
<ul>
<li><strong>Customization</strong>: Build exactly what you need, nothing more</li>
<li><strong>Hardware Independence</strong>: Support for multiple architectures (ARM, x86, MIPS, PowerPC, RISC-V)</li>
<li><strong>Flexibility</strong>: Modular layer-based architecture</li>
<li><strong>Industry Support</strong>: Backed by Linux Foundation with extensive commercial support</li>
<li><strong>Long-term Support</strong>: Stable releases with extended maintenance</li>
<li><strong>Reproducibility</strong>: Deterministic builds with version control</li>
</ul>
<h3 id="yocto-vs-traditional-distributions"><a class="header" href="#yocto-vs-traditional-distributions">Yocto vs. Traditional Distributions</a></h3>
<pre><code>Traditional Distribution          Yocto Project
┌─────────────────────┐          ┌─────────────────────┐
│   Pre-built Packages │          │  Custom Build System │
│   ┌──────────────┐  │          │   ┌──────────────┐   │
│   │   apt/yum    │  │          │   │   BitBake    │   │
│   └──────────────┘  │          │   └──────────────┘   │
│   Install packages   │          │   Build from source  │
│   from repository    │          │   with custom config │
└─────────────────────┘          └─────────────────────┘
   Fixed configuration              Full customization
   Quick deployment                 Optimized for target
   Larger footprint                 Minimal footprint
</code></pre>
<h2 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h2>
<h3 id="system-requirements"><a class="header" href="#system-requirements">System Requirements</a></h3>
<p><strong>Minimum Hardware:</strong></p>
<ul>
<li>50 GB free disk space (100+ GB recommended)</li>
<li>8 GB RAM minimum (16+ GB recommended)</li>
<li>Multi-core processor (builds are CPU-intensive)</li>
</ul>
<p><strong>Supported Host Distributions:</strong></p>
<ul>
<li>Ubuntu 20.04, 22.04, 24.04 (LTS versions recommended)</li>
<li>Fedora 38, 39, 40</li>
<li>Debian 11, 12</li>
<li>OpenSUSE Leap 15.4, 15.5</li>
<li>AlmaLinux 8, 9</li>
<li>Rocky Linux 8, 9</li>
</ul>
<h3 id="installing-dependencies"><a class="header" href="#installing-dependencies">Installing Dependencies</a></h3>
<p><strong>Ubuntu/Debian:</strong></p>
<pre><code class="language-bash">sudo apt update
sudo apt install -y gawk wget git diffstat unzip texinfo gcc build-essential \
  chrpath socat cpio python3 python3-pip python3-pexpect xz-utils \
  debianutils iputils-ping python3-git python3-jinja2 libegl1-mesa \
  libsdl1.2-dev python3-subunit mesa-common-dev zstd liblz4-tool \
  file locales libacl1
</code></pre>
<p><strong>Fedora:</strong></p>
<pre><code class="language-bash">sudo dnf install -y gawk make wget tar bzip2 gzip python3 unzip perl patch \
  diffutils diffstat git cpp gcc gcc-c++ glibc-devel texinfo chrpath \
  ccache perl-Data-Dumper perl-Text-ParseWords perl-Thread-Queue \
  perl-bignum socat python3-pexpect findutils which file cpio python3 \
  python3-pip python3-pexpect python3-GitPython python3-jinja2 SDL-devel \
  xz lz4 zstd
</code></pre>
<h3 id="downloading-poky"><a class="header" href="#downloading-poky">Downloading Poky</a></h3>
<p><strong>Poky</strong> is the reference distribution of Yocto Project.</p>
<pre><code class="language-bash"># Clone Poky repository
git clone git://git.yoctoproject.org/poky
cd poky

# Checkout latest LTS release (Scarthgap - 5.0)
git checkout -b scarthgap origin/scarthgap

# Or for latest stable (Styhead - 5.1)
git checkout -b styhead origin/styhead
</code></pre>
<p><strong>Yocto Release Codenames:</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Release</th><th>Version</th><th>Codename</th><th>Release Date</th><th>Status</th></tr>
</thead>
<tbody>
<tr><td>5.1</td><td>Styhead</td><td>Latest</td><td>Apr 2024</td><td>Current</td></tr>
<tr><td>5.0</td><td>Scarthgap</td><td>LTS</td><td>Apr 2024</td><td>LTS</td></tr>
<tr><td>4.3</td><td>Nanbield</td><td></td><td>Oct 2023</td><td>Stable</td></tr>
<tr><td>4.2</td><td>Mickledore</td><td>LTS</td><td>Apr 2023</td><td>LTS</td></tr>
<tr><td>4.0</td><td>Kirkstone</td><td>LTS</td><td>May 2022</td><td>LTS</td></tr>
</tbody>
</table>
</div>
<h3 id="first-build"><a class="header" href="#first-build">First Build</a></h3>
<pre><code class="language-bash"># Source the build environment setup script
source oe-init-build-env

# This creates a 'build' directory and changes to it
# You'll see output like:
#   You had no conf/local.conf file. This configuration file has
#   therefore been created for you from .../local.conf.sample
</code></pre>
<p><strong>Directory structure after initialization:</strong></p>
<pre><code>poky/
├── build/                    # Build directory (created)
│   ├── conf/
│   │   ├── local.conf       # Build configuration
│   │   └── bblayers.conf    # Layer configuration
│   ├── tmp/                 # Build artifacts (created during build)
│   ├── downloads/           # Downloaded sources
│   └── sstate-cache/        # Shared state cache
├── meta/                    # OE-Core metadata
├── meta-poky/               # Poky-specific metadata
├── meta-yocto-bsp/          # Reference BSPs
└── meta-skeleton/           # Example recipes and layers
</code></pre>
<p><strong>Build a minimal image:</strong></p>
<pre><code class="language-bash"># Build core-image-minimal (basic console-only image)
bitbake core-image-minimal

# This will:
# 1. Parse all metadata
# 2. Determine dependencies
# 3. Download sources (~2-5 GB)
# 4. Build cross-compilation toolchain
# 5. Build all packages
# 6. Create root filesystem
# 7. Generate image file
#
# First build: 1-4 hours depending on hardware
# Subsequent builds: Much faster due to caching
</code></pre>
<p><strong>Build output location:</strong></p>
<pre><code class="language-bash"># Image files are in:
ls tmp/deploy/images/&lt;MACHINE&gt;/

# For QEMU x86-64:
ls tmp/deploy/images/qemux86-64/
# core-image-minimal-qemux86-64.ext4
# core-image-minimal-qemux86-64.iso
# core-image-minimal-qemux86-64.tar.bz2
# core-image-minimal-qemux86-64.wic
</code></pre>
<p><strong>Test with QEMU:</strong></p>
<pre><code class="language-bash"># Run the built image in QEMU
runqemu qemux86-64

# Or with graphics
runqemu qemux86-64 nographic

# Login as 'root' (no password by default)
</code></pre>
<h2 id="core-architecture"><a class="header" href="#core-architecture">Core Architecture</a></h2>
<h3 id="yocto-project-components"><a class="header" href="#yocto-project-components">Yocto Project Components</a></h3>
<pre><code>┌────────────────────────────────────────────────────────────┐
│                    Yocto Project                            │
├────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌──────────────┐  ┌──────────────┐  ┌─────────────────┐  │
│  │   BitBake    │  │     Poky     │  │  OpenEmbedded   │  │
│  │ Build Engine │  │  Reference   │  │   Build System  │  │
│  └──────────────┘  │ Distribution │  └─────────────────┘  │
│         │          └──────────────┘           │            │
│         │                 │                   │            │
│         └─────────────────┴───────────────────┘            │
│                           │                                │
│         ┌─────────────────┴─────────────────┐             │
│         │                                    │             │
│  ┌──────▼──────┐                    ┌───────▼────────┐    │
│  │  Metadata   │                    │  Build Output   │    │
│  │  (Layers)   │                    │  (Images, SDK)  │    │
│  │             │                    │                 │    │
│  │  - Recipes  │                    │  - Filesystem   │    │
│  │  - Classes  │                    │  - Packages     │    │
│  │  - Config   │                    │  - Toolchain    │    │
│  └─────────────┘                    └─────────────────┘    │
│                                                             │
└────────────────────────────────────────────────────────────┘
</code></pre>
<h3 id="bitbake-build-engine"><a class="header" href="#bitbake-build-engine">BitBake Build Engine</a></h3>
<p><strong>BitBake</strong> is the task scheduler and execution engine. It:</p>
<ul>
<li>Parses recipes and configuration files</li>
<li>Builds dependency graphs</li>
<li>Schedules and executes tasks</li>
<li>Manages parallel execution</li>
<li>Handles shared state caching</li>
</ul>
<p><strong>Key concepts:</strong></p>
<pre><code class="language-python"># BitBake processes metadata written in:
# 1. .bb files (recipes)
# 2. .bbappend files (recipe extensions)
# 3. .bbclass files (shared functionality)
# 4. .conf files (configuration)
# 5. .inc files (included files)
</code></pre>
<h3 id="metadata-and-layers"><a class="header" href="#metadata-and-layers">Metadata and Layers</a></h3>
<p><strong>Layers</strong> are repositories of related metadata. The layer mechanism provides:</p>
<ul>
<li>Modular organization</li>
<li>Easy sharing of metadata</li>
<li>Separation of concerns</li>
<li>Override mechanism</li>
</ul>
<pre><code>Layer Stack Example:
┌─────────────────────────┐
│  meta-custom-app        │  ← Your application
├─────────────────────────┤
│  meta-custom-bsp        │  ← Your BSP
├─────────────────────────┤
│  meta-openembedded      │  ← Additional recipes
├─────────────────────────┤
│  meta-poky              │  ← Poky distro config
├─────────────────────────┤
│  meta (OE-Core)         │  ← Core recipes
└─────────────────────────┘

Higher layers can override lower layers
</code></pre>
<h3 id="openembedded-core"><a class="header" href="#openembedded-core">OpenEmbedded Core</a></h3>
<p><strong>OE-Core</strong> (meta layer) provides:</p>
<ul>
<li>Core recipes for fundamental packages</li>
<li>Base classes for recipe inheritance</li>
<li>Build system infrastructure</li>
<li>Cross-compilation toolchain recipes</li>
<li>Standard image recipes</li>
</ul>
<h2 id="build-system-workflow"><a class="header" href="#build-system-workflow">Build System Workflow</a></h2>
<h3 id="build-process-overview"><a class="header" href="#build-process-overview">Build Process Overview</a></h3>
<pre><code>BitBake Execution Flow:
┌──────────────────────────────────────────────────────────┐
│ 1. Parse Configuration                                    │
│    - Read local.conf, bblayers.conf                      │
│    - Load layer configurations                           │
│    - Set variables                                       │
└────────────────┬─────────────────────────────────────────┘
                 │
┌────────────────▼─────────────────────────────────────────┐
│ 2. Parse Metadata                                         │
│    - Parse all .bb files                                 │
│    - Parse .bbappend files                               │
│    - Inherit classes                                     │
│    - Resolve variables                                   │
└────────────────┬─────────────────────────────────────────┘
                 │
┌────────────────▼─────────────────────────────────────────┐
│ 3. Build Dependency Graph                                 │
│    - DEPENDS (build-time dependencies)                   │
│    - RDEPENDS (runtime dependencies)                     │
│    - Task dependencies                                   │
└────────────────┬─────────────────────────────────────────┘
                 │
┌────────────────▼─────────────────────────────────────────┐
│ 4. Execute Tasks                                          │
│    - Fetch sources                                       │
│    - Unpack archives                                     │
│    - Patch sources                                       │
│    - Configure                                           │
│    - Compile                                             │
│    - Install                                             │
│    - Package                                             │
└────────────────┬─────────────────────────────────────────┘
                 │
┌────────────────▼─────────────────────────────────────────┐
│ 5. Create Output                                          │
│    - Root filesystem                                     │
│    - Image file(s)                                       │
│    - SDK (if requested)                                  │
└──────────────────────────────────────────────────────────┘
</code></pre>
<h3 id="task-execution"><a class="header" href="#task-execution">Task Execution</a></h3>
<p><strong>Standard task sequence for a recipe:</strong></p>
<pre><code>do_fetch      → Download source from SRC_URI
    ↓
do_unpack     → Extract archives
    ↓
do_patch      → Apply patches
    ↓
do_configure  → Run ./configure or equivalent
    ↓
do_compile    → Build the software
    ↓
do_install    → Install to staging area
    ↓
do_package    → Split into packages
    ↓
do_package_write_* → Create package files (rpm/deb/ipk)
</code></pre>
<p><strong>Task dependencies:</strong></p>
<pre><code class="language-bash"># View task dependencies for a recipe
bitbake -g &lt;recipe-name&gt;
# Generates task-depends.dot

# View all tasks for a recipe
bitbake &lt;recipe-name&gt; -c listtasks

# Example output:
# do_build
# do_bundle_initramfs
# do_checkuri
# do_clean
# do_cleanall
# do_cleansstate
# do_compile
# do_configure
# ...
</code></pre>
<h3 id="dependency-management"><a class="header" href="#dependency-management">Dependency Management</a></h3>
<p><strong>Build-time dependencies (DEPENDS):</strong></p>
<pre><code class="language-python"># Required for building the recipe
DEPENDS = "zlib openssl"

# These packages' do_populate_sysroot must complete
# before this recipe's do_configure starts
</code></pre>
<p><strong>Runtime dependencies (RDEPENDS):</strong></p>
<pre><code class="language-python"># Required for running the package
RDEPENDS:${PN} = "bash python3 libssl"

# These packages must be installed on target
# when this package is installed
</code></pre>
<p><strong>Dependency graph visualization:</strong></p>
<pre><code class="language-bash"># Generate dependency graph
bitbake -g core-image-minimal

# This creates:
# - pn-buildlist: Package build order
# - task-depends.dot: Task dependency graph
# - pn-depends.dot: Package dependency graph

# View with graphviz
dot -Tpng pn-depends.dot -o depends.png
</code></pre>
<h3 id="shared-state-cache"><a class="header" href="#shared-state-cache">Shared State Cache</a></h3>
<p><strong>SSTATE</strong> (Shared State) enables build acceleration:</p>
<pre><code>Without SSTATE:              With SSTATE:
┌────────────────┐          ┌────────────────┐
│ Full rebuild   │          │ Check SSTATE   │
│ every time     │          │ cache          │
│                │          │                │
│ Hours...       │          │ ┌──────────┐   │
└────────────────┘          │ │ Hit: Use │   │
                            │ │ cached   │   │
                            │ └──────────┘   │
                            │ ┌──────────┐   │
                            │ │ Miss:    │   │
                            │ │ Rebuild  │   │
                            │ └──────────┘   │
                            └────────────────┘
                            Minutes instead!
</code></pre>
<p><strong>SSTATE configuration:</strong></p>
<pre><code class="language-python"># In local.conf
SSTATE_DIR ?= "${TOPDIR}/sstate-cache"

# Use shared SSTATE location for multiple builds
SSTATE_DIR = "/common/sstate-cache"

# Use mirror for SSTATE
SSTATE_MIRRORS = "\
    file://.* http://sstate.yoctoproject.org/all/PATH;downloadfilename=PATH \
    file://.* http://example.com/sstate/PATH;downloadfilename=PATH \
"
</code></pre>
<h2 id="recipes"><a class="header" href="#recipes">Recipes</a></h2>
<h3 id="recipe-basics"><a class="header" href="#recipe-basics">Recipe Basics</a></h3>
<p>A <strong>recipe</strong> (.bb file) contains:</p>
<ul>
<li>Source location (SRC_URI)</li>
<li>Dependencies (DEPENDS, RDEPENDS)</li>
<li>License information</li>
<li>Build configuration</li>
<li>Installation instructions</li>
<li>Package splitting rules</li>
</ul>
<p><strong>Minimal recipe example:</strong></p>
<pre><code class="language-python"># hello-world_1.0.bb

SUMMARY = "Simple hello world application"
DESCRIPTION = "A hello world program demonstrating basic recipe structure"
LICENSE = "MIT"
LIC_FILES_CHKSUM = "file://LICENSE;md5=..."

SRC_URI = "https://example.com/hello-1.0.tar.gz"
SRC_URI[sha256sum] = "abcd1234..."

inherit autotools

do_install:append() {
    install -d ${D}${docdir}/${PN}
    install -m 0644 README ${D}${docdir}/${PN}/
}
</code></pre>
<h3 id="recipe-syntax"><a class="header" href="#recipe-syntax">Recipe Syntax</a></h3>
<p><strong>Variable assignment operators:</strong></p>
<pre><code class="language-python"># = : Simple assignment (evaluated at reference time)
VAR = "value"

# := : Immediate assignment (evaluated immediately)
VAR := "value"

# ?= : Weak default (only if not already set)
VAR ?= "default"

# ??= : Weaker default (lowest priority)
VAR ??= "weak default"

# += : Append with space
VAR += "append"

# =+ : Prepend with space
VAR =+ "prepend"

# .= : Append without space
VAR .= "append"

# =. : Prepend without space
VAR =. "prepend"

# :append : Append after all other operations
VAR:append = " appended"

# :prepend : Prepend before all other operations
VAR:prepend = "prepended "

# :remove : Remove items
VAR:remove = "item to remove"
</code></pre>
<p><strong>Package-specific variables (overrides):</strong></p>
<pre><code class="language-python"># Apply to all packages
RDEPENDS = "bash"

# Apply only to main package
RDEPENDS:${PN} = "bash"

# Apply to specific package
RDEPENDS:${PN}-dev = "pkgconfig"

# Machine-specific
SRC_URI:append:x86 = " file://x86-specific.patch"

# Distro-specific
PACKAGE_ARCH:poky = "core2-64"
</code></pre>
<h3 id="common-variables"><a class="header" href="#common-variables">Common Variables</a></h3>
<p><strong>Source and destination:</strong></p>
<pre><code class="language-python"># Source directory (after do_unpack)
S = "${WORKDIR}/${PN}-${PV}"

# Build directory
B = "${WORKDIR}/build"

# Destination (install root)
D = "${WORKDIR}/image"

# Staging directories
STAGING_DIR_HOST = "${TMPDIR}/sysroots/${MACHINE}"
STAGING_BINDIR = "${STAGING_DIR_HOST}${bindir}"
STAGING_INCDIR = "${STAGING_DIR_HOST}${includedir}"
STAGING_LIBDIR = "${STAGING_DIR_HOST}${libdir}"
</code></pre>
<p><strong>Standard directories:</strong></p>
<pre><code class="language-python"># Filesystem paths (target)
prefix = "/usr"
exec_prefix = "/usr"
bindir = "/usr/bin"
sbindir = "/usr/sbin"
libdir = "/usr/lib"
includedir = "/usr/include"
datadir = "/usr/share"
sysconfdir = "/etc"
localstatedir = "/var"
</code></pre>
<p><strong>Package naming:</strong></p>
<pre><code class="language-python"># Package name
PN = "packagename"

# Package version
PV = "1.0"

# Package revision
PR = "r0"

# Package epoch (for versioning)
PE = "1"

# Full package name with version
PF = "${PN}-${PV}-${PR}"

# Base package name for files
BP = "${PN}-${PV}"
</code></pre>
<h3 id="fetchers-and-source-retrieval"><a class="header" href="#fetchers-and-source-retrieval">Fetchers and Source Retrieval</a></h3>
<p><strong>SRC_URI supports multiple protocols:</strong></p>
<pre><code class="language-python"># HTTP/HTTPS
SRC_URI = "https://example.com/project-${PV}.tar.gz"

# Git repository
SRC_URI = "git://github.com/user/repo.git;protocol=https;branch=master"

# Git with specific commit
SRC_URI = "git://github.com/user/repo.git;protocol=https"
SRCREV = "abc123def456..."

# Subversion
SRC_URI = "svn://svn.example.com/project;module=trunk;protocol=https"

# Local files
SRC_URI = "file://local-source.tar.gz \
           file://0001-fix-build.patch \
           file://custom-config.cfg \
          "

# Multiple sources
SRC_URI = "https://example.com/main-${PV}.tar.gz \
           git://github.com/user/addon.git;protocol=https;destsuffix=addon \
           file://init.d/myservice \
          "
</code></pre>
<p><strong>Checksum verification:</strong></p>
<pre><code class="language-python"># SHA256 checksum for archives
SRC_URI[sha256sum] = "abcd1234ef567890..."

# MD5 checksum (legacy, avoid)
SRC_URI[md5sum] = "abc123..."

# Multiple files with checksums
SRC_URI = "https://example.com/main.tar.gz \
           https://example.com/addon.tar.gz;name=addon"

SRC_URI[sha256sum] = "main-file-checksum..."
SRC_URI[addon.sha256sum] = "addon-file-checksum..."
</code></pre>
<p><strong>Git-specific options:</strong></p>
<pre><code class="language-python"># Specific branch
SRC_URI = "git://github.com/user/repo.git;protocol=https;branch=develop"

# Specific tag
SRC_URI = "git://github.com/user/repo.git;protocol=https;tag=v1.0"
SRCREV = "${AUTOREV}"  # Or specific commit

# Submodules
SRC_URI = "git://github.com/user/repo.git;protocol=https;branch=master;submodules=1"

# Custom destination directory
SRC_URI = "git://github.com/user/repo.git;protocol=https;destsuffix=custom-dir"

# Multiple git repos
SRC_URI = "git://github.com/user/main.git;protocol=https;name=main \
           git://github.com/user/lib.git;protocol=https;name=lib;destsuffix=lib"
SRCREV_main = "abc123..."
SRCREV_lib = "def456..."
</code></pre>
<h3 id="tasks-in-recipes"><a class="header" href="#tasks-in-recipes">Tasks in Recipes</a></h3>
<p><strong>Standard tasks:</strong></p>
<pre><code class="language-python"># Fetch task (download sources)
do_fetch() {
    # Usually handled by fetchers automatically
}

# Unpack task (extract archives)
do_unpack() {
    # Usually handled automatically
}

# Patch task (apply patches)
do_patch() {
    # Automatically applies patches from SRC_URI
}

# Configure task
do_configure() {
    # For autotools:
    oe_runconf

    # For CMake (with cmake class):
    cmake_do_configure

    # Custom:
    ./custom-configure --prefix=${prefix}
}

# Compile task
do_compile() {
    # For make:
    oe_runmake

    # Custom:
    ${CC} ${CFLAGS} -o myapp main.c
}

# Install task
do_install() {
    # Create directories
    install -d ${D}${bindir}
    install -d ${D}${sysconfdir}

    # Install files
    install -m 0755 myapp ${D}${bindir}/
    install -m 0644 myapp.conf ${D}${sysconfdir}/
}
</code></pre>
<p><strong>Task modification:</strong></p>
<pre><code class="language-python"># Append to existing task
do_install:append() {
    # Add extra install steps
    install -d ${D}${datadir}/myapp
    cp -r data/* ${D}${datadir}/myapp/
}

# Prepend to existing task
do_configure:prepend() {
    # Run before configure
    ./autogen.sh
}

# Completely override task
do_compile() {
    # Completely replace default compile
    ${CC} ${CFLAGS} -o special special.c
}
</code></pre>
<p><strong>Custom tasks:</strong></p>
<pre><code class="language-python"># Define custom task
do_custom_task() {
    echo "Running custom task"
    # Custom operations
}

# Add to task chain
addtask custom_task after do_compile before do_install

# Or with dependencies
addtask custom_task after do_configure before do_compile
do_custom_task[depends] = "other-recipe:do_install"
</code></pre>
<h3 id="recipe-examples"><a class="header" href="#recipe-examples">Recipe Examples</a></h3>
<p><strong>Simple C application:</strong></p>
<pre><code class="language-python"># myapp_1.0.bb

SUMMARY = "My custom application"
DESCRIPTION = "A custom C application for embedded Linux"
LICENSE = "GPL-2.0-only"
LIC_FILES_CHKSUM = "file://COPYING;md5=..."

SRC_URI = "git://github.com/myuser/myapp.git;protocol=https;branch=main \
           file://0001-add-syslog.patch \
           file://myapp.service \
          "
SRCREV = "${AUTOREV}"

S = "${WORKDIR}/git"

DEPENDS = "zlib openssl"
RDEPENDS:${PN} = "bash"

inherit systemd

SYSTEMD_SERVICE:${PN} = "myapp.service"

do_compile() {
    ${CC} ${CFLAGS} ${LDFLAGS} -o myapp main.c -lz -lssl
}

do_install() {
    install -d ${D}${bindir}
    install -m 0755 myapp ${D}${bindir}/

    # Install systemd service
    install -d ${D}${systemd_system_unitdir}
    install -m 0644 ${WORKDIR}/myapp.service ${D}${systemd_system_unitdir}/
}
</code></pre>
<p><strong>Python package:</strong></p>
<pre><code class="language-python"># python3-mymodule_1.0.bb

SUMMARY = "My Python module"
LICENSE = "MIT"
LIC_FILES_CHKSUM = "file://LICENSE;md5=..."

SRC_URI = "https://pypi.org/packages/source/m/mymodule/mymodule-${PV}.tar.gz"
SRC_URI[sha256sum] = "..."

inherit setuptools3

RDEPENDS:${PN} = "python3-core python3-requests"
</code></pre>
<p><strong>Kernel module:</strong></p>
<pre><code class="language-python"># my-driver_1.0.bb

SUMMARY = "Custom kernel driver"
LICENSE = "GPL-2.0-only"
LIC_FILES_CHKSUM = "file://COPYING;md5=..."

inherit module

SRC_URI = "file://my-driver.c \
           file://Makefile \
          "

S = "${WORKDIR}"

# Module is tied to kernel version
RPROVIDES:${PN} += "kernel-module-my-driver"
</code></pre>
<p><strong>Library with development package:</strong></p>
<pre><code class="language-python"># libmylib_1.0.bb

SUMMARY = "My custom library"
LICENSE = "LGPL-2.1-only"
LIC_FILES_CHKSUM = "file://COPYING;md5=..."

SRC_URI = "https://example.com/libmylib-${PV}.tar.gz"
SRC_URI[sha256sum] = "..."

inherit autotools pkgconfig

# Package splitting
PACKAGES = "${PN} ${PN}-dev ${PN}-dbg ${PN}-doc"

FILES:${PN} = "${libdir}/lib*.so.*"
FILES:${PN}-dev = "${includedir} ${libdir}/lib*.so ${libdir}/*.la \
                   ${libdir}/pkgconfig"
FILES:${PN}-dbg = "${libdir}/.debug"
FILES:${PN}-doc = "${datadir}/doc ${mandir}"

RDEPENDS:${PN}-dev = "${PN} (= ${EXTENDPKGV})"
</code></pre>
<h2 id="recipe-development"><a class="header" href="#recipe-development">Recipe Development</a></h2>
<h3 id="creating-recipes-with-recipetool"><a class="header" href="#creating-recipes-with-recipetool">Creating Recipes with recipetool</a></h3>
<p><strong>recipetool</strong> automates recipe creation:</p>
<pre><code class="language-bash"># Create recipe from source URL
recipetool create https://example.com/package-1.0.tar.gz

# Create recipe from Git repository
recipetool create git://github.com/user/project.git

# Specify output file
recipetool create -o myrecipe_1.0.bb https://example.com/src.tar.gz

# Create recipe for Python package from PyPI
recipetool create https://pypi.org/packages/source/p/package/package-1.0.tar.gz
</code></pre>
<p><strong>Example output:</strong></p>
<pre><code class="language-python"># Auto-generated by recipetool
SUMMARY = "Package description from source"
HOMEPAGE = "https://example.com"
LICENSE = "MIT"
LIC_FILES_CHKSUM = "file://LICENSE;md5=..."

SRC_URI = "https://example.com/package-${PV}.tar.gz"
SRC_URI[sha256sum] = "..."

# Dependencies detected automatically
DEPENDS = "zlib openssl"

inherit autotools
</code></pre>
<h3 id="writing-custom-recipes"><a class="header" href="#writing-custom-recipes">Writing Custom Recipes</a></h3>
<p><strong>Step-by-step recipe creation:</strong></p>
<pre><code class="language-bash"># 1. Create layer (if not exists)
bitbake-layers create-layer meta-custom
bitbake-layers add-layer meta-custom

# 2. Create recipe directory
mkdir -p meta-custom/recipes-apps/myapp

# 3. Create recipe file
vim meta-custom/recipes-apps/myapp/myapp_1.0.bb
</code></pre>
<p><strong>Recipe template:</strong></p>
<pre><code class="language-python"># myapp_1.0.bb

SUMMARY = "Brief description"
DESCRIPTION = "Longer description of what this does"
HOMEPAGE = "https://example.com"
SECTION = "applications"
LICENSE = "MIT"
LIC_FILES_CHKSUM = "file://LICENSE;md5=..."

DEPENDS = ""
RDEPENDS:${PN} = ""

SRC_URI = "https://example.com/${PN}-${PV}.tar.gz"
SRC_URI[sha256sum] = ""

S = "${WORKDIR}/${PN}-${PV}"

inherit autotools

# Override/append tasks as needed
do_install:append() {
    # Additional install steps
}
</code></pre>
<p><strong>Computing checksums:</strong></p>
<pre><code class="language-bash"># Calculate SHA256
sha256sum package-1.0.tar.gz

# Calculate MD5 (for LICENSE files)
md5sum LICENSE
</code></pre>
<h3 id="using-bbappend-files"><a class="header" href="#using-bbappend-files">Using .bbappend Files</a></h3>
<p><strong>bbappend files</strong> extend/modify existing recipes without editing them:</p>
<pre><code class="language-bash"># Location must match recipe path
# Recipe: meta/recipes-core/busybox/busybox_1.36.1.bb
# Append: meta-custom/recipes-core/busybox/busybox_%.bbappend

# % matches any version
# Or use specific version: busybox_1.36.1.bbappend
</code></pre>
<p><strong>Example bbappend:</strong></p>
<pre><code class="language-python"># busybox_%.bbappend

FILESEXTRAPATHS:prepend := "${THISDIR}/${PN}:"

SRC_URI += "file://custom.cfg \
            file://0001-add-feature.patch \
           "

do_install:append() {
    # Add custom configuration
    install -d ${D}${sysconfdir}
    install -m 0644 ${WORKDIR}/custom.cfg ${D}${sysconfdir}/busybox.conf
}
</code></pre>
<p><strong>Directory structure:</strong></p>
<pre><code>meta-custom/recipes-core/busybox/
├── busybox_%.bbappend
└── busybox/
    ├── custom.cfg
    └── 0001-add-feature.patch
</code></pre>
<p><strong>FILESEXTRAPATHS</strong> tells BitBake where to find additional files:</p>
<pre><code class="language-python"># Prepend to search path
FILESEXTRAPATHS:prepend := "${THISDIR}/${PN}:"

# ${THISDIR} = directory containing .bbappend
# ${PN} = package name (e.g., "busybox")
</code></pre>
<h3 id="applying-patches"><a class="header" href="#applying-patches">Applying Patches</a></h3>
<p><strong>Patch format:</strong></p>
<pre><code class="language-bash"># Create patch from git
cd source-repo
git format-patch -1 commit-hash
# Creates 0001-commit-message.patch

# Or create patch manually
diff -Naur original/ modified/ &gt; my-changes.patch
</code></pre>
<p><strong>Add patch to recipe:</strong></p>
<pre><code class="language-python">SRC_URI = "https://example.com/package-${PV}.tar.gz \
           file://0001-fix-build.patch \
           file://0002-add-feature.patch \
          "

# Patches applied in order during do_patch
</code></pre>
<p><strong>Patch with different strip level:</strong></p>
<pre><code class="language-python"># Default: -p1
SRC_URI = "file://0001-fix.patch"

# Custom strip level
SRC_URI = "file://0001-fix.patch;striplevel=0"
</code></pre>
<p><strong>Conditional patches:</strong></p>
<pre><code class="language-python"># Machine-specific patch
SRC_URI:append:raspberrypi4 = " file://rpi4-fix.patch"

# Version-specific patch
SRC_URI:append = "${@bb.utils.contains('PV', '1.0', ' file://v1-fix.patch', '', d)}"
</code></pre>
<p><strong>Patch directory structure:</strong></p>
<pre><code>meta-custom/recipes-apps/myapp/
├── myapp_1.0.bb
└── myapp/
    ├── 0001-first-fix.patch
    ├── 0002-second-fix.patch
    └── files/
        └── config.h
</code></pre>
<h3 id="recipe-inheritance"><a class="header" href="#recipe-inheritance">Recipe Inheritance</a></h3>
<p><strong>Classes</strong> provide shared functionality:</p>
<pre><code class="language-python"># Inherit a class
inherit autotools

# Multiple classes
inherit systemd update-rc.d

# Conditional inheritance
inherit ${@bb.utils.contains('DISTRO_FEATURES', 'systemd', 'systemd', '', d)}
</code></pre>
<p><strong>Common classes:</strong></p>
<pre><code class="language-python"># autotools: ./configure &amp;&amp; make &amp;&amp; make install
inherit autotools

# cmake: CMake-based projects
inherit cmake

# setuptools3: Python setuptools
inherit setuptools3

# systemd: systemd service integration
inherit systemd

# update-rc.d: SysV init scripts
inherit update-rc.d

# pkgconfig: pkg-config integration
inherit pkgconfig

# module: Kernel modules
inherit module

# native: Build for build host
inherit native

# cross: Cross-compilation tools
inherit cross
</code></pre>
<p><strong>Class example (autotools):</strong></p>
<pre><code class="language-python">inherit autotools

# Provides:
# - do_configure: Runs ./configure with standard options
# - do_compile: Runs make
# - do_install: Runs make install
# - Standard variable handling

# Customize configure arguments
EXTRA_OECONF = "--enable-feature --with-lib=/path"

# Customize make arguments
EXTRA_OEMAKE = "CFLAGS='${CFLAGS}' LDFLAGS='${LDFLAGS}'"
</code></pre>
<h2 id="layers"><a class="header" href="#layers">Layers</a></h2>
<h3 id="layer-structure"><a class="header" href="#layer-structure">Layer Structure</a></h3>
<p><strong>Standard layer structure:</strong></p>
<pre><code>meta-custom/
├── conf/
│   └── layer.conf              # Layer configuration
├── classes/
│   └── custom.bbclass          # Shared classes
├── recipes-*/                  # Recipe directories
│   ├── recipes-core/
│   │   └── images/
│   │       └── custom-image.bb
│   ├── recipes-apps/
│   │   └── myapp/
│   │       ├── myapp_1.0.bb
│   │       └── myapp/
│   │           └── files...
│   └── recipes-bsp/
│       └── u-boot/
│           └── u-boot_%.bbappend
├── recipes-kernel/
│   └── linux/
│       └── linux-%.bbappend
├── conf/
│   ├── machine/
│   │   └── mymachine.conf      # Machine definitions
│   └── distro/
│       └── mydistro.conf       # Distribution config
├── wic/
│   └── custom-image.wks        # WIC kickstart files
├── LICENSE
└── README
</code></pre>
<h3 id="layer-configuration"><a class="header" href="#layer-configuration">Layer Configuration</a></h3>
<p><strong>layer.conf:</strong></p>
<pre><code class="language-python"># meta-custom/conf/layer.conf

# Layer identity
BBPATH .= ":${LAYERDIR}"

# Recipe paths
BBFILES += "${LAYERDIR}/recipes-*/*/*.bb \
            ${LAYERDIR}/recipes-*/*/*.bbappend"

# Layer name
BBFILE_COLLECTIONS += "custom-layer"

# Recipe priority (higher = higher priority)
BBFILE_PRIORITY_custom-layer = "6"

# Layer pattern matching
BBFILE_PATTERN_custom-layer = "^${LAYERDIR}/"

# Compatible versions
LAYERSERIES_COMPAT_custom-layer = "styhead scarthgap"

# Layer dependencies
LAYERDEPENDS_custom-layer = "core openembedded-layer"

# Additional class paths
BBFILES_DYNAMIC += ""
</code></pre>
<p><strong>Layer priority:</strong></p>
<pre><code>Priority values:
0-4:   Reserved for OE-Core
5:     meta-poky (default)
6-9:   Custom layers (typical)
10+:   High priority overrides
</code></pre>
<h3 id="creating-custom-layers"><a class="header" href="#creating-custom-layers">Creating Custom Layers</a></h3>
<pre><code class="language-bash"># Create new layer with bitbake-layers
bitbake-layers create-layer meta-custom

# Output:
# meta-custom/
# ├── conf/
# │   └── layer.conf
# ├── COPYING.MIT
# ├── README
# └── recipes-example/
#     └── example/
#         └── example_0.1.bb

# Add layer to build
bitbake-layers add-layer meta-custom

# Or manually edit conf/bblayers.conf
</code></pre>
<p><strong>Manual layer creation:</strong></p>
<pre><code class="language-bash"># 1. Create directory structure
mkdir -p meta-custom/conf
mkdir -p meta-custom/recipes-apps

# 2. Create layer.conf
cat &gt; meta-custom/conf/layer.conf &lt;&lt; 'EOF'
BBPATH .= ":${LAYERDIR}"
BBFILES += "${LAYERDIR}/recipes-*/*/*.bb \
            ${LAYERDIR}/recipes-*/*/*.bbappend"
BBFILE_COLLECTIONS += "custom"
BBFILE_PRIORITY_custom = "6"
BBFILE_PATTERN_custom = "^${LAYERDIR}/"
LAYERSERIES_COMPAT_custom = "styhead scarthgap"
EOF

# 3. Add to bblayers.conf
bitbake-layers add-layer meta-custom
</code></pre>
<h3 id="layer-priorities"><a class="header" href="#layer-priorities">Layer Priorities</a></h3>
<p><strong>Override mechanism:</strong></p>
<pre><code>Higher priority layers override lower priority:

meta-custom (priority 8)      # Highest
    ↓ overrides
meta-custom-bsp (priority 7)
    ↓ overrides
meta-openembedded (priority 6)
    ↓ overrides
meta-poky (priority 5)
    ↓ overrides
meta (priority 5)             # Lowest
</code></pre>
<p><strong>Example:</strong></p>
<pre><code class="language-python"># meta/recipes-core/bash/bash_5.2.bb (priority 5)
SRC_URI = "https://ftp.gnu.org/gnu/bash/bash-${PV}.tar.gz"

# meta-custom/recipes-core/bash/bash_%.bbappend (priority 8)
# This takes precedence
SRC_URI:append = " file://custom-config.patch"
</code></pre>
<h3 id="bbpath-and-bbfiles"><a class="header" href="#bbpath-and-bbfiles">BBPATH and BBFILES</a></h3>
<p><strong>BBPATH:</strong></p>
<pre><code class="language-python"># Search path for configuration files
BBPATH = "path1:path2:path3"

# Each layer adds to BBPATH
BBPATH .= ":${LAYERDIR}"

# Used to find files like:
# - conf/machine/*.conf
# - conf/distro/*.conf
# - classes/*.bbclass
</code></pre>
<p><strong>BBFILES:</strong></p>
<pre><code class="language-python"># Recipes to include
BBFILES = "${LAYERDIR}/recipes-*/*/*.bb ${LAYERDIR}/recipes-*/*/*.bbappend"

# Wildcard patterns:
# recipes-*    : Any directory starting with "recipes-"
# /*           : Any subdirectory
# /*.bb        : Any .bb file
# /*.bbappend  : Any .bbappend file
</code></pre>
<p><strong>Dynamic layers:</strong></p>
<pre><code class="language-python"># Conditional recipe inclusion
BBFILES_DYNAMIC += "\
    qt5-layer:${LAYERDIR}/dynamic-layers/qt5-layer/recipes-*/*/*.bb \
    meta-python:${LAYERDIR}/dynamic-layers/meta-python/recipes-*/*/*.bb \
"

# Directory structure:
# meta-custom/
# └── dynamic-layers/
#     ├── qt5-layer/
#     │   └── recipes-apps/
#     └── meta-python/
#         └── recipes-devtools/

# Recipes only included if dependency layer present
</code></pre>
<h3 id="layer-dependencies"><a class="header" href="#layer-dependencies">Layer Dependencies</a></h3>
<p><strong>LAYERDEPENDS:</strong></p>
<pre><code class="language-python"># In layer.conf
LAYERDEPENDS_custom-layer = "core openembedded-layer qt5-layer"

# Ensures required layers are present
# Build fails if dependencies missing
</code></pre>
<p><strong>LAYERRECOMMENDS:</strong></p>
<pre><code class="language-python"># Recommended but not required
LAYERRECOMMENDS_custom-layer = "meta-networking"

# Warning if missing, but build continues
</code></pre>
<p><strong>Version-specific dependencies:</strong></p>
<pre><code class="language-python"># Require specific layer version
LAYERDEPENDS_custom-layer = "core:styhead openembedded-layer:styhead"
</code></pre>
<p><strong>Checking layer dependencies:</strong></p>
<pre><code class="language-bash"># Show layer configuration
bitbake-layers show-layers

# Output:
# layer           path                                      priority
# ==========================================================================
# meta            /path/to/poky/meta                        5
# meta-poky       /path/to/poky/meta-poky                   5
# meta-custom     /path/to/meta-custom                      6

# Show dependencies
bitbake-layers layerindex-show-depends meta-custom
</code></pre>
<h2 id="images"><a class="header" href="#images">Images</a></h2>
<h3 id="image-recipes"><a class="header" href="#image-recipes">Image Recipes</a></h3>
<p><strong>Image recipe basics:</strong></p>
<pre><code class="language-python"># custom-image-minimal.bb

SUMMARY = "A minimal custom image"
DESCRIPTION = "Minimal image with custom applications"

# Inherit image creation class
inherit core-image

# License (for the recipe itself)
LICENSE = "MIT"

# Base packages to include
IMAGE_INSTALL = "packagegroup-core-boot ${CORE_IMAGE_EXTRA_INSTALL}"

# Add custom packages
IMAGE_INSTALL += "myapp python3 openssh"

# Image features
IMAGE_FEATURES += "ssh-server-openssh"

# Root filesystem size (KB)
IMAGE_ROOTFS_SIZE ?= "8192"

# Extra space (KB)
IMAGE_ROOTFS_EXTRA_SPACE = "1024"
</code></pre>
<p><strong>Common base image classes:</strong></p>
<pre><code class="language-python"># core-image: Basic image class
inherit core-image

# core-image-minimal: Minimal bootable image
require recipes-core/images/core-image-minimal.bb

# core-image-base: Small image with package manager
require recipes-core/images/core-image-base.bb

# core-image-full-cmdline: Console-only with full hardware support
require recipes-core/images/core-image-full-cmdline.bb
</code></pre>
<h3 id="image-features"><a class="header" href="#image-features">Image Features</a></h3>
<p><strong>IMAGE_FEATURES:</strong></p>
<pre><code class="language-python"># Development tools
IMAGE_FEATURES += "tools-debug tools-profile tools-sdk"

# Package management
IMAGE_FEATURES += "package-management"

# SSH server
IMAGE_FEATURES += "ssh-server-openssh"
# Or dropbear (lighter)
IMAGE_FEATURES += "ssh-server-dropbear"

# X11 support
IMAGE_FEATURES += "x11 x11-base x11-sato"

# Documentation
IMAGE_FEATURES += "doc-pkgs"

# Development headers
IMAGE_FEATURES += "dev-pkgs"

# Debug symbols
IMAGE_FEATURES += "dbg-pkgs"

# Read-only root filesystem
IMAGE_FEATURES += "read-only-rootfs"

# Empty root password
IMAGE_FEATURES += "empty-root-password"

# Allow root login
IMAGE_FEATURES += "allow-root-login"

# Post-install logging
IMAGE_FEATURES += "post-install-logging"
</code></pre>
<p><strong>Feature to package mapping:</strong></p>
<pre><code class="language-python"># In conf/bitbake.conf and image.bbclass
FEATURE_PACKAGES_ssh-server-openssh = "packagegroup-core-ssh-openssh"
FEATURE_PACKAGES_tools-debug = "packagegroup-core-tools-debug"
FEATURE_PACKAGES_package-management = "${ROOTFS_PKGMANAGE}"
</code></pre>
<h3 id="package-groups"><a class="header" href="#package-groups">Package Groups</a></h3>
<p><strong>Package groups</strong> bundle related packages:</p>
<pre><code class="language-python"># packagegroup-custom-apps.bb

SUMMARY = "Custom application package group"
DESCRIPTION = "Package group for custom applications"

inherit packagegroup

PACKAGES = "${PN}"

RDEPENDS:${PN} = "\
    myapp \
    python3 \
    python3-requests \
    nginx \
    postgresql \
"
</code></pre>
<p><strong>Using package groups in images:</strong></p>
<pre><code class="language-python"># custom-image.bb
IMAGE_INSTALL += "packagegroup-custom-apps"
</code></pre>
<p><strong>Standard package groups:</strong></p>
<pre><code class="language-python"># Core boot packages
packagegroup-core-boot

# SSH server (OpenSSH)
packagegroup-core-ssh-openssh

# Debug tools
packagegroup-core-tools-debug
# Includes: gdb, strace, ltrace, tcf-agent

# Profiling tools
packagegroup-core-tools-profile
# Includes: perf, oprofile, lttng

# Build essentials
packagegroup-core-buildessential
# Includes: gcc, make, binutils, headers
</code></pre>
<h3 id="customizing-images"><a class="header" href="#customizing-images">Customizing Images</a></h3>
<p><strong>Adding packages:</strong></p>
<pre><code class="language-python"># Direct package installation
IMAGE_INSTALL += "vim htop tmux"

# From package group
IMAGE_INSTALL += "packagegroup-core-tools-debug"

# Conditional installation
IMAGE_INSTALL += "${@bb.utils.contains('MACHINE', 'raspberrypi4', 'raspi-gpio', '', d)}"
</code></pre>
<p><strong>Removing packages:</strong></p>
<pre><code class="language-python"># Remove from inherited image
IMAGE_INSTALL:remove = "packagegroup-core-x11"

# Remove specific packages
PACKAGE_EXCLUDE = "package1 package2"
</code></pre>
<p><strong>Custom post-processing:</strong></p>
<pre><code class="language-python"># Run after rootfs creation
ROOTFS_POSTPROCESS_COMMAND += "custom_postprocess; "

custom_postprocess() {
    # Modify rootfs
    echo "CustomHost" &gt; ${IMAGE_ROOTFS}/etc/hostname

    # Create custom files
    install -d ${IMAGE_ROOTFS}/opt/custom
    echo "config data" &gt; ${IMAGE_ROOTFS}/opt/custom/config

    # Modify permissions
    chmod 600 ${IMAGE_ROOTFS}/opt/custom/config
}
</code></pre>
<h3 id="root-filesystem-customization"><a class="header" href="#root-filesystem-customization">Root Filesystem Customization</a></h3>
<p><strong>Root filesystem types:</strong></p>
<pre><code class="language-python"># Set filesystem types to generate
IMAGE_FSTYPES = "ext4 tar.bz2 wic"

# Common types:
# - ext4: ext4 filesystem
# - ext3: ext3 filesystem
# - tar.bz2: Compressed tarball
# - tar.gz: Gzip compressed tarball
# - cpio: cpio archive
# - cpio.gz: Compressed cpio
# - wic: Partitioned disk image
# - iso: ISO image
# - hddimg: Hybrid ISO/HDD image
# - ubi: UBI filesystem (for NAND flash)
# - ubifs: UBIFS filesystem
# - squashfs: Compressed read-only filesystem
</code></pre>
<p><strong>Filesystem configuration:</strong></p>
<pre><code class="language-python"># Ext4 options
EXTRA_IMAGECMD:ext4 = "-i 4096 -L rootfs"

# Size constraints
IMAGE_ROOTFS_SIZE = "8192"          # Fixed size (KB)
IMAGE_ROOTFS_MAXSIZE = "10240"      # Maximum size (KB)
IMAGE_ROOTFS_EXTRA_SPACE = "1024"   # Extra space (KB)

# Overhead factor
IMAGE_OVERHEAD_FACTOR = "1.3"       # 30% overhead
</code></pre>
<p><strong>Read-only root filesystem:</strong></p>
<pre><code class="language-python"># Enable read-only rootfs
IMAGE_FEATURES += "read-only-rootfs"

# Requires:
# - /var as tmpfs or separate writable partition
# - /etc overlayfs or tmpfs
# - Proper mount configuration

# Additional configuration
EXTRA_IMAGE_FEATURES += "read-only-rootfs"

# Writable directories
VOLATILE_LOG_DIR = "yes"
</code></pre>
<p><strong>User and group management:</strong></p>
<pre><code class="language-python"># Add users in recipe
inherit useradd

USERADD_PACKAGES = "${PN}"
USERADD_PARAM:${PN} = "-u 1000 -d /home/myuser -s /bin/bash myuser"
GROUPADD_PARAM:${PN} = "-g 1000 mygroup"

# Or in image recipe
ROOTFS_POSTPROCESS_COMMAND += "add_custom_users; "

add_custom_users() {
    echo "myuser:x:1000:1000::/home/myuser:/bin/bash" &gt;&gt; ${IMAGE_ROOTFS}/etc/passwd
    echo "myuser:!:18000:0:99999:7:::" &gt;&gt; ${IMAGE_ROOTFS}/etc/shadow
    echo "mygroup:x:1000:" &gt;&gt; ${IMAGE_ROOTFS}/etc/group
}
</code></pre>
<p><strong>Hostname and networking:</strong></p>
<pre><code class="language-python"># Set hostname
hostname:pn-base-files = "my-device"

# Or in postprocess
ROOTFS_POSTPROCESS_COMMAND += "set_hostname; "

set_hostname() {
    echo "my-device" &gt; ${IMAGE_ROOTFS}/etc/hostname
}

# Network configuration
ROOTFS_POSTPROCESS_COMMAND += "setup_network; "

setup_network() {
    cat &gt; ${IMAGE_ROOTFS}/etc/network/interfaces &lt;&lt; EOF
auto lo
iface lo inet loopback

auto eth0
iface eth0 inet dhcp
EOF
}
</code></pre>
<h2 id="bsp-development"><a class="header" href="#bsp-development">BSP Development</a></h2>
<h3 id="machine-configuration"><a class="header" href="#machine-configuration">Machine Configuration</a></h3>
<p><strong>Machine conf file:</strong></p>
<pre><code class="language-python"># conf/machine/mymachine.conf

#@TYPE: Machine
#@NAME: My Custom Machine
#@DESCRIPTION: Machine configuration for my custom hardware

# Architecture
DEFAULTTUNE = "cortexa72"
require conf/machine/include/arm/armv8a/tune-cortexa72.inc

# Kernel
PREFERRED_PROVIDER_virtual/kernel = "linux-custom"
PREFERRED_VERSION_linux-custom = "6.1%"

# Bootloader
PREFERRED_PROVIDER_virtual/bootloader = "u-boot-custom"
PREFERRED_VERSION_u-boot-custom = "2024.01%"

# Machine features
MACHINE_FEATURES = "usbhost usbgadget alsa wifi bluetooth ext2 ext3 ext4 serial"

# Serial console
SERIAL_CONSOLES = "115200;ttyS0"

# Kernel configuration
KERNEL_IMAGETYPE = "Image"
KERNEL_DEVICETREE = "myvendor/mymachine.dtb"

# U-Boot configuration
UBOOT_MACHINE = "mymachine_defconfig"
UBOOT_ENTRYPOINT = "0x80008000"
UBOOT_LOADADDRESS = "0x80008000"

# Image format
IMAGE_FSTYPES = "ext4 tar.bz2 wic"
WKS_FILE = "mymachine.wks"

# Extra packages for this machine
MACHINE_EXTRA_RDEPENDS = "kernel-modules"
MACHINE_EXTRA_RRECOMMENDS = "firmware-custom"

# Root device
ROOT_DEVICE = "mmcblk0p2"
</code></pre>
<p><strong>Machine features:</strong></p>
<pre><code class="language-python"># Common machine features:
MACHINE_FEATURES = "\
    alsa          # Audio ALSA support
    bluetooth     # Bluetooth
    ext2          # ext2 filesystem
    ext3          # ext3 filesystem
    ext4          # ext4 filesystem
    keyboard      # Keyboard
    pci           # PCI bus
    pcmcia        # PCMCIA/CardBus
    phone         # Phone
    qvga          # QVGA display (320x240)
    screen        # Screen/display
    serial        # Serial console
    touchscreen   # Touchscreen
    usbgadget     # USB gadget
    usbhost       # USB host
    vfat          # VFAT filesystem
    wifi          # WiFi
"
</code></pre>
<h3 id="kernel-configuration"><a class="header" href="#kernel-configuration">Kernel Configuration</a></h3>
<p><strong>Kernel recipe for custom machine:</strong></p>
<pre><code class="language-python"># recipes-kernel/linux/linux-custom_6.1.bb

require recipes-kernel/linux/linux-yocto.inc

LINUX_VERSION = "6.1.50"
LINUX_VERSION_EXTENSION = "-custom"

SRCREV = "abc123..."
SRC_URI = "git://github.com/myorg/linux.git;protocol=https;branch=custom-6.1"

SRC_URI += "\
    file://defconfig \
    file://mymachine.scc \
    file://0001-custom-driver.patch \
"

COMPATIBLE_MACHINE = "mymachine"

# Kernel configuration fragments
KERNEL_FEATURES:append = " cfg/smp.scc"
</code></pre>
<p><strong>Kernel configuration fragment:</strong></p>
<pre><code class="language-bash"># recipes-kernel/linux/linux-custom/mymachine.scc

define KFEATURE_DESCRIPTION "My Machine kernel configuration"
define KFEATURE_COMPATIBILITY machine

# Include kernel types
kconf hardware mymachine.cfg

# mymachine.cfg:
CONFIG_MYDRIVER=y
CONFIG_I2C=y
CONFIG_SPI=y
CONFIG_GPIO_SYSFS=y
</code></pre>
<p><strong>Using kernel config fragments with bbappend:</strong></p>
<pre><code class="language-python"># recipes-kernel/linux/linux-yocto_%.bbappend

FILESEXTRAPATHS:prepend := "${THISDIR}/${PN}:"

SRC_URI += "\
    file://custom-drivers.cfg \
    file://custom-features.cfg \
"

# custom-drivers.cfg:
# CONFIG_MYDRIVER=y
# CONFIG_ANOTHER_DRIVER=m
</code></pre>
<h3 id="bootloader-integration"><a class="header" href="#bootloader-integration">Bootloader Integration</a></h3>
<p><strong>U-Boot recipe:</strong></p>
<pre><code class="language-python"># recipes-bsp/u-boot/u-boot-custom_2024.01.bb

require recipes-bsp/u-boot/u-boot-common.inc
require recipes-bsp/u-boot/u-boot.inc

SUMMARY = "U-Boot for My Machine"
LICENSE = "GPL-2.0-or-later"
LIC_FILES_CHKSUM = "file://Licenses/README;md5=..."

SRCREV = "def456..."
SRC_URI = "git://github.com/myorg/u-boot.git;protocol=https;branch=custom"

SRC_URI += "\
    file://boot.cmd \
    file://0001-add-board-support.patch \
"

S = "${WORKDIR}/git"

COMPATIBLE_MACHINE = "mymachine"

# Compile boot script
do_compile:append() {
    ${B}/tools/mkimage -C none -A arm -T script -d ${WORKDIR}/boot.cmd ${B}/boot.scr
}

do_install:append() {
    install -d ${D}/boot
    install -m 0644 ${B}/boot.scr ${D}/boot/
}

FILES:${PN} += "/boot/boot.scr"
</code></pre>
<p><strong>U-Boot bbappend for environment:</strong></p>
<pre><code class="language-python"># recipes-bsp/u-boot/u-boot_%.bbappend

FILESEXTRAPATHS:prepend := "${THISDIR}/${PN}:"

SRC_URI += "file://mymachine-env.txt"

do_compile:append() {
    ${B}/tools/mkenvimage -s 131072 -o ${B}/u-boot-env.bin ${WORKDIR}/mymachine-env.txt
}
</code></pre>
<h3 id="device-tree-integration"><a class="header" href="#device-tree-integration">Device Tree Integration</a></h3>
<p><strong>Device tree recipe:</strong></p>
<pre><code class="language-python"># recipes-bsp/device-tree/device-tree-custom.bb

SUMMARY = "Custom device trees"
LICENSE = "GPL-2.0-only | BSD-2-Clause"
LIC_FILES_CHKSUM = "file://COPYING;md5=..."

inherit devicetree

SRC_URI = "\
    file://mymachine.dts \
    file://mymachine-overlay.dts \
"

S = "${WORKDIR}"

# Compiled DTBs installed to /boot/devicetree/
</code></pre>
<p><strong>Device tree in kernel recipe:</strong></p>
<pre><code class="language-python"># Specify device tree in machine conf
KERNEL_DEVICETREE = "\
    myvendor/mymachine.dtb \
    myvendor/mymachine-v2.dtb \
    myvendor/mymachine-overlay.dtbo \
"

# Add device tree sources to kernel
# recipes-kernel/linux/linux-custom/mymachine.dts
# Automatically compiled by kernel build
</code></pre>
<p><strong>Device tree overlay:</strong></p>
<pre><code class="language-dts">/* mymachine-overlay.dts */
/dts-v1/;
/plugin/;

/ {
    compatible = "myvendor,mymachine";

    fragment@0 {
        target-path = "/";
        __overlay__ {
            custom-device {
                compatible = "myvendor,custom";
                status = "okay";
            };
        };
    };
};
</code></pre>
<h3 id="creating-a-bsp-layer"><a class="header" href="#creating-a-bsp-layer">Creating a BSP Layer</a></h3>
<pre><code class="language-bash"># Create BSP layer
bitbake-layers create-layer meta-mymachine
cd meta-mymachine

# Structure:
mkdir -p conf/machine
mkdir -p recipes-bsp/u-boot
mkdir -p recipes-kernel/linux
mkdir -p recipes-core/images
mkdir -p wic

# Create machine configuration
cat &gt; conf/machine/mymachine.conf &lt;&lt; 'EOF'
#@TYPE: Machine
#@NAME: My Machine
#@DESCRIPTION: Machine configuration for My Hardware

DEFAULTTUNE = "cortexa72"
require conf/machine/include/arm/armv8a/tune-cortexa72.inc

PREFERRED_PROVIDER_virtual/kernel = "linux-mymachine"
PREFERRED_PROVIDER_virtual/bootloader = "u-boot-mymachine"

MACHINE_FEATURES = "usbhost usbgadget ext4 serial"
SERIAL_CONSOLES = "115200;ttyS0"

KERNEL_IMAGETYPE = "Image"
KERNEL_DEVICETREE = "myvendor/mymachine.dtb"

UBOOT_MACHINE = "mymachine_defconfig"

IMAGE_FSTYPES = "wic ext4"
WKS_FILE = "mymachine.wks"
EOF

# Create WIC kickstart
cat &gt; wic/mymachine.wks &lt;&lt; 'EOF'
# Partitioning for My Machine
# Boot partition (FAT32)
part /boot --source bootimg-partition --ondisk mmcblk0 --fstype=vfat --label boot --align 4096 --size 64M
# Root partition (ext4)
part / --source rootfs --ondisk mmcblk0 --fstype=ext4 --label root --align 4096 --size 1024M

bootloader --ptable msdos
EOF

# Add layer to build
bitbake-layers add-layer meta-mymachine
</code></pre>
<p><strong>BSP image recipe:</strong></p>
<pre><code class="language-python"># recipes-core/images/mymachine-image.bb

require recipes-core/images/core-image-minimal.bb

SUMMARY = "Image for My Machine"

IMAGE_INSTALL += "\
    kernel-modules \
    u-boot-fw-utils \
    packagegroup-mymachine \
"

IMAGE_FEATURES += "ssh-server-dropbear"

# Machine-specific post-processing
ROOTFS_POSTPROCESS_COMMAND += "mymachine_setup; "

mymachine_setup() {
    # Custom setup for this machine
    echo "mymachine" &gt; ${IMAGE_ROOTFS}/etc/hostname
}
</code></pre>
<h2 id="package-management"><a class="header" href="#package-management">Package Management</a></h2>
<h3 id="package-formats"><a class="header" href="#package-formats">Package Formats</a></h3>
<p>Yocto supports three package formats:</p>
<pre><code class="language-python"># Select package format in local.conf
PACKAGE_CLASSES = "package_rpm"      # RPM (default)
# PACKAGE_CLASSES = "package_deb"    # Debian
# PACKAGE_CLASSES = "package_ipk"    # IPK (opkg)

# Multiple formats (discouraged)
# PACKAGE_CLASSES = "package_rpm package_deb"
</code></pre>
<p><strong>RPM (default):</strong></p>
<pre><code class="language-python"># RPM-specific configuration
PACKAGE_CLASSES = "package_rpm"

# RPM architecture
PACKAGE_ARCH_RPM = "noarch"

# Repository configuration
PACKAGE_FEED_URIS = "http://example.com/rpm"
</code></pre>
<p><strong>DEB (Debian/Ubuntu style):</strong></p>
<pre><code class="language-python">PACKAGE_CLASSES = "package_deb"

# Debian-specific
PACKAGE_FEED_URIS = "http://example.com/deb"
PACKAGE_FEED_BASE_PATHS = "deb"
PACKAGE_FEED_ARCHS = "all cortexa72"
</code></pre>
<p><strong>IPK (lightweight):</strong></p>
<pre><code class="language-python">PACKAGE_CLASSES = "package_ipk"

# Used by opkg package manager
PACKAGE_FEED_URIS = "http://example.com/ipk"
</code></pre>
<h3 id="package-feeds"><a class="header" href="#package-feeds">Package Feeds</a></h3>
<p><strong>Creating package feeds:</strong></p>
<pre><code class="language-python"># In local.conf
PACKAGE_CLASSES = "package_rpm"
PACKAGE_FEED_URIS = "http://myserver.com/rpm-feed"

# Build packages (without creating image)
bitbake &lt;recipe-name&gt; -c package_write_rpm

# Or build everything and populate feed
bitbake &lt;image-name&gt;
bitbake package-index
</code></pre>
<p><strong>Package feed directory structure:</strong></p>
<pre><code>tmp/deploy/rpm/
├── all/                    # Architecture-independent
│   └── packagegroup-*.rpm
├── cortexa72/              # Architecture-specific
│   ├── kernel-*.rpm
│   └── myapp-*.rpm
├── mymachine/              # Machine-specific
│   └── firmware-*.rpm
└── repodata/               # RPM repository metadata
    └── repomd.xml
</code></pre>
<p><strong>Setting up HTTP package feed:</strong></p>
<pre><code class="language-bash"># Serve packages via HTTP
cd tmp/deploy/rpm
python3 -m http.server 8000

# Or with nginx
# Copy tmp/deploy/rpm to /var/www/html/rpm-feed
</code></pre>
<p><strong>Client configuration:</strong></p>
<pre><code class="language-python"># On target device
# For RPM (dnf/yum)
cat &gt; /etc/yum.repos.d/custom.repo &lt;&lt; EOF
[custom]
name=Custom Repository
baseurl=http://myserver:8000/cortexa72
enabled=1
gpgcheck=0
EOF

# For DEB (apt)
echo "deb http://myserver:8000/deb cortexa72/" &gt; /etc/apt/sources.list.d/custom.list

# For IPK (opkg)
echo "src/gz custom http://myserver:8000/ipk/cortexa72" &gt; /etc/opkg/custom.conf
</code></pre>
<h3 id="runtime-package-management"><a class="header" href="#runtime-package-management">Runtime Package Management</a></h3>
<p><strong>Enable package management in image:</strong></p>
<pre><code class="language-python"># In image recipe or local.conf
IMAGE_FEATURES += "package-management"

# This includes:
# - Package manager (rpm/apt/opkg)
# - Package database
# - Repository configuration
</code></pre>
<p><strong>Using package managers on target:</strong></p>
<pre><code class="language-bash"># RPM (dnf)
dnf update
dnf install mypackage
dnf search keyword
dnf remove mypackage

# DEB (apt)
apt update
apt install mypackage
apt search keyword
apt remove mypackage

# IPK (opkg)
opkg update
opkg install mypackage
opkg list | grep keyword
opkg remove mypackage
</code></pre>
<h3 id="package-dependencies"><a class="header" href="#package-dependencies">Package Dependencies</a></h3>
<p><strong>Build dependencies (DEPENDS):</strong></p>
<pre><code class="language-python"># Required to build this recipe
DEPENDS = "zlib openssl virtual/kernel"

# These must complete do_populate_sysroot before
# this recipe's do_configure runs
</code></pre>
<p><strong>Runtime dependencies (RDEPENDS):</strong></p>
<pre><code class="language-python"># Main package dependencies
RDEPENDS:${PN} = "bash libssl libz"

# Development package dependencies
RDEPENDS:${PN}-dev = "${PN} (= ${EXTENDPKGV})"

# Conditional dependencies
RDEPENDS:${PN} += "${@bb.utils.contains('DISTRO_FEATURES', 'systemd', 'systemd', 'sysvinit', d)}"

# Optional dependencies (recommended)
RRECOMMENDS:${PN} = "optional-package"
</code></pre>
<p><strong>Package provides/conflicts:</strong></p>
<pre><code class="language-python"># Virtual package provision
PROVIDES = "virtual/some-service"

# Conflicts with other packages
RCONFLICTS:${PN} = "other-package"

# Replaces other packages
RREPLACES:${PN} = "old-package"

# Same functionality as another package
RPROVIDES:${PN} = "alternative-name"
</code></pre>
<p><strong>Dependency debugging:</strong></p>
<pre><code class="language-bash"># Show runtime dependencies
bitbake -g &lt;recipe&gt;
# Generates pn-depends.dot

# Show why a package is included
bitbake -g &lt;image&gt; -u depexp
# Opens dependency explorer GUI

# List runtime dependencies of a package
oe-pkgdata-util list-pkg-files &lt;package&gt;
oe-pkgdata-util read-value RDEPENDS &lt;package&gt;
</code></pre>
<h2 id="configuration-system"><a class="header" href="#configuration-system">Configuration System</a></h2>
<h3 id="configuration-files"><a class="header" href="#configuration-files">Configuration Files</a></h3>
<p><strong>Configuration file hierarchy:</strong></p>
<pre><code>Build Configuration Loading Order:
┌────────────────────────────────────┐
│ 1. bitbake.conf                    │  ← OE-Core defaults
├────────────────────────────────────┤
│ 2. layer.conf (each layer)         │  ← Layer settings
├────────────────────────────────────┤
│ 3. machine/*.conf                  │  ← Machine config
├────────────────────────────────────┤
│ 4. distro/*.conf                   │  ← Distribution config
├────────────────────────────────────┤
│ 5. bblayers.conf                   │  ← Layer list
├────────────────────────────────────┤
│ 6. local.conf                      │  ← Local overrides
└────────────────────────────────────┘
       Later files override earlier
</code></pre>
<h3 id="localconf"><a class="header" href="#localconf">local.conf</a></h3>
<p><strong>Key settings in local.conf:</strong></p>
<pre><code class="language-python"># Machine selection
MACHINE = "qemux86-64"
# MACHINE = "raspberrypi4"
# MACHINE = "mymachine"

# Distribution
DISTRO = "poky"

# Package format
PACKAGE_CLASSES = "package_rpm"

# Parallel build jobs
BB_NUMBER_THREADS = "8"      # BitBake parallel tasks
PARALLEL_MAKE = "-j 8"       # Make parallel jobs

# Disk space monitoring
BB_DISKMON_DIRS = "\
    STOPTASKS,${TMPDIR},1G,100K \
    STOPTASKS,${DL_DIR},1G,100K \
    STOPTASKS,${SSTATE_DIR},1G,100K \
    ABORT,${TMPDIR},100M,1K \
    ABORT,${DL_DIR},100M,1K \
    ABORT,${SSTATE_DIR},100M,1K"

# Shared state cache
SSTATE_DIR = "${TOPDIR}/sstate-cache"
# SSTATE_DIR = "/common/sstate-cache"  # Shared location

# Download directory
DL_DIR = "${TOPDIR}/downloads"
# DL_DIR = "/common/downloads"  # Shared location

# SSTATE mirrors
SSTATE_MIRRORS = "\
    file://.* http://sstate.yoctoproject.org/all/PATH;downloadfilename=PATH \
"

# Premirrors (check before original)
PREMIRRORS:prepend = "\
    git://.*/.* http://mirror.example.com/git/MIRRORNAME \
    ftp://.*/.* http://mirror.example.com/sources/ \
    http://.*/.* http://mirror.example.com/sources/ \
    https://.*/.* http://mirror.example.com/sources/ \
"

# Mirrors (fallback if download fails)
MIRRORS:prepend = "\
    ftp://.*/.* http://backup.example.com/sources/ \
    http://.*/.* http://backup.example.com/sources/ \
    https://.*/.* http://backup.example.com/sources/ \
"

# Remove packages from image
PACKAGE_EXCLUDE = "package1 package2"

# Additional image features
EXTRA_IMAGE_FEATURES = "debug-tweaks tools-debug"

# Root password (debug only!)
EXTRA_USERS_PARAMS = "usermod -P rootpass root;"

# SDK configuration
SDKMACHINE = "x86_64"

# RM_OLD_IMAGE: Remove previous image when building new one
RM_OLD_IMAGE = "1"

# Image name customization
IMAGE_NAME = "${IMAGE_BASENAME}-${MACHINE}-${DATETIME}"
</code></pre>
<p><strong>Development settings:</strong></p>
<pre><code class="language-python"># Disable shared state cache (for testing)
# SSTATE_DIR = ""

# Keep temporary files after build
# RM_WORK_EXCLUDE += "recipe-name"

# Enable buildhistory
INHERIT += "buildhistory"
BUILDHISTORY_COMMIT = "1"

# Hash equivalence server (for distributed builds)
BB_HASHSERVE = "auto"
BB_SIGNATURE_HANDLER = "OEEquivHash"

# Enable network during build (for specific recipes only!)
# BB_NO_NETWORK = "0"  # Not recommended globally
</code></pre>
<h3 id="bblayersconf"><a class="header" href="#bblayersconf">bblayers.conf</a></h3>
<pre><code class="language-python"># conf/bblayers.conf

# Build layers directory
BBPATH = "${TOPDIR}"

# Poky directory
BBFILES ?= ""

BBLAYERS ?= " \
  /path/to/poky/meta \
  /path/to/poky/meta-poky \
  /path/to/poky/meta-yocto-bsp \
  /path/to/meta-openembedded/meta-oe \
  /path/to/meta-openembedded/meta-python \
  /path/to/meta-openembedded/meta-networking \
  /path/to/meta-custom \
  /path/to/meta-mymachine \
"
</code></pre>
<p><strong>Managing layers:</strong></p>
<pre><code class="language-bash"># Show configured layers
bitbake-layers show-layers

# Add layer
bitbake-layers add-layer /path/to/meta-layer

# Remove layer
bitbake-layers remove-layer meta-layer

# Show recipes provided by layer
bitbake-layers show-recipes -i meta-layer

# Show appends in layer
bitbake-layers show-appends
</code></pre>
<h3 id="distribution-configuration"><a class="header" href="#distribution-configuration">Distribution Configuration</a></h3>
<p><strong>Creating custom distribution:</strong></p>
<pre><code class="language-python"># meta-custom/conf/distro/mydistro.conf

require conf/distro/poky.conf

DISTRO = "mydistro"
DISTRO_NAME = "My Custom Distribution"
DISTRO_VERSION = "1.0"
DISTRO_CODENAME = "custom"

MAINTAINER = "Your Name &lt;your@email.com&gt;"

# Target OS
TARGET_VENDOR = "-custom"

# Distribution features
DISTRO_FEATURES:append = " systemd"
DISTRO_FEATURES:remove = "sysvinit"
DISTRO_FEATURES_BACKFILL_CONSIDERED = "sysvinit"

# Init manager
VIRTUAL-RUNTIME_init_manager = "systemd"
VIRTUAL-RUNTIME_initscripts = ""

# Package management
PACKAGE_CLASSES = "package_rpm"

# Preferred versions
PREFERRED_VERSION_linux-yocto = "6.1%"
PREFERRED_VERSION_u-boot = "2024.01%"

# SDK
SDK_VENDOR = "-customsdk"
SDK_VERSION = "${DISTRO_VERSION}"

# Security flags
SECURITY_CFLAGS = "-fstack-protector-strong -D_FORTIFY_SOURCE=2"
SECURITY_LDFLAGS = "-Wl,-z,relro,-z,now"

# Reproducible builds
INHERIT += "reproducible_build"
</code></pre>
<p><strong>Using custom distribution:</strong></p>
<pre><code class="language-python"># In local.conf
DISTRO = "mydistro"
</code></pre>
<h3 id="machine-configuration-files"><a class="header" href="#machine-configuration-files">Machine Configuration Files</a></h3>
<p>See <a href="#machine-configuration">BSP Development - Machine Configuration</a> section for details.</p>
<h3 id="variable-assignment"><a class="header" href="#variable-assignment">Variable Assignment</a></h3>
<p><strong>Assignment operators summary:</strong></p>
<pre><code class="language-python"># Immediate expansion
VAR := "value_${OTHER_VAR}"        # Expanded now

# Delayed expansion
VAR = "value_${OTHER_VAR}"         # Expanded when referenced

# Default (weak assignment)
VAR ?= "default"                   # Only if not set

# Weak default (weaker)
VAR ??= "weak"                     # Lowest priority

# Append with space
VAR += "append"                    # VAR = "original append"

# Prepend with space
VAR =+ "prepend"                   # VAR = "prepend original"

# Append without space
VAR .= "append"                    # VAR = "originalappend"

# Prepend without space
VAR =. "prepend"                   # VAR = "prependoriginal"

# Append (after all operations)
VAR:append = " late"               # Applied last

# Prepend (before all operations)
VAR:prepend = "early "             # Applied first

# Remove items
VAR:remove = "item"                # Removes "item" from VAR

# Override (conditional)
VAR:arm = "arm-value"              # Only for ARM
VAR:mymachine = "machine-value"    # Only for mymachine
</code></pre>
<p><strong>Order of operations:</strong></p>
<pre><code>1. :prepend
2. =.
3. =+
4. = or :=
5. += or ?= or ??=
6. .=
7. :append
8. :remove
</code></pre>
<p><strong>Example:</strong></p>
<pre><code class="language-python">VAR = "base"
VAR:prepend = "pre "
VAR:append = " post"
VAR += "add"

# Result: "pre base add post"
</code></pre>
<h3 id="important-variables"><a class="header" href="#important-variables">Important Variables</a></h3>
<p><strong>Paths:</strong></p>
<pre><code class="language-python"># Top-level directories
TOPDIR          # Build directory
TMPDIR          # tmp/ (build artifacts)
DL_DIR          # downloads/
SSTATE_DIR      # sstate-cache/

# Deploy directories
DEPLOY_DIR              # tmp/deploy
DEPLOY_DIR_IMAGE        # tmp/deploy/images/${MACHINE}
DEPLOY_DIR_RPM          # tmp/deploy/rpm
DEPLOY_DIR_TAR          # tmp/deploy/tar

# Work directories
WORKDIR         # Recipe work directory
S               # Source directory
B               # Build directory
D               # Destination directory (install root)

# Staging
STAGING_DIR_HOST        # Sysroot for target
STAGING_DIR_NATIVE      # Sysroot for build host
STAGING_DIR_TARGET      # Sysroot for target (legacy)
</code></pre>
<p><strong>Build configuration:</strong></p>
<pre><code class="language-python">MACHINE                 # Target machine
DISTRO                  # Distribution
TARGET_ARCH             # Target architecture (arm, x86_64, etc.)
TARGET_OS               # Target OS (linux, etc.)
TARGET_VENDOR           # Vendor string
TARGET_SYS              # Complete target system (arm-poky-linux-gnueabi)

BUILD_ARCH              # Build host architecture
BUILD_OS                # Build host OS
BUILD_SYS               # Build host system

HOST_ARCH               # Same as TARGET_ARCH
HOST_OS                 # Same as TARGET_OS
HOST_SYS                # Same as TARGET_SYS

TUNE_FEATURES           # CPU tuning features
DEFAULTTUNE             # Default tune settings
</code></pre>
<p><strong>Recipe metadata:</strong></p>
<pre><code class="language-python">PN                      # Package name
PV                      # Package version
PR                      # Package revision
PE                      # Package epoch
PF                      # Package full name (PN-PV-PR)
BP                      # Base package (PN-PV)

SUMMARY                 # Short description
DESCRIPTION             # Long description
HOMEPAGE                # Project homepage
SECTION                 # Package category
LICENSE                 # License(s)
LIC_FILES_CHKSUM        # License file checksums
</code></pre>
<p><strong>Dependencies:</strong></p>
<pre><code class="language-python">DEPENDS                 # Build-time dependencies
RDEPENDS                # Runtime dependencies
RRECOMMENDS             # Recommended packages
RSUGGESTS               # Suggested packages
RPROVIDES               # Virtual packages provided
RCONFLICTS              # Conflicting packages
RREPLACES               # Replaced packages
</code></pre>
<p><strong>Features:</strong></p>
<pre><code class="language-python">DISTRO_FEATURES         # Distribution features
MACHINE_FEATURES        # Machine features
IMAGE_FEATURES          # Image features
COMBINED_FEATURES       # Intersection of DISTRO and MACHINE
</code></pre>
<h2 id="advanced-features"><a class="header" href="#advanced-features">Advanced Features</a></h2>
<h3 id="sdk-generation"><a class="header" href="#sdk-generation">SDK Generation</a></h3>
<p><strong>Standard SDK:</strong></p>
<pre><code class="language-bash"># Build SDK for an image
bitbake core-image-minimal -c populate_sdk

# SDK location
ls tmp/deploy/sdk/
# poky-glibc-x86_64-core-image-minimal-cortexa72-mymachine-toolchain-5.0.sh
</code></pre>
<p><strong>SDK contents:</strong></p>
<pre><code>SDK Directory Structure:
/opt/poky/5.0/
├── sysroots/
│   ├── x86_64-pokysdk-linux/        # Host tools
│   │   ├── usr/
│   │   │   ├── bin/                 # Cross-compilation tools
│   │   │   │   ├── arm-poky-linux-gcc
│   │   │   │   ├── arm-poky-linux-g++
│   │   │   │   └── ...
│   │   │   └── lib/
│   │   └── environment-setup-*      # Setup script
│   └── cortexa72-poky-linux/        # Target sysroot
│       ├── lib/                     # Target libraries
│       ├── usr/
│       │   ├── include/             # Headers
│       │   └── lib/                 # Development libraries
│       └── etc/
└── site-config-*
</code></pre>
<p><strong>Installing and using SDK:</strong></p>
<pre><code class="language-bash"># Install SDK
./poky-glibc-x86_64-core-image-minimal-cortexa72-mymachine-toolchain-5.0.sh

# Default location: /opt/poky/5.0
# Or specify: ./sdk.sh -d /custom/path

# Setup environment
source /opt/poky/5.0/environment-setup-cortexa72-poky-linux

# Cross-compile application
$CC hello.c -o hello
# Uses arm-poky-linux-gcc with proper sysroot and flags

# Check variables
echo $CC
# arm-poky-linux-gcc -mthumb -mfpu=neon -mfloat-abi=hard -mcpu=cortex-a72 ...

echo $CXX
echo $CFLAGS
echo $LDFLAGS
</code></pre>
<p><strong>Customizing SDK:</strong></p>
<pre><code class="language-python"># In image recipe
TOOLCHAIN_HOST_TASK:append = " nativesdk-cmake nativesdk-make"
TOOLCHAIN_TARGET_TASK:append = " libssl-dev zlib-dev"

# SDK name
SDK_NAME = "${DISTRO}-${TCLIBC}-${SDK_ARCH}-${IMAGE_BASENAME}-${TUNE_PKGARCH}"

# SDK output format
SDKIMAGE_FEATURES = "dev-pkgs dbg-pkgs src-pkgs"

# Post-install script
SDK_POST_INSTALL_COMMAND = "echo 'SDK installed' &gt; ${SDK_OUTPUT}/${SDKPATH}/version"
</code></pre>
<h3 id="esdk-extensible-sdk"><a class="header" href="#esdk-extensible-sdk">eSDK (Extensible SDK)</a></h3>
<p><strong>Build eSDK:</strong></p>
<pre><code class="language-bash"># Build extensible SDK
bitbake core-image-minimal -c populate_sdk_ext

# Output
ls tmp/deploy/sdk/
# poky-glibc-x86_64-core-image-minimal-cortexa72-mymachine-toolchain-ext-5.0.sh
</code></pre>
<p><strong>eSDK features:</strong></p>
<ul>
<li>Contains full build system</li>
<li>Can build recipes from source</li>
<li>Includes devtool for development workflow</li>
<li>Larger than standard SDK (~5-10 GB)</li>
<li>Self-contained build environment</li>
</ul>
<p><strong>Using eSDK:</strong></p>
<pre><code class="language-bash"># Install eSDK
./poky-*-toolchain-ext-*.sh

# Setup environment
source /opt/poky/5.0/environment-setup-cortexa72-poky-linux

# Use devtool
devtool add myapp https://github.com/user/myapp.git
devtool build myapp
devtool deploy-target myapp root@192.168.1.100
</code></pre>
<h3 id="devtool"><a class="header" href="#devtool">devtool</a></h3>
<p><strong>devtool workflow:</strong></p>
<pre><code class="language-bash"># Add new recipe (creates workspace)
devtool add myapp https://github.com/user/myapp.git

# Creates:
# workspace/sources/myapp/     - Source code
# workspace/recipes/myapp/     - Recipe
# workspace/appends/myapp.bbappend

# Modify source
cd workspace/sources/myapp
# Make changes...

# Build recipe
devtool build myapp

# Build and create package
devtool build myapp -c package

# Test on target device
devtool deploy-target myapp root@192.168.1.100

# Update recipe (after source changes)
devtool update-recipe myapp

# Create patch from changes
devtool finish myapp meta-custom

# This:
# - Creates final recipe in meta-custom
# - Generates patches for source changes
# - Removes from workspace
</code></pre>
<p><strong>devtool commands:</strong></p>
<pre><code class="language-bash"># Create new recipe
devtool add &lt;recipe&gt; &lt;source&gt;

# Modify existing recipe
devtool modify &lt;recipe&gt;

# Build recipe
devtool build &lt;recipe&gt;

# Build SDK for recipe
devtool build-sdk &lt;recipe&gt;

# Deploy to target
devtool deploy-target &lt;recipe&gt; &lt;target&gt;

# Undeploy from target
devtool undeploy-target &lt;recipe&gt; &lt;target&gt;

# Update recipe with changes
devtool update-recipe &lt;recipe&gt;

# Finalize recipe
devtool finish &lt;recipe&gt; &lt;layer&gt;

# Reset workspace
devtool reset &lt;recipe&gt;

# Search for recipe
devtool search &lt;pattern&gt;

# Show recipe info
devtool latest-version &lt;recipe&gt;

# Configure devtool
devtool configure-help &lt;recipe&gt;
</code></pre>
<p><strong>devtool configuration:</strong></p>
<pre><code class="language-python"># workspace/devtool.conf (auto-generated)
# Configure target device
DEVTOOL_TARGET = "root@192.168.1.100"

# Configure deployment directory
DEVTOOL_DEPLOY_DIR = "/opt/deployed"
</code></pre>
<h3 id="multiconfig-builds"><a class="header" href="#multiconfig-builds">Multiconfig Builds</a></h3>
<p><strong>Multiconfig</strong> enables building for multiple configurations in one build:</p>
<pre><code class="language-bash"># Create additional config
cp conf/local.conf conf/multiconfig/target2.conf

# Edit target2.conf
sed -i 's/MACHINE = "qemux86-64"/MACHINE = "raspberrypi4"/' conf/multiconfig/target2.conf
</code></pre>
<p><strong>Enable multiconfig:</strong></p>
<pre><code class="language-python"># In local.conf
BBMULTICONFIG = "target2 target3"

# This loads:
# - conf/multiconfig/target2.conf
# - conf/multiconfig/target3.conf
</code></pre>
<p><strong>Build with multiconfig:</strong></p>
<pre><code class="language-bash"># Build for default config
bitbake core-image-minimal

# Build for specific multiconfig
bitbake mc:target2:core-image-minimal

# Build for all configs
bitbake mc::core-image-minimal mc:target2:core-image-minimal

# Or use dependency
# In recipe:
# do_something[mcdepends] = "mc:target2:core-image-minimal:do_image_complete"
</code></pre>
<p><strong>Use cases:</strong></p>
<ul>
<li>Multiple machine targets</li>
<li>Different distro configurations</li>
<li>SDK and target in one build</li>
<li>Different optimization levels</li>
</ul>
<h3 id="sstate-and-build-acceleration"><a class="header" href="#sstate-and-build-acceleration">SSTATE and Build Acceleration</a></h3>
<p><strong>Shared state cache optimization:</strong></p>
<pre><code class="language-python"># Share SSTATE between builds
SSTATE_DIR = "/common/sstate-cache"

# SSTATE mirrors (read-only)
SSTATE_MIRRORS = "\
    file://.* http://sstate-mirror.example.com/PATH;downloadfilename=PATH \
    file://.* file:///network/sstate/PATH;downloadfilename=PATH \
"

# Publish to SSTATE mirror
SSTATE_UPLOAD = "1"
SSTATE_UPLOAD_DIR = "/network/sstate"
</code></pre>
<p><strong>Hash equivalence:</strong></p>
<pre><code class="language-python"># Enable hash equivalence server
BB_HASHSERVE = "auto"  # Start local server
# BB_HASHSERVE = "hashserv.example.com:8686"  # Remote server

BB_SIGNATURE_HANDLER = "OEEquivHash"

# Allows reusing binaries even if hashes differ
# but build inputs are equivalent
</code></pre>
<p><strong>Build history:</strong></p>
<pre><code class="language-python"># Enable build history
INHERIT += "buildhistory"
BUILDHISTORY_COMMIT = "1"
BUILDHISTORY_DIR = "${TOPDIR}/buildhistory"

# Track:
# - Installed packages
# - Package sizes
# - License information
# - Recipe changes

# View history
git -C buildhistory log
git -C buildhistory diff HEAD~1
</code></pre>
<p><strong>RM_WORK class:</strong></p>
<pre><code class="language-python"># Automatically remove temporary files after build
INHERIT += "rm_work"

# Exclude specific recipes
RM_WORK_EXCLUDE += "myapp linux-yocto"

# Saves disk space but requires rebuild if task re-runs
</code></pre>
<h3 id="template-layer"><a class="header" href="#template-layer">Template Layer</a></h3>
<p><strong>Using meta-skeleton as template:</strong></p>
<pre><code class="language-bash"># Copy template layer
cp -r poky/meta-skeleton /path/to/meta-custom

# Contains examples:
# - recipes-kernel/hello-mod/        # Kernel module
# - recipes-core/hello/              # Autotools app
# - recipes-core/hello-makefile/     # Makefile app
# - conf/layer.conf.sample           # Layer config
</code></pre>
<h2 id="debugging-and-troubleshooting"><a class="header" href="#debugging-and-troubleshooting">Debugging and Troubleshooting</a></h2>
<h3 id="bitbake-debug-options"><a class="header" href="#bitbake-debug-options">BitBake Debug Options</a></h3>
<p><strong>Verbose output:</strong></p>
<pre><code class="language-bash"># Verbose logging
bitbake -v &lt;recipe&gt;

# Debug logging
bitbake -D &lt;recipe&gt;

# Very verbose debug
bitbake -DD &lt;recipe&gt;

# Specific log domain
bitbake -l DEBUG &lt;recipe&gt;
</code></pre>
<p><strong>Dry run and dependency analysis:</strong></p>
<pre><code class="language-bash"># Dry run (parse only)
bitbake -n &lt;recipe&gt;

# Show what would be built
bitbake -s

# Dependency graph
bitbake -g &lt;recipe&gt;
# Creates: pn-depends.dot, task-depends.dot, pn-buildlist

# Dependency tree
bitbake -g &lt;recipe&gt; -u taskexp

# Why is package included?
bitbake -g &lt;image&gt;
grep "package-name" pn-depends.dot
</code></pre>
<p><strong>Task execution:</strong></p>
<pre><code class="language-bash"># Run specific task
bitbake &lt;recipe&gt; -c compile

# Force re-run task
bitbake &lt;recipe&gt; -c compile -f

# Continue after task
bitbake &lt;recipe&gt; -c compile --continue

# Clean tasks
bitbake &lt;recipe&gt; -c clean        # Clean work files
bitbake &lt;recipe&gt; -c cleansstate  # Clean sstate
bitbake &lt;recipe&gt; -c cleanall     # Clean everything including downloads
</code></pre>
<p><strong>Interactive development:</strong></p>
<pre><code class="language-bash"># Run task and drop into shell
bitbake &lt;recipe&gt; -c devshell

# Build environment available:
# - $CC, $CXX, $CFLAGS, etc.
# - Source in $S
# - Build in $B

# Python shell for recipe
bitbake &lt;recipe&gt; -c devpyshell

# Available:
# - d (datastore)
# - d.getVar('VARNAME')
</code></pre>
<h3 id="build-failures"><a class="header" href="#build-failures">Build Failures</a></h3>
<p><strong>Common build failure patterns:</strong></p>
<p><strong>1. Fetch failures:</strong></p>
<pre><code class="language-bash"># Error: Fetcher failure for URL...

# Causes:
# - Network issues
# - Incorrect URL
# - Missing checksum

# Solutions:
# Check SRC_URI
bitbake &lt;recipe&gt; -c fetch -f

# Verify checksum
bitbake &lt;recipe&gt; -c checksum

# Use mirror
PREMIRRORS:prepend = "git://.*/.* http://mirror.example.com/git/MIRRORNAME"
</code></pre>
<p><strong>2. Configure failures:</strong></p>
<pre><code class="language-bash"># Error: configure failed

# Check log
cat tmp/work/.../temp/log.do_configure

# Common causes:
# - Missing dependencies
# - Wrong configure flags

# Solutions:
# Add missing dependencies to DEPENDS
DEPENDS += "missing-package"

# Adjust configure options
EXTRA_OECONF += "--disable-problematic-feature"

# Manual configure
bitbake &lt;recipe&gt; -c devshell
./configure ...
</code></pre>
<p><strong>3. Compile failures:</strong></p>
<pre><code class="language-bash"># Error: compilation failed

# Check log
cat tmp/work/.../temp/log.do_compile

# Common causes:
# - Incompatible compiler flags
# - Missing headers

# Solutions:
# Adjust compiler flags
CFLAGS:append = " -Wno-error=specific-warning"

# Add include directory
CFLAGS:append = " -I${STAGING_INCDIR}/custom"

# Apply patches
SRC_URI += "file://fix-build.patch"
</code></pre>
<p><strong>4. QA failures:</strong></p>
<pre><code class="language-bash"># Error: QA Issue: ...

# Common QA issues:
# - already-stripped: Binaries stripped during install
# - installed-vs-shipped: Files installed but not packaged
# - host-user-contaminated: Files owned by build user
# - textrel: Text relocations in shared libraries

# Solutions:
# Skip specific QA check (not recommended)
INSANE_SKIP:${PN} += "already-stripped"

# Fix packaging
FILES:${PN} += "/path/to/installed/file"

# Fix installation
do_install:append() {
    # Don't strip here, let OE handle it
}
</code></pre>
<h3 id="dependency-issues"><a class="header" href="#dependency-issues">Dependency Issues</a></h3>
<p><strong>Missing dependencies:</strong></p>
<pre><code class="language-bash"># Error: Nothing PROVIDES 'package'

# Solutions:
# Add layer containing package
bitbake-layers add-layer meta-layer

# Check layer compatibility
bitbake-layers show-layers

# Search for recipe
bitbake-layers show-recipes package

# Add dependency
DEPENDS += "package"
</code></pre>
<p><strong>Circular dependencies:</strong></p>
<pre><code class="language-bash"># Error: Circular dependency

# Find cycle
bitbake -g &lt;recipe&gt;
grep -E "(recipe1.*recipe2|recipe2.*recipe1)" pn-depends.dot

# Solutions:
# - Remove unnecessary dependency
# - Split recipe into multiple packages
# - Use DEPENDS vs RDEPENDS appropriately
</code></pre>
<p><strong>Version conflicts:</strong></p>
<pre><code class="language-bash"># Error: Multiple versions of recipe

# Check available versions
bitbake-layers show-recipes &lt;recipe&gt;

# Select specific version
PREFERRED_VERSION_&lt;recipe&gt; = "1.2.3"

# Or in recipe
DEFAULT_PREFERENCE = "-1"  # Prefer other versions
</code></pre>
<h3 id="task-debugging"><a class="header" href="#task-debugging">Task Debugging</a></h3>
<p><strong>Examine task scripts:</strong></p>
<pre><code class="language-bash"># View generated task script
cat tmp/work/.../temp/run.do_compile

# Contains actual shell commands executed
# Useful for understanding what BitBake does
</code></pre>
<p><strong>Environment dump:</strong></p>
<pre><code class="language-bash"># Dump all variables for recipe
bitbake -e &lt;recipe&gt; &gt; recipe-env.txt

# Search for specific variable
bitbake -e &lt;recipe&gt; | grep ^DEPENDS=

# Show variable history
bitbake -e &lt;recipe&gt; | grep -A 10 "^# DEPENDS"
</code></pre>
<p><strong>Debugging Python tasks:</strong></p>
<pre><code class="language-python"># Add debug output in recipe
python do_custom_task() {
    bb.warn("Debug message")
    bb.note("Info message")
    bb.error("Error message")

    # Print variables
    var = d.getVar('SOME_VAR')
    bb.warn(f"SOME_VAR = {var}")
}
</code></pre>
<p><strong>Logging:</strong></p>
<pre><code class="language-bash"># Build log location
tmp/work/&lt;arch&gt;/&lt;recipe&gt;/&lt;version&gt;/temp/log.do_&lt;task&gt;

# Example
tmp/work/cortexa72-poky-linux/myapp/1.0-r0/temp/log.do_compile

# View recent logs
ls -lt tmp/work/*/*/*/temp/log.do_* | head
</code></pre>
<h3 id="common-problems"><a class="header" href="#common-problems">Common Problems</a></h3>
<p><strong>Problem: Disk space issues</strong></p>
<pre><code class="language-bash"># Clean old builds
bitbake &lt;recipe&gt; -c cleanall

# Remove tmp (rebuild from scratch)
rm -rf tmp

# Use rm_work class
INHERIT += "rm_work"

# Clean specific states
bitbake &lt;recipe&gt; -c cleansstate
</code></pre>
<p><strong>Problem: State corruption</strong></p>
<pre><code class="language-bash"># Clean and rebuild
bitbake &lt;recipe&gt; -c cleansstate
bitbake &lt;recipe&gt;

# Force re-parse
bitbake -e  # Then Ctrl+C
bitbake &lt;recipe&gt;

# Complete rebuild
rm -rf tmp sstate-cache
bitbake &lt;recipe&gt;
</code></pre>
<p><strong>Problem: Parse errors</strong></p>
<pre><code class="language-bash"># Error: ParseError at recipe.bb:10

# Check syntax
# - Missing quotes
# - Unclosed strings
# - Wrong operators

# Validate Python syntax
python3 -m py_compile recipe.bb
</code></pre>
<p><strong>Problem: Patch failures</strong></p>
<pre><code class="language-bash"># Error: patch failed

# Check patch
cat recipes-*/recipe/recipe/0001-fix.patch

# Verify patch applies
cd tmp/work/.../recipe-version
patch -p1 --dry-run &lt; path/to/patch

# Update patch
devtool modify recipe
# Make changes
devtool finish recipe meta-custom
</code></pre>
<p><strong>Problem: Missing files in package</strong></p>
<pre><code class="language-bash"># QA Issue: Files installed but not shipped

# Check what's installed
oe-pkgdata-util list-pkg-files &lt;package&gt;

# Fix FILES variable
FILES:${PN} += "/path/to/file"

# Or create new package
PACKAGES =+ "${PN}-extra"
FILES:${PN}-extra = "/path/to/extra/files"
</code></pre>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<h3 id="layer-design"><a class="header" href="#layer-design">Layer Design</a></h3>
<p><strong>Layer organization:</strong></p>
<pre><code>meta-company/
├── conf/
│   └── layer.conf
├── COPYING.MIT
├── README.md
│
├── classes/                    # Shared classes
│   └── company.bbclass
│
├── recipes-core/
│   └── images/
│       └── company-image.bb
│
├── recipes-bsp/               # Board support
│   ├── u-boot/
│   └── firmware/
│
├── recipes-kernel/            # Kernel customization
│   └── linux/
│
├── recipes-support/           # Libraries, utilities
│
└── recipes-apps/              # Applications
    └── company-app/
</code></pre>
<p><strong>Layer best practices:</strong></p>
<ol>
<li>
<p><strong>One purpose per layer:</strong></p>
<ul>
<li>BSP layer: Hardware support only</li>
<li>Distro layer: Distribution config only</li>
<li>App layer: Applications only</li>
</ul>
</li>
<li>
<p><strong>Clear dependencies:</strong></p>
<ul>
<li>Document in README</li>
<li>Set LAYERDEPENDS</li>
<li>Specify LAYERSERIES_COMPAT</li>
</ul>
</li>
<li>
<p><strong>Maintainability:</strong></p>
<ul>
<li>Use meaningful names</li>
<li>Version control</li>
<li>Document changes</li>
</ul>
</li>
<li>
<p><strong>Compatibility:</strong></p>
<ul>
<li>Test with multiple Yocto releases</li>
<li>Update LAYERSERIES_COMPAT</li>
<li>Pin SRCREV for stability</li>
</ul>
</li>
</ol>
<h3 id="recipe-patterns"><a class="header" href="#recipe-patterns">Recipe Patterns</a></h3>
<p><strong>Recipe naming:</strong></p>
<pre><code class="language-python"># Format: &lt;name&gt;_&lt;version&gt;.bb
myapp_1.0.bb          # Good
myapp.bb              # Bad: no version

# Multiple versions
myapp_1.0.bb
myapp_1.1.bb
myapp_git.bb          # Development version
</code></pre>
<p><strong>Source management:</strong></p>
<pre><code class="language-python"># Prefer specific commits over AUTOREV
SRCREV = "abc123def456..."
# Not: SRCREV = "${AUTOREV}"  # Unreproducible

# Use PV from tag
PV = "1.0+git${SRCPV}"

# Separate local files
SRC_URI = "git://github.com/user/repo.git;protocol=https \
           file://0001-fix.patch \
           file://config.in \
          "
</code></pre>
<p><strong>Dependency specification:</strong></p>
<pre><code class="language-python"># Build-time dependencies
DEPENDS = "zlib virtual/kernel"

# Runtime dependencies (package-specific)
RDEPENDS:${PN} = "bash libz"
RDEPENDS:${PN}-dev = "${PN} (= ${EXTENDPKGV})"

# Avoid:
# RDEPENDS:${PN} = "${PN}-dev"  # Wrong: circular
</code></pre>
<p><strong>Task organization:</strong></p>
<pre><code class="language-python"># Prefer :append over complete override
do_install:append() {
    # Additional install steps
}

# Not (unless necessary):
do_install() {
    # Complete replacement - loses base functionality
}

# Use :prepend for setup
do_configure:prepend() {
    ./autogen.sh
}
</code></pre>
<h3 id="version-management"><a class="header" href="#version-management">Version Management</a></h3>
<p><strong>Version pinning:</strong></p>
<pre><code class="language-python"># In distro config or local.conf
PREFERRED_VERSION_linux-yocto = "6.1%"
PREFERRED_VERSION_u-boot = "2024.01%"

# % allows any PR
# Without %: exact match required
</code></pre>
<p><strong>Recipe versioning:</strong></p>
<pre><code class="language-python"># Use PV from source
PV = "1.0"

# For git recipes
PV = "1.0+git${SRCPV}"

# PR for recipe changes (usually not needed)
PR = "r0"

# Increment PR for recipe-only changes
# (changes that don't affect PV)
</code></pre>
<p><strong>SRCREV management:</strong></p>
<pre><code class="language-python"># Development: use branch
SRC_URI = "git://github.com/user/repo.git;protocol=https;branch=develop"
SRCREV = "${AUTOREV}"

# Production: use specific commit
SRC_URI = "git://github.com/user/repo.git;protocol=https"
SRCREV = "abc123def456..."

# Tagged release
SRC_URI = "git://github.com/user/repo.git;protocol=https;tag=v1.0"
SRCREV = "${AUTOREV}"
</code></pre>
<h3 id="build-reproducibility"><a class="header" href="#build-reproducibility">Build Reproducibility</a></h3>
<p><strong>Reproducible builds:</strong></p>
<pre><code class="language-python"># Enable reproducible build class
inherit reproducible_build

# This ensures:
# - Timestamps are normalized
# - Build paths are consistent
# - File ordering is deterministic
</code></pre>
<p><strong>Version control metadata:</strong></p>
<pre><code class="language-python"># Don't use timestamps in versions
# Bad:
PV = "1.0+${DATE}"

# Good:
PV = "1.0+git${SRCPV}"

# Lock down sources
SRCREV = "specific-commit-hash"
SRC_URI[sha256sum] = "specific-checksum"
</code></pre>
<p><strong>Build isolation:</strong></p>
<pre><code class="language-python"># Disable network access (enforced by default)
BB_NO_NETWORK = "1"

# Prevent host contamination
# - Don't reference /usr or /opt
# - Use STAGING_* variables
# - Don't hardcode paths

# Bad:
CFLAGS += "-I/usr/include/custom"

# Good:
DEPENDS = "custom"
CFLAGS += "-I${STAGING_INCDIR}"
</code></pre>
<p><strong>Shared state:</strong></p>
<pre><code class="language-python"># Use consistent SSTATE_DIR
SSTATE_DIR = "/shared/sstate-cache"

# Configure SSTATE mirrors
SSTATE_MIRRORS = "file://.* http://sstate-server.local/PATH;downloadfilename=PATH"

# Enable hash equivalence
BB_HASHSERVE = "auto"
BB_SIGNATURE_HANDLER = "OEEquivHash"
</code></pre>
<h2 id="command-reference"><a class="header" href="#command-reference">Command Reference</a></h2>
<h3 id="bitbake-commands"><a class="header" href="#bitbake-commands">BitBake Commands</a></h3>
<pre><code class="language-bash"># Basic build
bitbake &lt;recipe&gt;

# Build image
bitbake &lt;image-recipe&gt;

# Show available recipes
bitbake -s

# Show recipe info
bitbake-layers show-recipes &lt;pattern&gt;

# Parse only (dry run)
bitbake -n &lt;recipe&gt;

# Clean tasks
bitbake &lt;recipe&gt; -c clean       # Clean work directory
bitbake &lt;recipe&gt; -c cleansstate # Clean shared state
bitbake &lt;recipe&gt; -c cleanall    # Clean everything

# Run specific task
bitbake &lt;recipe&gt; -c &lt;task&gt;

# Force task execution
bitbake &lt;recipe&gt; -c &lt;task&gt; -f

# List tasks
bitbake &lt;recipe&gt; -c listtasks

# Dependency graph
bitbake -g &lt;recipe&gt;

# Environment dump
bitbake -e &lt;recipe&gt; &gt; env.log

# Continue despite errors
bitbake -k &lt;recipe&gt;

# Development shell
bitbake &lt;recipe&gt; -c devshell

# Python shell
bitbake &lt;recipe&gt; -c devpyshell

# Build world (all recipes)
bitbake world

# Build SDK
bitbake &lt;image&gt; -c populate_sdk

# Build eSDK
bitbake &lt;image&gt; -c populate_sdk_ext

# Multiconfig build
bitbake mc:config:recipe
</code></pre>
<h3 id="devtool-commands"><a class="header" href="#devtool-commands">devtool Commands</a></h3>
<pre><code class="language-bash"># Add new recipe
devtool add &lt;name&gt; &lt;source-url&gt;

# Modify existing recipe
devtool modify &lt;recipe&gt;

# Build recipe
devtool build &lt;recipe&gt;

# Deploy to target
devtool deploy-target &lt;recipe&gt; root@&lt;ip&gt;

# Undeploy from target
devtool undeploy-target &lt;recipe&gt; root@&lt;ip&gt;

# Update recipe
devtool update-recipe &lt;recipe&gt;

# Finish development
devtool finish &lt;recipe&gt; &lt;layer&gt;

# Reset workspace
devtool reset &lt;recipe&gt;

# Search recipes
devtool search &lt;pattern&gt;

# Show latest version
devtool latest-version &lt;recipe&gt;

# Create workspace
devtool create-workspace &lt;path&gt;

# Configure recipe
devtool configure &lt;recipe&gt;

# Build image with workspace
devtool build-image &lt;image&gt;

# Export recipe
devtool export &lt;recipe&gt;

# Import recipe
devtool import &lt;exported-file&gt;
</code></pre>
<h3 id="recipetool-commands"><a class="header" href="#recipetool-commands">recipetool Commands</a></h3>
<pre><code class="language-bash"># Create recipe from source
recipetool create &lt;source-url&gt;

# Create with output file
recipetool create -o &lt;recipe.bb&gt; &lt;source&gt;

# Append to recipe
recipetool appendfile &lt;recipe&gt; &lt;file&gt; &lt;source-file&gt;

# Append source file
recipetool appendsrcfile &lt;recipe&gt; &lt;file&gt; &lt;source-file&gt;

# Append source files
recipetool appendsrcfiles &lt;recipe&gt; &lt;files...&gt;

# New appends
recipetool newappend &lt;recipe&gt;

# Set variable
recipetool setvar &lt;recipe&gt; &lt;variable&gt; &lt;value&gt;
</code></pre>
<h3 id="common-workflows"><a class="header" href="#common-workflows">Common Workflows</a></h3>
<p><strong>New recipe development:</strong></p>
<pre><code class="language-bash"># 1. Create recipe
recipetool create -o myapp_1.0.bb https://github.com/user/myapp.git

# 2. Or use devtool
devtool add myapp https://github.com/user/myapp.git

# 3. Modify source
cd workspace/sources/myapp
# Make changes...

# 4. Build and test
devtool build myapp
devtool deploy-target myapp root@192.168.1.100

# 5. Update recipe
devtool update-recipe myapp

# 6. Finalize
devtool finish myapp meta-custom
</code></pre>
<p><strong>Modify existing recipe:</strong></p>
<pre><code class="language-bash"># 1. Start modification
devtool modify linux-yocto

# 2. Make changes
cd workspace/sources/linux-yocto
# Edit source...

# 3. Build
devtool build linux-yocto

# 4. Generate patches
devtool update-recipe linux-yocto

# 5. Finish
devtool finish linux-yocto meta-custom
</code></pre>
<p><strong>Image customization:</strong></p>
<pre><code class="language-bash"># 1. Create custom layer
bitbake-layers create-layer meta-custom
bitbake-layers add-layer meta-custom

# 2. Create image recipe
mkdir -p meta-custom/recipes-core/images
cat &gt; meta-custom/recipes-core/images/custom-image.bb &lt;&lt; 'EOF'
require recipes-core/images/core-image-minimal.bb
SUMMARY = "Custom image"
IMAGE_INSTALL += "myapp python3"
IMAGE_FEATURES += "ssh-server-openssh"
EOF

# 3. Build image
bitbake custom-image

# 4. Test
runqemu custom-image
</code></pre>
<p><strong>BSP creation:</strong></p>
<pre><code class="language-bash"># 1. Create BSP layer
bitbake-layers create-layer meta-mybsp
cd meta-mybsp

# 2. Create machine config
mkdir -p conf/machine
cat &gt; conf/machine/mymachine.conf &lt;&lt; 'EOF'
#@TYPE: Machine
#@NAME: My Machine
DEFAULTTUNE = "cortexa72"
require conf/machine/include/arm/armv8a/tune-cortexa72.inc
PREFERRED_PROVIDER_virtual/kernel = "linux-yocto"
KERNEL_IMAGETYPE = "Image"
SERIAL_CONSOLES = "115200;ttyS0"
MACHINE_FEATURES = "serial usbhost"
IMAGE_FSTYPES = "ext4 wic"
EOF

# 3. Add layer and build
bitbake-layers add-layer meta-mybsp
MACHINE=mymachine bitbake core-image-minimal
</code></pre>
<p><strong>Debugging failed build:</strong></p>
<pre><code class="language-bash"># 1. Check error
bitbake myapp

# 2. View log
cat tmp/work/.../temp/log.do_compile

# 3. Development shell
bitbake myapp -c devshell
# Try manual build...

# 4. Force rebuild
bitbake myapp -c compile -f

# 5. Check dependencies
bitbake -g myapp
grep myapp pn-depends.dot

# 6. Clean and rebuild
bitbake myapp -c cleansstate
bitbake myapp
</code></pre>
<h2 id="resources"><a class="header" href="#resources">Resources</a></h2>
<p><strong>Official Documentation:</strong></p>
<ul>
<li>Yocto Project: https://www.yoctoproject.org/</li>
<li>Documentation: https://docs.yoctoproject.org/</li>
<li>Reference Manual: https://docs.yoctoproject.org/ref-manual/</li>
<li>Developer Manual: https://docs.yoctoproject.org/dev-manual/</li>
<li>BitBake Manual: https://docs.yoctoproject.org/bitbake/</li>
</ul>
<p><strong>Layer Index:</strong></p>
<ul>
<li>OpenEmbedded Layer Index: https://layers.openembedded.org/</li>
<li>Find existing layers and recipes</li>
</ul>
<p><strong>Mailing Lists:</strong></p>
<ul>
<li>yocto@lists.yoctoproject.org</li>
<li>openembedded-core@lists.openembedded.org</li>
</ul>
<p><strong>IRC Channels:</strong></p>
<ul>
<li>#yocto on libera.chat</li>
<li>#openembedded on libera.chat</li>
</ul>
<p><strong>Source Code:</strong></p>
<ul>
<li>Poky: https://git.yoctoproject.org/poky/</li>
<li>OpenEmbedded-Core: https://git.openembedded.org/openembedded-core/</li>
<li>BitBake: https://git.openembedded.org/bitbake/</li>
</ul>
<p><strong>Training and Books:</strong></p>
<ul>
<li>Embedded Linux Development using Yocto Project</li>
<li>Linux Foundation training courses</li>
<li>Free Software Foundation training</li>
</ul>
<p><strong>Related Documentation in This Repository:</strong></p>
<ul>
<li>See <a href="cross_compilation.html">Cross Compilation</a> for basic Yocto workflow</li>
<li>See <a href="device_tree.html">Device Tree</a> for device tree integration</li>
<li>See <a href="driver_development.html">Driver Development</a> for kernel module recipes</li>
<li>See <a href="kernel.html">Kernel</a> for kernel concepts</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../linux/openwrt.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../android/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../linux/openwrt.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../android/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-c2a407aa.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>

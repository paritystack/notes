<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Wireguard - My Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-ae938929.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex-56f85b31.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-a4fa5267.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">My Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="wireguard"><a class="header" href="#wireguard">WireGuard</a></h1>
<p>WireGuard is a modern, high-performance VPN protocol that aims to be faster, simpler, and more secure than traditional VPN solutions like IPsec and OpenVPN. It has been integrated into the Linux kernel since version 5.6.</p>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>WireGuard uses state-of-the-art cryptography and is designed with simplicity in mind, consisting of only about 4,000 lines of code compared to hundreds of thousands in older VPN implementations.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li><strong>Performance</strong>: Significantly faster than IPsec and OpenVPN</li>
<li><strong>Security</strong>: Modern cryptography with no configuration options (secure by default)</li>
<li><strong>Simplicity</strong>: Minimal attack surface and easy to audit</li>
<li><strong>Cross-Platform</strong>: Available on Linux, Windows, macOS, BSD, iOS, and Android</li>
<li><strong>Kernel Integration</strong>: Part of Linux kernel (5.6+)</li>
<li><strong>Stealth</strong>: Silent to port scanners when not actively communicating</li>
<li><strong>Roaming</strong>: Seamless IP address changes and network transitions</li>
</ul>
<h2 id="cryptography"><a class="header" href="#cryptography">Cryptography</a></h2>
<p>WireGuard uses a fixed set of modern cryptographic primitives:</p>
<ul>
<li><strong>ChaCha20</strong>: Symmetric encryption</li>
<li><strong>Poly1305</strong>: Message authentication</li>
<li><strong>Curve25519</strong>: Elliptic-curve Diffie-Hellman (ECDH)</li>
<li><strong>BLAKE2s</strong>: Cryptographic hash function</li>
<li><strong>SipHash24</strong>: Hash table keys</li>
<li><strong>HKDF</strong>: Key derivation</li>
</ul>
<p>This approach eliminates cryptographic agility vulnerabilities and ensures consistent security.</p>
<h2 id="protocol-architecture"><a class="header" href="#protocol-architecture">Protocol Architecture</a></h2>
<h3 id="noise-protocol-framework"><a class="header" href="#noise-protocol-framework">Noise Protocol Framework</a></h3>
<p>WireGuard implements the Noise_IK handshake pattern from the Noise Protocol Framework:</p>
<ul>
<li><strong>I</strong>: Initiator provides static public key</li>
<li><strong>K</strong>: Responder’s static public key is known beforehand</li>
</ul>
<p>This provides mutual authentication, forward secrecy, and identity hiding.</p>
<h3 id="handshake-process"><a class="header" href="#handshake-process">Handshake Process</a></h3>
<p>The handshake establishes a secure session between peers:</p>
<pre><code>Initiator                                Responder
   |                                         |
   |  (1) Initiation Message                 |
   |  - Initiator's ephemeral public key     |
   |  - Encrypted static public key          |
   |  - Encrypted timestamp                  |
   | --------------------------------------&gt; |
   |                                         |
   |  (2) Response Message                   |
   |  - Responder's ephemeral public key     |
   |  - Encrypted "empty" payload            |
   | &lt;-------------------------------------- |
   |                                         |
   |  (3) Data Packets                       |
   |  - Encrypted with derived keys          |
   | &lt;-------------------------------------&gt; |
</code></pre>
<p><strong>Handshake Details:</strong></p>
<ol>
<li>
<p><strong>Initiation (148 bytes)</strong>:</p>
<ul>
<li>Sender index (4 bytes)</li>
<li>Unencrypted ephemeral key (32 bytes)</li>
<li>Encrypted static key (32 + 16 bytes)</li>
<li>Encrypted timestamp (12 + 16 bytes)</li>
<li>MAC1 and MAC2 (16 + 16 bytes)</li>
</ul>
</li>
<li>
<p><strong>Response (92 bytes)</strong>:</p>
<ul>
<li>Sender index (4 bytes)</li>
<li>Receiver index (4 bytes)</li>
<li>Unencrypted ephemeral key (32 bytes)</li>
<li>Encrypted empty (16 bytes)</li>
<li>MAC1 and MAC2 (16 + 16 bytes)</li>
</ul>
</li>
</ol>
<h3 id="timer-state-machine"><a class="header" href="#timer-state-machine">Timer State Machine</a></h3>
<p>WireGuard uses five timer states to manage connections:</p>
<ol>
<li><strong>REKEY_AFTER_TIME</strong> (120 seconds): Initiate new handshake</li>
<li><strong>REJECT_AFTER_TIME</strong> (180 seconds): Reject packets, must handshake</li>
<li><strong>REKEY_ATTEMPT_TIME</strong> (90 seconds): Retry handshake if no response</li>
<li><strong>REKEY_TIMEOUT</strong> (5 seconds): Exponential backoff for retries</li>
<li><strong>KEEPALIVE_TIMEOUT</strong> (10 seconds): Send keepalive if no traffic</li>
</ol>
<h3 id="key-rotation"><a class="header" href="#key-rotation">Key Rotation</a></h3>
<p>WireGuard automatically rotates keys to maintain forward secrecy:</p>
<pre><code>Time (seconds):    0        120       180
                   |         |         |
Key Pair 1:    [Active]--[Rekey]--[Reject]
                            |
Key Pair 2:              [Active]--[Rekey]--[Reject]
                                     |
Key Pair 3:                       [Active]--&gt;
</code></pre>
<ul>
<li>Keys are valid for 180 seconds</li>
<li>New handshake initiated at 120 seconds</li>
<li>After 180 seconds, old keys are rejected</li>
<li>Seamless transition with no connection interruption</li>
</ul>
<h3 id="packet-flow"><a class="header" href="#packet-flow">Packet Flow</a></h3>
<pre><code>┌─────────────────────────────────────────────────────────────┐
│                    Outgoing Packet Path                      │
└─────────────────────────────────────────────────────────────┘

Application Layer
       |
       v
Socket Buffer (SKB) Created
       |
       v
Routing Decision ─────&gt; Check AllowedIPs (Cryptokey Routing)
       |                        |
       v                        v
  Match Found?            Select Peer
       |                        |
       v                        v
  [WireGuard Interface]         |
       |                        |
       v                        |
  Valid Handshake? &lt;────────────┘
       |
       | Yes (use session keys)
       v
  Encrypt with ChaCha20-Poly1305
       |
       v
  Add WireGuard Header
  - Type (4 bytes)
  - Receiver index (4 bytes)
  - Counter (8 bytes)
  - Encrypted payload
  - Poly1305 tag (16 bytes)
       |
       v
  UDP Encapsulation (port 51820)
       |
       v
  Send via Physical Interface

┌─────────────────────────────────────────────────────────────┐
│                    Incoming Packet Path                      │
└─────────────────────────────────────────────────────────────┘

Physical Interface
       |
       v
UDP Packet Received (port 51820)
       |
       v
WireGuard Module
       |
       v
Packet Type Check
  ├─&gt; Handshake Initiation (Type 1)
  ├─&gt; Handshake Response (Type 2)
  ├─&gt; Cookie Reply (Type 3)
  └─&gt; Transport Data (Type 4)
       |
       v
  Lookup Receiver Index
       |
       v
  Verify Counter (anti-replay)
       |
       v
  Decrypt with ChaCha20-Poly1305
       |
       v
  Verify Poly1305 MAC
       |
       v
  Extract IP Packet
       |
       v
  Verify Source IP in AllowedIPs
       |
       v
  Forward to Network Stack
       |
       v
  Application Layer
</code></pre>
<h3 id="cryptokey-routing"><a class="header" href="#cryptokey-routing">Cryptokey Routing</a></h3>
<p>WireGuard’s unique routing mechanism based on public keys:</p>
<pre><code>Peer Configuration:
[Peer]
PublicKey = &lt;peer_key&gt;
AllowedIPs = 10.0.0.2/32, 192.168.1.0/24

Routing Logic:
1. Outgoing:
   Destination IP → Lookup in AllowedIPs → Select Peer → Encrypt

2. Incoming:
   Decrypt → Extract Source IP → Verify in Peer's AllowedIPs → Accept
</code></pre>
<p>This provides both routing and firewall functionality in one mechanism.</p>
<h2 id="kernel-implementation"><a class="header" href="#kernel-implementation">Kernel Implementation</a></h2>
<h3 id="data-structures"><a class="header" href="#data-structures">Data Structures</a></h3>
<p>Key kernel data structures in WireGuard:</p>
<pre><code class="language-c">// Main device structure
struct wg_device {
    struct net_device *dev;
    struct list_head peer_list;
    struct mutex device_update_lock;
    struct sk_buff_head incoming_handshakes;
    // ... encryption keys, timers, etc.
};

// Peer structure
struct wg_peer {
    struct wg_device *device;
    struct endpoint endpoint;
    struct wireguard_peer *next;
    u8 public_key[NOISE_PUBLIC_KEY_LEN];
    // ... session keys, timers, allowedips, etc.
};

// Session keys
struct noise_keypair {
    u8 sending_key[CHACHA20POLY1305_KEY_SIZE];
    u8 receiving_key[CHACHA20POLY1305_KEY_SIZE];
    u64 sending_counter;
    u64 receiving_counter;
    // ... timestamps, validity
};
</code></pre>
<h3 id="netlink-interface"><a class="header" href="#netlink-interface">Netlink Interface</a></h3>
<p>WireGuard uses Generic Netlink for userspace communication:</p>
<pre><code class="language-c">// Communication between wg-quick/wg and kernel module
Userspace (wg tool)
        |
        | Netlink messages
        v
    WG_CMD_GET_DEVICE
    WG_CMD_SET_DEVICE
        |
        v
Kernel Module (wireguard.ko)
        |
        v
    Process configuration
    Update peer lists
    Set keys and endpoints
</code></pre>
<p><strong>Netlink Commands:</strong></p>
<ul>
<li><code>WG_CMD_GET_DEVICE</code>: Retrieve interface configuration</li>
<li><code>WG_CMD_SET_DEVICE</code>: Update interface configuration</li>
</ul>
<h3 id="network-stack-integration"><a class="header" href="#network-stack-integration">Network Stack Integration</a></h3>
<p>WireGuard integrates as a network device:</p>
<pre><code>┌───────────────────────────────────────────────┐
│        Linux Network Stack                     │
│                                                │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐    │
│  │   eth0   │  │   wlan0  │  │   wg0    │    │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘    │
│       │             │              │          │
│       └─────────────┴──────────────┘          │
│                     │                         │
│              ┌──────▼──────┐                  │
│              │   Routing   │                  │
│              │   Decision  │                  │
│              └──────┬──────┘                  │
│                     │                         │
│              ┌──────▼──────┐                  │
│              │  iptables/  │                  │
│              │  netfilter  │                  │
│              └──────┬──────┘                  │
│                     │                         │
│              ┌──────▼──────┐                  │
│              │Application  │                  │
│              └─────────────┘                  │
└───────────────────────────────────────────────┘

WireGuard Operations:
- net_device_ops for interface operations
- Hard header length for encapsulation
- MTU handling for overhead
- Queueing discipline integration
</code></pre>
<h3 id="performance-optimizations"><a class="header" href="#performance-optimizations">Performance Optimizations</a></h3>
<p>Kernel-level optimizations in WireGuard:</p>
<ol>
<li><strong>SIMD Acceleration</strong>: Uses CPU SIMD instructions for ChaCha20</li>
<li><strong>Parallel Processing</strong>: Multi-core capable for encryption/decryption</li>
<li><strong>Zero-Copy</strong>: Minimizes memory copies in data path</li>
<li><strong>Lockless Operations</strong>: Lock-free data structures where possible</li>
<li><strong>Batch Processing</strong>: Handles multiple packets efficiently</li>
</ol>
<h2 id="installation"><a class="header" href="#installation">Installation</a></h2>
<h3 id="kernel-module-linux-56"><a class="header" href="#kernel-module-linux-56">Kernel Module (Linux 5.6+)</a></h3>
<p>On modern kernels, WireGuard is built-in:</p>
<pre><code class="language-bash"># Check if WireGuard is available
sudo modinfo wireguard

# Load the module if needed
sudo modprobe wireguard

# Verify module is loaded
lsmod | grep wireguard
</code></pre>
<h3 id="user-space-tools"><a class="header" href="#user-space-tools">User-Space Tools</a></h3>
<p>Install the WireGuard tools:</p>
<pre><code class="language-bash"># Ubuntu/Debian
sudo apt update
sudo apt install wireguard wireguard-tools

# Fedora/RHEL/CentOS
sudo dnf install wireguard-tools

# Arch Linux
sudo pacman -S wireguard-tools

# Verify installation
wg --version
</code></pre>
<h2 id="key-concepts"><a class="header" href="#key-concepts">Key Concepts</a></h2>
<h3 id="interface"><a class="header" href="#interface">Interface</a></h3>
<p>WireGuard interfaces are network interfaces like any other (e.g., eth0, wlan0):</p>
<pre><code class="language-bash"># Create a WireGuard interface
sudo ip link add dev wg0 type wireguard

# Delete a WireGuard interface
sudo ip link delete dev wg0
</code></pre>
<h3 id="publicprivate-keys"><a class="header" href="#publicprivate-keys">Public/Private Keys</a></h3>
<p>WireGuard uses public-key cryptography for authentication:</p>
<pre><code class="language-bash"># Generate private key
wg genkey &gt; privatekey

# Generate public key from private key
wg pubkey &lt; privatekey &gt; publickey

# Generate both keys
umask 077
wg genkey | tee privatekey | wg pubkey &gt; publickey

# Generate pre-shared key (optional, for additional security)
wg genpsk &gt; presharedkey
</code></pre>
<p><strong>Security Note</strong>: Private keys should never be shared and must be protected with proper file permissions (600).</p>
<h3 id="peers"><a class="header" href="#peers">Peers</a></h3>
<p>Each WireGuard interface has a list of peers it can communicate with. Each peer is identified by their public key.</p>
<h3 id="allowed-ips"><a class="header" href="#allowed-ips">Allowed IPs</a></h3>
<p>The “allowed IPs” setting determines:</p>
<ol>
<li>Which source IPs can be received from a peer (incoming traffic filtering)</li>
<li>Which destination IPs are routed to a peer (outgoing routing)</li>
</ol>
<p>This dual purpose is a key WireGuard concept called “Cryptokey Routing”.</p>
<h2 id="configuration"><a class="header" href="#configuration">Configuration</a></h2>
<h3 id="configuration-file-format"><a class="header" href="#configuration-file-format">Configuration File Format</a></h3>
<p>WireGuard configuration files are typically stored in <code>/etc/wireguard/</code>:</p>
<pre><code class="language-ini"># /etc/wireguard/wg0.conf
[Interface]
# Interface settings
PrivateKey = &lt;interface_private_key&gt;
Address = 10.0.0.1/24
ListenPort = 51820
# Optional settings
#PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
#PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE
#DNS = 1.1.1.1, 8.8.8.8
#MTU = 1420

[Peer]
# Peer configuration
PublicKey = &lt;peer_public_key&gt;
# Optional pre-shared key for quantum resistance
#PresharedKey = &lt;pre_shared_key&gt;
# Which IPs this peer can use as source/destination
AllowedIPs = 10.0.0.2/32
# Peer's external endpoint
Endpoint = peer.example.com:51820
# Keep connection alive (useful for NAT traversal)
PersistentKeepalive = 25
</code></pre>
<h3 id="interface-configuration-options"><a class="header" href="#interface-configuration-options">Interface Configuration Options</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Option</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>PrivateKey</code></td><td>Interface’s private key (required)</td></tr>
<tr><td><code>ListenPort</code></td><td>UDP port to listen on (default: random)</td></tr>
<tr><td><code>Address</code></td><td>IP address(es) assigned to interface</td></tr>
<tr><td><code>DNS</code></td><td>DNS servers for the interface</td></tr>
<tr><td><code>MTU</code></td><td>Maximum transmission unit size</td></tr>
<tr><td><code>Table</code></td><td>Routing table to use (auto, off, or number)</td></tr>
<tr><td><code>PreUp</code></td><td>Command to run before bringing interface up</td></tr>
<tr><td><code>PostUp</code></td><td>Command to run after bringing interface up</td></tr>
<tr><td><code>PreDown</code></td><td>Command to run before bringing interface down</td></tr>
<tr><td><code>PostDown</code></td><td>Command to run after bringing interface down</td></tr>
</tbody>
</table>
</div>
<h3 id="peer-configuration-options"><a class="header" href="#peer-configuration-options">Peer Configuration Options</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Option</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>PublicKey</code></td><td>Peer’s public key (required)</td></tr>
<tr><td><code>PresharedKey</code></td><td>Pre-shared key for additional security</td></tr>
<tr><td><code>AllowedIPs</code></td><td>CIDR ranges for cryptokey routing</td></tr>
<tr><td><code>Endpoint</code></td><td>Peer’s external IP/hostname and port</td></tr>
<tr><td><code>PersistentKeepalive</code></td><td>Interval in seconds for keepalive packets</td></tr>
</tbody>
</table>
</div>
<h2 id="basic-setup-examples"><a class="header" href="#basic-setup-examples">Basic Setup Examples</a></h2>
<h3 id="point-to-point-vpn"><a class="header" href="#point-to-point-vpn">Point-to-Point VPN</a></h3>
<p><strong>Server Configuration</strong> (<code>/etc/wireguard/wg0.conf</code>):</p>
<pre><code class="language-ini">[Interface]
PrivateKey = &lt;server_private_key&gt;
Address = 10.0.0.1/24
ListenPort = 51820

[Peer]
PublicKey = &lt;client_public_key&gt;
AllowedIPs = 10.0.0.2/32
</code></pre>
<p><strong>Client Configuration</strong> (<code>/etc/wireguard/wg0.conf</code>):</p>
<pre><code class="language-ini">[Interface]
PrivateKey = &lt;client_private_key&gt;
Address = 10.0.0.2/24

[Peer]
PublicKey = &lt;server_public_key&gt;
AllowedIPs = 10.0.0.0/24
Endpoint = server.example.com:51820
PersistentKeepalive = 25
</code></pre>
<h3 id="vpn-gateway-route-all-traffic"><a class="header" href="#vpn-gateway-route-all-traffic">VPN Gateway (Route All Traffic)</a></h3>
<p><strong>Server Configuration</strong> (<code>/etc/wireguard/wg0.conf</code>):</p>
<pre><code class="language-ini">[Interface]
PrivateKey = &lt;server_private_key&gt;
Address = 10.0.0.1/24
ListenPort = 51820
PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE

[Peer]
PublicKey = &lt;client_public_key&gt;
AllowedIPs = 10.0.0.2/32
</code></pre>
<p><strong>Client Configuration</strong> (<code>/etc/wireguard/wg0.conf</code>):</p>
<pre><code class="language-ini">[Interface]
PrivateKey = &lt;client_private_key&gt;
Address = 10.0.0.2/24
DNS = 1.1.1.1

[Peer]
PublicKey = &lt;server_public_key&gt;
# Route all traffic through VPN
AllowedIPs = 0.0.0.0/0
Endpoint = server.example.com:51820
PersistentKeepalive = 25
</code></pre>
<p><strong>Server System Configuration</strong>:</p>
<pre><code class="language-bash"># Enable IP forwarding
sudo sysctl -w net.ipv4.ip_forward=1
sudo sysctl -w net.ipv6.conf.all.forwarding=1

# Make permanent
echo "net.ipv4.ip_forward=1" | sudo tee -a /etc/sysctl.conf
echo "net.ipv6.conf.all.forwarding=1" | sudo tee -a /etc/sysctl.conf
</code></pre>
<h3 id="site-to-site-vpn"><a class="header" href="#site-to-site-vpn">Site-to-Site VPN</a></h3>
<p><strong>Site A Configuration</strong>:</p>
<pre><code class="language-ini">[Interface]
PrivateKey = &lt;site_a_private_key&gt;
Address = 10.0.0.1/24
ListenPort = 51820
PostUp = iptables -A FORWARD -i %i -j ACCEPT
PostDown = iptables -D FORWARD -i %i -j ACCEPT

[Peer]
PublicKey = &lt;site_b_public_key&gt;
# Allow traffic to Site B's local network
AllowedIPs = 192.168.2.0/24, 10.0.0.2/32
Endpoint = site-b.example.com:51820
PersistentKeepalive = 25
</code></pre>
<p><strong>Site B Configuration</strong>:</p>
<pre><code class="language-ini">[Interface]
PrivateKey = &lt;site_b_private_key&gt;
Address = 10.0.0.2/24
ListenPort = 51820
PostUp = iptables -A FORWARD -i %i -j ACCEPT
PostDown = iptables -D FORWARD -i %i -j ACCEPT

[Peer]
PublicKey = &lt;site_a_public_key&gt;
# Allow traffic to Site A's local network
AllowedIPs = 192.168.1.0/24, 10.0.0.1/32
Endpoint = site-a.example.com:51820
PersistentKeepalive = 25
</code></pre>
<h2 id="managing-wireguard"><a class="header" href="#managing-wireguard">Managing WireGuard</a></h2>
<h3 id="using-wg-quick"><a class="header" href="#using-wg-quick">Using wg-quick</a></h3>
<p>The <code>wg-quick</code> utility simplifies interface management:</p>
<pre><code class="language-bash"># Start VPN interface
sudo wg-quick up wg0

# Stop VPN interface
sudo wg-quick down wg0

# Restart VPN interface
sudo wg-quick down wg0 &amp;&amp; sudo wg-quick up wg0
</code></pre>
<h3 id="using-systemd"><a class="header" href="#using-systemd">Using systemd</a></h3>
<p>Enable WireGuard to start on boot:</p>
<pre><code class="language-bash"># Enable and start
sudo systemctl enable wg-quick@wg0.service
sudo systemctl start wg-quick@wg0.service

# Check status
sudo systemctl status wg-quick@wg0.service

# Stop and disable
sudo systemctl stop wg-quick@wg0.service
sudo systemctl disable wg-quick@wg0.service

# Restart
sudo systemctl restart wg-quick@wg0.service
</code></pre>
<h3 id="manual-configuration"><a class="header" href="#manual-configuration">Manual Configuration</a></h3>
<p>Configure WireGuard interfaces manually using <code>wg</code> and <code>ip</code> commands:</p>
<pre><code class="language-bash"># Create interface
sudo ip link add dev wg0 type wireguard

# Configure interface
sudo wg setconf wg0 /etc/wireguard/wg0.conf
# Or configure directly
sudo wg set wg0 private-key /etc/wireguard/privatekey listen-port 51820

# Assign IP address
sudo ip address add dev wg0 10.0.0.1/24

# Bring interface up
sudo ip link set up dev wg0

# Show configuration
sudo wg show wg0
</code></pre>
<h3 id="addingremoving-peers-dynamically"><a class="header" href="#addingremoving-peers-dynamically">Adding/Removing Peers Dynamically</a></h3>
<pre><code class="language-bash"># Add a peer
sudo wg set wg0 peer &lt;peer_public_key&gt; \
  allowed-ips 10.0.0.3/32 \
  endpoint peer.example.com:51820 \
  persistent-keepalive 25

# Remove a peer
sudo wg set wg0 peer &lt;peer_public_key&gt; remove

# Update peer's allowed IPs
sudo wg set wg0 peer &lt;peer_public_key&gt; \
  allowed-ips 10.0.0.3/32,10.0.1.0/24
</code></pre>
<h2 id="monitoring-and-troubleshooting"><a class="header" href="#monitoring-and-troubleshooting">Monitoring and Troubleshooting</a></h2>
<h3 id="show-interface-status"><a class="header" href="#show-interface-status">Show Interface Status</a></h3>
<pre><code class="language-bash"># Show all WireGuard interfaces
sudo wg show

# Show specific interface
sudo wg show wg0

# Show in different formats
sudo wg show wg0 dump        # Machine-readable format
sudo wg show wg0 endpoints   # Show peer endpoints
sudo wg show wg0 allowed-ips # Show allowed IPs
sudo wg show wg0 latest-handshakes  # Show handshake times
sudo wg show wg0 transfer    # Show data transfer
sudo wg show wg0 persistent-keepalive  # Show keepalive settings
</code></pre>
<h3 id="detailed-status-output"><a class="header" href="#detailed-status-output">Detailed Status Output</a></h3>
<pre><code class="language-bash"># View detailed interface information
sudo wg show wg0

# Example output:
# interface: wg0
#   public key: &lt;public_key&gt;
#   private key: (hidden)
#   listening port: 51820
#
# peer: &lt;peer_public_key&gt;
#   endpoint: 203.0.113.1:51820
#   allowed ips: 10.0.0.2/32
#   latest handshake: 1 minute, 23 seconds ago
#   transfer: 15.23 MiB received, 8.92 MiB sent
#   persistent keepalive: every 25 seconds
</code></pre>
<h3 id="check-connectivity"><a class="header" href="#check-connectivity">Check Connectivity</a></h3>
<pre><code class="language-bash"># Ping peer through tunnel
ping 10.0.0.2

# Trace route through tunnel
traceroute 10.0.0.2

# Check if handshake is happening
sudo wg show wg0 latest-handshakes

# Monitor interface statistics
sudo ip -s link show wg0

# Check for errors
sudo dmesg | grep wireguard
sudo journalctl -u wg-quick@wg0
</code></pre>
<h3 id="common-issues-and-solutions"><a class="header" href="#common-issues-and-solutions">Common Issues and Solutions</a></h3>
<p><strong>1. No handshake occurring:</strong></p>
<pre><code class="language-bash"># Check if WireGuard is running
sudo wg show

# Verify endpoint is reachable
ping -c 4 server.example.com
nc -u -v server.example.com 51820

# Check firewall rules
sudo iptables -L -n | grep 51820
sudo ufw status
</code></pre>
<p><strong>2. Handshake successful but no traffic:</strong></p>
<pre><code class="language-bash"># Verify IP forwarding (on server)
sudo sysctl net.ipv4.ip_forward
sudo sysctl net.ipv6.conf.all.forwarding

# Check routing
ip route get 10.0.0.2
ip route show table all

# Verify iptables rules
sudo iptables -L FORWARD -n -v
sudo iptables -t nat -L POSTROUTING -n -v
</code></pre>
<p><strong>3. MTU issues (packet loss/slow performance):</strong></p>
<pre><code class="language-bash"># Test MTU
ping -M do -s 1400 10.0.0.2

# Adjust MTU in configuration
# Add to [Interface] section:
# MTU = 1420

# Or manually:
sudo ip link set mtu 1420 dev wg0
</code></pre>
<p><strong>4. Connection drops after network change:</strong></p>
<pre><code class="language-bash"># Ensure PersistentKeepalive is set (client side)
# Add to [Peer] section:
# PersistentKeepalive = 25

# Force handshake
sudo wg set wg0 peer &lt;peer_public_key&gt; endpoint new.example.com:51820
</code></pre>
<h2 id="advanced-configurations"><a class="header" href="#advanced-configurations">Advanced Configurations</a></h2>
<h3 id="multiple-peers-road-warrior-setup"><a class="header" href="#multiple-peers-road-warrior-setup">Multiple Peers (Road Warrior Setup)</a></h3>
<p>Server configuration for multiple clients:</p>
<pre><code class="language-ini">[Interface]
PrivateKey = &lt;server_private_key&gt;
Address = 10.0.0.1/24
ListenPort = 51820
PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE

# Client 1
[Peer]
PublicKey = &lt;client1_public_key&gt;
AllowedIPs = 10.0.0.2/32

# Client 2
[Peer]
PublicKey = &lt;client2_public_key&gt;
AllowedIPs = 10.0.0.3/32

# Client 3
[Peer]
PublicKey = &lt;client3_public_key&gt;
AllowedIPs = 10.0.0.4/32
</code></pre>
<h3 id="dynamic-ip-assignment-script"><a class="header" href="#dynamic-ip-assignment-script">Dynamic IP Assignment Script</a></h3>
<p>For larger deployments, automate client IP assignment:</p>
<pre><code class="language-bash">#!/bin/bash
# add-client.sh

CLIENT_NAME=$1
SERVER_PUBLIC_KEY="&lt;server_public_key&gt;"
SERVER_ENDPOINT="vpn.example.com:51820"
CONFIG_DIR="/etc/wireguard"
NETWORK="10.0.0"

# Find next available IP
NEXT_IP=$(wg show wg0 allowed-ips | \
  grep -oP "${NETWORK}\.\K\d+" | \
  sort -n | tail -1)
NEXT_IP=$((NEXT_IP + 1))

# Generate keys
umask 077
CLIENT_PRIVATE_KEY=$(wg genkey)
CLIENT_PUBLIC_KEY=$(echo "$CLIENT_PRIVATE_KEY" | wg pubkey)

# Add peer to server
wg set wg0 peer "$CLIENT_PUBLIC_KEY" \
  allowed-ips ${NETWORK}.${NEXT_IP}/32

# Generate client config
cat &gt; "${CONFIG_DIR}/${CLIENT_NAME}.conf" &lt;&lt;EOF
[Interface]
PrivateKey = ${CLIENT_PRIVATE_KEY}
Address = ${NETWORK}.${NEXT_IP}/24
DNS = 1.1.1.1

[Peer]
PublicKey = ${SERVER_PUBLIC_KEY}
AllowedIPs = 0.0.0.0/0
Endpoint = ${SERVER_ENDPOINT}
PersistentKeepalive = 25
EOF

echo "Client ${CLIENT_NAME} added with IP ${NETWORK}.${NEXT_IP}"
echo "Config: ${CONFIG_DIR}/${CLIENT_NAME}.conf"

# Save to server config
wg-quick save wg0
</code></pre>
<h3 id="split-tunneling"><a class="header" href="#split-tunneling">Split Tunneling</a></h3>
<p>Route only specific traffic through VPN:</p>
<pre><code class="language-ini">[Interface]
PrivateKey = &lt;client_private_key&gt;
Address = 10.0.0.2/24

[Peer]
PublicKey = &lt;server_public_key&gt;
# Only route specific networks through VPN
AllowedIPs = 10.0.0.0/24, 192.168.1.0/24
Endpoint = server.example.com:51820
PersistentKeepalive = 25
</code></pre>
<h3 id="ipv6-support"><a class="header" href="#ipv6-support">IPv6 Support</a></h3>
<p>Enable IPv6 in WireGuard:</p>
<pre><code class="language-ini">[Interface]
PrivateKey = &lt;private_key&gt;
Address = 10.0.0.1/24, fd00::1/64
ListenPort = 51820

[Peer]
PublicKey = &lt;peer_public_key&gt;
AllowedIPs = 10.0.0.2/32, fd00::2/128
Endpoint = peer.example.com:51820
</code></pre>
<h3 id="network-namespaces"><a class="header" href="#network-namespaces">Network Namespaces</a></h3>
<p>Isolate WireGuard in a network namespace:</p>
<pre><code class="language-bash"># Create namespace
sudo ip netns add wg_namespace

# Create WireGuard interface in namespace
sudo ip link add wg0 type wireguard
sudo ip link set wg0 netns wg_namespace

# Configure in namespace
sudo ip netns exec wg_namespace wg setconf wg0 /etc/wireguard/wg0.conf
sudo ip netns exec wg_namespace ip addr add 10.0.0.1/24 dev wg0
sudo ip netns exec wg_namespace ip link set wg0 up

# Run application in namespace
sudo ip netns exec wg_namespace sudo -u user firefox
</code></pre>
<h3 id="pre-shared-keys-for-quantum-resistance"><a class="header" href="#pre-shared-keys-for-quantum-resistance">Pre-shared Keys for Quantum Resistance</a></h3>
<p>Add pre-shared keys for post-quantum security:</p>
<pre><code class="language-bash"># Generate pre-shared key
wg genpsk &gt; presharedkey

# Add to peer configuration
sudo wg set wg0 peer &lt;peer_public_key&gt; \
  preshared-key /etc/wireguard/presharedkey
</code></pre>
<p>Configuration file:</p>
<pre><code class="language-ini">[Peer]
PublicKey = &lt;peer_public_key&gt;
PresharedKey = &lt;pre_shared_key&gt;
AllowedIPs = 10.0.0.2/32
</code></pre>
<h3 id="high-availability-configurations"><a class="header" href="#high-availability-configurations">High Availability Configurations</a></h3>
<h4 id="active-passive-failover"><a class="header" href="#active-passive-failover">Active-Passive Failover</a></h4>
<p>Primary and backup servers with automatic failover:</p>
<p><strong>Primary Server</strong> (<code>/etc/wireguard/wg0.conf</code>):</p>
<pre><code class="language-ini">[Interface]
PrivateKey = &lt;primary_private_key&gt;
Address = 10.0.0.1/24
ListenPort = 51820
PostUp = ip route add 192.168.1.0/24 dev wg0

[Peer]
PublicKey = &lt;client_public_key&gt;
AllowedIPs = 10.0.0.2/32
</code></pre>
<p><strong>Backup Server</strong> (<code>/etc/wireguard/wg0.conf</code>):</p>
<pre><code class="language-ini">[Interface]
PrivateKey = &lt;backup_private_key&gt;  # Same or different key
Address = 10.0.0.1/24               # Same VPN IP
ListenPort = 51820
PostUp = ip route add 192.168.1.0/24 dev wg0

[Peer]
PublicKey = &lt;client_public_key&gt;
AllowedIPs = 10.0.0.2/32
</code></pre>
<p><strong>Client Configuration with Failover</strong>:</p>
<pre><code class="language-ini">[Interface]
PrivateKey = &lt;client_private_key&gt;
Address = 10.0.0.2/24

# Primary peer
[Peer]
PublicKey = &lt;primary_public_key&gt;
AllowedIPs = 0.0.0.0/0
Endpoint = primary.example.com:51820
PersistentKeepalive = 25

# Backup peer (activate manually or via script)
#[Peer]
#PublicKey = &lt;backup_public_key&gt;
#AllowedIPs = 0.0.0.0/0
#Endpoint = backup.example.com:51820
#PersistentKeepalive = 25
</code></pre>
<p><strong>Failover Script</strong> (<code>/usr/local/bin/wg-failover.sh</code>):</p>
<pre><code class="language-bash">#!/bin/bash

PRIMARY_ENDPOINT="primary.example.com:51820"
BACKUP_ENDPOINT="backup.example.com:51820"
PRIMARY_KEY="&lt;primary_public_key&gt;"
BACKUP_KEY="&lt;backup_public_key&gt;"
INTERFACE="wg0"
CHECK_INTERVAL=10

check_connection() {
    # Check if last handshake was recent (within 3 minutes)
    last_handshake=$(sudo wg show "$INTERFACE" latest-handshakes | \
        grep "$1" | awk '{print $2}')
    current_time=$(date +%s)

    if [ -z "$last_handshake" ]; then
        return 1
    fi

    time_diff=$((current_time - last_handshake))
    [ "$time_diff" -lt 180 ]
}

while true; do
    if ! check_connection "$PRIMARY_KEY"; then
        echo "Primary connection failed, switching to backup"
        sudo wg set "$INTERFACE" peer "$PRIMARY_KEY" remove
        sudo wg set "$INTERFACE" peer "$BACKUP_KEY" \
            endpoint "$BACKUP_ENDPOINT" \
            allowed-ips 0.0.0.0/0 \
            persistent-keepalive 25
    elif check_connection "$BACKUP_KEY"; then
        echo "Primary restored, switching back"
        sudo wg set "$INTERFACE" peer "$BACKUP_KEY" remove
        sudo wg set "$INTERFACE" peer "$PRIMARY_KEY" \
            endpoint "$PRIMARY_ENDPOINT" \
            allowed-ips 0.0.0.0/0 \
            persistent-keepalive 25
    fi
    sleep "$CHECK_INTERVAL"
done
</code></pre>
<p>Run as systemd service:</p>
<pre><code class="language-ini"># /etc/systemd/system/wg-failover.service
[Unit]
Description=WireGuard Failover Service
After=wg-quick@wg0.service
Requires=wg-quick@wg0.service

[Service]
Type=simple
ExecStart=/usr/local/bin/wg-failover.sh
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
</code></pre>
<h4 id="load-balancing-with-multiple-peers"><a class="header" href="#load-balancing-with-multiple-peers">Load Balancing with Multiple Peers</a></h4>
<p>Distribute traffic across multiple WireGuard servers:</p>
<p><strong>Client Configuration</strong>:</p>
<pre><code class="language-ini">[Interface]
PrivateKey = &lt;client_private_key&gt;
Address = 10.0.0.10/24
Table = off  # Disable automatic routing
PostUp = ip route add 10.0.1.0/24 via 10.0.0.1 dev wg0
PostUp = ip route add 10.0.2.0/24 via 10.0.0.2 dev wg0

# Server 1 - for network 10.0.1.0/24
[Peer]
PublicKey = &lt;server1_public_key&gt;
AllowedIPs = 10.0.0.1/32, 10.0.1.0/24
Endpoint = server1.example.com:51820
PersistentKeepalive = 25

# Server 2 - for network 10.0.2.0/24
[Peer]
PublicKey = &lt;server2_public_key&gt;
AllowedIPs = 10.0.0.2/32, 10.0.2.0/24
Endpoint = server2.example.com:51820
PersistentKeepalive = 25
</code></pre>
<h3 id="multi-hop-and-complex-topologies"><a class="header" href="#multi-hop-and-complex-topologies">Multi-Hop and Complex Topologies</a></h3>
<h4 id="multi-hop-vpn-cascading"><a class="header" href="#multi-hop-vpn-cascading">Multi-Hop VPN (Cascading)</a></h4>
<p>Route traffic through multiple WireGuard servers:</p>
<pre><code>Client → Server A → Server B → Internet
</code></pre>
<p><strong>Server A Configuration</strong>:</p>
<pre><code class="language-ini">[Interface]
PrivateKey = &lt;server_a_private_key&gt;
Address = 10.0.0.1/24
ListenPort = 51820
PostUp = iptables -A FORWARD -i wg0 -j ACCEPT
PostUp = iptables -t nat -A POSTROUTING -o wg1 -j MASQUERADE
PostDown = iptables -D FORWARD -i wg0 -j ACCEPT
PostDown = iptables -t nat -D POSTROUTING -o wg1 -j MASQUERADE

[Peer]
PublicKey = &lt;client_public_key&gt;
AllowedIPs = 10.0.0.2/32

# Second interface for connection to Server B
# /etc/wireguard/wg1.conf
[Interface]
PrivateKey = &lt;server_a_wg1_private_key&gt;
Address = 10.0.1.1/24

[Peer]
PublicKey = &lt;server_b_public_key&gt;
AllowedIPs = 0.0.0.0/0
Endpoint = server-b.example.com:51820
PersistentKeepalive = 25
</code></pre>
<p><strong>Client Configuration</strong>:</p>
<pre><code class="language-ini">[Interface]
PrivateKey = &lt;client_private_key&gt;
Address = 10.0.0.2/24
DNS = 1.1.1.1

[Peer]
PublicKey = &lt;server_a_public_key&gt;
AllowedIPs = 0.0.0.0/0
Endpoint = server-a.example.com:51820
PersistentKeepalive = 25
</code></pre>
<h4 id="hub-and-spoke-network"><a class="header" href="#hub-and-spoke-network">Hub-and-Spoke Network</a></h4>
<p>Central hub with multiple spoke sites:</p>
<pre><code>        Spoke 1 (192.168.1.0/24)
              |
              |
         [Hub Server]
         (10.0.0.1)
         /         \
        /           \
  Spoke 2         Spoke 3
(192.168.2.0/24) (192.168.3.0/24)
</code></pre>
<p><strong>Hub Configuration</strong>:</p>
<pre><code class="language-ini">[Interface]
PrivateKey = &lt;hub_private_key&gt;
Address = 10.0.0.1/24
ListenPort = 51820
PostUp = sysctl -w net.ipv4.ip_forward=1

# Spoke 1
[Peer]
PublicKey = &lt;spoke1_public_key&gt;
AllowedIPs = 10.0.0.2/32, 192.168.1.0/24

# Spoke 2
[Peer]
PublicKey = &lt;spoke2_public_key&gt;
AllowedIPs = 10.0.0.3/32, 192.168.2.0/24

# Spoke 3
[Peer]
PublicKey = &lt;spoke3_public_key&gt;
AllowedIPs = 10.0.0.4/32, 192.168.3.0/24
</code></pre>
<p><strong>Spoke Configuration</strong> (example for Spoke 1):</p>
<pre><code class="language-ini">[Interface]
PrivateKey = &lt;spoke1_private_key&gt;
Address = 10.0.0.2/24
PostUp = ip route add 192.168.2.0/24 via 10.0.0.1 dev wg0
PostUp = ip route add 192.168.3.0/24 via 10.0.0.1 dev wg0

[Peer]
PublicKey = &lt;hub_public_key&gt;
AllowedIPs = 10.0.0.1/32, 192.168.2.0/24, 192.168.3.0/24
Endpoint = hub.example.com:51820
PersistentKeepalive = 25
</code></pre>
<h4 id="full-mesh-network"><a class="header" href="#full-mesh-network">Full Mesh Network</a></h4>
<p>Every node connects to every other node:</p>
<pre><code>     Node A ─────── Node B
       │  \       /  │
       │   \     /   │
       │    \   /    │
       │     \ /     │
       │      X      │
       │     / \     │
       │    /   \    │
       │   /     \   │
       │  /       \  │
     Node C ─────── Node D
</code></pre>
<p><strong>Node A Configuration</strong>:</p>
<pre><code class="language-ini">[Interface]
PrivateKey = &lt;node_a_private_key&gt;
Address = 10.0.0.1/24
ListenPort = 51820

[Peer]  # Node B
PublicKey = &lt;node_b_public_key&gt;
AllowedIPs = 10.0.0.2/32
Endpoint = node-b.example.com:51820
PersistentKeepalive = 25

[Peer]  # Node C
PublicKey = &lt;node_c_public_key&gt;
AllowedIPs = 10.0.0.3/32
Endpoint = node-c.example.com:51820
PersistentKeepalive = 25

[Peer]  # Node D
PublicKey = &lt;node_d_public_key&gt;
AllowedIPs = 10.0.0.4/32
Endpoint = node-d.example.com:51820
PersistentKeepalive = 25
</code></pre>
<h3 id="dns-configuration"><a class="header" href="#dns-configuration">DNS Configuration</a></h3>
<h4 id="split-dns-configuration"><a class="header" href="#split-dns-configuration">Split DNS Configuration</a></h4>
<p>Route DNS queries based on domain:</p>
<pre><code class="language-ini">[Interface]
PrivateKey = &lt;private_key&gt;
Address = 10.0.0.2/24
# Internal DNS for corporate domains
DNS = 10.0.0.53
PostUp = resolvconf -a %i -m 0 -x
PostUp = echo "search corporate.local" &gt;&gt; /etc/resolv.conf
PostUp = echo "nameserver 10.0.0.53" &gt;&gt; /etc/resolv.conf
PostDown = resolvconf -d %i

[Peer]
PublicKey = &lt;server_public_key&gt;
AllowedIPs = 10.0.0.0/24
Endpoint = vpn.example.com:51820
PersistentKeepalive = 25
</code></pre>
<h4 id="dns-over-https-through-tunnel"><a class="header" href="#dns-over-https-through-tunnel">DNS-Over-HTTPS Through Tunnel</a></h4>
<p><strong>Server-side DNS-over-HTTPS Setup</strong>:</p>
<pre><code class="language-bash"># Install cloudflared
wget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64
sudo mv cloudflared-linux-amd64 /usr/local/bin/cloudflared
sudo chmod +x /usr/local/bin/cloudflared

# Configure DNS proxy
sudo cloudflared proxy-dns --port 53 --upstream https://1.1.1.1/dns-query

# Add to WireGuard config
# DNS = 10.0.0.1  (server's WireGuard IP)
</code></pre>
<h4 id="internal-dns-server"><a class="header" href="#internal-dns-server">Internal DNS Server</a></h4>
<p>Set up a DNS server for the VPN network:</p>
<pre><code class="language-bash"># Install dnsmasq
sudo apt install dnsmasq

# Configure /etc/dnsmasq.conf
interface=wg0
bind-interfaces
listen-address=10.0.0.1
domain=vpn.local
expand-hosts

# DNS records
address=/server1.vpn.local/10.0.0.10
address=/server2.vpn.local/10.0.0.11

# Upstream DNS
server=1.1.1.1
server=8.8.8.8

# Enable and start
sudo systemctl enable dnsmasq
sudo systemctl restart dnsmasq
</code></pre>
<p><strong>Client Configuration</strong>:</p>
<pre><code class="language-ini">[Interface]
PrivateKey = &lt;client_private_key&gt;
Address = 10.0.0.2/24
DNS = 10.0.0.1
PostUp = echo "search vpn.local" &gt;&gt; /etc/resolv.conf

[Peer]
PublicKey = &lt;server_public_key&gt;
AllowedIPs = 10.0.0.0/24
Endpoint = vpn.example.com:51820
PersistentKeepalive = 25
</code></pre>
<h3 id="dynamic-dns-for-endpoints"><a class="header" href="#dynamic-dns-for-endpoints">Dynamic DNS for Endpoints</a></h3>
<p>Update WireGuard endpoints when server IP changes:</p>
<p><strong>DDNS Update Script</strong> (<code>/usr/local/bin/wg-ddns-update.sh</code>):</p>
<pre><code class="language-bash">#!/bin/bash

INTERFACE="wg0"
PEER_KEY="&lt;peer_public_key&gt;"
DDNS_HOSTNAME="dynamic.example.com"
PORT="51820"
CHECK_INTERVAL=300  # 5 minutes

get_current_ip() {
    dig +short "$DDNS_HOSTNAME" A | tail -n1
}

get_configured_endpoint() {
    sudo wg show "$INTERFACE" endpoints | grep "$PEER_KEY" | awk '{print $2}'
}

while true; do
    current_ip=$(get_current_ip)
    configured_endpoint=$(get_configured_endpoint)
    expected_endpoint="${current_ip}:${PORT}"

    if [ "$configured_endpoint" != "$expected_endpoint" ] &amp;&amp; [ -n "$current_ip" ]; then
        echo "Updating endpoint to $expected_endpoint"
        sudo wg set "$INTERFACE" peer "$PEER_KEY" endpoint "$expected_endpoint"
    fi

    sleep "$CHECK_INTERVAL"
done
</code></pre>
<h2 id="security-best-practices"><a class="header" href="#security-best-practices">Security Best Practices</a></h2>
<h3 id="key-management"><a class="header" href="#key-management">Key Management</a></h3>
<pre><code class="language-bash"># Secure private key permissions
sudo chmod 600 /etc/wireguard/privatekey
sudo chmod 600 /etc/wireguard/wg0.conf
sudo chown root:root /etc/wireguard/*

# Store keys securely
# - Never commit to version control
# - Use encrypted storage
# - Rotate keys periodically
</code></pre>
<h3 id="firewall-configuration"><a class="header" href="#firewall-configuration">Firewall Configuration</a></h3>
<pre><code class="language-bash"># Allow WireGuard traffic
sudo ufw allow 51820/udp

# Or with iptables
sudo iptables -A INPUT -p udp --dport 51820 -j ACCEPT

# Restrict to specific sources (more secure)
sudo ufw allow from 203.0.113.0/24 to any port 51820 proto udp
</code></pre>
<h3 id="harden-server-configuration"><a class="header" href="#harden-server-configuration">Harden Server Configuration</a></h3>
<pre><code class="language-bash"># Disable IP forwarding for other interfaces
sudo iptables -A FORWARD -i wg0 -j ACCEPT
sudo iptables -A FORWARD -o wg0 -j ACCEPT
sudo iptables -A FORWARD -j DROP

# Rate limit new connections
sudo iptables -A INPUT -p udp --dport 51820 \
  -m state --state NEW -m recent --set
sudo iptables -A INPUT -p udp --dport 51820 \
  -m state --state NEW -m recent --update --seconds 60 --hitcount 10 -j DROP
</code></pre>
<h3 id="monitoring-and-auditing"><a class="header" href="#monitoring-and-auditing">Monitoring and Auditing</a></h3>
<pre><code class="language-bash"># Log connections
sudo journalctl -u wg-quick@wg0 -f

# Monitor bandwidth
watch -n 1 'sudo wg show wg0 transfer'

# Track handshakes
watch -n 5 'sudo wg show wg0 latest-handshakes'

# Audit configuration
sudo wg show all
</code></pre>
<h2 id="monitoring-and-observability"><a class="header" href="#monitoring-and-observability">Monitoring and Observability</a></h2>
<h3 id="prometheus-metrics-exporter"><a class="header" href="#prometheus-metrics-exporter">Prometheus Metrics Exporter</a></h3>
<p>Monitor WireGuard with Prometheus using a custom exporter:</p>
<p><strong>Install wireguard_exporter</strong>:</p>
<pre><code class="language-bash"># Download and install
wget https://github.com/MindFlavor/prometheus_wireguard_exporter/releases/latest/download/prometheus_wireguard_exporter
sudo mv prometheus_wireguard_exporter /usr/local/bin/
sudo chmod +x /usr/local/bin/prometheus_wireguard_exporter

# Create systemd service
sudo tee /etc/systemd/system/prometheus-wireguard-exporter.service &lt;&lt;EOF
[Unit]
Description=Prometheus WireGuard Exporter
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/prometheus_wireguard_exporter -n /etc/wireguard/wg0.conf
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

# Enable and start
sudo systemctl daemon-reload
sudo systemctl enable prometheus-wireguard-exporter
sudo systemctl start prometheus-wireguard-exporter
</code></pre>
<p><strong>Prometheus Configuration</strong> (<code>prometheus.yml</code>):</p>
<pre><code class="language-yaml">scrape_configs:
  - job_name: 'wireguard'
    static_configs:
      - targets: ['localhost:9586']
        labels:
          instance: 'wg-server-01'
</code></pre>
<p><strong>Key Metrics Exposed</strong>:</p>
<ul>
<li><code>wireguard_sent_bytes_total</code>: Total bytes sent per peer</li>
<li><code>wireguard_received_bytes_total</code>: Total bytes received per peer</li>
<li><code>wireguard_latest_handshake_seconds</code>: Unix timestamp of last handshake</li>
<li><code>wireguard_peers</code>: Number of configured peers</li>
</ul>
<h3 id="grafana-dashboard"><a class="header" href="#grafana-dashboard">Grafana Dashboard</a></h3>
<p>Create a Grafana dashboard for WireGuard:</p>
<p><strong>Example Dashboard JSON</strong> (key panels):</p>
<pre><code class="language-json">{
  "dashboard": {
    "title": "WireGuard Monitoring",
    "panels": [
      {
        "title": "Active Connections",
        "targets": [{
          "expr": "count(time() - wireguard_latest_handshake_seconds &lt; 300)"
        }]
      },
      {
        "title": "Traffic per Peer",
        "targets": [{
          "expr": "rate(wireguard_sent_bytes_total[5m])"
        }, {
          "expr": "rate(wireguard_received_bytes_total[5m])"
        }]
      },
      {
        "title": "Handshake Freshness",
        "targets": [{
          "expr": "(time() - wireguard_latest_handshake_seconds) / 60"
        }]
      }
    ]
  }
}
</code></pre>
<h3 id="logging-configuration"><a class="header" href="#logging-configuration">Logging Configuration</a></h3>
<p><strong>Enhanced Logging with systemd</strong>:</p>
<pre><code class="language-bash"># Enable detailed logging
sudo mkdir -p /var/log/wireguard

# Create logging wrapper script
sudo tee /usr/local/bin/wg-quick-log &lt;&lt;'EOF'
#!/bin/bash
LOG_FILE="/var/log/wireguard/wg0.log"
ACTION=$1
INTERFACE=$2

{
    echo "$(date '+%Y-%m-%d %H:%M:%S') - Action: $ACTION, Interface: $INTERFACE"
    /usr/bin/wg-quick "$ACTION" "$INTERFACE" 2&gt;&amp;1
    echo "Exit code: $?"
} | tee -a "$LOG_FILE"
EOF

sudo chmod +x /usr/local/bin/wg-quick-log

# Modify systemd service to use wrapper
sudo systemctl edit wg-quick@wg0 --full
# Change ExecStart to: /usr/local/bin/wg-quick-log up %i
</code></pre>
<p><strong>Connection Logging Script</strong>:</p>
<pre><code class="language-bash">#!/bin/bash
# /usr/local/bin/wg-connection-logger.sh

INTERFACE="wg0"
LOG_FILE="/var/log/wireguard/connections.log"
CHECK_INTERVAL=60

declare -A last_handshakes

while true; do
    while IFS= read -r line; do
        peer_key=$(echo "$line" | awk '{print $1}')
        handshake_time=$(echo "$line" | awk '{print $2}')

        if [ "${last_handshakes[$peer_key]}" != "$handshake_time" ]; then
            echo "$(date '+%Y-%m-%d %H:%M:%S') - New handshake: $peer_key" &gt;&gt; "$LOG_FILE"
            last_handshakes[$peer_key]=$handshake_time
        fi
    done &lt; &lt;(sudo wg show "$INTERFACE" latest-handshakes)

    sleep "$CHECK_INTERVAL"
done
</code></pre>
<h3 id="alert-rules"><a class="header" href="#alert-rules">Alert Rules</a></h3>
<p><strong>Prometheus Alert Rules</strong>:</p>
<pre><code class="language-yaml"># /etc/prometheus/rules/wireguard.yml
groups:
  - name: wireguard
    interval: 30s
    rules:
      - alert: WireGuardPeerDown
        expr: (time() - wireguard_latest_handshake_seconds) &gt; 300
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "WireGuard peer {{ $labels.public_key }} is down"
          description: "No handshake in last 5 minutes"

      - alert: WireGuardHighLatency
        expr: wireguard_latest_handshake_seconds &gt; 180
        for: 10m
        labels:
          severity: info
        annotations:
          summary: "WireGuard peer {{ $labels.public_key }} high latency"

      - alert: WireGuardNoTraffic
        expr: rate(wireguard_received_bytes_total[5m]) == 0
        for: 15m
        labels:
          severity: info
        annotations:
          summary: "No traffic on peer {{ $labels.public_key }}"
</code></pre>
<h3 id="health-check-script"><a class="header" href="#health-check-script">Health Check Script</a></h3>
<pre><code class="language-bash">#!/bin/bash
# /usr/local/bin/wg-health-check.sh

INTERFACE="wg0"
MAX_HANDSHAKE_AGE=300  # 5 minutes
EXIT_CODE=0

echo "WireGuard Health Check - $(date)"
echo "======================================"

# Check if interface exists
if ! ip link show "$INTERFACE" &amp;&gt;/dev/null; then
    echo "❌ Interface $INTERFACE does not exist"
    exit 1
fi

# Check if interface is up
if ! ip link show "$INTERFACE" | grep -q "UP"; then
    echo "❌ Interface $INTERFACE is down"
    exit 1
fi

echo "✓ Interface $INTERFACE is up"

# Check peers
CURRENT_TIME=$(date +%s)
PEER_COUNT=0
HEALTHY_PEERS=0

while IFS= read -r line; do
    PEER_COUNT=$((PEER_COUNT + 1))
    peer_key=$(echo "$line" | awk '{print $1}')
    handshake_time=$(echo "$line" | awk '{print $2}')

    if [ -z "$handshake_time" ] || [ "$handshake_time" -eq 0 ]; then
        echo "⚠ Peer ${peer_key:0:16}... never completed handshake"
        EXIT_CODE=1
        continue
    fi

    age=$((CURRENT_TIME - handshake_time))

    if [ "$age" -gt "$MAX_HANDSHAKE_AGE" ]; then
        echo "⚠ Peer ${peer_key:0:16}... handshake too old (${age}s ago)"
        EXIT_CODE=1
    else
        echo "✓ Peer ${peer_key:0:16}... healthy (handshake ${age}s ago)"
        HEALTHY_PEERS=$((HEALTHY_PEERS + 1))
    fi
done &lt; &lt;(sudo wg show "$INTERFACE" latest-handshakes)

echo ""
echo "Summary: $HEALTHY_PEERS/$PEER_COUNT peers healthy"

exit $EXIT_CODE
</code></pre>
<h2 id="performance-tuning"><a class="header" href="#performance-tuning">Performance Tuning</a></h2>
<h3 id="optimize-udp-buffer-sizes"><a class="header" href="#optimize-udp-buffer-sizes">Optimize UDP Buffer Sizes</a></h3>
<pre><code class="language-bash"># Increase UDP buffer sizes
sudo sysctl -w net.core.rmem_max=26214400
sudo sysctl -w net.core.rmem_default=26214400
sudo sysctl -w net.core.wmem_max=26214400
sudo sysctl -w net.core.wmem_default=26214400
sudo sysctl -w net.core.netdev_max_backlog=2000
</code></pre>
<h3 id="mtu-optimization"><a class="header" href="#mtu-optimization">MTU Optimization</a></h3>
<pre><code class="language-bash"># Determine optimal MTU
# Standard Ethernet MTU: 1500
# WireGuard overhead: 60 bytes (IPv4) or 80 bytes (IPv6)
# Optimal MTU: 1420 (IPv4) or 1400 (IPv6)

# Set in configuration
# MTU = 1420

# Or manually
sudo ip link set mtu 1420 dev wg0
</code></pre>
<h3 id="cpu-affinity"><a class="header" href="#cpu-affinity">CPU Affinity</a></h3>
<pre><code class="language-bash"># Pin WireGuard to specific CPU cores (for high-throughput scenarios)
# Find WireGuard kernel threads
ps -eLo psr,pid,comm | grep wg

# Set CPU affinity
sudo taskset -cp 0,1 &lt;wg_pid&gt;
</code></pre>
<h2 id="integration-examples"><a class="header" href="#integration-examples">Integration Examples</a></h2>
<h3 id="with-docker"><a class="header" href="#with-docker">With Docker</a></h3>
<pre><code class="language-bash"># Allow Docker containers to use WireGuard
docker run -it --rm \
  --cap-add=NET_ADMIN \
  --device=/dev/net/tun \
  -v /path/to/wg0.conf:/etc/wireguard/wg0.conf \
  alpine sh -c "apk add wireguard-tools &amp;&amp; wg-quick up wg0 &amp;&amp; sh"
</code></pre>
<h3 id="with-networkmanager"><a class="header" href="#with-networkmanager">With NetworkManager</a></h3>
<pre><code class="language-bash"># Import WireGuard connection
sudo nmcli connection import type wireguard file /etc/wireguard/wg0.conf

# Activate connection
sudo nmcli connection up wg0

# Deactivate connection
sudo nmcli connection down wg0
</code></pre>
<h3 id="with-systemd-networkd"><a class="header" href="#with-systemd-networkd">With systemd-networkd</a></h3>
<p>Create <code>/etc/systemd/network/99-wg0.netdev</code>:</p>
<pre><code class="language-ini">[NetDev]
Name=wg0
Kind=wireguard
Description=WireGuard tunnel wg0

[WireGuard]
PrivateKey=&lt;private_key&gt;
ListenPort=51820

[WireGuardPeer]
PublicKey=&lt;peer_public_key&gt;
AllowedIPs=10.0.0.2/32
Endpoint=peer.example.com:51820
PersistentKeepalive=25
</code></pre>
<p>Create <code>/etc/systemd/network/99-wg0.network</code>:</p>
<pre><code class="language-ini">[Match]
Name=wg0

[Network]
Address=10.0.0.1/24

[Route]
Gateway=10.0.0.1
Destination=10.0.0.0/24
</code></pre>
<p>Enable:</p>
<pre><code class="language-bash">sudo systemctl enable systemd-networkd
sudo systemctl restart systemd-networkd
</code></pre>
<h3 id="cloud-provider-integrations"><a class="header" href="#cloud-provider-integrations">Cloud Provider Integrations</a></h3>
<h4 id="aws-vpc-peering-with-wireguard"><a class="header" href="#aws-vpc-peering-with-wireguard">AWS VPC Peering with WireGuard</a></h4>
<p>Connect on-premises network to AWS VPC:</p>
<p><strong>AWS EC2 Instance Setup</strong>:</p>
<pre><code class="language-bash"># Launch EC2 instance (Amazon Linux 2 or Ubuntu)
# Security Group: Allow UDP 51820 inbound

# Install WireGuard
sudo amazon-linux-extras install epel -y
sudo yum install wireguard-tools -y

# Enable IP forwarding
sudo sysctl -w net.ipv4.ip_forward=1
echo "net.ipv4.ip_forward=1" | sudo tee -a /etc/sysctl.conf

# Disable source/dest check on EC2 instance (AWS Console)
</code></pre>
<p><strong>AWS Configuration</strong> (<code>/etc/wireguard/wg0.conf</code>):</p>
<pre><code class="language-ini">[Interface]
PrivateKey = &lt;aws_private_key&gt;
Address = 10.0.0.1/24
ListenPort = 51820
# Route VPC traffic through tunnel
PostUp = ip route add 172.31.0.0/16 dev wg0
PostUp = iptables -A FORWARD -i wg0 -j ACCEPT
PostUp = iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
PostDown = iptables -D FORWARD -i wg0 -j ACCEPT
PostDown = iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE

[Peer]
PublicKey = &lt;onprem_public_key&gt;
AllowedIPs = 10.0.0.2/32, 192.168.1.0/24
PersistentKeepalive = 25
</code></pre>
<p><strong>VPC Route Table</strong>:</p>
<ul>
<li>Destination: <code>192.168.1.0/24</code></li>
<li>Target: WireGuard EC2 instance ENI</li>
</ul>
<p><strong>Terraform Example</strong>:</p>
<pre><code class="language-hcl">resource "aws_instance" "wireguard" {
  ami           = data.aws_ami.ubuntu.id
  instance_type = "t3.micro"
  key_name      = var.key_name
  subnet_id     = aws_subnet.public.id

  vpc_security_group_ids = [aws_security_group.wireguard.id]
  source_dest_check      = false

  user_data = &lt;&lt;-EOF
    #!/bin/bash
    apt update
    apt install -y wireguard
    # Configuration deployment...
  EOF

  tags = {
    Name = "wireguard-gateway"
  }
}

resource "aws_security_group" "wireguard" {
  name        = "wireguard-sg"
  description = "WireGuard VPN"
  vpc_id      = aws_vpc.main.id

  ingress {
    from_port   = 51820
    to_port     = 51820
    protocol    = "udp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }
}
</code></pre>
<h4 id="google-cloud-platform"><a class="header" href="#google-cloud-platform">Google Cloud Platform</a></h4>
<p><strong>GCP Compute Engine Setup</strong>:</p>
<pre><code class="language-bash"># Create firewall rule
gcloud compute firewall-rules create wireguard-allow \
  --allow=udp:51820 \
  --source-ranges=0.0.0.0/0 \
  --description="Allow WireGuard VPN"

# Create instance
gcloud compute instances create wireguard-gateway \
  --machine-type=e2-micro \
  --image-family=ubuntu-2204-lts \
  --image-project=ubuntu-os-cloud \
  --can-ip-forward \
  --tags=wireguard

# SSH and install
gcloud compute ssh wireguard-gateway
sudo apt update &amp;&amp; sudo apt install -y wireguard
</code></pre>
<h4 id="azure-virtual-network"><a class="header" href="#azure-virtual-network">Azure Virtual Network</a></h4>
<p><strong>Azure VM Setup</strong>:</p>
<pre><code class="language-bash"># Create VM with Azure CLI
az vm create \
  --resource-group myResourceGroup \
  --name wireguard-vm \
  --image UbuntuLTS \
  --size Standard_B1s \
  --admin-username azureuser \
  --generate-ssh-keys

# Enable IP forwarding
az network nic update \
  --resource-group myResourceGroup \
  --name wireguard-vmVMNic \
  --ip-forwarding true

# Add NSG rule
az network nsg rule create \
  --resource-group myResourceGroup \
  --nsg-name wireguard-vmNSG \
  --name AllowWireGuard \
  --priority 1000 \
  --protocol Udp \
  --destination-port-range 51820 \
  --access Allow
</code></pre>
<h3 id="kubernetes-integration"><a class="header" href="#kubernetes-integration">Kubernetes Integration</a></h3>
<h4 id="wireguard-as-cni-plugin"><a class="header" href="#wireguard-as-cni-plugin">WireGuard as CNI Plugin</a></h4>
<p>Use WireGuard for pod-to-pod encryption:</p>
<p><strong>Installation with Helm</strong>:</p>
<pre><code class="language-bash"># Add WireGuard CNI chart
helm repo add wiretrustee https://wiretrustee.github.io/helm-charts
helm repo update

# Install
helm install wireguard-cni wiretrustee/wireguard-cni \
  --namespace kube-system \
  --set subnet=10.244.0.0/16
</code></pre>
<h4 id="daemonset-deployment"><a class="header" href="#daemonset-deployment">DaemonSet Deployment</a></h4>
<p>Deploy WireGuard on all nodes:</p>
<pre><code class="language-yaml"># wireguard-daemonset.yaml
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: wireguard
  namespace: kube-system
spec:
  selector:
    matchLabels:
      app: wireguard
  template:
    metadata:
      labels:
        app: wireguard
    spec:
      hostNetwork: true
      containers:
      - name: wireguard
        image: linuxserver/wireguard:latest
        securityContext:
          privileged: true
          capabilities:
            add:
              - NET_ADMIN
              - SYS_MODULE
        env:
        - name: PUID
          value: "1000"
        - name: PGID
          value: "1000"
        volumeMounts:
        - name: config
          mountPath: /config
        - name: lib-modules
          mountPath: /lib/modules
          readOnly: true
      volumes:
      - name: config
        configMap:
          name: wireguard-config
      - name: lib-modules
        hostPath:
          path: /lib/modules
</code></pre>
<p><strong>ConfigMap for WireGuard</strong>:</p>
<pre><code class="language-yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: wireguard-config
  namespace: kube-system
data:
  wg0.conf: |
    [Interface]
    PrivateKey = &lt;node_private_key&gt;
    Address = 10.0.0.x/24
    ListenPort = 51820

    [Peer]
    PublicKey = &lt;peer_public_key&gt;
    AllowedIPs = 10.0.0.0/24
    Endpoint = peer.example.com:51820
    PersistentKeepalive = 25
</code></pre>
<h4 id="service-mesh-integration"><a class="header" href="#service-mesh-integration">Service Mesh Integration</a></h4>
<p>Integrate with service meshes like Linkerd or Istio:</p>
<pre><code class="language-yaml"># Pod annotation for WireGuard routing
apiVersion: v1
kind: Pod
metadata:
  name: secure-app
  annotations:
    wireguard.io/tunnel: "wg0"
spec:
  containers:
  - name: app
    image: myapp:latest
</code></pre>
<h3 id="mobile-client-management"><a class="header" href="#mobile-client-management">Mobile Client Management</a></h3>
<h4 id="qr-code-generation"><a class="header" href="#qr-code-generation">QR Code Generation</a></h4>
<p>Generate QR codes for easy mobile client setup:</p>
<pre><code class="language-bash">#!/bin/bash
# qr-gen.sh

CLIENT_NAME=$1
CONFIG_FILE="/etc/wireguard/clients/${CLIENT_NAME}.conf"

if [ ! -f "$CONFIG_FILE" ]; then
    echo "Config file not found: $CONFIG_FILE"
    exit 1
fi

# Install qrencode if needed
if ! command -v qrencode &amp;&gt; /dev/null; then
    sudo apt install -y qrencode
fi

# Generate QR code
qrencode -t ansiutf8 &lt; "$CONFIG_FILE"

# Or save to file
qrencode -t PNG -o "${CLIENT_NAME}.png" &lt; "$CONFIG_FILE"
echo "QR code saved to ${CLIENT_NAME}.png"
</code></pre>
<h4 id="ios-configuration-profile"><a class="header" href="#ios-configuration-profile">iOS Configuration Profile</a></h4>
<p>Generate iOS configuration profile:</p>
<pre><code class="language-bash">#!/bin/bash
# ios-profile-gen.sh

CLIENT_NAME=$1
PROFILE_UUID=$(uuidgen)

cat &gt; "${CLIENT_NAME}.mobileconfig" &lt;&lt;EOF
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;plist version="1.0"&gt;
&lt;dict&gt;
    &lt;key&gt;PayloadContent&lt;/key&gt;
    &lt;array&gt;
        &lt;dict&gt;
            &lt;key&gt;PayloadType&lt;/key&gt;
            &lt;string&gt;com.wireguard.ios.config&lt;/string&gt;
            &lt;key&gt;PayloadUUID&lt;/key&gt;
            &lt;string&gt;${PROFILE_UUID}&lt;/string&gt;
            &lt;key&gt;PayloadIdentifier&lt;/key&gt;
            &lt;string&gt;com.example.wireguard.${CLIENT_NAME}&lt;/string&gt;
            &lt;key&gt;PayloadVersion&lt;/key&gt;
            &lt;integer&gt;1&lt;/integer&gt;
        &lt;/dict&gt;
    &lt;/array&gt;
    &lt;key&gt;PayloadDisplayName&lt;/key&gt;
    &lt;string&gt;WireGuard - ${CLIENT_NAME}&lt;/string&gt;
    &lt;key&gt;PayloadIdentifier&lt;/key&gt;
    &lt;string&gt;com.example.wireguard&lt;/string&gt;
    &lt;key&gt;PayloadUUID&lt;/key&gt;
    &lt;string&gt;${PROFILE_UUID}&lt;/string&gt;
    &lt;key&gt;PayloadType&lt;/key&gt;
    &lt;string&gt;Configuration&lt;/string&gt;
    &lt;key&gt;PayloadVersion&lt;/key&gt;
    &lt;integer&gt;1&lt;/integer&gt;
&lt;/dict&gt;
&lt;/plist&gt;
EOF
</code></pre>
<h4 id="android-client-automation"><a class="header" href="#android-client-automation">Android Client Automation</a></h4>
<p>Automate Android client distribution:</p>
<pre><code class="language-bash"># Generate Tunnels.zip for WireGuard Android app
zip wireguard-configs.zip /etc/wireguard/clients/*.conf

# Or use wg-quick to generate configs
for client in client1 client2 client3; do
    # Generate config with wg-quick format
    cat &gt; "${client}.conf" &lt;&lt;EOF
[Interface]
PrivateKey = $(wg genkey)
Address = 10.0.0.${i}/24
DNS = 1.1.1.1

[Peer]
PublicKey = ${SERVER_PUBLIC_KEY}
AllowedIPs = 0.0.0.0/0
Endpoint = vpn.example.com:51820
PersistentKeepalive = 25
EOF
done
</code></pre>
<h3 id="automation-and-orchestration"><a class="header" href="#automation-and-orchestration">Automation and Orchestration</a></h3>
<h4 id="ansible-playbook"><a class="header" href="#ansible-playbook">Ansible Playbook</a></h4>
<p>Deploy WireGuard with Ansible:</p>
<pre><code class="language-yaml"># wireguard-deploy.yml
---
- name: Deploy WireGuard VPN
  hosts: vpn_servers
  become: yes
  vars:
    wg_interface: wg0
    wg_port: 51820
    wg_network: 10.0.0.0/24

  tasks:
    - name: Install WireGuard
      apt:
        name:
          - wireguard
          - wireguard-tools
        state: present
        update_cache: yes

    - name: Enable IP forwarding
      sysctl:
        name: net.ipv4.ip_forward
        value: '1'
        sysctl_set: yes
        state: present
        reload: yes

    - name: Generate private key
      shell: wg genkey
      register: private_key
      changed_when: false
      no_log: true

    - name: Generate public key
      shell: echo "{{ private_key.stdout }}" | wg pubkey
      register: public_key
      changed_when: false

    - name: Create WireGuard config directory
      file:
        path: /etc/wireguard
        state: directory
        mode: '0700'

    - name: Deploy WireGuard configuration
      template:
        src: templates/wg0.conf.j2
        dest: /etc/wireguard/wg0.conf
        mode: '0600'
      notify: restart wireguard

    - name: Enable WireGuard service
      systemd:
        name: wg-quick@wg0
        enabled: yes
        state: started

  handlers:
    - name: restart wireguard
      systemd:
        name: wg-quick@wg0
        state: restarted
</code></pre>
<p><strong>Template</strong> (<code>templates/wg0.conf.j2</code>):</p>
<pre><code class="language-jinja2">[Interface]
PrivateKey = {{ private_key.stdout }}
Address = {{ ansible_default_ipv4.address }}/24
ListenPort = {{ wg_port }}
PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE

{% for peer in wg_peers %}
[Peer]
PublicKey = {{ peer.public_key }}
AllowedIPs = {{ peer.allowed_ips }}
{% if peer.endpoint is defined %}
Endpoint = {{ peer.endpoint }}
{% endif %}
PersistentKeepalive = 25
{% endfor %}
</code></pre>
<h4 id="terraform-module"><a class="header" href="#terraform-module">Terraform Module</a></h4>
<p>Infrastructure as Code for WireGuard:</p>
<pre><code class="language-hcl"># modules/wireguard/main.tf
terraform {
  required_providers {
    random = {
      source  = "hashicorp/random"
      version = "~&gt; 3.0"
    }
  }
}

resource "random_password" "wg_private_key" {
  length  = 32
  special = true
}

resource "null_resource" "wireguard_keys" {
  provisioner "local-exec" {
    command = &lt;&lt;-EOT
      wg genkey | tee privatekey | wg pubkey &gt; publickey
    EOT
  }
}

output "public_key" {
  value = file("publickey")
}
</code></pre>
<h2 id="migration-guides"><a class="header" href="#migration-guides">Migration Guides</a></h2>
<h3 id="migrating-from-openvpn"><a class="header" href="#migrating-from-openvpn">Migrating from OpenVPN</a></h3>
<p><strong>Comparison and Strategy</strong>:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Aspect</th><th>OpenVPN</th><th>WireGuard</th><th>Migration Impact</th></tr>
</thead>
<tbody>
<tr><td>Config Format</td><td>.ovpn files</td><td>.conf files</td><td>Manual conversion needed</td></tr>
<tr><td>Certificates</td><td>PKI/certs</td><td>Public keys</td><td>Simplified key management</td></tr>
<tr><td>Port</td><td>TCP/UDP customizable</td><td>UDP only</td><td>Firewall rules update</td></tr>
<tr><td>Routing</td><td>Complex routes</td><td>AllowedIPs</td><td>Routing logic change</td></tr>
</tbody>
</table>
</div>
<p><strong>Migration Steps</strong>:</p>
<ol>
<li><strong>Inventory existing OpenVPN setup</strong>:</li>
</ol>
<pre><code class="language-bash"># List current OpenVPN clients
ls -l /etc/openvpn/clients/

# Document network topology
cat /etc/openvpn/server.conf | grep -E "server|route|push"
</code></pre>
<ol start="2">
<li><strong>Generate WireGuard equivalents</strong>:</li>
</ol>
<pre><code class="language-bash">#!/bin/bash
# openvpn-to-wireguard.sh

OPENVPN_SERVER_CONF="/etc/openvpn/server.conf"
WG_CONFIG="/etc/wireguard/wg0.conf"

# Extract OpenVPN network
OVPN_NETWORK=$(grep "^server " "$OPENVPN_SERVER_CONF" | awk '{print $2}')
OVPN_NETMASK=$(grep "^server " "$OPENVPN_SERVER_CONF" | awk '{print $3}')

# Generate WireGuard server config
cat &gt; "$WG_CONFIG" &lt;&lt;EOF
[Interface]
PrivateKey = $(wg genkey)
Address = ${OVPN_NETWORK}/24
ListenPort = 51820
PostUp = iptables -A FORWARD -i %i -j ACCEPT
PostDown = iptables -D FORWARD -i %i -j ACCEPT
EOF

echo "WireGuard server config created at $WG_CONFIG"
echo "OpenVPN network: $OVPN_NETWORK/$OVPN_NETMASK"
</code></pre>
<ol start="3">
<li><strong>Parallel operation period</strong>:</li>
</ol>
<p>Run both OpenVPN and WireGuard simultaneously:</p>
<pre><code class="language-bash"># Keep OpenVPN running
sudo systemctl status openvpn@server

# Start WireGuard on different port
sudo wg-quick up wg0

# Monitor both
watch -n 5 'echo "=== OpenVPN ==="; sudo systemctl status openvpn@server; echo "=== WireGuard ==="; sudo wg show'
</code></pre>
<ol start="4">
<li><strong>Gradual client migration</strong>:</li>
</ol>
<pre><code class="language-bash"># Migrate one client at a time
# 1. Generate WireGuard config
# 2. Test connection
# 3. Remove from OpenVPN
# 4. Monitor for issues
</code></pre>
<ol start="5">
<li><strong>Decommission OpenVPN</strong>:</li>
</ol>
<pre><code class="language-bash"># After all clients migrated
sudo systemctl stop openvpn@server
sudo systemctl disable openvpn@server
</code></pre>
<h3 id="migrating-from-ipsec"><a class="header" href="#migrating-from-ipsec">Migrating from IPsec</a></h3>
<p><strong>Key Differences</strong>:</p>
<ul>
<li>IPsec uses IKE for key exchange; WireGuard uses static keys</li>
<li>IPsec has multiple modes (transport/tunnel); WireGuard is tunnel-only</li>
<li>IPsec configuration is complex; WireGuard is simple</li>
</ul>
<p><strong>Conversion Example</strong>:</p>
<p>IPsec (strongSwan) configuration:</p>
<pre><code>conn site-to-site
    left=192.0.2.1
    leftsubnet=10.1.0.0/16
    right=198.51.100.1
    rightsubnet=10.2.0.0/16
    ike=aes256-sha2_256-modp2048!
    esp=aes256-sha2_256!
    keyexchange=ikev2
    auto=start
</code></pre>
<p>WireGuard equivalent:</p>
<pre><code class="language-ini"># Site A
[Interface]
PrivateKey = &lt;site_a_key&gt;
Address = 10.0.0.1/24
ListenPort = 51820

[Peer]
PublicKey = &lt;site_b_key&gt;
AllowedIPs = 10.2.0.0/16, 10.0.0.2/32
Endpoint = 198.51.100.1:51820
</code></pre>
<h2 id="advanced-debugging"><a class="header" href="#advanced-debugging">Advanced Debugging</a></h2>
<h3 id="packet-capture-and-analysis"><a class="header" href="#packet-capture-and-analysis">Packet Capture and Analysis</a></h3>
<p><strong>Capture WireGuard Traffic</strong>:</p>
<pre><code class="language-bash"># Capture on physical interface (encrypted)
sudo tcpdump -i eth0 -n udp port 51820 -w wireguard-encrypted.pcap

# Capture on WireGuard interface (decrypted)
sudo tcpdump -i wg0 -n -w wireguard-decrypted.pcap

# Analyze with Wireshark
wireshark wireguard-encrypted.pcap
</code></pre>
<p><strong>Wireshark Filters</strong>:</p>
<pre><code># WireGuard handshake packets
udp.port == 51820 &amp;&amp; udp.length == 148

# WireGuard data packets
udp.port == 51820 &amp;&amp; udp.length &gt; 148

# Filter by endpoint
ip.addr == 203.0.113.1 &amp;&amp; udp.port == 51820
</code></pre>
<h3 id="ebpf-tracing"><a class="header" href="#ebpf-tracing">eBPF Tracing</a></h3>
<p>Trace WireGuard kernel operations with eBPF:</p>
<pre><code class="language-bash"># Install bpftrace
sudo apt install bpftrace

# Trace WireGuard packet processing
sudo bpftrace -e '
kprobe:wg_packet_receive {
    printf("RX packet on wg, size: %d\n", arg1);
}

kprobe:wg_packet_send {
    printf("TX packet on wg, size: %d\n", arg1);
}
'

# Trace handshakes
sudo bpftrace -e '
kprobe:wg_noise_handshake_create_initiation {
    printf("Initiating handshake\n");
}

kprobe:wg_noise_handshake_consume_response {
    printf("Consuming handshake response\n");
}
'
</code></pre>
<h3 id="performance-profiling"><a class="header" href="#performance-profiling">Performance Profiling</a></h3>
<p><strong>CPU Profiling</strong>:</p>
<pre><code class="language-bash"># Use perf to profile WireGuard
sudo perf record -g -p $(pgrep kworker/.*wg-crypt)
# Generate load, then:
sudo perf report

# Profile specific functions
sudo perf record -e cycles -g -- sleep 30
sudo perf report --sort comm,dso,symbol | grep wireguard
</code></pre>
<p><strong>Latency Measurement</strong>:</p>
<pre><code class="language-bash">#!/bin/bash
# wg-latency-test.sh

PEER_IP="10.0.0.2"
SAMPLES=1000

echo "Testing WireGuard latency ($SAMPLES samples)..."

ping -c "$SAMPLES" -i 0.01 "$PEER_IP" | tee ping-results.txt

# Calculate statistics
awk '/^rtt/ {
    split($4, values, "/");
    printf "Min: %.2f ms\n", values[1];
    printf "Avg: %.2f ms\n", values[2];
    printf "Max: %.2f ms\n", values[3];
    printf "StdDev: %.2f ms\n", values[4];
}' ping-results.txt
</code></pre>
<p><strong>Throughput Testing</strong>:</p>
<pre><code class="language-bash"># Server side (run iperf3 server through tunnel)
iperf3 -s -B 10.0.0.1

# Client side
iperf3 -c 10.0.0.1 -t 60 -i 1

# Bidirectional test
iperf3 -c 10.0.0.1 -t 60 -i 1 --bidir

# UDP throughput
iperf3 -c 10.0.0.1 -t 60 -u -b 1G
</code></pre>
<h3 id="kernel-debugging"><a class="header" href="#kernel-debugging">Kernel Debugging</a></h3>
<p><strong>Enable debug logging</strong>:</p>
<pre><code class="language-bash"># Check current debug level
cat /sys/kernel/debug/dynamic_debug/control | grep wireguard

# Enable all WireGuard debug messages
echo 'module wireguard +p' | sudo tee /sys/kernel/debug/dynamic_debug/control

# View logs
sudo dmesg -w | grep wireguard

# Disable when done
echo 'module wireguard -p' | sudo tee /sys/kernel/debug/dynamic_debug/control
</code></pre>
<p><strong>Trace route debugging</strong>:</p>
<pre><code class="language-bash"># Check routing for specific destination
ip route get 10.0.0.2

# Show all routes in WireGuard table
ip route show table all | grep wg0

# Trace packet path
sudo mtr --report 10.0.0.2

# Check policy routing
ip rule show
</code></pre>
<h2 id="comparison-with-other-vpn-solutions"><a class="header" href="#comparison-with-other-vpn-solutions">Comparison with Other VPN Solutions</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Feature</th><th>WireGuard</th><th>OpenVPN</th><th>IPsec</th></tr>
</thead>
<tbody>
<tr><td>Lines of Code</td><td>~4,000</td><td>~100,000</td><td>~400,000</td></tr>
<tr><td>Performance</td><td>Excellent</td><td>Good</td><td>Good</td></tr>
<tr><td>Setup Complexity</td><td>Simple</td><td>Medium</td><td>Complex</td></tr>
<tr><td>Cryptography</td><td>Modern, fixed</td><td>Configurable</td><td>Configurable</td></tr>
<tr><td>Kernel Integration</td><td>Yes (Linux 5.6+)</td><td>No</td><td>Yes</td></tr>
<tr><td>Roaming</td><td>Seamless</td><td>Requires reconnect</td><td>Requires reconnect</td></tr>
<tr><td>NAT Traversal</td><td>Excellent</td><td>Good</td><td>Challenging</td></tr>
<tr><td>CPU Usage</td><td>Low</td><td>Medium</td><td>Medium-High</td></tr>
</tbody>
</table>
</div>
<h2 id="quick-reference"><a class="header" href="#quick-reference">Quick Reference</a></h2>
<h3 id="essential-commands"><a class="header" href="#essential-commands">Essential Commands</a></h3>
<pre><code class="language-bash"># Key generation
wg genkey | tee privatekey | wg pubkey &gt; publickey

# Interface management
sudo wg-quick up wg0
sudo wg-quick down wg0

# Show status
sudo wg show
sudo wg show wg0

# Add peer
sudo wg set wg0 peer &lt;pubkey&gt; allowed-ips 10.0.0.2/32

# Remove peer
sudo wg set wg0 peer &lt;pubkey&gt; remove

# Reload configuration
sudo wg syncconf wg0 &lt;(wg-quick strip wg0)
</code></pre>
<h3 id="configuration-template"><a class="header" href="#configuration-template">Configuration Template</a></h3>
<pre><code class="language-ini">[Interface]
PrivateKey = &lt;base64_private_key&gt;
Address = &lt;interface_ip&gt;/24
ListenPort = 51820
DNS = 1.1.1.1

[Peer]
PublicKey = &lt;base64_public_key&gt;
AllowedIPs = &lt;allowed_cidr&gt;
Endpoint = &lt;hostname_or_ip&gt;:51820
PersistentKeepalive = 25
</code></pre>
<h2 id="useful-resources"><a class="header" href="#useful-resources">Useful Resources</a></h2>
<h3 id="official-documentation"><a class="header" href="#official-documentation">Official Documentation</a></h3>
<ul>
<li><a href="https://www.wireguard.com/">WireGuard Official Site</a></li>
<li><a href="https://www.kernel.org/doc/html/latest/networking/wireguard.html">WireGuard Kernel Documentation</a></li>
<li><a href="https://www.wireguard.com/papers/wireguard.pdf">WireGuard Whitepaper</a></li>
</ul>
<h3 id="tools-and-utilities"><a class="header" href="#tools-and-utilities">Tools and Utilities</a></h3>
<ul>
<li><a href="https://git.zx2c4.com/wireguard-tools/about/src/man/wg-quick.8">wg-quick</a> - Configuration management tool</li>
<li><a href="https://git.zx2c4.com/wireguard-tools/about/src/man/wg.8">wg</a> - Low-level configuration tool</li>
<li><a href="https://git.zx2c4.com/wireguard-tools/">wireguard-tools</a> - Official command-line tools</li>
</ul>
<h3 id="community-resources"><a class="header" href="#community-resources">Community Resources</a></h3>
<ul>
<li><a href="https://lists.zx2c4.com/mailman/listinfo/wireguard">WireGuard Mailing List</a></li>
<li><a href="https://www.reddit.com/r/WireGuard/">WireGuard Subreddit</a></li>
<li><a href="https://github.com/cedrickchee/awesome-wireguard">Awesome WireGuard</a> - Curated resources</li>
</ul>
<h2 id="troubleshooting-checklist"><a class="header" href="#troubleshooting-checklist">Troubleshooting Checklist</a></h2>
<ul>
<li><input disabled="" type="checkbox"> Private/public keys correctly generated and configured</li>
<li><input disabled="" type="checkbox"> Firewall allows UDP traffic on WireGuard port</li>
<li><input disabled="" type="checkbox"> IP forwarding enabled on server</li>
<li><input disabled="" type="checkbox"> AllowedIPs correctly configured for both directions</li>
<li><input disabled="" type="checkbox"> Endpoint reachable and correct</li>
<li><input disabled="" type="checkbox"> PersistentKeepalive set for clients behind NAT</li>
<li><input disabled="" type="checkbox"> MTU configured appropriately</li>
<li><input disabled="" type="checkbox"> No IP conflicts with existing networks</li>
<li><input disabled="" type="checkbox"> WireGuard kernel module loaded</li>
<li><input disabled="" type="checkbox"> Correct permissions on configuration files (600)</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../linux/process.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../android/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../linux/process.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../android/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-c2a407aa.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>

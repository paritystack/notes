<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Monitoring - My Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">My Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="monitoring--observability"><a class="header" href="#monitoring--observability">Monitoring &amp; Observability</a></h1>
<p>Comprehensive monitoring, logging, and observability practices for maintaining reliable, performant systems.</p>
<h2 id="core-concepts"><a class="header" href="#core-concepts">Core Concepts</a></h2>
<h3 id="the-three-pillars-of-observability"><a class="header" href="#the-three-pillars-of-observability">The Three Pillars of Observability</a></h3>
<h4 id="1-metrics"><a class="header" href="#1-metrics">1. Metrics</a></h4>
<p>Numerical data points measured over time:</p>
<ul>
<li><strong>System Metrics</strong>: CPU, memory, disk, network</li>
<li><strong>Application Metrics</strong>: Request rate, error rate, latency</li>
<li><strong>Business Metrics</strong>: User signups, transactions, revenue</li>
</ul>
<h4 id="2-logs"><a class="header" href="#2-logs">2. Logs</a></h4>
<p>Discrete event records with timestamps:</p>
<ul>
<li><strong>Application Logs</strong>: Debug, info, warning, error messages</li>
<li><strong>Access Logs</strong>: HTTP requests, API calls</li>
<li><strong>Audit Logs</strong>: Security events, user actions</li>
</ul>
<h4 id="3-traces"><a class="header" href="#3-traces">3. Traces</a></h4>
<p>Request flow through distributed systems:</p>
<ul>
<li><strong>Distributed Tracing</strong>: Track requests across services</li>
<li><strong>Span</strong>: Single operation in trace</li>
<li><strong>Context Propagation</strong>: Pass trace context between services</li>
</ul>
<h3 id="monitoring-vs-observability"><a class="header" href="#monitoring-vs-observability">Monitoring vs Observability</a></h3>
<p><strong>Monitoring</strong>: Known unknowns - track predefined metrics</p>
<ul>
<li>"Is the system up?"</li>
<li>"What's the error rate?"</li>
</ul>
<p><strong>Observability</strong>: Unknown unknowns - understand system behavior</p>
<ul>
<li>"Why is this request slow?"</li>
<li>"What caused this error?"</li>
</ul>
<h2 id="key-metrics"><a class="header" href="#key-metrics">Key Metrics</a></h2>
<h3 id="golden-signals-sre"><a class="header" href="#golden-signals-sre">Golden Signals (SRE)</a></h3>
<h4 id="latency"><a class="header" href="#latency">Latency</a></h4>
<p>Time to serve requests:</p>
<pre><code class="language-promql"># P95 latency
histogram_quantile(0.95,
  rate(http_request_duration_seconds_bucket[5m])
)

# Average latency
rate(http_request_duration_seconds_sum[5m]) /
rate(http_request_duration_seconds_count[5m])
</code></pre>
<h4 id="traffic"><a class="header" href="#traffic">Traffic</a></h4>
<p>Demand on system:</p>
<pre><code class="language-promql"># Requests per second
rate(http_requests_total[5m])

# Request volume by endpoint
sum by (endpoint) (rate(http_requests_total[5m]))
</code></pre>
<h4 id="errors"><a class="header" href="#errors">Errors</a></h4>
<p>Failed requests:</p>
<pre><code class="language-promql"># Error rate
rate(http_requests_total{status=~"5.."}[5m]) /
rate(http_requests_total[5m])

# Error count
sum(rate(http_requests_total{status=~"5.."}[5m]))
</code></pre>
<h4 id="saturation"><a class="header" href="#saturation">Saturation</a></h4>
<p>System utilization:</p>
<pre><code class="language-promql"># CPU usage
100 - (avg by(instance) (rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)

# Memory usage
(node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) /
node_memory_MemTotal_bytes * 100

# Disk usage
(node_filesystem_size_bytes - node_filesystem_avail_bytes) /
node_filesystem_size_bytes * 100
</code></pre>
<h3 id="red-method-services"><a class="header" href="#red-method-services">RED Method (Services)</a></h3>
<p><strong>Rate</strong>: Requests per second
<strong>Errors</strong>: Failed requests per second
<strong>Duration</strong>: Request latency</p>
<h3 id="use-method-resources"><a class="header" href="#use-method-resources">USE Method (Resources)</a></h3>
<p><strong>Utilization</strong>: % time resource is busy
<strong>Saturation</strong>: Amount of queued work
<strong>Errors</strong>: Error count</p>
<h2 id="prometheus"><a class="header" href="#prometheus">Prometheus</a></h2>
<h3 id="architecture"><a class="header" href="#architecture">Architecture</a></h3>
<pre><code>Applications → Prometheus → Grafana
     ↓
  Exporters
</code></pre>
<h3 id="configuration"><a class="header" href="#configuration">Configuration</a></h3>
<pre><code class="language-yaml"># prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    cluster: 'production'
    region: 'us-east-1'

scrape_configs:
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  - job_name: 'node-exporter'
    static_configs:
      - targets: ['node1:9100', 'node2:9100']

  - job_name: 'application'
    kubernetes_sd_configs:
      - role: pod
    relabel_configs:
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
        action: keep
        regex: true

  - job_name: 'blackbox'
    metrics_path: /probe
    params:
      module: [http_2xx]
    static_configs:
      - targets:
          - https://example.com
          - https://api.example.com
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: instance
      - target_label: __address__
        replacement: blackbox-exporter:9115
</code></pre>
<h3 id="metrics-instrumentation"><a class="header" href="#metrics-instrumentation">Metrics Instrumentation</a></h3>
<h4 id="nodejs-prom-client"><a class="header" href="#nodejs-prom-client">Node.js (prom-client)</a></h4>
<pre><code class="language-javascript">const client = require('prom-client');

// Default metrics (CPU, memory, etc.)
client.collectDefaultMetrics();

// Counter
const httpRequestsTotal = new client.Counter({
  name: 'http_requests_total',
  help: 'Total HTTP requests',
  labelNames: ['method', 'route', 'status']
});

// Histogram
const httpRequestDuration = new client.Histogram({
  name: 'http_request_duration_seconds',
  help: 'HTTP request latency',
  labelNames: ['method', 'route', 'status'],
  buckets: [0.1, 0.5, 1, 2, 5]
});

// Gauge
const activeConnections = new client.Gauge({
  name: 'active_connections',
  help: 'Active connections'
});

// Middleware
app.use((req, res, next) =&gt; {
  const start = Date.now();

  res.on('finish', () =&gt; {
    const duration = (Date.now() - start) / 1000;
    httpRequestsTotal.inc({
      method: req.method,
      route: req.route?.path || req.path,
      status: res.statusCode
    });
    httpRequestDuration.observe({
      method: req.method,
      route: req.route?.path || req.path,
      status: res.statusCode
    }, duration);
  });

  next();
});

// Metrics endpoint
app.get('/metrics', async (req, res) =&gt; {
  res.set('Content-Type', client.register.contentType);
  res.end(await client.register.metrics());
});
</code></pre>
<h4 id="python-prometheus_client"><a class="header" href="#python-prometheus_client">Python (prometheus_client)</a></h4>
<pre><code class="language-python">from prometheus_client import Counter, Histogram, Gauge, start_http_server

# Metrics
requests_total = Counter(
    'http_requests_total',
    'Total HTTP requests',
    ['method', 'endpoint', 'status']
)

request_duration = Histogram(
    'http_request_duration_seconds',
    'HTTP request latency',
    ['method', 'endpoint'],
    buckets=[0.1, 0.5, 1.0, 2.0, 5.0]
)

active_users = Gauge(
    'active_users',
    'Currently active users'
)

# Decorator
def track_metrics(func):
    def wrapper(*args, **kwargs):
        method = request.method
        endpoint = request.endpoint

        with request_duration.labels(method, endpoint).time():
            response = func(*args, **kwargs)

        requests_total.labels(
            method,
            endpoint,
            response.status_code
        ).inc()

        return response
    return wrapper

# Start metrics server
start_http_server(8000)
</code></pre>
<h3 id="promql-queries"><a class="header" href="#promql-queries">PromQL Queries</a></h3>
<h4 id="rate-and-increase"><a class="header" href="#rate-and-increase">Rate and Increase</a></h4>
<pre><code class="language-promql"># Requests per second
rate(http_requests_total[5m])

# Total requests in 5 minutes
increase(http_requests_total[5m])

# Delta for gauges
delta(cpu_temperature_celsius[1h])
</code></pre>
<h4 id="aggregation"><a class="header" href="#aggregation">Aggregation</a></h4>
<pre><code class="language-promql"># Sum across all instances
sum(rate(http_requests_total[5m]))

# Average by instance
avg by(instance) (rate(http_requests_total[5m]))

# Top 5 endpoints
topk(5, sum by(endpoint) (rate(http_requests_total[5m])))

# Count of targets
count(up == 1)
</code></pre>
<h4 id="functions"><a class="header" href="#functions">Functions</a></h4>
<pre><code class="language-promql"># Percentiles
histogram_quantile(0.99,
  rate(http_request_duration_seconds_bucket[5m])
)

# Prediction (linear regression)
predict_linear(node_filesystem_free_bytes[1h], 4 * 3600)

# Absolute value
abs(delta(cpu_temp[5m]))

# Rounding
round(node_memory_MemAvailable_bytes / 1024 / 1024)
</code></pre>
<h2 id="grafana"><a class="header" href="#grafana">Grafana</a></h2>
<h3 id="dashboard-configuration"><a class="header" href="#dashboard-configuration">Dashboard Configuration</a></h3>
<pre><code class="language-json">{
  "dashboard": {
    "title": "Application Metrics",
    "panels": [
      {
        "title": "Request Rate",
        "type": "graph",
        "targets": [
          {
            "expr": "sum(rate(http_requests_total[5m]))",
            "legendFormat": "Total RPS"
          }
        ]
      },
      {
        "title": "Error Rate",
        "type": "graph",
        "targets": [
          {
            "expr": "sum(rate(http_requests_total{status=~\"5..\"}[5m])) / sum(rate(http_requests_total[5m])) * 100",
            "legendFormat": "Error %"
          }
        ]
      },
      {
        "title": "P95 Latency",
        "type": "graph",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[5m])) by (le))",
            "legendFormat": "P95"
          }
        ]
      }
    ]
  }
}
</code></pre>
<h3 id="variables"><a class="header" href="#variables">Variables</a></h3>
<pre><code class="language-json">{
  "templating": {
    "list": [
      {
        "name": "environment",
        "type": "query",
        "query": "label_values(http_requests_total, environment)",
        "current": {
          "text": "production",
          "value": "production"
        }
      },
      {
        "name": "instance",
        "type": "query",
        "query": "label_values(http_requests_total{environment=\"$environment\"}, instance)"
      }
    ]
  }
}
</code></pre>
<h2 id="elk-stack-elasticsearch-logstash-kibana"><a class="header" href="#elk-stack-elasticsearch-logstash-kibana">ELK Stack (Elasticsearch, Logstash, Kibana)</a></h2>
<h3 id="logstash-configuration"><a class="header" href="#logstash-configuration">Logstash Configuration</a></h3>
<pre><code class="language-ruby">input {
  beats {
    port =&gt; 5044
  }

  tcp {
    port =&gt; 5000
    codec =&gt; json
  }
}

filter {
  if [type] == "nginx" {
    grok {
      match =&gt; {
        "message" =&gt; "%{COMBINEDAPACHELOG}"
      }
    }

    date {
      match =&gt; [ "timestamp", "dd/MMM/yyyy:HH:mm:ss Z" ]
    }

    geoip {
      source =&gt; "clientip"
    }
  }

  if [type] == "application" {
    json {
      source =&gt; "message"
    }

    mutate {
      add_field =&gt; {
        "[@metadata][index]" =&gt; "app-logs-%{+YYYY.MM.dd}"
      }
    }
  }
}

output {
  elasticsearch {
    hosts =&gt; ["elasticsearch:9200"]
    index =&gt; "%{[@metadata][index]}"
  }

  if [level] == "ERROR" {
    slack {
      url =&gt; "${SLACK_WEBHOOK}"
      format =&gt; "Error: %{message}"
    }
  }
}
</code></pre>
<h3 id="filebeat-configuration"><a class="header" href="#filebeat-configuration">Filebeat Configuration</a></h3>
<pre><code class="language-yaml">filebeat.inputs:
  - type: log
    enabled: true
    paths:
      - /var/log/app/*.log
    fields:
      type: application
      environment: production
    multiline.pattern: '^[0-9]{4}-[0-9]{2}-[0-9]{2}'
    multiline.negate: true
    multiline.match: after

  - type: docker
    containers.ids: '*'
    processors:
      - add_docker_metadata: ~

output.logstash:
  hosts: ["logstash:5044"]

processors:
  - add_host_metadata: ~
  - add_cloud_metadata: ~
</code></pre>
<h3 id="kibana-search-queries"><a class="header" href="#kibana-search-queries">Kibana Search Queries</a></h3>
<pre><code># Search by field
level: ERROR

# Time range
@timestamp: [now-1h TO now]

# Boolean
level: ERROR AND service: api

# Wildcard
message: *timeout*

# Regex
message: /error \d+/

# Range
response_time: [500 TO *]

# Exists
_exists_: user_id

# Aggregation
service: api | stats count() by status_code
</code></pre>
<h2 id="distributed-tracing"><a class="header" href="#distributed-tracing">Distributed Tracing</a></h2>
<h3 id="opentelemetry"><a class="header" href="#opentelemetry">OpenTelemetry</a></h3>
<h4 id="nodejs-setup"><a class="header" href="#nodejs-setup">Node.js Setup</a></h4>
<pre><code class="language-javascript">const { NodeSDK } = require('@opentelemetry/sdk-node');
const { getNodeAutoInstrumentations } = require('@opentelemetry/auto-instrumentations-node');
const { JaegerExporter } = require('@opentelemetry/exporter-jaeger');

const sdk = new NodeSDK({
  traceExporter: new JaegerExporter({
    endpoint: 'http://jaeger:14268/api/traces',
  }),
  instrumentations: [getNodeAutoInstrumentations()],
  serviceName: 'my-service',
});

sdk.start();

// Custom spans
const { trace } = require('@opentelemetry/api');

async function processOrder(orderId) {
  const tracer = trace.getTracer('order-service');

  return tracer.startActiveSpan('processOrder', async (span) =&gt; {
    span.setAttribute('order.id', orderId);

    try {
      await validateOrder(orderId);
      await chargePayment(orderId);
      await fulfillOrder(orderId);

      span.setStatus({ code: SpanStatusCode.OK });
      return { success: true };
    } catch (error) {
      span.setStatus({
        code: SpanStatusCode.ERROR,
        message: error.message
      });
      span.recordException(error);
      throw error;
    } finally {
      span.end();
    }
  });
}
</code></pre>
<h4 id="context-propagation"><a class="header" href="#context-propagation">Context Propagation</a></h4>
<pre><code class="language-javascript">const { propagation, context } = require('@opentelemetry/api');

// Extract context from headers
const extractedContext = propagation.extract(
  context.active(),
  req.headers
);

// Inject context into headers
const carrier = {};
propagation.inject(context.active(), carrier);
axios.get('http://downstream-service', {
  headers: carrier
});
</code></pre>
<h2 id="alerting"><a class="header" href="#alerting">Alerting</a></h2>
<h3 id="prometheus-alerting-rules"><a class="header" href="#prometheus-alerting-rules">Prometheus Alerting Rules</a></h3>
<pre><code class="language-yaml"># alerts.yml
groups:
  - name: application
    interval: 30s
    rules:
      - alert: HighErrorRate
        expr: |
          (
            sum(rate(http_requests_total{status=~"5.."}[5m])) /
            sum(rate(http_requests_total[5m]))
          ) &gt; 0.05
        for: 5m
        labels:
          severity: critical
          team: backend
        annotations:
          summary: "High error rate on {{ $labels.instance }}"
          description: "Error rate is {{ $value | humanizePercentage }}"

      - alert: HighLatency
        expr: |
          histogram_quantile(0.95,
            sum(rate(http_request_duration_seconds_bucket[5m])) by (le)
          ) &gt; 1
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "High latency detected"
          description: "P95 latency is {{ $value }}s"

      - alert: ServiceDown
        expr: up{job="application"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Service {{ $labels.instance }} is down"

      - alert: DiskSpaceLow
        expr: |
          (
            node_filesystem_avail_bytes{mountpoint="/"} /
            node_filesystem_size_bytes{mountpoint="/"}
          ) &lt; 0.1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Low disk space on {{ $labels.instance }}"
          description: "Only {{ $value | humanizePercentage }} remaining"
</code></pre>
<h3 id="alertmanager-configuration"><a class="header" href="#alertmanager-configuration">Alertmanager Configuration</a></h3>
<pre><code class="language-yaml"># alertmanager.yml
global:
  resolve_timeout: 5m
  slack_api_url: 'https://hooks.slack.com/services/XXX'

route:
  group_by: ['alertname', 'cluster']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 12h
  receiver: 'team-notifications'
  routes:
    - match:
        severity: critical
      receiver: 'critical-alerts'
      continue: true

    - match:
        team: backend
      receiver: 'backend-team'

receivers:
  - name: 'team-notifications'
    slack_configs:
      - channel: '#alerts'
        title: 'Alert: {{ .GroupLabels.alertname }}'
        text: '{{ range .Alerts }}{{ .Annotations.description }}{{ end }}'

  - name: 'critical-alerts'
    slack_configs:
      - channel: '#critical'
    pagerduty_configs:
      - service_key: 'xxx'

  - name: 'backend-team'
    email_configs:
      - to: 'backend@example.com'
        from: 'alerts@example.com'
        smarthost: 'smtp.gmail.com:587'

inhibit_rules:
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'instance']
</code></pre>
<h2 id="slis-slos-slas"><a class="header" href="#slis-slos-slas">SLIs, SLOs, SLAs</a></h2>
<h3 id="service-level-indicators-slis"><a class="header" href="#service-level-indicators-slis">Service Level Indicators (SLIs)</a></h3>
<p>Metrics that measure service performance:</p>
<pre><code class="language-promql"># Availability SLI
sum(rate(http_requests_total{status!~"5.."}[30d])) /
sum(rate(http_requests_total[30d]))

# Latency SLI
histogram_quantile(0.95,
  sum(rate(http_request_duration_seconds_bucket[30d])) by (le)
)

# Throughput SLI
sum(rate(http_requests_total[30d]))
</code></pre>
<h3 id="service-level-objectives-slos"><a class="header" href="#service-level-objectives-slos">Service Level Objectives (SLOs)</a></h3>
<p>Target values for SLIs:</p>
<pre><code class="language-yaml">slos:
  - name: availability
    target: 99.9%  # 3 nines
    sli: |
      sum(rate(http_requests_total{status!~"5.."}[30d])) /
      sum(rate(http_requests_total[30d]))

  - name: latency
    target: 95%    # 95% of requests &lt; 200ms
    sli: |
      sum(rate(http_request_duration_seconds_bucket{le="0.2"}[30d])) /
      sum(rate(http_request_duration_seconds_count[30d]))
</code></pre>
<h3 id="error-budget"><a class="header" href="#error-budget">Error Budget</a></h3>
<pre><code class="language-promql"># Error budget remaining
1 - (
  (1 - (sum(rate(http_requests_total{status!~"5.."}[30d])) /
        sum(rate(http_requests_total[30d]))))
  /
  (1 - 0.999)  # SLO target
)

# Error budget burn rate
(1 - availability_sli) / (1 - availability_slo)
</code></pre>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<h3 id="logging"><a class="header" href="#logging">Logging</a></h3>
<h4 id="structured-logging"><a class="header" href="#structured-logging">Structured Logging</a></h4>
<pre><code class="language-javascript">const logger = require('pino')();

logger.info({
  req_id: req.id,
  user_id: req.user.id,
  method: req.method,
  path: req.path,
  duration_ms: duration,
  status: res.statusCode
}, 'Request completed');
</code></pre>
<h4 id="log-levels"><a class="header" href="#log-levels">Log Levels</a></h4>
<pre><code>DEBUG: Detailed diagnostic information
INFO: General informational messages
WARN: Warning messages for degraded state
ERROR: Error events that still allow app to continue
FATAL: Critical errors that cause shutdown
</code></pre>
<h4 id="what-to-log"><a class="header" href="#what-to-log">What to Log</a></h4>
<ul>
<li>Request/response details</li>
<li>Errors with stack traces</li>
<li>Authentication events</li>
<li>Data changes (audit trail)</li>
<li>Performance metrics</li>
<li>External service calls</li>
</ul>
<h4 id="what-not-to-log"><a class="header" href="#what-not-to-log">What NOT to Log</a></h4>
<ul>
<li>Passwords or secrets</li>
<li>Credit card numbers</li>
<li>Personal identifiable information (PII)</li>
<li>Session tokens</li>
</ul>
<h3 id="metrics"><a class="header" href="#metrics">Metrics</a></h3>
<h4 id="naming-conventions"><a class="header" href="#naming-conventions">Naming Conventions</a></h4>
<pre><code># Format: &lt;namespace&gt;_&lt;name&gt;_&lt;unit&gt;
http_requests_total
http_request_duration_seconds
database_connections_active
</code></pre>
<h4 id="cardinality"><a class="header" href="#cardinality">Cardinality</a></h4>
<pre><code># Low cardinality - Good
http_requests_total{method="GET", status="200"}

# High cardinality - Bad (avoid)
http_requests_total{user_id="12345"}  # Too many unique values
</code></pre>
<h3 id="alerting-1"><a class="header" href="#alerting-1">Alerting</a></h3>
<h4 id="alert-design"><a class="header" href="#alert-design">Alert Design</a></h4>
<ul>
<li><strong>Actionable</strong>: Can be resolved by on-call engineer</li>
<li><strong>Specific</strong>: Clear what's wrong and where</li>
<li><strong>Severe</strong>: Requires immediate attention</li>
<li><strong>Sustainable</strong>: Won't cause alert fatigue</li>
</ul>
<h4 id="alert-thresholds"><a class="header" href="#alert-thresholds">Alert Thresholds</a></h4>
<pre><code>Critical: User-facing impact, immediate action
Warning: Potential future impact, review during business hours
Info: FYI, no action required
</code></pre>
<h2 id="dashboard-design"><a class="header" href="#dashboard-design">Dashboard Design</a></h2>
<h3 id="key-principles"><a class="header" href="#key-principles">Key Principles</a></h3>
<ol>
<li><strong>Above the fold</strong>: Most important metrics visible without scrolling</li>
<li><strong>Consistent layout</strong>: Similar dashboards use same structure</li>
<li><strong>Clear labels</strong>: Descriptive titles and legends</li>
<li><strong>Appropriate time ranges</strong>: Match use case (1h for ops, 30d for trends)</li>
<li><strong>Color coding</strong>: Red for errors, yellow for warnings, green for OK</li>
</ol>
<h3 id="dashboard-types"><a class="header" href="#dashboard-types">Dashboard Types</a></h3>
<h4 id="overview-dashboard"><a class="header" href="#overview-dashboard">Overview Dashboard</a></h4>
<ul>
<li>Service health at a glance</li>
<li>Golden signals</li>
<li>Active alerts</li>
<li>Key business metrics</li>
</ul>
<h4 id="detail-dashboard"><a class="header" href="#detail-dashboard">Detail Dashboard</a></h4>
<ul>
<li>Deep dive into specific service</li>
<li>All relevant metrics</li>
<li>Logs integration</li>
<li>Trace links</li>
</ul>
<h4 id="slo-dashboard"><a class="header" href="#slo-dashboard">SLO Dashboard</a></h4>
<ul>
<li>SLI current values</li>
<li>SLO targets</li>
<li>Error budget remaining</li>
<li>Historical trends</li>
</ul>
<h2 id="tools-comparison"><a class="header" href="#tools-comparison">Tools Comparison</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Tool</th><th>Best For</th><th>Strengths</th><th>Limitations</th></tr></thead><tbody>
<tr><td>Prometheus</td><td>Metrics</td><td>Time-series, powerful queries</td><td>Limited long-term storage</td></tr>
<tr><td>Grafana</td><td>Visualization</td><td>Beautiful dashboards</td><td>Not a data source</td></tr>
<tr><td>ELK</td><td>Logs</td><td>Full-text search, scalable</td><td>Resource intensive</td></tr>
<tr><td>Jaeger</td><td>Tracing</td><td>Distributed tracing</td><td>Sampling overhead</td></tr>
<tr><td>Datadog</td><td>All-in-one</td><td>Integrated platform</td><td>Expensive</td></tr>
<tr><td>New Relic</td><td>APM</td><td>Easy setup, great UI</td><td>Cost scales with data</td></tr>
</tbody></table>
</div>
<h2 id="resources"><a class="header" href="#resources">Resources</a></h2>
<ul>
<li><a href="https://prometheus.io/docs/">Prometheus Documentation</a></li>
<li><a href="https://grafana.com/docs/">Grafana Documentation</a></li>
<li><a href="https://www.elastic.co/guide/">ELK Stack Guide</a></li>
<li><a href="https://opentelemetry.io/">OpenTelemetry</a></li>
<li><a href="https://sre.google/sre-book/table-of-contents/">Google SRE Book</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../devops/infrastructure.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../devops/terraform.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../devops/infrastructure.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../devops/terraform.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>

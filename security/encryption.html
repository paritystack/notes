<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Encryption - My Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-ae938929.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex-c422b50d.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-bd4efd9a.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">My Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="encryption"><a class="header" href="#encryption">Encryption</a></h1>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>Encryption converts readable data (plaintext) into unreadable data (ciphertext) using mathematical algorithms and keys. Only those with the correct key can decrypt it.</p>
<h2 id="types-of-encryption"><a class="header" href="#types-of-encryption">Types of Encryption</a></h2>
<h3 id="symmetric-encryption"><a class="header" href="#symmetric-encryption">Symmetric Encryption</a></h3>
<p>Same key encrypts and decrypts:</p>
<pre><code>Plaintext + Key  [Encrypt] &gt; Ciphertext
Ciphertext + Key  [Decrypt] &gt; Plaintext
</code></pre>
<p><strong>Algorithms</strong>:</p>
<ul>
<li><strong>AES</strong> (Advanced Encryption Standard): Industry standard, 128/192/256-bit keys</li>
<li><strong>ChaCha20-Poly1305</strong>: Modern, fast, authenticated encryption (AEAD)</li>
<li><strong>Blowfish</strong>: 64-bit blocks, 32-448 bit keys (legacy, use AES instead)</li>
<li><strong>Twofish</strong>: AES finalist, 128-bit blocks, up to 256-bit keys</li>
<li><strong>DES</strong>: Obsolete, 56-bit key (too short)</li>
<li><strong>3DES</strong>: Triple DES, more secure but slow (being phased out)</li>
</ul>
<p><strong>When to use</strong>: Database encryption, file encryption, internal communication</p>
<h3 id="asymmetric-encryption"><a class="header" href="#asymmetric-encryption">Asymmetric Encryption</a></h3>
<p>Different keys for encryption/decryption:</p>
<pre><code>Plaintext + Public Key  [Encrypt] &gt; Ciphertext
Ciphertext + Private Key  [Decrypt] &gt; Plaintext
</code></pre>
<p><strong>Algorithms</strong>:</p>
<ul>
<li><strong>RSA</strong>: Based on factoring difficulty, 2048/4096-bit keys</li>
<li><strong>ECC</strong> (Elliptic Curve): Shorter keys, same security as RSA</li>
<li><strong>EdDSA/Ed25519</strong>: Modern elliptic curve for signatures, very fast</li>
<li><strong>ECDSA</strong>: Elliptic Curve Digital Signature Algorithm</li>
<li><strong>Diffie-Hellman</strong>: Key exchange, not encryption</li>
</ul>
<p><strong>When to use</strong>: HTTPS, email encryption, digital signatures</p>
<h3 id="post-quantum-cryptography"><a class="header" href="#post-quantum-cryptography">Post-Quantum Cryptography</a></h3>
<p>Algorithms resistant to quantum computer attacks:</p>
<pre><code>Quantum computers threaten:
 RSA, ECC, Diffie-Hellman (based on factoring/discrete log)

Post-quantum alternatives:
 Lattice-based, hash-based, code-based
</code></pre>
<p><strong>NIST Standardized Algorithms</strong> (2024):</p>
<ul>
<li><strong>CRYSTALS-Kyber</strong>: Key encapsulation mechanism (KEM)</li>
<li><strong>CRYSTALS-Dilithium</strong>: Digital signatures</li>
<li><strong>SPHINCS+</strong>: Hash-based signatures (stateless)</li>
<li><strong>FALCON</strong>: Fast lattice-based signatures</li>
</ul>
<p><strong>Status</strong>: Transitioning to production (TLS 1.3, Signal Protocol adding support)</p>
<p><strong>When to use</strong>: Long-term secure data, forward-looking systems</p>
<h2 id="key-concepts"><a class="header" href="#key-concepts">Key Concepts</a></h2>
<h3 id="key-size"><a class="header" href="#key-size">Key Size</a></h3>
<pre><code>More bits = More security but slower

AES-128: 2^128 possible keys (feasible to break with quantum)
AES-256: 2^256 possible keys (quantum-resistant)
RSA-2048: H112-bit symmetric equivalent
ECC-256: H256-bit symmetric equivalent
</code></pre>
<h3 id="modes-of-operation-symmetric"><a class="header" href="#modes-of-operation-symmetric">Modes of Operation (Symmetric)</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Mode</th><th>Use</th><th>Properties</th></tr>
</thead>
<tbody>
<tr><td><strong>ECB</strong></td><td>L Never</td><td>Reveals patterns</td></tr>
<tr><td><strong>CBC</strong></td><td>File encryption</td><td>Needs IV, not parallel</td></tr>
<tr><td><strong>CTR</strong></td><td>Streaming</td><td>Parallelizable</td></tr>
<tr><td><strong>GCM</strong></td><td>Authenticated encryption</td><td>Authentication built-in</td></tr>
</tbody>
</table>
</div>
<h3 id="initialization-vector-iv"><a class="header" href="#initialization-vector-iv">Initialization Vector (IV)</a></h3>
<p>Random value ensuring same plaintext produces different ciphertext:</p>
<pre><code>Plaintext: "Hello"
IV1 + Key  [AES-CBC] &gt; "xK#$%"
IV2 + Key  [AES-CBC] &gt; "mN&amp;*@"  (different!)
</code></pre>
<h2 id="code-examples"><a class="header" href="#code-examples">Code Examples</a></h2>
<h3 id="python---symmetric-aes"><a class="header" href="#python---symmetric-aes">Python - Symmetric (AES)</a></h3>
<pre><code class="language-python">from cryptography.fernet import Fernet

# Generate key (keep secret!)
key = Fernet.generate_key()  # Save this securely
cipher = Fernet(key)

# Encrypt
plaintext = b"Secret message"
ciphertext = cipher.encrypt(plaintext)  # b'gAAAAABl...'

# Decrypt
plaintext = cipher.decrypt(ciphertext)  # b"Secret message"
</code></pre>
<h3 id="python---asymmetric-rsa"><a class="header" href="#python---asymmetric-rsa">Python - Asymmetric (RSA)</a></h3>
<pre><code class="language-python">from cryptography.hazmat.primitives.asymmetric import rsa, padding
from cryptography.hazmat.primitives import hashes

# Generate key pair
private_key = rsa.generate_private_key(
    public_exponent=65537,
    key_size=2048,
)
public_key = private_key.public_key()

# Encrypt with public key
ciphertext = public_key.encrypt(
    b"Secret",
    padding.OAEP(hashing=hashes.SHA256())
)

# Decrypt with private key
plaintext = private_key.decrypt(
    ciphertext,
    padding.OAEP(hashing=hashes.SHA256())
)
</code></pre>
<h3 id="javascript---aes-encryption"><a class="header" href="#javascript---aes-encryption">JavaScript - AES Encryption</a></h3>
<pre><code class="language-javascript">import crypto from 'crypto';

// Encrypt
const key = crypto.randomBytes(32);  // 256-bit key
const iv = crypto.randomBytes(16);   // 128-bit IV
const cipher = crypto.createCipheriv('aes-256-cbc', key, iv);

let ciphertext = cipher.update('Secret', 'utf8', 'hex');
ciphertext += cipher.final('hex');

// Decrypt
const decipher = crypto.createDecipheriv('aes-256-cbc', key, iv);
let plaintext = decipher.update(ciphertext, 'hex', 'utf8');
plaintext += decipher.final('utf8');
</code></pre>
<h3 id="go---aes-gcm-authenticated-encryption"><a class="header" href="#go---aes-gcm-authenticated-encryption">Go - AES-GCM Authenticated Encryption</a></h3>
<pre><code class="language-go">package main

import (
    "crypto/aes"
    "crypto/cipher"
    "crypto/rand"
    "io"
)

func encrypt(plaintext []byte, key []byte) ([]byte, error) {
    // Create cipher block
    block, err := aes.NewCipher(key) // key: 16, 24, or 32 bytes
    if err != nil {
        return nil, err
    }

    // Create GCM mode
    gcm, err := cipher.NewGCM(block)
    if err != nil {
        return nil, err
    }

    // Generate nonce
    nonce := make([]byte, gcm.NonceSize())
    if _, err := io.ReadFull(rand.Reader, nonce); err != nil {
        return nil, err
    }

    // Encrypt (nonce is prepended to ciphertext)
    ciphertext := gcm.Seal(nonce, nonce, plaintext, nil)
    return ciphertext, nil
}

func decrypt(ciphertext []byte, key []byte) ([]byte, error) {
    block, err := aes.NewCipher(key)
    if err != nil {
        return nil, err
    }

    gcm, err := cipher.NewGCM(block)
    if err != nil {
        return nil, err
    }

    // Extract nonce and decrypt
    nonceSize := gcm.NonceSize()
    nonce, ciphertext := ciphertext[:nonceSize], ciphertext[nonceSize:]

    plaintext, err := gcm.Open(nil, nonce, ciphertext, nil)
    return plaintext, err
}
</code></pre>
<h3 id="rust---chacha20-poly1305"><a class="header" href="#rust---chacha20-poly1305">Rust - ChaCha20-Poly1305</a></h3>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use chacha20poly1305::{
    aead::{Aead, KeyInit, OsRng},
    ChaCha20Poly1305, Nonce
};

fn encrypt_message(plaintext: &amp;[u8], key: &amp;[u8; 32]) -&gt; Result&lt;Vec&lt;u8&gt;, Box&lt;dyn Error&gt;&gt; {
    let cipher = ChaCha20Poly1305::new(key.into());

    // Generate random nonce (96 bits for ChaCha20Poly1305)
    let nonce = ChaCha20Poly1305::generate_nonce(&amp;mut OsRng);

    // Encrypt
    let ciphertext = cipher.encrypt(&amp;nonce, plaintext)
        .map_err(|e| format!("Encryption failed: {}", e))?;

    // Prepend nonce to ciphertext
    let mut result = nonce.to_vec();
    result.extend_from_slice(&amp;ciphertext);

    Ok(result)
}

fn decrypt_message(data: &amp;[u8], key: &amp;[u8; 32]) -&gt; Result&lt;Vec&lt;u8&gt;, Box&lt;dyn Error&gt;&gt; {
    let cipher = ChaCha20Poly1305::new(key.into());

    // Extract nonce and ciphertext
    let (nonce_bytes, ciphertext) = data.split_at(12);
    let nonce = Nonce::from_slice(nonce_bytes);

    // Decrypt
    let plaintext = cipher.decrypt(nonce, ciphertext)
        .map_err(|e| format!("Decryption failed: {}", e))?;

    Ok(plaintext)
}
<span class="boring">}</span></code></pre>
<h3 id="java---aes-encryption"><a class="header" href="#java---aes-encryption">Java - AES Encryption</a></h3>
<pre><code class="language-java">import javax.crypto.Cipher;
import javax.crypto.KeyGenerator;
import javax.crypto.SecretKey;
import javax.crypto.spec.GCMParameterSpec;
import javax.crypto.spec.SecretKeySpec;
import java.security.SecureRandom;

public class AESEncryption {
    private static final int GCM_TAG_LENGTH = 128;
    private static final int GCM_IV_LENGTH = 12;

    public static byte[] encrypt(byte[] plaintext, SecretKey key) throws Exception {
        Cipher cipher = Cipher.getInstance("AES/GCM/NoPadding");

        // Generate random IV
        byte[] iv = new byte[GCM_IV_LENGTH];
        SecureRandom random = new SecureRandom();
        random.nextBytes(iv);

        GCMParameterSpec parameterSpec = new GCMParameterSpec(GCM_TAG_LENGTH, iv);
        cipher.init(Cipher.ENCRYPT_MODE, key, parameterSpec);

        byte[] ciphertext = cipher.doFinal(plaintext);

        // Prepend IV to ciphertext
        byte[] encrypted = new byte[iv.length + ciphertext.length];
        System.arraycopy(iv, 0, encrypted, 0, iv.length);
        System.arraycopy(ciphertext, 0, encrypted, iv.length, ciphertext.length);

        return encrypted;
    }

    public static byte[] decrypt(byte[] encrypted, SecretKey key) throws Exception {
        // Extract IV and ciphertext
        byte[] iv = new byte[GCM_IV_LENGTH];
        System.arraycopy(encrypted, 0, iv, 0, iv.length);

        byte[] ciphertext = new byte[encrypted.length - GCM_IV_LENGTH];
        System.arraycopy(encrypted, GCM_IV_LENGTH, ciphertext, 0, ciphertext.length);

        Cipher cipher = Cipher.getInstance("AES/GCM/NoPadding");
        GCMParameterSpec parameterSpec = new GCMParameterSpec(GCM_TAG_LENGTH, iv);
        cipher.init(Cipher.DECRYPT_MODE, key, parameterSpec);

        return cipher.doFinal(ciphertext);
    }

    // Generate AES key
    public static SecretKey generateKey() throws Exception {
        KeyGenerator keyGen = KeyGenerator.getInstance("AES");
        keyGen.init(256); // 256-bit key
        return keyGen.generateKey();
    }
}
</code></pre>
<h3 id="hybrid-encryption-pattern"><a class="header" href="#hybrid-encryption-pattern">Hybrid Encryption Pattern</a></h3>
<p>Combining asymmetric and symmetric for performance:</p>
<pre><code class="language-python">from cryptography.hazmat.primitives.asymmetric import rsa, padding
from cryptography.hazmat.primitives import hashes, serialization
from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes
import os

def hybrid_encrypt(plaintext: bytes, recipient_public_key):
    # Generate random symmetric key
    symmetric_key = os.urandom(32)  # AES-256 key
    iv = os.urandom(16)

    # Encrypt data with symmetric key (fast)
    cipher = Cipher(algorithms.AES(symmetric_key), modes.CBC(iv))
    encryptor = cipher.encryptor()
    ciphertext = encryptor.update(plaintext) + encryptor.finalize()

    # Encrypt symmetric key with public key (small data)
    encrypted_key = recipient_public_key.encrypt(
        symmetric_key,
        padding.OAEP(
            mgf=padding.MGF1(algorithm=hashes.SHA256()),
            algorithm=hashes.SHA256(),
            label=None
        )
    )

    # Return: encrypted_key + iv + ciphertext
    return encrypted_key + iv + ciphertext

def hybrid_decrypt(encrypted_data: bytes, private_key):
    # Extract components
    key_size = private_key.key_size // 8
    encrypted_key = encrypted_data[:key_size]
    iv = encrypted_data[key_size:key_size+16]
    ciphertext = encrypted_data[key_size+16:]

    # Decrypt symmetric key
    symmetric_key = private_key.decrypt(
        encrypted_key,
        padding.OAEP(
            mgf=padding.MGF1(algorithm=hashes.SHA256()),
            algorithm=hashes.SHA256(),
            label=None
        )
    )

    # Decrypt data
    cipher = Cipher(algorithms.AES(symmetric_key), modes.CBC(iv))
    decryptor = cipher.decryptor()
    plaintext = decryptor.update(ciphertext) + decryptor.finalize()

    return plaintext
</code></pre>
<h2 id="common-algorithms-comparison"><a class="header" href="#common-algorithms-comparison">Common Algorithms Comparison</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Algorithm</th><th>Type</th><th>Speed</th><th>Security</th><th>Use Case</th></tr>
</thead>
<tbody>
<tr><td><strong>AES</strong></td><td>Symmetric</td><td>Fast</td><td>Very good</td><td>General encryption</td></tr>
<tr><td><strong>ChaCha20-Poly1305</strong></td><td>Symmetric</td><td>Very fast</td><td>Excellent</td><td>Mobile/streaming/AEAD</td></tr>
<tr><td><strong>Twofish</strong></td><td>Symmetric</td><td>Fast</td><td>Very good</td><td>Alternative to AES</td></tr>
<tr><td><strong>RSA</strong></td><td>Asymmetric</td><td>Slow</td><td>Good</td><td>Key exchange, signatures</td></tr>
<tr><td><strong>ECC</strong></td><td>Asymmetric</td><td>Medium</td><td>Excellent</td><td>HTTPS, signatures</td></tr>
<tr><td><strong>Ed25519</strong></td><td>Asymmetric</td><td>Fast</td><td>Excellent</td><td>Digital signatures</td></tr>
<tr><td><strong>CRYSTALS-Kyber</strong></td><td>Post-quantum</td><td>Medium</td><td>Quantum-resistant</td><td>Future-proof KEM</td></tr>
<tr><td><strong>DES</strong></td><td>Symmetric</td><td>Fast</td><td>L Broken</td><td>Legacy only</td></tr>
</tbody>
</table>
</div>
<h2 id="attacks-on-encryption"><a class="header" href="#attacks-on-encryption">Attacks on Encryption</a></h2>
<h3 id="brute-force"><a class="header" href="#brute-force">Brute Force</a></h3>
<p>Try all possible keys:</p>
<pre><code>Defense: Use strong key (256-bit AES)
Cost: 2^256 operations (infeasible)
</code></pre>
<h3 id="side-channel-attacks"><a class="header" href="#side-channel-attacks">Side-Channel Attacks</a></h3>
<p>Extract info from timing, power usage:</p>
<pre><code>Defense: Constant-time operations
</code></pre>
<h3 id="weak-random-number-generator"><a class="header" href="#weak-random-number-generator">Weak Random Number Generator</a></h3>
<p>Predictable keys:</p>
<pre><code>Defense: Use cryptographically secure RNG
</code></pre>
<h3 id="quantum-computing"><a class="header" href="#quantum-computing">Quantum Computing</a></h3>
<p>Threatens RSA, but not AES:</p>
<pre><code>Current RSA: 2048-bit
Post-quantum: Need other algorithms
AES-256: Still secure against quantum
</code></pre>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<h3 id="1-choose-right-algorithm"><a class="header" href="#1-choose-right-algorithm">1. Choose Right Algorithm</a></h3>
<pre><code> AES-256 for symmetric
 RSA-2048/ECC-256 for asymmetric
 DES, MD5, SHA-1 (deprecated)
</code></pre>
<h3 id="2-secure-key-storage"><a class="header" href="#2-secure-key-storage">2. Secure Key Storage</a></h3>
<pre><code class="language-python"># Bad: Hardcoded key
key = "supersecret123"

# Good: Load from secure storage
key = os.environ.get('ENCRYPTION_KEY')
# Or use key management service (AWS KMS, HashiCorp Vault)
</code></pre>
<h3 id="3-use-authenticated-encryption"><a class="header" href="#3-use-authenticated-encryption">3. Use Authenticated Encryption</a></h3>
<pre><code class="language-python"># Use modes that verify integrity (GCM, authenticated encryption)
# Don't just encrypt without authentication
</code></pre>
<h3 id="4-random-ivs"><a class="header" href="#4-random-ivs">4. Random IVs</a></h3>
<pre><code class="language-python"># Generate new IV for each encryption
iv = os.urandom(16)  # Different each time
</code></pre>
<h2 id="advanced-concepts"><a class="header" href="#advanced-concepts">Advanced Concepts</a></h2>
<h3 id="key-derivation-functions-kdf"><a class="header" href="#key-derivation-functions-kdf">Key Derivation Functions (KDF)</a></h3>
<p>Transforms weak key material into strong cryptographic keys:</p>
<pre><code>Purpose: Password → Strong encryption key
        Low-entropy → High-entropy
</code></pre>
<p><strong>Common KDFs</strong>:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Algorithm</th><th>Params</th><th>Best For</th><th>Notes</th></tr>
</thead>
<tbody>
<tr><td><strong>PBKDF2</strong></td><td>Iterations</td><td>General</td><td>Widely supported</td></tr>
<tr><td><strong>Argon2</strong></td><td>Memory, time, parallelism</td><td>Password hashing</td><td>Winner of PHC (2015)</td></tr>
<tr><td><strong>scrypt</strong></td><td>Memory, CPU</td><td>Key derivation</td><td>Memory-hard</td></tr>
<tr><td><strong>HKDF</strong></td><td>None</td><td>Key expansion</td><td>Fast, not for passwords</td></tr>
</tbody>
</table>
</div>
<p><strong>Python Example (PBKDF2)</strong>:</p>
<pre><code class="language-python">from cryptography.hazmat.primitives.kdf.pbkdf2 import PBKDF2HMAC
from cryptography.hazmat.primitives import hashes
import os

def derive_key(password: bytes, salt: bytes = None):
    if salt is None:
        salt = os.urandom(16)  # Generate random salt

    kdf = PBKDF2HMAC(
        algorithm=hashes.SHA256(),
        length=32,  # 256-bit key
        salt=salt,
        iterations=600_000,  # OWASP 2023 recommendation
    )

    key = kdf.derive(password)
    return key, salt
</code></pre>
<p><strong>Why KDFs?</strong>:</p>
<pre><code>Direct hash:  SHA256("password") = always same output (vulnerable)
With KDF:     PBKDF2("password", salt, 600k iter) = unique, slow to brute force
</code></pre>
<h3 id="password-hashing"><a class="header" href="#password-hashing">Password Hashing</a></h3>
<p><strong>Never encrypt passwords - hash them!</strong></p>
<pre><code>Encryption: Reversible (you can decrypt)
Hashing:    One-way (cannot reverse)
</code></pre>
<p><strong>Modern Password Hashing</strong> (use these):</p>
<pre><code class="language-python">import bcrypt
import argon2

# bcrypt (good)
password = b"user_password"
hashed = bcrypt.hashpw(password, bcrypt.gensalt(rounds=12))
# Verify
if bcrypt.checkpw(password, hashed):
    print("Valid password")

# Argon2 (better - memory-hard)
from argon2 import PasswordHasher
ph = PasswordHasher()
hash = ph.hash("user_password")
# Verify
try:
    ph.verify(hash, "user_password")
    print("Valid password")
except argon2.exceptions.VerifyMismatchError:
    print("Invalid password")
</code></pre>
<p><strong>Salt vs Pepper</strong>:</p>
<pre><code>Salt: Random per-password, stored with hash
      Prevents rainbow table attacks
      Example: $argon2id$v=19$m=65536...[salt][hash]

Pepper: Secret key, same for all passwords, stored separately
        Additional defense if database is compromised
        Example: HMAC(hash, pepper_key)
</code></pre>
<p><strong>Bad Practices</strong>:</p>
<pre><code class="language-python"># L Never do this
password_hash = hashlib.md5(password).hexdigest()  # Fast, no salt, broken
password_hash = hashlib.sha256(password).hexdigest()  # Fast, no salt

#  Do this
password_hash = argon2.hash(password)  # Slow, salted, memory-hard
</code></pre>
<h3 id="perfect-forward-secrecy-pfs"><a class="header" href="#perfect-forward-secrecy-pfs">Perfect Forward Secrecy (PFS)</a></h3>
<p>Ensures past communications remain secure even if long-term keys are compromised:</p>
<pre><code>Without PFS:
  Server private key compromised → All past traffic decrypted

With PFS:
  Server private key compromised → Past sessions still secure
  (Each session uses ephemeral keys that are destroyed)
</code></pre>
<p><strong>How it works</strong>:</p>
<pre><code>1. Each session generates temporary (ephemeral) key pair
2. Ephemeral keys used for that session only
3. Keys destroyed after session ends
4. Even if server key stolen later, old sessions safe
</code></pre>
<p><strong>TLS 1.3 with PFS</strong>:</p>
<pre><code>Client                                Server
  |                                     |
  | ClientHello (supported groups)      |
  |------------------------------------&gt;|
  |                                     |
  |     ServerHello (ephemeral key)     |
  |&lt;------------------------------------|
  |                                     |
Both derive session key from ephemeral Diffie-Hellman exchange
Ephemeral keys discarded after handshake
</code></pre>
<p><strong>Cipher suites with PFS</strong>:</p>
<ul>
<li><code>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</code> (ECDHE = ephemeral)</li>
<li><code>TLS_DHE_RSA_WITH_AES_256_GCM_SHA384</code></li>
</ul>
<p><strong>Without PFS</strong>:</p>
<ul>
<li><code>TLS_RSA_WITH_AES_128_CBC_SHA</code> (static RSA key)</li>
</ul>
<h3 id="homomorphic-encryption"><a class="header" href="#homomorphic-encryption">Homomorphic Encryption</a></h3>
<p>Allows computation on encrypted data without decrypting:</p>
<pre><code>Normal:
  Decrypt → Compute → Encrypt

Homomorphic:
  Compute directly on ciphertext
</code></pre>
<p><strong>Example</strong>:</p>
<pre><code>E(a) + E(b) = E(a + b)
E(a) × E(b) = E(a × b)

Cloud server can add encrypted numbers without seeing values!
</code></pre>
<p><strong>Types</strong>:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Type</th><th>Operations</th><th>Use Case</th></tr>
</thead>
<tbody>
<tr><td><strong>Partial</strong></td><td>Addition OR multiplication</td><td>Limited computation</td></tr>
<tr><td><strong>Somewhat</strong></td><td>Limited additions + multiplications</td><td>Simple functions</td></tr>
<tr><td><strong>Fully</strong></td><td>Unlimited operations</td><td>Any computation (slow)</td></tr>
</tbody>
</table>
</div>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Private cloud computing</li>
<li>Encrypted database queries</li>
<li>Secure voting systems</li>
<li>Medical data analysis (privacy-preserving)</li>
</ul>
<p><strong>Python Example</strong> (using tenseal for partial HE):</p>
<pre><code class="language-python">import tenseal as ts

# Setup context
context = ts.context(ts.SCHEME_TYPE.CKKS, poly_modulus_degree=8192, coeff_mod_bit_sizes=[60, 40, 40, 60])
context.global_scale = 2**40
context.generate_galois_keys()

# Encrypt
v1 = ts.ckks_vector(context, [1.5, 2.5, 3.5])
v2 = ts.ckks_vector(context, [4.0, 5.0, 6.0])

# Compute on encrypted data
result = v1 + v2  # Still encrypted!

# Decrypt
print(result.decrypt())  # [5.5, 7.5, 9.5]
</code></pre>
<p><strong>Limitations</strong>: Very slow (1000-1000000x slower than plaintext computation)</p>
<h3 id="zero-knowledge-proofs-zkp"><a class="header" href="#zero-knowledge-proofs-zkp">Zero-Knowledge Proofs (ZKP)</a></h3>
<p>Prove you know something without revealing what it is:</p>
<pre><code>Prover: "I know the password"
Verifier: "Prove it without telling me the password"
Prover: [sends proof]
Verifier: "Verified!"
</code></pre>
<p><strong>Properties</strong>:</p>
<ol>
<li><strong>Completeness</strong>: If true, honest verifier will be convinced</li>
<li><strong>Soundness</strong>: If false, cannot fool verifier</li>
<li><strong>Zero-knowledge</strong>: Verifier learns nothing except validity</li>
</ol>
<p><strong>Simple Example - Cave Analogy</strong>:</p>
<pre><code>     A ←─── Entrance
     │
     ├─────┐
     │     │
     B     C ← Secret door needs password

1. Prover enters cave, goes to B or C (verifier can't see)
2. Verifier asks prover to come out from random side (B or C)
3. If prover knows password, can always comply
4. Repeat many times → probability of cheating becomes negligible
5. Verifier convinced prover knows password, but didn't see it
</code></pre>
<p><strong>Real-World Uses</strong>:</p>
<ul>
<li><strong>Cryptocurrencies</strong>: Zcash (prove transaction validity without revealing amount)</li>
<li><strong>Authentication</strong>: Prove identity without revealing password</li>
<li><strong>Private voting</strong>: Prove vote is valid without revealing choice</li>
</ul>
<p><strong>zk-SNARKs</strong> (Zero-Knowledge Succinct Non-Interactive ARgument of Knowledge):</p>
<pre><code class="language-python"># Conceptual example (real implementation is complex)
# Prove you know x such that hash(x) = y, without revealing x

statement = "I know preimage of this hash"
proof = generate_proof(secret_x, public_hash_y)

# Verifier checks proof
is_valid = verify_proof(proof, public_hash_y)  # True, but doesn't learn x
</code></pre>
<p><strong>Modern ZKP Systems</strong>:</p>
<ul>
<li><strong>zk-SNARKs</strong>: Tiny proofs, fast verification (used in Zcash)</li>
<li><strong>zk-STARKs</strong>: Larger proofs, no trusted setup needed</li>
<li><strong>Bulletproofs</strong>: Short proofs, no trusted setup</li>
</ul>
<h2 id="key-exchange"><a class="header" href="#key-exchange">Key Exchange</a></h2>
<h3 id="diffie-hellman"><a class="header" href="#diffie-hellman">Diffie-Hellman</a></h3>
<p>Agree on shared secret over insecure channel:</p>
<pre><code>Alice: chooses a, sends: g^a mod p
Bob:   chooses b, sends: g^b mod p

Shared secret:
Alice: (g^b)^a mod p = g^ab mod p
Bob:   (g^a)^b mod p = g^ab mod p
</code></pre>
<h3 id="tls-handshake"><a class="header" href="#tls-handshake">TLS Handshake</a></h3>
<pre><code>1. Client hello
2. Server hello + certificate (contains public key)
3. Client generates pre-master secret, encrypts with public key
4. Both derive session key from pre-master secret
5. Encrypted communication begins
</code></pre>
<h2 id="practical-use-cases"><a class="header" href="#practical-use-cases">Practical Use Cases</a></h2>
<h3 id="1-password-storage--authentication"><a class="header" href="#1-password-storage--authentication">1. Password Storage &amp; Authentication</a></h3>
<p><strong>L NEVER store passwords in plaintext or encrypted form!</strong></p>
<pre><code class="language-python"># Backend password storage
from argon2 import PasswordHasher

class UserAuth:
    def __init__(self):
        self.ph = PasswordHasher()

    def register(self, username, password):
        # Hash password with Argon2
        password_hash = self.ph.hash(password)

        # Store in database
        save_to_db(username, password_hash)

    def login(self, username, password):
        # Retrieve hash from database
        stored_hash = get_from_db(username)

        try:
            # Verify password
            self.ph.verify(stored_hash, password)

            # Check if rehashing needed (params changed)
            if self.ph.check_needs_rehash(stored_hash):
                new_hash = self.ph.hash(password)
                update_db(username, new_hash)

            return True
        except:
            return False
</code></pre>
<p><strong>Database schema</strong>:</p>
<pre><code class="language-sql">CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,  -- e.g., $argon2id$v=19$m=65536...
    created_at TIMESTAMP DEFAULT NOW()
);
</code></pre>
<h3 id="2-end-to-end-encryption-e2ee"><a class="header" href="#2-end-to-end-encryption-e2ee">2. End-to-End Encryption (E2EE)</a></h3>
<p>Messaging app pattern where only sender and receiver can read messages:</p>
<pre><code class="language-python"># Signal Protocol simplified concept
from cryptography.hazmat.primitives.asymmetric import x25519
from cryptography.hazmat.primitives import serialization
import os

class E2EEMessaging:
    def __init__(self):
        # Each user has identity key pair
        self.private_key = x25519.X25519PrivateKey.generate()
        self.public_key = self.private_key.public_key()

    def send_message(self, recipient_public_key, message):
        # 1. Perform key exchange
        shared_secret = self.private_key.exchange(recipient_public_key)

        # 2. Derive encryption key from shared secret
        key, salt = derive_key(shared_secret)

        # 3. Encrypt message with AES-GCM
        from cryptography.hazmat.primitives.ciphers.aead import AESGCM
        aesgcm = AESGCM(key)
        nonce = os.urandom(12)
        ciphertext = aesgcm.encrypt(nonce, message.encode(), None)

        # 4. Send: nonce + ciphertext (server never sees plaintext)
        return nonce + ciphertext

    def receive_message(self, sender_public_key, encrypted_data):
        # 1. Perform same key exchange
        shared_secret = self.private_key.exchange(sender_public_key)

        # 2. Derive same encryption key
        key, _ = derive_key(shared_secret)

        # 3. Decrypt
        from cryptography.hazmat.primitives.ciphers.aead import AESGCM
        aesgcm = AESGCM(key)
        nonce = encrypted_data[:12]
        ciphertext = encrypted_data[12:]

        plaintext = aesgcm.decrypt(nonce, ciphertext, None)
        return plaintext.decode()
</code></pre>
<p><strong>Key properties</strong>:</p>
<ul>
<li>Server cannot read messages (no decryption key)</li>
<li>Each conversation has unique keys</li>
<li>Forward secrecy with ephemeral keys</li>
</ul>
<h3 id="3-database-field-encryption"><a class="header" href="#3-database-field-encryption">3. Database Field Encryption</a></h3>
<p>Encrypt sensitive fields while keeping database functional:</p>
<pre><code class="language-python">from cryptography.fernet import Fernet
import os

class EncryptedDatabase:
    def __init__(self):
        # Load encryption key from secure storage (KMS, env var, etc.)
        self.key = os.environ.get('DB_ENCRYPTION_KEY').encode()
        self.cipher = Fernet(self.key)

    def store_user(self, name, email, ssn, credit_card):
        # Encrypt sensitive fields
        encrypted_ssn = self.cipher.encrypt(ssn.encode())
        encrypted_cc = self.cipher.encrypt(credit_card.encode())

        # Store in database
        sql = """
            INSERT INTO users (name, email, ssn_encrypted, cc_encrypted)
            VALUES (%s, %s, %s, %s)
        """
        execute(sql, (name, email, encrypted_ssn, encrypted_cc))

    def get_user_sensitive_data(self, user_id):
        # Retrieve encrypted data
        result = query("SELECT ssn_encrypted, cc_encrypted FROM users WHERE id = %s", user_id)

        # Decrypt
        ssn = self.cipher.decrypt(result['ssn_encrypted']).decode()
        cc = self.cipher.decrypt(result['cc_encrypted']).decode()

        return {'ssn': ssn, 'credit_card': cc}
</code></pre>
<p><strong>When to use</strong>:</p>
<ul>
<li>Encrypt: SSN, credit cards, medical records, personal addresses</li>
<li>Don’t encrypt: Usernames, email (need to search), timestamps</li>
</ul>
<p><strong>Limitations</strong>:</p>
<ul>
<li>Cannot search on encrypted fields directly</li>
<li>Cannot use database indexes on encrypted data</li>
<li>Consider: Deterministic encryption for searchable fields (less secure)</li>
</ul>
<h3 id="4-file-encryption-at-rest"><a class="header" href="#4-file-encryption-at-rest">4. File Encryption at Rest</a></h3>
<p><strong>Full Disk Encryption</strong> vs <strong>File-Level Encryption</strong>:</p>
<pre><code>Full Disk (LUKS, BitLocker, FileVault):
  + Encrypts everything automatically
  + No application changes needed
  - Decrypted when system is running
  - All-or-nothing protection

File-Level:
  + Selective encryption
  + Files stay encrypted in memory
  - Must implement in application
</code></pre>
<p><strong>File encryption example</strong>:</p>
<pre><code class="language-python">from cryptography.fernet import Fernet
import os

def encrypt_file(input_path, output_path, key=None):
    if key is None:
        key = Fernet.generate_key()
        # Save key securely!
        with open('file.key', 'wb') as f:
            f.write(key)

    cipher = Fernet(key)

    # Read file
    with open(input_path, 'rb') as f:
        data = f.read()

    # Encrypt and write
    encrypted = cipher.encrypt(data)
    with open(output_path, 'wb') as f:
        f.write(encrypted)

    return key

def decrypt_file(input_path, output_path, key):
    cipher = Fernet(key)

    with open(input_path, 'rb') as f:
        encrypted = f.read()

    decrypted = cipher.decrypt(encrypted)

    with open(output_path, 'wb') as f:
        f.write(decrypted)

# Usage
key = encrypt_file('secret.pdf', 'secret.pdf.encrypted')
decrypt_file('secret.pdf.encrypted', 'secret_decrypted.pdf', key)
</code></pre>
<p><strong>Large file encryption</strong> (streaming):</p>
<pre><code class="language-python">from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes
import os

def encrypt_large_file(input_path, output_path, key):
    iv = os.urandom(16)
    cipher = Cipher(algorithms.AES(key), modes.CBC(iv))
    encryptor = cipher.encryptor()

    with open(input_path, 'rb') as infile, open(output_path, 'wb') as outfile:
        # Write IV first
        outfile.write(iv)

        # Encrypt in chunks
        while True:
            chunk = infile.read(64 * 1024)  # 64KB chunks
            if not chunk:
                break
            # Pad last chunk if needed
            if len(chunk) % 16 != 0:
                chunk += b'\0' * (16 - len(chunk) % 16)

            encrypted_chunk = encryptor.update(chunk)
            outfile.write(encrypted_chunk)

        outfile.write(encryptor.finalize())
</code></pre>
<h3 id="5-secure-api-communication"><a class="header" href="#5-secure-api-communication">5. Secure API Communication</a></h3>
<p><strong>API Key Encryption</strong>:</p>
<pre><code class="language-python">import hmac
import hashlib
import time

class APIAuth:
    def __init__(self, api_key, api_secret):
        self.api_key = api_key
        self.api_secret = api_secret

    def create_signature(self, method, endpoint, params):
        # Timestamp prevents replay attacks
        timestamp = str(int(time.time()))

        # Create message to sign
        message = f"{method}{endpoint}{timestamp}{params}"

        # HMAC signature
        signature = hmac.new(
            self.api_secret.encode(),
            message.encode(),
            hashlib.sha256
        ).hexdigest()

        return {
            'X-API-Key': self.api_key,
            'X-Timestamp': timestamp,
            'X-Signature': signature
        }

    def verify_signature(self, received_sig, method, endpoint, params, timestamp):
        # Prevent replay attacks (5 min window)
        if abs(int(time.time()) - int(timestamp)) &gt; 300:
            return False

        # Recreate signature
        message = f"{method}{endpoint}{timestamp}{params}"
        expected_sig = hmac.new(
            self.api_secret.encode(),
            message.encode(),
            hashlib.sha256
        ).hexdigest()

        # Constant-time comparison
        return hmac.compare_digest(expected_sig, received_sig)

# Usage
auth = APIAuth('key_abc123', 'secret_xyz789')
headers = auth.create_signature('POST', '/api/users', '{"name":"Alice"}')
</code></pre>
<p><strong>JWT (JSON Web Tokens)</strong>:</p>
<pre><code class="language-python">import jwt
from datetime import datetime, timedelta

SECRET_KEY = "your-secret-key"  # Store securely!

def create_token(user_id, role):
    payload = {
        'user_id': user_id,
        'role': role,
        'exp': datetime.utcnow() + timedelta(hours=24),  # Expires in 24h
        'iat': datetime.utcnow()  # Issued at
    }

    token = jwt.encode(payload, SECRET_KEY, algorithm='HS256')
    return token

def verify_token(token):
    try:
        payload = jwt.decode(token, SECRET_KEY, algorithms=['HS256'])
        return payload
    except jwt.ExpiredSignatureError:
        return None  # Token expired
    except jwt.InvalidTokenError:
        return None  # Invalid token
</code></pre>
<h3 id="6-backup-encryption"><a class="header" href="#6-backup-encryption">6. Backup Encryption</a></h3>
<p>Encrypt backups with key management strategy:</p>
<pre><code class="language-python">import tarfile
import os
from cryptography.fernet import Fernet
from cryptography.hazmat.primitives.kdf.pbkdf2 import PBKDF2HMAC
from cryptography.hazmat.primitives import hashes

def create_encrypted_backup(source_dir, backup_path, password):
    # 1. Create tar archive
    tar_path = backup_path + '.tar'
    with tarfile.open(tar_path, 'w') as tar:
        tar.add(source_dir, arcname='.')

    # 2. Derive key from password
    salt = os.urandom(16)
    kdf = PBKDF2HMAC(
        algorithm=hashes.SHA256(),
        length=32,
        salt=salt,
        iterations=600_000,
    )
    key = base64.urlsafe_b64encode(kdf.derive(password.encode()))
    cipher = Fernet(key)

    # 3. Encrypt tar file
    with open(tar_path, 'rb') as f:
        data = f.read()

    encrypted = cipher.encrypt(data)

    # 4. Write salt + encrypted data
    with open(backup_path + '.encrypted', 'wb') as f:
        f.write(salt)
        f.write(encrypted)

    # 5. Clean up tar file
    os.remove(tar_path)

    print(f"Backup created: {backup_path}.encrypted")
    print("IMPORTANT: Store your password securely!")

def restore_encrypted_backup(backup_path, restore_dir, password):
    with open(backup_path, 'rb') as f:
        salt = f.read(16)
        encrypted = f.read()

    # Derive key
    kdf = PBKDF2HMAC(
        algorithm=hashes.SHA256(),
        length=32,
        salt=salt,
        iterations=600_000,
    )
    key = base64.urlsafe_b64encode(kdf.derive(password.encode()))
    cipher = Fernet(key)

    # Decrypt
    data = cipher.decrypt(encrypted)

    # Extract tar
    tar_path = 'temp_restore.tar'
    with open(tar_path, 'wb') as f:
        f.write(data)

    with tarfile.open(tar_path, 'r') as tar:
        tar.extractall(restore_dir)

    os.remove(tar_path)
</code></pre>
<p><strong>Key Management Strategies</strong>:</p>
<pre><code>1. Password-based:
    User password → KDF → Encryption key
    Pros: Simple, no key storage
    Cons: Forget password = lose data

2. Key splitting:
    Key split into parts, stored separately
    Example: Part A in code, Part B in env var, Part C in vault
    Pros: Multiple points of failure needed
    Cons: Complex

3. Cloud KMS (AWS KMS, Google Cloud KMS):
    Master key in cloud HSM
    Pros: Managed, audited, rotatable
    Cons: Dependency on cloud provider

4. Hardware Security Module (HSM):
    Keys stored in tamper-proof hardware
    Pros: Highest security
    Cons: Expensive
</code></pre>
<h2 id="eli10"><a class="header" href="#eli10">ELI10</a></h2>
<p>Think of encryption as a locked box:</p>
<p><strong>Symmetric</strong>:</p>
<ul>
<li>Same key locks and unlocks</li>
<li>Fast but you need to share the key somehow</li>
<li>Like: “Secret code 42” for both locking and unlocking</li>
</ul>
<p><strong>Asymmetric</strong>:</p>
<ul>
<li>Public key locks, private key unlocks</li>
<li>Like: Anyone can put a message in a mailbox (public), but only owner has the key (private)</li>
</ul>
<p><strong>Why both?</strong>:</p>
<ul>
<li>Asymmetric slower but solves key-sharing problem</li>
<li>Use asymmetric to exchange a symmetric key</li>
<li>Then use fast symmetric key for actual data</li>
</ul>
<h2 id="further-resources"><a class="header" href="#further-resources">Further Resources</a></h2>
<ul>
<li><a href="https://cryptography.io/">Cryptography.io Python</a></li>
<li><a href="https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html">OWASP Encryption Cheatsheet</a></li>
<li><a href="https://www.youtube.com/watch?v=Z8M2BTscoD4">3Blue1Brown Public Key Cryptography</a></li>
<li><a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES Explained</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../security/hashing.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../security/digital_signatures.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../security/hashing.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../security/digital_signatures.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-c2a407aa.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>

<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Flask - My Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">My Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="flask"><a class="header" href="#flask">Flask</a></h1>
<p>Flask is a lightweight WSGI web application framework for Python. It's designed to make getting started quick and easy, with the ability to scale up to complex applications. Flask is often called a "microframework" because it doesn't require particular tools or libraries, giving developers flexibility in choosing their tools and architecture.</p>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#installation-and-setup">Installation and Setup</a></li>
<li><a href="#basic-application">Basic Application</a></li>
<li><a href="#routing">Routing</a></li>
<li><a href="#request-and-response">Request and Response</a></li>
<li><a href="#templates-with-jinja2">Templates with Jinja2</a></li>
<li><a href="#forms-and-validation">Forms and Validation</a></li>
<li><a href="#database-integration">Database Integration</a></li>
<li><a href="#authentication">Authentication</a></li>
<li><a href="#restful-apis">RESTful APIs</a></li>
<li><a href="#blueprints">Blueprints</a></li>
<li><a href="#error-handling">Error Handling</a></li>
<li><a href="#file-uploads">File Uploads</a></li>
<li><a href="#testing">Testing</a></li>
<li><a href="#best-practices">Best Practices</a></li>
<li><a href="#production-deployment">Production Deployment</a></li>
</ul>
<hr />
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p><strong>Key Features:</strong></p>
<ul>
<li>Minimal core with extensions for added functionality</li>
<li>Built-in development server and debugger</li>
<li>Integrated unit testing support</li>
<li>RESTful request dispatching</li>
<li>Jinja2 templating engine</li>
<li>Secure cookies for client-side sessions</li>
<li>WSGI 1.0 compliant</li>
<li>Unicode-based</li>
<li>Extensive documentation</li>
<li>Active community</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>RESTful APIs</li>
<li>Microservices</li>
<li>Prototypes and MVPs</li>
<li>Small to medium web applications</li>
<li>Backend for single-page applications</li>
<li>Data science dashboards</li>
<li>Webhook handlers</li>
<li>Static sites with dynamic content</li>
</ul>
<p><strong>Philosophy:</strong></p>
<ul>
<li>Simplicity and flexibility</li>
<li>Explicit over implicit</li>
<li>Start small, scale when needed</li>
<li>No forced dependencies</li>
<li>Easy to extend</li>
</ul>
<hr />
<h2 id="installation-and-setup"><a class="header" href="#installation-and-setup">Installation and Setup</a></h2>
<h3 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h3>
<pre><code class="language-bash"># Python 3.7+ required
python3 --version
pip --version
</code></pre>
<h3 id="virtual-environment"><a class="header" href="#virtual-environment">Virtual Environment</a></h3>
<pre><code class="language-bash"># Create virtual environment
python3 -m venv venv

# Activate virtual environment
# Linux/Mac:
source venv/bin/activate
# Windows:
# venv\Scripts\activate

# Upgrade pip
pip install --upgrade pip
</code></pre>
<h3 id="install-flask"><a class="header" href="#install-flask">Install Flask</a></h3>
<pre><code class="language-bash"># Install Flask
pip install Flask

# Install common extensions
pip install Flask-SQLAlchemy Flask-Migrate Flask-Login Flask-WTF
pip install Flask-CORS Flask-JWT-Extended python-dotenv
</code></pre>
<h3 id="project-structure"><a class="header" href="#project-structure">Project Structure</a></h3>
<pre><code>flask-app/
├── app/
│   ├── __init__.py
│   ├── models.py
│   ├── routes.py
│   ├── forms.py
│   ├── templates/
│   │   ├── base.html
│   │   └── index.html
│   ├── static/
│   │   ├── css/
│   │   ├── js/
│   │   └── images/
│   └── blueprints/
│       ├── auth/
│       └── api/
├── tests/
│   └── test_routes.py
├── migrations/
├── config.py
├── .env
├── .flaskenv
├── requirements.txt
└── run.py
</code></pre>
<hr />
<h2 id="basic-application"><a class="header" href="#basic-application">Basic Application</a></h2>
<h3 id="minimal-flask-app"><a class="header" href="#minimal-flask-app">Minimal Flask App</a></h3>
<pre><code class="language-python">from flask import Flask

app = Flask(__name__)

@app.route('/')
def hello():
    return 'Hello, World!'

if __name__ == '__main__':
    app.run(debug=True)
</code></pre>
<h3 id="application-factory-pattern"><a class="header" href="#application-factory-pattern">Application Factory Pattern</a></h3>
<p><strong>app/<strong>init</strong>.py:</strong></p>
<pre><code class="language-python">from flask import Flask
from flask_sqlalchemy import SQLAlchemy
from flask_migrate import Migrate
from flask_login import LoginManager
from config import Config

db = SQLAlchemy()
migrate = Migrate()
login_manager = LoginManager()

def create_app(config_class=Config):
    app = Flask(__name__)
    app.config.from_object(config_class)

    # Initialize extensions
    db.init_app(app)
    migrate.init_app(app, db)
    login_manager.init_app(app)
    login_manager.login_view = 'auth.login'

    # Register blueprints
    from app.blueprints.auth import auth_bp
    from app.blueprints.main import main_bp
    from app.blueprints.api import api_bp

    app.register_blueprint(auth_bp, url_prefix='/auth')
    app.register_blueprint(main_bp)
    app.register_blueprint(api_bp, url_prefix='/api')

    return app

from app import models
</code></pre>
<p><strong>config.py:</strong></p>
<pre><code class="language-python">import os
from dotenv import load_dotenv

basedir = os.path.abspath(os.path.dirname(__file__))
load_dotenv(os.path.join(basedir, '.env'))

class Config:
    SECRET_KEY = os.environ.get('SECRET_KEY') or 'dev-secret-key'
    SQLALCHEMY_DATABASE_URI = os.environ.get('DATABASE_URL') or \
        'sqlite:///' + os.path.join(basedir, 'app.db')
    SQLALCHEMY_TRACK_MODIFICATIONS = False

    # File upload settings
    UPLOAD_FOLDER = os.path.join(basedir, 'uploads')
    MAX_CONTENT_LENGTH = 16 * 1024 * 1024  # 16MB max file size

class DevelopmentConfig(Config):
    DEBUG = True

class ProductionConfig(Config):
    DEBUG = False

class TestingConfig(Config):
    TESTING = True
    SQLALCHEMY_DATABASE_URI = 'sqlite:///:memory:'
</code></pre>
<p><strong>run.py:</strong></p>
<pre><code class="language-python">from app import create_app, db
from app.models import User, Post

app = create_app()

@app.shell_context_processor
def make_shell_context():
    return {'db': db, 'User': User, 'Post': Post}

if __name__ == '__main__':
    app.run(debug=True)
</code></pre>
<hr />
<h2 id="routing"><a class="header" href="#routing">Routing</a></h2>
<h3 id="basic-routes"><a class="header" href="#basic-routes">Basic Routes</a></h3>
<pre><code class="language-python">from flask import Flask

app = Flask(__name__)

@app.route('/')
def index():
    return 'Home Page'

@app.route('/about')
def about():
    return 'About Page'

# Route with variable
@app.route('/user/&lt;username&gt;')
def show_user(username):
    return f'User: {username}'

# Route with type converter
@app.route('/post/&lt;int:post_id&gt;')
def show_post(post_id):
    return f'Post ID: {post_id}'

# Route with multiple types
@app.route('/path/&lt;path:subpath&gt;')
def show_subpath(subpath):
    return f'Subpath: {subpath}'
</code></pre>
<h3 id="http-methods"><a class="header" href="#http-methods">HTTP Methods</a></h3>
<pre><code class="language-python">from flask import request, jsonify

@app.route('/login', methods=['GET', 'POST'])
def login():
    if request.method == 'POST':
        username = request.form.get('username')
        password = request.form.get('password')
        # Process login
        return {'message': 'Login successful'}
    return 'Login form'

# Separate methods
@app.get('/users')
def get_users():
    return jsonify([])

@app.post('/users')
def create_user():
    data = request.get_json()
    return jsonify(data), 201

@app.put('/users/&lt;int:id&gt;')
def update_user(id):
    data = request.get_json()
    return jsonify(data)

@app.delete('/users/&lt;int:id&gt;')
def delete_user(id):
    return '', 204
</code></pre>
<h3 id="url-building"><a class="header" href="#url-building">URL Building</a></h3>
<pre><code class="language-python">from flask import url_for, redirect

@app.route('/admin')
def admin():
    return 'Admin Page'

@app.route('/redirect-to-admin')
def redirect_to_admin():
    return redirect(url_for('admin'))

@app.route('/user/&lt;username&gt;')
def profile(username):
    return f'Profile: {username}'

# Generate URL
with app.test_request_context():
    print(url_for('admin'))  # /admin
    print(url_for('profile', username='john'))  # /user/john
    print(url_for('static', filename='style.css'))  # /static/style.css
</code></pre>
<hr />
<h2 id="request-and-response"><a class="header" href="#request-and-response">Request and Response</a></h2>
<h3 id="request-object"><a class="header" href="#request-object">Request Object</a></h3>
<pre><code class="language-python">from flask import request, jsonify

@app.route('/search')
def search():
    # Query parameters
    query = request.args.get('q', '')
    page = request.args.get('page', 1, type=int)

    return f'Searching for: {query}, Page: {page}'

@app.route('/submit', methods=['POST'])
def submit():
    # Form data
    name = request.form.get('name')
    email = request.form.get('email')

    # JSON data
    if request.is_json:
        data = request.get_json()
        name = data.get('name')
        email = data.get('email')

    # Files
    if 'file' in request.files:
        file = request.files['file']
        if file.filename:
            file.save(f'uploads/{file.filename}')

    # Headers
    user_agent = request.headers.get('User-Agent')
    auth_token = request.headers.get('Authorization')

    # Cookies
    session_id = request.cookies.get('session_id')

    return jsonify({
        'name': name,
        'email': email,
        'user_agent': user_agent
    })
</code></pre>
<h3 id="response-object"><a class="header" href="#response-object">Response Object</a></h3>
<pre><code class="language-python">from flask import make_response, jsonify, render_template, send_file

@app.route('/json')
def json_response():
    return jsonify({
        'status': 'success',
        'data': {'id': 1, 'name': 'John'}
    })

@app.route('/custom')
def custom_response():
    response = make_response('Custom response', 200)
    response.headers['X-Custom-Header'] = 'Value'
    response.set_cookie('user_id', '123', max_age=3600)
    return response

@app.route('/download')
def download():
    return send_file('path/to/file.pdf', as_attachment=True)

@app.route('/stream')
def stream():
    def generate():
        for i in range(10):
            yield f'data: {i}\n\n'

    return app.response_class(generate(), mimetype='text/event-stream')
</code></pre>
<hr />
<h2 id="templates-with-jinja2"><a class="header" href="#templates-with-jinja2">Templates with Jinja2</a></h2>
<h3 id="base-template"><a class="header" href="#base-template">Base Template</a></h3>
<p><strong>templates/base.html:</strong></p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;{% block title %}My App{% endblock %}&lt;/title&gt;
    &lt;link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}"&gt;
    {% block extra_css %}{% endblock %}
&lt;/head&gt;
&lt;body&gt;
    &lt;nav&gt;
        &lt;a href="{{ url_for('index') }}"&gt;Home&lt;/a&gt;
        {% if current_user.is_authenticated %}
            &lt;a href="{{ url_for('profile') }}"&gt;Profile&lt;/a&gt;
            &lt;a href="{{ url_for('logout') }}"&gt;Logout&lt;/a&gt;
        {% else %}
            &lt;a href="{{ url_for('login') }}"&gt;Login&lt;/a&gt;
            &lt;a href="{{ url_for('register') }}"&gt;Register&lt;/a&gt;
        {% endif %}
    &lt;/nav&gt;

    &lt;main&gt;
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    &lt;div class="alert alert-{{ category }}"&gt;{{ message }}&lt;/div&gt;
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    &lt;/main&gt;

    &lt;footer&gt;
        &lt;p&gt;&amp;copy; 2024 My App&lt;/p&gt;
    &lt;/footer&gt;

    &lt;script src="{{ url_for('static', filename='js/main.js') }}"&gt;&lt;/script&gt;
    {% block extra_js %}{% endblock %}
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h3 id="child-template"><a class="header" href="#child-template">Child Template</a></h3>
<p><strong>templates/index.html:</strong></p>
<pre><code class="language-html">{% extends 'base.html' %}

{% block title %}Home - {{ super() }}{% endblock %}

{% block content %}
&lt;h1&gt;Welcome to {{ app_name }}&lt;/h1&gt;

{% if users %}
    &lt;ul&gt;
    {% for user in users %}
        &lt;li&gt;
            &lt;a href="{{ url_for('show_user', username=user.username) }}"&gt;
                {{ user.username }}
            &lt;/a&gt;
            {% if user.is_admin %}
                &lt;span class="badge"&gt;Admin&lt;/span&gt;
            {% endif %}
        &lt;/li&gt;
    {% endfor %}
    &lt;/ul&gt;
{% else %}
    &lt;p&gt;No users found.&lt;/p&gt;
{% endif %}

&lt;!-- Macros --&gt;
{% macro render_user(user) %}
    &lt;div class="user-card"&gt;
        &lt;h3&gt;{{ user.username }}&lt;/h3&gt;
        &lt;p&gt;{{ user.email }}&lt;/p&gt;
    &lt;/div&gt;
{% endmacro %}

{% for user in users %}
    {{ render_user(user) }}
{% endfor %}
{% endblock %}
</code></pre>
<h3 id="template-filters-and-functions"><a class="header" href="#template-filters-and-functions">Template Filters and Functions</a></h3>
<pre><code class="language-python">from flask import Flask
from datetime import datetime

app = Flask(__name__)

@app.template_filter('datetimeformat')
def datetimeformat(value, format='%Y-%m-%d %H:%M'):
    return value.strftime(format)

@app.template_filter('currency')
def currency(value):
    return f'${value:,.2f}'

@app.context_processor
def utility_processor():
    def format_price(amount):
        return f'${amount:,.2f}'

    return dict(format_price=format_price)

# Usage in template:
# {{ order.created_at|datetimeformat }}
# {{ product.price|currency }}
# {{ format_price(100.50) }}
</code></pre>
<hr />
<h2 id="forms-and-validation"><a class="header" href="#forms-and-validation">Forms and Validation</a></h2>
<h3 id="flask-wtf-forms"><a class="header" href="#flask-wtf-forms">Flask-WTF Forms</a></h3>
<pre><code class="language-python">from flask_wtf import FlaskForm
from wtforms import StringField, PasswordField, TextAreaField, SelectField, BooleanField
from wtforms.validators import DataRequired, Email, Length, EqualTo, ValidationError
from app.models import User

class RegistrationForm(FlaskForm):
    username = StringField('Username',
                         validators=[DataRequired(), Length(min=3, max=20)])
    email = StringField('Email',
                       validators=[DataRequired(), Email()])
    password = PasswordField('Password',
                           validators=[DataRequired(), Length(min=8)])
    confirm_password = PasswordField('Confirm Password',
                                   validators=[DataRequired(), EqualTo('password')])

    def validate_username(self, username):
        user = User.query.filter_by(username=username.data).first()
        if user:
            raise ValidationError('Username already exists')

    def validate_email(self, email):
        user = User.query.filter_by(email=email.data).first()
        if user:
            raise ValidationError('Email already registered')

class LoginForm(FlaskForm):
    email = StringField('Email', validators=[DataRequired(), Email()])
    password = PasswordField('Password', validators=[DataRequired()])
    remember = BooleanField('Remember Me')

class PostForm(FlaskForm):
    title = StringField('Title', validators=[DataRequired(), Length(max=100)])
    content = TextAreaField('Content', validators=[DataRequired()])
    category = SelectField('Category', coerce=int)

    def __init__(self, *args, **kwargs):
        super(PostForm, self).__init__(*args, **kwargs)
        from app.models import Category
        self.category.choices = [(c.id, c.name) for c in Category.query.all()]
</code></pre>
<h3 id="form-handling-in-views"><a class="header" href="#form-handling-in-views">Form Handling in Views</a></h3>
<pre><code class="language-python">from flask import render_template, redirect, url_for, flash
from app import db
from app.forms import RegistrationForm, LoginForm
from app.models import User

@app.route('/register', methods=['GET', 'POST'])
def register():
    form = RegistrationForm()

    if form.validate_on_submit():
        user = User(username=form.username.data, email=form.email.data)
        user.set_password(form.password.data)
        db.session.add(user)
        db.session.commit()

        flash('Registration successful!', 'success')
        return redirect(url_for('login'))

    return render_template('register.html', form=form)

@app.route('/login', methods=['GET', 'POST'])
def login():
    form = LoginForm()

    if form.validate_on_submit():
        user = User.query.filter_by(email=form.email.data).first()

        if user and user.check_password(form.password.data):
            login_user(user, remember=form.remember.data)
            flash('Login successful!', 'success')

            next_page = request.args.get('next')
            return redirect(next_page) if next_page else redirect(url_for('index'))

        flash('Invalid email or password', 'danger')

    return render_template('login.html', form=form)
</code></pre>
<h3 id="form-template"><a class="header" href="#form-template">Form Template</a></h3>
<p><strong>templates/register.html:</strong></p>
<pre><code class="language-html">{% extends 'base.html' %}

{% block content %}
&lt;h2&gt;Register&lt;/h2&gt;
&lt;form method="POST" novalidate&gt;
    {{ form.hidden_tag() }}

    &lt;div class="form-group"&gt;
        {{ form.username.label }}
        {{ form.username(class='form-control') }}
        {% if form.username.errors %}
            &lt;div class="errors"&gt;
                {% for error in form.username.errors %}
                    &lt;span&gt;{{ error }}&lt;/span&gt;
                {% endfor %}
            &lt;/div&gt;
        {% endif %}
    &lt;/div&gt;

    &lt;div class="form-group"&gt;
        {{ form.email.label }}
        {{ form.email(class='form-control') }}
        {% if form.email.errors %}
            &lt;div class="errors"&gt;
                {% for error in form.email.errors %}
                    &lt;span&gt;{{ error }}&lt;/span&gt;
                {% endfor %}
            &lt;/div&gt;
        {% endif %}
    &lt;/div&gt;

    &lt;div class="form-group"&gt;
        {{ form.password.label }}
        {{ form.password(class='form-control') }}
        {% if form.password.errors %}
            &lt;div class="errors"&gt;
                {% for error in form.password.errors %}
                    &lt;span&gt;{{ error }}&lt;/span&gt;
                {% endfor %}
            &lt;/div&gt;
        {% endif %}
    &lt;/div&gt;

    &lt;div class="form-group"&gt;
        {{ form.confirm_password.label }}
        {{ form.confirm_password(class='form-control') }}
    &lt;/div&gt;

    &lt;button type="submit" class="btn btn-primary"&gt;Register&lt;/button&gt;
&lt;/form&gt;
{% endblock %}
</code></pre>
<hr />
<h2 id="database-integration"><a class="header" href="#database-integration">Database Integration</a></h2>
<h3 id="sqlalchemy-models"><a class="header" href="#sqlalchemy-models">SQLAlchemy Models</a></h3>
<p><strong>app/models.py:</strong></p>
<pre><code class="language-python">from app import db, login_manager
from datetime import datetime
from werkzeug.security import generate_password_hash, check_password_hash
from flask_login import UserMixin

@login_manager.user_loader
def load_user(user_id):
    return User.query.get(int(user_id))

class User(UserMixin, db.Model):
    id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String(80), unique=True, nullable=False, index=True)
    email = db.Column(db.String(120), unique=True, nullable=False, index=True)
    password_hash = db.Column(db.String(128))
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    posts = db.relationship('Post', backref='author', lazy='dynamic')

    def set_password(self, password):
        self.password_hash = generate_password_hash(password)

    def check_password(self, password):
        return check_password_hash(self.password_hash, password)

    def __repr__(self):
        return f'&lt;User {self.username}&gt;'

class Post(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    title = db.Column(db.String(100), nullable=False)
    content = db.Column(db.Text, nullable=False)
    slug = db.Column(db.String(120), unique=True, index=True)
    published = db.Column(db.Boolean, default=False)
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    updated_at = db.Column(db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)
    category_id = db.Column(db.Integer, db.ForeignKey('category.id'))

    def __repr__(self):
        return f'&lt;Post {self.title}&gt;'

class Category(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(50), unique=True, nullable=False)
    posts = db.relationship('Post', backref='category', lazy=True)
</code></pre>
<h3 id="database-operations"><a class="header" href="#database-operations">Database Operations</a></h3>
<pre><code class="language-python">from app import db
from app.models import User, Post

# Create
user = User(username='john', email='john@example.com')
user.set_password('password123')
db.session.add(user)
db.session.commit()

# Read
users = User.query.all()
user = User.query.filter_by(username='john').first()
user = User.query.get(1)
posts = Post.query.filter_by(published=True).order_by(Post.created_at.desc()).all()

# Update
user = User.query.get(1)
user.email = 'newemail@example.com'
db.session.commit()

# Delete
user = User.query.get(1)
db.session.delete(user)
db.session.commit()

# Complex queries
from sqlalchemy import or_, and_

posts = Post.query.filter(
    or_(
        Post.title.like('%python%'),
        Post.content.like('%python%')
    ),
    Post.published == True
).all()

# Pagination
page = request.args.get('page', 1, type=int)
posts = Post.query.order_by(Post.created_at.desc()).paginate(
    page=page, per_page=10, error_out=False
)
</code></pre>
<h3 id="migrations"><a class="header" href="#migrations">Migrations</a></h3>
<pre><code class="language-bash"># Initialize migrations
flask db init

# Create migration
flask db migrate -m "Add user table"

# Apply migration
flask db upgrade

# Rollback
flask db downgrade
</code></pre>
<hr />
<h2 id="authentication"><a class="header" href="#authentication">Authentication</a></h2>
<h3 id="flask-login-setup"><a class="header" href="#flask-login-setup">Flask-Login Setup</a></h3>
<pre><code class="language-python">from flask_login import LoginManager, login_user, logout_user, login_required, current_user
from app import app, db
from app.models import User

login_manager = LoginManager()
login_manager.init_app(app)
login_manager.login_view = 'login'
login_manager.login_message = 'Please log in to access this page.'

@login_manager.user_loader
def load_user(user_id):
    return User.query.get(int(user_id))

@app.route('/login', methods=['GET', 'POST'])
def login():
    if current_user.is_authenticated:
        return redirect(url_for('index'))

    form = LoginForm()
    if form.validate_on_submit():
        user = User.query.filter_by(email=form.email.data).first()

        if user and user.check_password(form.password.data):
            login_user(user, remember=form.remember.data)
            next_page = request.args.get('next')
            return redirect(next_page) if next_page else redirect(url_for('index'))

        flash('Invalid email or password', 'danger')

    return render_template('login.html', form=form)

@app.route('/logout')
@login_required
def logout():
    logout_user()
    flash('You have been logged out', 'info')
    return redirect(url_for('index'))

@app.route('/profile')
@login_required
def profile():
    return render_template('profile.html', user=current_user)
</code></pre>
<h3 id="jwt-authentication"><a class="header" href="#jwt-authentication">JWT Authentication</a></h3>
<pre><code class="language-python">from flask_jwt_extended import JWTManager, create_access_token, jwt_required, get_jwt_identity

app.config['JWT_SECRET_KEY'] = 'your-secret-key'
jwt = JWTManager(app)

@app.route('/api/auth/login', methods=['POST'])
def api_login():
    data = request.get_json()
    email = data.get('email')
    password = data.get('password')

    user = User.query.filter_by(email=email).first()

    if user and user.check_password(password):
        access_token = create_access_token(identity=user.id)
        return jsonify(access_token=access_token), 200

    return jsonify({'message': 'Invalid credentials'}), 401

@app.route('/api/protected', methods=['GET'])
@jwt_required()
def protected():
    current_user_id = get_jwt_identity()
    user = User.query.get(current_user_id)
    return jsonify(username=user.username), 200
</code></pre>
<hr />
<h2 id="restful-apis"><a class="header" href="#restful-apis">RESTful APIs</a></h2>
<h3 id="flask-restful"><a class="header" href="#flask-restful">Flask-RESTful</a></h3>
<pre><code class="language-python">from flask import Flask
from flask_restful import Resource, Api, reqparse, fields, marshal_with
from app import db
from app.models import Post

app = Flask(__name__)
api = Api(app)

# Request parser
post_parser = reqparse.RequestParser()
post_parser.add_argument('title', type=str, required=True, help='Title is required')
post_parser.add_argument('content', type=str, required=True)
post_parser.add_argument('category_id', type=int)

# Resource fields for serialization
post_fields = {
    'id': fields.Integer,
    'title': fields.String,
    'content': fields.String,
    'created_at': fields.DateTime(dt_format='iso8601'),
    'author': fields.Nested({
        'id': fields.Integer,
        'username': fields.String
    })
}

class PostListAPI(Resource):
    @marshal_with(post_fields)
    def get(self):
        posts = Post.query.all()
        return posts

    @marshal_with(post_fields)
    def post(self):
        args = post_parser.parse_args()
        post = Post(
            title=args['title'],
            content=args['content'],
            user_id=current_user.id,
            category_id=args.get('category_id')
        )
        db.session.add(post)
        db.session.commit()
        return post, 201

class PostAPI(Resource):
    @marshal_with(post_fields)
    def get(self, post_id):
        post = Post.query.get_or_404(post_id)
        return post

    @marshal_with(post_fields)
    def put(self, post_id):
        post = Post.query.get_or_404(post_id)
        args = post_parser.parse_args()
        post.title = args['title']
        post.content = args['content']
        db.session.commit()
        return post

    def delete(self, post_id):
        post = Post.query.get_or_404(post_id)
        db.session.delete(post)
        db.session.commit()
        return '', 204

api.add_resource(PostListAPI, '/api/posts')
api.add_resource(PostAPI, '/api/posts/&lt;int:post_id&gt;')
</code></pre>
<hr />
<h2 id="blueprints"><a class="header" href="#blueprints">Blueprints</a></h2>
<h3 id="creating-blueprints"><a class="header" href="#creating-blueprints">Creating Blueprints</a></h3>
<p><strong>app/blueprints/auth/<strong>init</strong>.py:</strong></p>
<pre><code class="language-python">from flask import Blueprint

auth_bp = Blueprint('auth', __name__)

from app.blueprints.auth import routes
</code></pre>
<p><strong>app/blueprints/auth/routes.py:</strong></p>
<pre><code class="language-python">from flask import render_template, redirect, url_for, flash, request
from flask_login import login_user, logout_user, login_required
from app.blueprints.auth import auth_bp
from app import db
from app.models import User
from app.forms import LoginForm, RegistrationForm

@auth_bp.route('/login', methods=['GET', 'POST'])
def login():
    form = LoginForm()
    if form.validate_on_submit():
        user = User.query.filter_by(email=form.email.data).first()
        if user and user.check_password(form.password.data):
            login_user(user, remember=form.remember.data)
            return redirect(url_for('main.index'))
        flash('Invalid credentials', 'danger')
    return render_template('auth/login.html', form=form)

@auth_bp.route('/logout')
@login_required
def logout():
    logout_user()
    return redirect(url_for('main.index'))

@auth_bp.route('/register', methods=['GET', 'POST'])
def register():
    form = RegistrationForm()
    if form.validate_on_submit():
        user = User(username=form.username.data, email=form.email.data)
        user.set_password(form.password.data)
        db.session.add(user)
        db.session.commit()
        flash('Registration successful!', 'success')
        return redirect(url_for('auth.login'))
    return render_template('auth/register.html', form=form)
</code></pre>
<h3 id="registering-blueprints"><a class="header" href="#registering-blueprints">Registering Blueprints</a></h3>
<p><strong>app/<strong>init</strong>.py:</strong></p>
<pre><code class="language-python">def create_app():
    app = Flask(__name__)

    # Register blueprints
    from app.blueprints.auth import auth_bp
    from app.blueprints.main import main_bp
    from app.blueprints.api import api_bp

    app.register_blueprint(auth_bp, url_prefix='/auth')
    app.register_blueprint(main_bp)
    app.register_blueprint(api_bp, url_prefix='/api')

    return app
</code></pre>
<hr />
<h2 id="error-handling"><a class="header" href="#error-handling">Error Handling</a></h2>
<pre><code class="language-python">from flask import render_template, jsonify

@app.errorhandler(404)
def not_found_error(error):
    if request.path.startswith('/api/'):
        return jsonify({'error': 'Not found'}), 404
    return render_template('errors/404.html'), 404

@app.errorhandler(500)
def internal_error(error):
    db.session.rollback()
    if request.path.startswith('/api/'):
        return jsonify({'error': 'Internal server error'}), 500
    return render_template('errors/500.html'), 500

@app.errorhandler(403)
def forbidden_error(error):
    return jsonify({'error': 'Forbidden'}), 403

# Custom exception
class ValidationError(Exception):
    pass

@app.errorhandler(ValidationError)
def handle_validation_error(error):
    return jsonify({'error': str(error)}), 400
</code></pre>
<hr />
<h2 id="file-uploads"><a class="header" href="#file-uploads">File Uploads</a></h2>
<pre><code class="language-python">import os
from werkzeug.utils import secure_filename
from flask import request, flash, redirect, url_for

ALLOWED_EXTENSIONS = {'txt', 'pdf', 'png', 'jpg', 'jpeg', 'gif'}

def allowed_file(filename):
    return '.' in filename and \
           filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS

@app.route('/upload', methods=['GET', 'POST'])
@login_required
def upload_file():
    if request.method == 'POST':
        if 'file' not in request.files:
            flash('No file part', 'danger')
            return redirect(request.url)

        file = request.files['file']

        if file.filename == '':
            flash('No selected file', 'danger')
            return redirect(request.url)

        if file and allowed_file(file.filename):
            filename = secure_filename(file.filename)
            filepath = os.path.join(app.config['UPLOAD_FOLDER'], filename)
            file.save(filepath)
            flash('File uploaded successfully', 'success')
            return redirect(url_for('index'))

    return render_template('upload.html')
</code></pre>
<hr />
<h2 id="testing"><a class="header" href="#testing">Testing</a></h2>
<pre><code class="language-python">import unittest
from app import create_app, db
from app.models import User, Post
from config import TestingConfig

class UserModelTestCase(unittest.TestCase):
    def setUp(self):
        self.app = create_app(TestingConfig)
        self.app_context = self.app.app_context()
        self.app_context.push()
        db.create_all()

    def tearDown(self):
        db.session.remove()
        db.drop_all()
        self.app_context.pop()

    def test_password_hashing(self):
        user = User(username='john', email='john@example.com')
        user.set_password('password')
        self.assertFalse(user.check_password('wrong'))
        self.assertTrue(user.check_password('password'))

class RoutesTestCase(unittest.TestCase):
    def setUp(self):
        self.app = create_app(TestingConfig)
        self.client = self.app.test_client()
        self.app_context = self.app.app_context()
        self.app_context.push()
        db.create_all()

    def tearDown(self):
        db.session.remove()
        db.drop_all()
        self.app_context.pop()

    def test_index_page(self):
        response = self.client.get('/')
        self.assertEqual(response.status_code, 200)

    def test_login(self):
        # Create user
        user = User(username='test', email='test@example.com')
        user.set_password('password')
        db.session.add(user)
        db.session.commit()

        # Test login
        response = self.client.post('/auth/login', data={
            'email': 'test@example.com',
            'password': 'password'
        }, follow_redirects=True)

        self.assertEqual(response.status_code, 200)

if __name__ == '__main__':
    unittest.main()
</code></pre>
<hr />
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<h3 id="1-application-factory"><a class="header" href="#1-application-factory">1. Application Factory</a></h3>
<pre><code class="language-python">def create_app(config_class=Config):
    app = Flask(__name__)
    app.config.from_object(config_class)

    db.init_app(app)
    migrate.init_app(app, db)

    return app
</code></pre>
<h3 id="2-configuration-management"><a class="header" href="#2-configuration-management">2. Configuration Management</a></h3>
<pre><code class="language-python"># Use environment variables
from dotenv import load_dotenv
load_dotenv()

SECRET_KEY = os.environ.get('SECRET_KEY')
DATABASE_URL = os.environ.get('DATABASE_URL')
</code></pre>
<h3 id="3-error-handling"><a class="header" href="#3-error-handling">3. Error Handling</a></h3>
<pre><code class="language-python"># Always handle exceptions
try:
    # Database operation
    db.session.commit()
except Exception as e:
    db.session.rollback()
    app.logger.error(f'Error: {str(e)}')
    flash('An error occurred', 'danger')
</code></pre>
<h3 id="4-security"><a class="header" href="#4-security">4. Security</a></h3>
<pre><code class="language-python"># CSRF protection
from flask_wtf.csrf import CSRFProtect
csrf = CSRFProtect(app)

# Security headers
from flask_talisman import Talisman
Talisman(app, content_security_policy=None)

# Rate limiting
from flask_limiter import Limiter
limiter = Limiter(app, key_func=lambda: request.remote_addr)

@app.route('/api/data')
@limiter.limit("5 per minute")
def api_data():
    return jsonify({'data': []})
</code></pre>
<hr />
<h2 id="production-deployment"><a class="header" href="#production-deployment">Production Deployment</a></h2>
<h3 id="requirements"><a class="header" href="#requirements">Requirements</a></h3>
<p><strong>requirements.txt:</strong></p>
<pre><code>Flask==3.0.0
Flask-SQLAlchemy==3.1.1
Flask-Migrate==4.0.5
Flask-Login==0.6.3
Flask-WTF==1.2.1
Flask-CORS==4.0.0
Flask-JWT-Extended==4.5.3
python-dotenv==1.0.0
gunicorn==21.2.0
psycopg2-binary==2.9.9
</code></pre>
<h3 id="gunicorn"><a class="header" href="#gunicorn">Gunicorn</a></h3>
<pre><code class="language-bash"># Install
pip install gunicorn

# Run
gunicorn -w 4 -b 0.0.0.0:8000 "app:create_app()"

# With config file
gunicorn -c gunicorn.conf.py "app:create_app()"
</code></pre>
<p><strong>gunicorn.conf.py:</strong></p>
<pre><code class="language-python">bind = '0.0.0.0:8000'
workers = 4
threads = 2
timeout = 30
accesslog = '-'
errorlog = '-'
loglevel = 'info'
</code></pre>
<h3 id="docker"><a class="header" href="#docker">Docker</a></h3>
<p><strong>Dockerfile:</strong></p>
<pre><code class="language-dockerfile">FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD ["gunicorn", "-c", "gunicorn.conf.py", "app:create_app()"]
</code></pre>
<p><strong>docker-compose.yml:</strong></p>
<pre><code class="language-yaml">version: '3.8'

services:
  web:
    build: .
    ports:
      - "8000:8000"
    environment:
      - FLASK_ENV=production
      - DATABASE_URL=postgresql://user:pass@db:5432/mydb
    depends_on:
      - db

  db:
    image: postgres:15-alpine
    environment:
      POSTGRES_PASSWORD: password
      POSTGRES_DB: mydb
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:
</code></pre>
<hr />
<h2 id="resources"><a class="header" href="#resources">Resources</a></h2>
<p><strong>Official Documentation:</strong></p>
<ul>
<li><a href="https://flask.palletsprojects.com/">Flask Documentation</a></li>
<li><a href="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world">Flask Mega-Tutorial</a></li>
<li><a href="https://flask.palletsprojects.com/en/latest/extensions/">Flask Extensions</a></li>
</ul>
<p><strong>Extensions:</strong></p>
<ul>
<li><a href="https://flask-sqlalchemy.palletsprojects.com/">Flask-SQLAlchemy</a></li>
<li><a href="https://flask-login.readthedocs.io/">Flask-Login</a></li>
<li><a href="https://flask-wtf.readthedocs.io/">Flask-WTF</a></li>
<li><a href="https://flask-restful.readthedocs.io/">Flask-RESTful</a></li>
</ul>
<p><strong>Community:</strong></p>
<ul>
<li><a href="https://discord.gg/pallets">Flask Discord</a></li>
<li><a href="https://stackoverflow.com/questions/tagged/flask">Stack Overflow</a></li>
<li><a href="https://www.reddit.com/r/flask/">Reddit r/flask</a></li>
</ul>
<p><strong>Books:</strong></p>
<ul>
<li>Flask Web Development by Miguel Grinberg</li>
<li>Flask Framework Cookbook</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../web_development/django.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../web_development/fastapi.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../web_development/django.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../web_development/fastapi.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>

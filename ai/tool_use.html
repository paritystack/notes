<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Tool Use - My Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-9dfbd86b.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex-69617736.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-da6337af.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">My Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="tool-use-in-ai-systems"><a class="header" href="#tool-use-in-ai-systems">Tool Use in AI Systems</a></h1>
<p>A comprehensive guide to tool use (function calling) in Large Language Models, enabling AI assistants to interact with external systems, APIs, and execute actions.</p>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#core-concepts">Core Concepts</a></li>
<li><a href="#how-tool-use-works">How Tool Use Works</a></li>
<li><a href="#tool-definition">Tool Definition</a></li>
<li><a href="#implementation-patterns">Implementation Patterns</a></li>
<li><a href="#platform-specific-implementations">Platform-Specific Implementations</a></li>
<li><a href="#best-practices">Best Practices</a></li>
<li><a href="#common-pitfalls">Common Pitfalls</a></li>
<li><a href="#advanced-patterns">Advanced Patterns</a></li>
<li><a href="#security-considerations">Security Considerations</a></li>
<li><a href="#performance-optimization">Performance Optimization</a></li>
<li><a href="#testing-tool-use">Testing Tool Use</a></li>
<li><a href="#real-world-examples">Real-World Examples</a></li>
</ul>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>Tool use (also called function calling or tool calling) enables Large Language Models to interact with external systems beyond text generation. Instead of just generating text responses, models can:</p>
<ul>
<li>Call APIs</li>
<li>Query databases</li>
<li>Execute code</li>
<li>Access real-time information</li>
<li>Perform calculations</li>
<li>Interact with files and systems</li>
<li>Control external services</li>
</ul>
<p>This transforms LLMs from passive text generators into <strong>agentic systems</strong> that can take actions and interact with the world.</p>
<h2 id="core-concepts"><a class="header" href="#core-concepts">Core Concepts</a></h2>
<h3 id="what-is-a-tool"><a class="header" href="#what-is-a-tool">What is a Tool?</a></h3>
<p>A tool is a defined function that an LLM can invoke to perform specific actions:</p>
<pre><code class="language-python"># Example: A simple weather tool
def get_weather(location: str, units: str = "celsius") -&gt; dict:
    """
    Get current weather for a location.

    Args:
        location: City name or coordinates
        units: Temperature units (celsius/fahrenheit)

    Returns:
        dict: Weather information
    """
    return {
        "temperature": 22,
        "conditions": "sunny",
        "location": location,
        "units": units
    }
</code></pre>
<h3 id="key-components"><a class="header" href="#key-components">Key Components</a></h3>
<ol>
<li><strong>Tool Definition</strong>: Schema describing the tool’s name, description, and parameters</li>
<li><strong>Tool Invocation</strong>: Model decides when and how to call the tool</li>
<li><strong>Tool Execution</strong>: System executes the tool with provided parameters</li>
<li><strong>Result Integration</strong>: Tool results are fed back to the model</li>
<li><strong>Response Generation</strong>: Model uses tool results to generate final response</li>
</ol>
<h3 id="tool-use-vs-prompt-engineering"><a class="header" href="#tool-use-vs-prompt-engineering">Tool Use vs. Prompt Engineering</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Aspect</th><th>Prompt Engineering</th><th>Tool Use</th></tr>
</thead>
<tbody>
<tr><td><strong>Capability</strong></td><td>Text-to-text</td><td>Text-to-action</td></tr>
<tr><td><strong>Real-time Data</strong></td><td>Limited to training data</td><td>Can access current data</td></tr>
<tr><td><strong>Actions</strong></td><td>Cannot perform actions</td><td>Can execute functions</td></tr>
<tr><td><strong>Accuracy</strong></td><td>Prone to hallucination</td><td>Deterministic execution</td></tr>
<tr><td><strong>Use Case</strong></td><td>Content generation</td><td>Interactive agents</td></tr>
</tbody>
</table>
</div>
<h2 id="how-tool-use-works"><a class="header" href="#how-tool-use-works">How Tool Use Works</a></h2>
<h3 id="basic-flow"><a class="header" href="#basic-flow">Basic Flow</a></h3>
<pre><code>User Input
    ↓
LLM Processing
    ↓
Decision Point: Need Tool?
    ├─ No → Generate Response
    └─ Yes → Select Tool &amp; Parameters
              ↓
         Execute Tool
              ↓
         Get Results
              ↓
         Feed Back to LLM
              ↓
         Generate Final Response
</code></pre>
<h3 id="example-conversation"><a class="header" href="#example-conversation">Example Conversation</a></h3>
<pre><code>User: "What's the weather in San Francisco and should I bring an umbrella?"

LLM: [Decides to use weather tool]
Tool Call: get_weather(location="San Francisco", units="fahrenheit")

Tool Result: {
  "temperature": 65,
  "conditions": "partly cloudy",
  "precipitation_chance": 20
}

LLM Response: "The weather in San Francisco is currently 65°F and partly cloudy
with only a 20% chance of precipitation. An umbrella probably isn't necessary,
but you might want to bring a light jacket."
</code></pre>
<h2 id="tool-definition"><a class="header" href="#tool-definition">Tool Definition</a></h2>
<h3 id="schema-format"><a class="header" href="#schema-format">Schema Format</a></h3>
<p>Most platforms use JSON Schema or similar formats:</p>
<pre><code class="language-json">{
  "name": "get_stock_price",
  "description": "Get the current stock price for a given ticker symbol",
  "parameters": {
    "type": "object",
    "properties": {
      "ticker": {
        "type": "string",
        "description": "Stock ticker symbol (e.g., AAPL, GOOGL)"
      },
      "exchange": {
        "type": "string",
        "enum": ["NYSE", "NASDAQ", "LSE"],
        "description": "Stock exchange"
      }
    },
    "required": ["ticker"]
  }
}
</code></pre>
<h3 id="good-tool-descriptions"><a class="header" href="#good-tool-descriptions">Good Tool Descriptions</a></h3>
<p>The quality of tool descriptions directly impacts model’s ability to use them correctly:</p>
<pre><code class="language-json">{
  "name": "send_email",
  "description": "Send an email to one or more recipients. Use this when the user explicitly requests to send an email or when an action requires email notification. Do not use for general email composition help.",
  "parameters": {
    "type": "object",
    "properties": {
      "to": {
        "type": "array",
        "items": {"type": "string"},
        "description": "List of recipient email addresses. Must be valid email format."
      },
      "subject": {
        "type": "string",
        "description": "Email subject line. Should be concise and descriptive."
      },
      "body": {
        "type": "string",
        "description": "Email body content. Can include HTML formatting if html_format is true."
      },
      "html_format": {
        "type": "boolean",
        "description": "Whether to send as HTML email. Default is false (plain text).",
        "default": false
      }
    },
    "required": ["to", "subject", "body"]
  }
}
</code></pre>
<h3 id="tool-description-best-practices"><a class="header" href="#tool-description-best-practices">Tool Description Best Practices</a></h3>
<p>✅ <strong>Good Practices:</strong></p>
<ul>
<li>Clear, specific descriptions</li>
<li>Explain when to use the tool</li>
<li>Document parameter formats and constraints</li>
<li>Include examples in descriptions</li>
<li>Specify required vs. optional parameters</li>
<li>Use enums for limited choices</li>
</ul>
<p>❌ <strong>Bad Practices:</strong></p>
<ul>
<li>Vague descriptions: “Does stuff with data”</li>
<li>Missing parameter constraints</li>
<li>Unclear when to invoke the tool</li>
<li>Overlapping tool purposes</li>
</ul>
<h2 id="implementation-patterns"><a class="header" href="#implementation-patterns">Implementation Patterns</a></h2>
<h3 id="pattern-1-single-tool-call"><a class="header" href="#pattern-1-single-tool-call">Pattern 1: Single Tool Call</a></h3>
<p>Model makes one tool call and generates response:</p>
<pre><code class="language-python"># User: "What's 15% of 250?"

# Model decides to use calculator
tool_call = {
    "name": "calculate",
    "parameters": {
        "expression": "0.15 * 250"
    }
}

# Execute tool
result = execute_tool(tool_call)  # Returns: {"result": 37.5}

# Model generates response
response = "15% of 250 is 37.5"
</code></pre>
<h3 id="pattern-2-multiple-parallel-tools"><a class="header" href="#pattern-2-multiple-parallel-tools">Pattern 2: Multiple Parallel Tools</a></h3>
<p>Model calls multiple independent tools simultaneously:</p>
<pre><code class="language-python"># User: "Compare the weather in NYC and LA"

# Model makes parallel calls
tool_calls = [
    {
        "name": "get_weather",
        "parameters": {"location": "New York City"}
    },
    {
        "name": "get_weather",
        "parameters": {"location": "Los Angeles"}
    }
]

# Execute in parallel
results = parallel_execute(tool_calls)

# Model synthesizes response
response = "NYC is 45°F and rainy, while LA is 72°F and sunny.
LA has much better weather today."
</code></pre>
<h3 id="pattern-3-sequential-tool-chaining"><a class="header" href="#pattern-3-sequential-tool-chaining">Pattern 3: Sequential Tool Chaining</a></h3>
<p>Model uses output from one tool to inform the next:</p>
<pre><code class="language-python"># User: "Buy 10 shares of the highest performing tech stock today"

# Step 1: Get top performers
tool_call_1 = {
    "name": "get_top_stocks",
    "parameters": {"sector": "technology", "limit": 1}
}
result_1 = {"ticker": "NVDA", "price": 875.50}

# Step 2: Execute purchase
tool_call_2 = {
    "name": "buy_stock",
    "parameters": {
        "ticker": "NVDA",
        "quantity": 10,
        "price": 875.50
    }
}
result_2 = {"status": "success", "order_id": "12345"}

# Model confirms
response = "I've purchased 10 shares of NVDA at $875.50 each.
Order ID: 12345"
</code></pre>
<h3 id="pattern-4-iterative-tool-use-agentic"><a class="header" href="#pattern-4-iterative-tool-use-agentic">Pattern 4: Iterative Tool Use (Agentic)</a></h3>
<p>Model repeatedly uses tools until task is complete:</p>
<pre><code class="language-python"># User: "Debug why the API is returning 500 errors"

# Iteration 1: Check logs
tool_call = {"name": "get_logs", "parameters": {"service": "api", "level": "error"}}
result = {"errors": ["Database connection timeout"]}

# Iteration 2: Check database
tool_call = {"name": "check_database", "parameters": {"check": "connections"}}
result = {"active_connections": 100, "max_connections": 100}

# Iteration 3: Get database config
tool_call = {"name": "get_config", "parameters": {"service": "database"}}
result = {"max_connections": 100}

# Model synthesizes findings
response = "The API is failing because the database has reached its
connection limit (100/100). You need to either increase max_connections
in the database config or implement connection pooling."
</code></pre>
<h2 id="platform-specific-implementations"><a class="header" href="#platform-specific-implementations">Platform-Specific Implementations</a></h2>
<h3 id="openai-function-calling"><a class="header" href="#openai-function-calling">OpenAI Function Calling</a></h3>
<pre><code class="language-python">import openai

# Define tools
tools = [
    {
        "type": "function",
        "function": {
            "name": "get_weather",
            "description": "Get the current weather in a location",
            "parameters": {
                "type": "object",
                "properties": {
                    "location": {
                        "type": "string",
                        "description": "City name"
                    },
                    "units": {
                        "type": "string",
                        "enum": ["celsius", "fahrenheit"]
                    }
                },
                "required": ["location"]
            }
        }
    }
]

# Make API call
response = openai.chat.completions.create(
    model="gpt-4",
    messages=[{"role": "user", "content": "What's the weather in Boston?"}],
    tools=tools,
    tool_choice="auto"  # Let model decide when to use tools
)

# Check if model wants to call a tool
if response.choices[0].message.tool_calls:
    tool_call = response.choices[0].message.tool_calls[0]

    # Execute the function
    if tool_call.function.name == "get_weather":
        import json
        args = json.loads(tool_call.function.arguments)
        result = get_weather(**args)

        # Send result back to model
        messages = [
            {"role": "user", "content": "What's the weather in Boston?"},
            response.choices[0].message,
            {
                "role": "tool",
                "tool_call_id": tool_call.id,
                "content": json.dumps(result)
            }
        ]

        final_response = openai.chat.completions.create(
            model="gpt-4",
            messages=messages
        )

        print(final_response.choices[0].message.content)
</code></pre>
<h3 id="anthropic-claude-tool-use"><a class="header" href="#anthropic-claude-tool-use">Anthropic Claude Tool Use</a></h3>
<pre><code class="language-python">import anthropic

client = anthropic.Anthropic()

# Define tools
tools = [
    {
        "name": "get_weather",
        "description": "Get the current weather in a given location",
        "input_schema": {
            "type": "object",
            "properties": {
                "location": {
                    "type": "string",
                    "description": "The city and state, e.g. San Francisco, CA"
                },
                "unit": {
                    "type": "string",
                    "enum": ["celsius", "fahrenheit"],
                    "description": "The unit of temperature"
                }
            },
            "required": ["location"]
        }
    }
]

# Make API call
message = client.messages.create(
    model="claude-3-5-sonnet-20241022",
    max_tokens=1024,
    tools=tools,
    messages=[{"role": "user", "content": "What's the weather in San Francisco?"}]
)

# Handle tool use
if message.stop_reason == "tool_use":
    tool_use = next(block for block in message.content if block.type == "tool_use")

    # Execute tool
    tool_result = get_weather(**tool_use.input)

    # Continue conversation
    response = client.messages.create(
        model="claude-3-5-sonnet-20241022",
        max_tokens=1024,
        tools=tools,
        messages=[
            {"role": "user", "content": "What's the weather in San Francisco?"},
            {"role": "assistant", "content": message.content},
            {
                "role": "user",
                "content": [
                    {
                        "type": "tool_result",
                        "tool_use_id": tool_use.id,
                        "content": str(tool_result)
                    }
                ]
            }
        ]
    )

    print(response.content[0].text)
</code></pre>
<h3 id="langchain-integration"><a class="header" href="#langchain-integration">LangChain Integration</a></h3>
<pre><code class="language-python">from langchain.agents import initialize_agent, Tool
from langchain.agents import AgentType
from langchain.llms import OpenAI

# Define tools
tools = [
    Tool(
        name="Calculator",
        func=lambda x: eval(x),
        description="Useful for mathematical calculations. Input should be a math expression."
    ),
    Tool(
        name="Weather",
        func=get_weather,
        description="Get current weather. Input should be a city name."
    )
]

# Initialize agent
llm = OpenAI(temperature=0)
agent = initialize_agent(
    tools,
    llm,
    agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION,
    verbose=True
)

# Run agent
result = agent.run("What's the weather in NYC and what's 15% of 200?")
</code></pre>
<h3 id="local-tool-use-llamacpp"><a class="header" href="#local-tool-use-llamacpp">Local Tool Use (llama.cpp)</a></h3>
<pre><code class="language-python"># Tool definitions for local models
tools = [
    {
        "type": "function",
        "function": {
            "name": "get_current_time",
            "description": "Get the current time",
            "parameters": {"type": "object", "properties": {}}
        }
    }
]

# Format prompt with tool definitions
prompt = f"""You have access to the following tools:
{json.dumps(tools, indent=2)}

To use a tool, respond with JSON in this format:
{{"tool": "tool_name", "parameters": {{}}}}

User: What time is it?
Assistant:"""

# Model generates tool call
response = model.generate(prompt)
# {"tool": "get_current_time", "parameters": {}}

# Parse and execute
tool_call = json.loads(response)
result = execute_tool(tool_call)

# Feed back to model
final_prompt = f"{prompt}\n{response}\nTool result: {result}\nAssistant:"
final_response = model.generate(final_prompt)
</code></pre>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<h3 id="1-clear-tool-naming"><a class="header" href="#1-clear-tool-naming">1. Clear Tool Naming</a></h3>
<pre><code class="language-python"># ❌ Bad: Vague names
def get()  # Get what?
def process_data()  # What kind of processing?
def send()  # Send what, where?

# ✅ Good: Specific names
def get_user_profile()
def calculate_compound_interest()
def send_email_notification()
</code></pre>
<h3 id="2-comprehensive-descriptions"><a class="header" href="#2-comprehensive-descriptions">2. Comprehensive Descriptions</a></h3>
<pre><code class="language-python"># ❌ Bad: Minimal description
{
    "name": "search",
    "description": "Search for stuff"
}

# ✅ Good: Detailed description
{
    "name": "search_knowledge_base",
    "description": """Search the company knowledge base for documents and articles.

    Use this tool when users ask questions that require company-specific information,
    policies, or documentation. The search uses semantic similarity to find relevant
    content. Returns top 5 most relevant results with titles and snippets.

    Examples of when to use:
    - "What's our vacation policy?"
    - "How do I submit an expense report?"
    - "Find documentation about our API"
    """
}
</code></pre>
<h3 id="3-parameter-validation"><a class="header" href="#3-parameter-validation">3. Parameter Validation</a></h3>
<pre><code class="language-python">def transfer_money(from_account: str, to_account: str, amount: float):
    """Transfer money between accounts."""

    # Validate inputs
    if not from_account or not to_account:
        raise ValueError("Account IDs cannot be empty")

    if amount &lt;= 0:
        raise ValueError("Amount must be positive")

    if amount &gt; 10000:
        raise ValueError("Amount exceeds single transaction limit")

    # Check account format
    if not re.match(r'^\d{10}$', from_account):
        raise ValueError("Invalid account ID format")

    # Execute transfer
    return execute_transfer(from_account, to_account, amount)
</code></pre>
<h3 id="4-error-handling"><a class="header" href="#4-error-handling">4. Error Handling</a></h3>
<pre><code class="language-python">def get_stock_price(ticker: str) -&gt; dict:
    """Get stock price with robust error handling."""
    try:
        # Validate ticker
        ticker = ticker.upper().strip()

        # Make API call
        response = stock_api.get_quote(ticker)

        return {
            "success": True,
            "ticker": ticker,
            "price": response.price,
            "timestamp": response.timestamp
        }

    except InvalidTickerError:
        return {
            "success": False,
            "error": f"Invalid ticker symbol: {ticker}",
            "suggestion": "Please use a valid stock ticker (e.g., AAPL, GOOGL)"
        }

    except APIError as e:
        return {
            "success": False,
            "error": "Unable to fetch stock data",
            "details": str(e)
        }

    except Exception as e:
        # Log unexpected errors
        logger.error(f"Unexpected error in get_stock_price: {e}")
        return {
            "success": False,
            "error": "An unexpected error occurred"
        }
</code></pre>
<h3 id="5-tool-organization"><a class="header" href="#5-tool-organization">5. Tool Organization</a></h3>
<pre><code class="language-python"># Group related tools
class WeatherTools:
    """Collection of weather-related tools."""

    @staticmethod
    def get_current_weather(location: str) -&gt; dict:
        """Get current weather conditions."""
        pass

    @staticmethod
    def get_forecast(location: str, days: int = 5) -&gt; dict:
        """Get weather forecast."""
        pass

    @staticmethod
    def get_weather_alerts(location: str) -&gt; dict:
        """Get active weather alerts."""
        pass

# Register tools
tools = [
    create_tool_definition(WeatherTools.get_current_weather),
    create_tool_definition(WeatherTools.get_forecast),
    create_tool_definition(WeatherTools.get_weather_alerts)
]
</code></pre>
<h3 id="6-idempotency"><a class="header" href="#6-idempotency">6. Idempotency</a></h3>
<pre><code class="language-python"># ❌ Bad: Not idempotent
def create_user(username: str, email: str):
    """Creates a user - calling twice creates duplicates!"""
    user_id = generate_id()
    db.insert({"id": user_id, "username": username, "email": email})
    return {"user_id": user_id}

# ✅ Good: Idempotent
def create_user(username: str, email: str):
    """Creates a user or returns existing if already exists."""
    existing = db.find_one({"username": username})
    if existing:
        return {
            "user_id": existing.id,
            "created": False,
            "message": "User already exists"
        }

    user_id = generate_id()
    db.insert({"id": user_id, "username": username, "email": email})
    return {
        "user_id": user_id,
        "created": True,
        "message": "User created successfully"
    }
</code></pre>
<h3 id="7-return-structured-data"><a class="header" href="#7-return-structured-data">7. Return Structured Data</a></h3>
<pre><code class="language-python"># ❌ Bad: Unstructured string
def get_weather(location: str) -&gt; str:
    return "It's 72 degrees and sunny in San Francisco"

# ✅ Good: Structured data
def get_weather(location: str) -&gt; dict:
    return {
        "location": "San Francisco, CA",
        "temperature": 72,
        "temperature_unit": "fahrenheit",
        "conditions": "sunny",
        "humidity": 65,
        "wind_speed": 8,
        "wind_unit": "mph",
        "timestamp": "2025-01-15T14:30:00Z"
    }
</code></pre>
<h2 id="common-pitfalls"><a class="header" href="#common-pitfalls">Common Pitfalls</a></h2>
<h3 id="1-tool-overload"><a class="header" href="#1-tool-overload">1. Tool Overload</a></h3>
<pre><code class="language-python"># ❌ Bad: Too many similar tools
tools = [
    "get_user_by_id",
    "get_user_by_email",
    "get_user_by_username",
    "get_user_by_phone",
    # ... 10 more variations
]

# ✅ Good: Single flexible tool
tools = [
    {
        "name": "get_user",
        "description": "Get user by ID, email, username, or phone",
        "parameters": {
            "type": "object",
            "properties": {
                "user_id": {"type": "string"},
                "email": {"type": "string"},
                "username": {"type": "string"},
                "phone": {"type": "string"}
            }
        }
    }
]
</code></pre>
<h3 id="2-missing-constraints"><a class="header" href="#2-missing-constraints">2. Missing Constraints</a></h3>
<pre><code class="language-python"># ❌ Bad: No limits
{
    "name": "send_emails",
    "parameters": {
        "recipients": {
            "type": "array",
            "items": {"type": "string"}
        }
    }
}

# ✅ Good: With constraints
{
    "name": "send_emails",
    "parameters": {
        "recipients": {
            "type": "array",
            "items": {"type": "string"},
            "maxItems": 50,  # Prevent abuse
            "minItems": 1
        }
    }
}
</code></pre>
<h3 id="3-unclear-success-indicators"><a class="header" href="#3-unclear-success-indicators">3. Unclear Success Indicators</a></h3>
<pre><code class="language-python"># ❌ Bad: Ambiguous response
def delete_file(path: str):
    os.remove(path)
    return "Done"

# ✅ Good: Clear status
def delete_file(path: str) -&gt; dict:
    try:
        if not os.path.exists(path):
            return {
                "success": False,
                "error": "File not found",
                "path": path
            }

        os.remove(path)
        return {
            "success": True,
            "message": "File deleted successfully",
            "path": path
        }
    except PermissionError:
        return {
            "success": False,
            "error": "Permission denied",
            "path": path
        }
</code></pre>
<h3 id="4-not-handling-async-operations"><a class="header" href="#4-not-handling-async-operations">4. Not Handling Async Operations</a></h3>
<pre><code class="language-python"># ❌ Bad: Blocking on long operations
def generate_report(data: dict) -&gt; dict:
    result = expensive_computation(data)  # Takes 30 seconds
    return result

# ✅ Good: Async with status checking
def generate_report(data: dict) -&gt; dict:
    job_id = start_background_job(expensive_computation, data)
    return {
        "job_id": job_id,
        "status": "processing",
        "message": "Report generation started",
        "check_status_with": "get_job_status"
    }

def get_job_status(job_id: str) -&gt; dict:
    job = get_job(job_id)
    return {
        "job_id": job_id,
        "status": job.status,  # "processing", "completed", "failed"
        "progress": job.progress,
        "result": job.result if job.status == "completed" else None
    }
</code></pre>
<h3 id="5-insufficient-context-in-responses"><a class="header" href="#5-insufficient-context-in-responses">5. Insufficient Context in Responses</a></h3>
<pre><code class="language-python"># ❌ Bad: Minimal context
def book_flight(destination: str, date: str) -&gt; dict:
    return {"confirmation": "ABC123"}

# ✅ Good: Rich context
def book_flight(destination: str, date: str, passengers: int) -&gt; dict:
    booking = create_booking(destination, date, passengers)
    return {
        "confirmation_code": "ABC123",
        "destination": destination,
        "departure_date": date,
        "passengers": passengers,
        "total_price": 850.00,
        "currency": "USD",
        "booking_time": "2025-01-15T10:30:00Z",
        "cancellation_policy": "Free cancellation until 24h before departure",
        "next_steps": "Check-in opens 24 hours before departure"
    }
</code></pre>
<h2 id="advanced-patterns"><a class="header" href="#advanced-patterns">Advanced Patterns</a></h2>
<h3 id="multi-step-reasoning-with-tools"><a class="header" href="#multi-step-reasoning-with-tools">Multi-Step Reasoning with Tools</a></h3>
<pre><code class="language-python"># Complex task requiring multiple tools
user_query = "Find the cheapest laptop with at least 16GB RAM and notify me on Slack"

# Step 1: Search products
search_results = search_products(category="laptop", min_ram="16GB")

# Step 2: Sort by price
cheapest = min(search_results, key=lambda x: x['price'])

# Step 3: Send notification
send_slack_message(
    channel="@user",
    message=f"Found {cheapest['name']} for ${cheapest['price']}"
)
</code></pre>
<h3 id="conditional-tool-selection"><a class="header" href="#conditional-tool-selection">Conditional Tool Selection</a></h3>
<pre><code class="language-python">def smart_search(query: str, search_type: str = "auto") -&gt; dict:
    """Intelligently route to appropriate search tool."""

    if search_type == "auto":
        # Let model decide which search to use
        if "latest" in query or "recent" in query or "today" in query:
            return web_search(query)
        elif is_factual_question(query):
            return knowledge_base_search(query)
        else:
            return general_search(query)
    else:
        # Explicit search type
        search_functions = {
            "web": web_search,
            "knowledge_base": knowledge_base_search,
            "code": code_search
        }
        return search_functions[search_type](query)
</code></pre>
<h3 id="tool-result-caching"><a class="header" href="#tool-result-caching">Tool Result Caching</a></h3>
<pre><code class="language-python">from functools import lru_cache
import hashlib

class ToolExecutor:
    def __init__(self):
        self.cache = {}

    def execute_with_cache(self, tool_name: str, parameters: dict) -&gt; dict:
        """Execute tool with caching for identical calls."""

        # Create cache key
        cache_key = hashlib.md5(
            f"{tool_name}:{json.dumps(parameters, sort_keys=True)}".encode()
        ).hexdigest()

        # Check cache
        if cache_key in self.cache:
            return {
                **self.cache[cache_key],
                "cached": True
            }

        # Execute tool
        result = self.execute_tool(tool_name, parameters)

        # Cache result (if cacheable)
        if self.is_cacheable(tool_name):
            self.cache[cache_key] = result

        return {
            **result,
            "cached": False
        }
</code></pre>
<h3 id="tool-composition"><a class="header" href="#tool-composition">Tool Composition</a></h3>
<pre><code class="language-python"># Compose simple tools into complex workflows
class CompositeTools:
    """Tools that combine multiple operations."""

    @staticmethod
    def research_and_summarize(topic: str) -&gt; dict:
        """Research a topic and provide summary."""

        # Step 1: Search
        search_results = web_search(topic, limit=10)

        # Step 2: Extract content
        articles = [fetch_article(url) for url in search_results]

        # Step 3: Summarize
        combined_text = "\n\n".join(articles)
        summary = summarize_text(combined_text, max_length=500)

        # Step 4: Extract key points
        key_points = extract_key_points(combined_text)

        return {
            "topic": topic,
            "summary": summary,
            "key_points": key_points,
            "sources": search_results,
            "article_count": len(articles)
        }
</code></pre>
<h3 id="fallback-mechanisms"><a class="header" href="#fallback-mechanisms">Fallback Mechanisms</a></h3>
<pre><code class="language-python">def robust_tool_execution(tool_name: str, parameters: dict) -&gt; dict:
    """Execute tool with fallback strategies."""

    try:
        # Primary tool
        return execute_tool(tool_name, parameters)

    except APIRateLimitError:
        # Fallback 1: Use cached data
        cached = get_cached_result(tool_name, parameters)
        if cached and not is_stale(cached):
            return {
                **cached,
                "source": "cache",
                "warning": "Using cached data due to rate limit"
            }

        # Fallback 2: Use alternative API
        alt_tool = get_alternative_tool(tool_name)
        if alt_tool:
            return execute_tool(alt_tool, parameters)

        # Fallback 3: Return error with context
        return {
            "success": False,
            "error": "Rate limit exceeded",
            "suggestion": "Please try again in a few minutes"
        }

    except ToolTimeoutError:
        # Fallback: Start async job
        job_id = queue_tool_execution(tool_name, parameters)
        return {
            "success": False,
            "async_job_id": job_id,
            "message": "Operation queued due to timeout",
            "check_with": "get_job_status"
        }
</code></pre>
<h2 id="security-considerations"><a class="header" href="#security-considerations">Security Considerations</a></h2>
<h3 id="1-input-validation"><a class="header" href="#1-input-validation">1. Input Validation</a></h3>
<pre><code class="language-python">def execute_sql_query(query: str) -&gt; dict:
    """Execute SQL query with security checks."""

    # Whitelist allowed operations
    allowed_operations = ['SELECT']
    operation = query.strip().split()[0].upper()

    if operation not in allowed_operations:
        return {
            "success": False,
            "error": f"Operation {operation} not allowed. Only SELECT queries permitted."
        }

    # Check for dangerous patterns
    dangerous_patterns = [
        r';\s*DROP',
        r';\s*DELETE',
        r';\s*UPDATE',
        r'--',
        r'/\*.*\*/'
    ]

    for pattern in dangerous_patterns:
        if re.search(pattern, query, re.IGNORECASE):
            return {
                "success": False,
                "error": "Query contains potentially dangerous pattern"
            }

    # Execute with parameterization
    return execute_safe_query(query)
</code></pre>
<h3 id="2-authorization-checks"><a class="header" href="#2-authorization-checks">2. Authorization Checks</a></h3>
<pre><code class="language-python">def delete_document(document_id: str, user_id: str) -&gt; dict:
    """Delete document with authorization."""

    # Check if document exists
    document = get_document(document_id)
    if not document:
        return {"success": False, "error": "Document not found"}

    # Check ownership
    if document.owner_id != user_id:
        # Check if user has permission
        if not has_permission(user_id, document_id, "delete"):
            return {
                "success": False,
                "error": "Unauthorized: You don't have permission to delete this document"
            }

    # Log the action
    audit_log(action="delete_document", user_id=user_id, document_id=document_id)

    # Perform deletion
    delete(document)
    return {"success": True, "message": "Document deleted"}
</code></pre>
<h3 id="3-rate-limiting"><a class="header" href="#3-rate-limiting">3. Rate Limiting</a></h3>
<pre><code class="language-python">from collections import defaultdict
from datetime import datetime, timedelta

class RateLimiter:
    def __init__(self, max_calls: int, time_window: int):
        self.max_calls = max_calls
        self.time_window = timedelta(seconds=time_window)
        self.calls = defaultdict(list)

    def allow_call(self, user_id: str, tool_name: str) -&gt; tuple[bool, str]:
        """Check if tool call is allowed under rate limits."""

        key = f"{user_id}:{tool_name}"
        now = datetime.now()

        # Remove old calls outside time window
        self.calls[key] = [
            call_time for call_time in self.calls[key]
            if now - call_time &lt; self.time_window
        ]

        # Check limit
        if len(self.calls[key]) &gt;= self.max_calls:
            oldest_call = min(self.calls[key])
            retry_after = (oldest_call + self.time_window - now).total_seconds()
            return False, f"Rate limit exceeded. Retry after {retry_after:.0f} seconds"

        # Record this call
        self.calls[key].append(now)
        return True, ""

# Usage
rate_limiter = RateLimiter(max_calls=10, time_window=60)

def execute_tool_with_rate_limit(tool_name: str, user_id: str, parameters: dict):
    allowed, message = rate_limiter.allow_call(user_id, tool_name)
    if not allowed:
        return {"success": False, "error": message}

    return execute_tool(tool_name, parameters)
</code></pre>
<h3 id="4-sandboxing"><a class="header" href="#4-sandboxing">4. Sandboxing</a></h3>
<pre><code class="language-python">import subprocess
import tempfile
import os

def execute_code_safely(code: str, language: str = "python") -&gt; dict:
    """Execute user code in sandboxed environment."""

    # Create temporary file
    with tempfile.NamedTemporaryFile(mode='w', suffix=f'.{language}', delete=False) as f:
        f.write(code)
        temp_file = f.name

    try:
        # Execute with restrictions
        result = subprocess.run(
            ['python', temp_file],
            capture_output=True,
            text=True,
            timeout=5,  # Timeout after 5 seconds
            env={'PATH': '/usr/bin'},  # Restricted environment
        )

        return {
            "success": result.returncode == 0,
            "stdout": result.stdout,
            "stderr": result.stderr,
            "returncode": result.returncode
        }

    except subprocess.TimeoutExpired:
        return {
            "success": False,
            "error": "Code execution timed out (5s limit)"
        }

    finally:
        # Cleanup
        os.unlink(temp_file)
</code></pre>
<h2 id="performance-optimization"><a class="header" href="#performance-optimization">Performance Optimization</a></h2>
<h3 id="1-parallel-tool-execution"><a class="header" href="#1-parallel-tool-execution">1. Parallel Tool Execution</a></h3>
<pre><code class="language-python">import asyncio
from concurrent.futures import ThreadPoolExecutor

async def execute_tools_parallel(tool_calls: list) -&gt; list:
    """Execute multiple independent tool calls in parallel."""

    async def execute_single(tool_call):
        loop = asyncio.get_event_loop()
        with ThreadPoolExecutor() as executor:
            result = await loop.run_in_executor(
                executor,
                execute_tool,
                tool_call['name'],
                tool_call['parameters']
            )
        return result

    # Execute all in parallel
    results = await asyncio.gather(*[execute_single(tc) for tc in tool_calls])
    return results

# Usage
tool_calls = [
    {"name": "get_weather", "parameters": {"location": "NYC"}},
    {"name": "get_weather", "parameters": {"location": "LA"}},
    {"name": "get_weather", "parameters": {"location": "Chicago"}}
]

results = asyncio.run(execute_tools_parallel(tool_calls))
</code></pre>
<h3 id="2-lazy-loading"><a class="header" href="#2-lazy-loading">2. Lazy Loading</a></h3>
<pre><code class="language-python">class LazyToolRegistry:
    """Load tool implementations only when needed."""

    def __init__(self):
        self._tools = {}
        self._tool_modules = {
            'weather': 'tools.weather',
            'database': 'tools.database',
            'email': 'tools.email'
        }

    def get_tool(self, tool_name: str):
        """Lazy load tool implementation."""
        if tool_name not in self._tools:
            module_path = self._tool_modules.get(tool_name)
            if not module_path:
                raise ValueError(f"Unknown tool: {tool_name}")

            # Import module only when needed
            module = __import__(module_path, fromlist=[''])
            self._tools[tool_name] = module

        return self._tools[tool_name]
</code></pre>
<h3 id="3-response-streaming"><a class="header" href="#3-response-streaming">3. Response Streaming</a></h3>
<pre><code class="language-python">def stream_large_result(query: str):
    """Stream results instead of waiting for complete response."""

    yield {"status": "starting", "message": "Searching database..."}

    results = []
    for batch in search_database_batches(query):
        results.extend(batch)
        yield {
            "status": "progress",
            "results_so_far": len(results),
            "latest_batch": batch
        }

    yield {
        "status": "complete",
        "total_results": len(results),
        "results": results
    }
</code></pre>
<h2 id="testing-tool-use"><a class="header" href="#testing-tool-use">Testing Tool Use</a></h2>
<h3 id="unit-testing-tools"><a class="header" href="#unit-testing-tools">Unit Testing Tools</a></h3>
<pre><code class="language-python">import pytest

def test_calculator_tool():
    """Test calculator tool with various inputs."""

    # Test basic calculation
    result = calculate("2 + 2")
    assert result == {"result": 4, "success": True}

    # Test division
    result = calculate("10 / 2")
    assert result == {"result": 5.0, "success": True}

    # Test division by zero
    result = calculate("10 / 0")
    assert result["success"] == False
    assert "division by zero" in result["error"].lower()

    # Test invalid expression
    result = calculate("invalid")
    assert result["success"] == False
</code></pre>
<h3 id="integration-testing"><a class="header" href="#integration-testing">Integration Testing</a></h3>
<pre><code class="language-python">def test_multi_tool_workflow():
    """Test workflow using multiple tools."""

    # Mock LLM responses
    with mock.patch('llm.generate') as mock_llm:
        # First call: LLM decides to use weather tool
        mock_llm.return_value = {
            "tool_call": {
                "name": "get_weather",
                "parameters": {"location": "NYC"}
            }
        }

        # Execute workflow
        result = execute_agent_workflow("What should I wear in NYC today?")

        # Verify tool was called
        assert "weather" in result.tools_used
        assert "NYC" in result.final_response


def test_tool_error_handling():
    """Test that errors are handled gracefully."""

    with mock.patch('tools.api.call') as mock_api:
        # Simulate API failure
        mock_api.side_effect = APIError("Service unavailable")

        result = execute_tool("get_stock_price", {"ticker": "AAPL"})

        assert result["success"] == False
        assert "error" in result
</code></pre>
<h3 id="mock-tools-for-testing"><a class="header" href="#mock-tools-for-testing">Mock Tools for Testing</a></h3>
<pre><code class="language-python">class MockToolExecutor:
    """Mock tool executor for testing."""

    def __init__(self):
        self.calls = []
        self.mock_responses = {}

    def set_mock_response(self, tool_name: str, response: dict):
        """Set predetermined response for a tool."""
        self.mock_responses[tool_name] = response

    def execute(self, tool_name: str, parameters: dict) -&gt; dict:
        """Execute tool (mocked)."""
        self.calls.append({
            "tool": tool_name,
            "parameters": parameters,
            "timestamp": datetime.now()
        })

        return self.mock_responses.get(tool_name, {"success": True})

    def verify_called(self, tool_name: str, times: int = None):
        """Verify tool was called."""
        calls = [c for c in self.calls if c["tool"] == tool_name]
        if times is not None:
            assert len(calls) == times, f"Expected {times} calls, got {len(calls)}"
        return len(calls) &gt; 0
</code></pre>
<h2 id="real-world-examples"><a class="header" href="#real-world-examples">Real-World Examples</a></h2>
<h3 id="example-1-customer-support-agent"><a class="header" href="#example-1-customer-support-agent">Example 1: Customer Support Agent</a></h3>
<pre><code class="language-python">tools = [
    {
        "name": "search_knowledge_base",
        "description": "Search help articles and documentation",
        "parameters": {
            "query": {"type": "string"},
            "category": {"type": "string", "enum": ["billing", "technical", "account"]}
        }
    },
    {
        "name": "get_order_status",
        "description": "Get status of customer order",
        "parameters": {
            "order_id": {"type": "string"}
        }
    },
    {
        "name": "create_support_ticket",
        "description": "Create ticket for complex issues requiring human support",
        "parameters": {
            "subject": {"type": "string"},
            "description": {"type": "string"},
            "priority": {"type": "string", "enum": ["low", "medium", "high"]}
        }
    }
]

# User: "Where's my order #12345?"
# Agent uses: get_order_status(order_id="12345")
# Agent responds with order tracking information
</code></pre>
<h3 id="example-2-data-analysis-assistant"><a class="header" href="#example-2-data-analysis-assistant">Example 2: Data Analysis Assistant</a></h3>
<pre><code class="language-python">tools = [
    {
        "name": "query_database",
        "description": "Execute SQL query on analytics database",
        "parameters": {
            "query": {"type": "string"},
            "database": {"type": "string", "enum": ["sales", "users", "products"]}
        }
    },
    {
        "name": "create_visualization",
        "description": "Create chart from data",
        "parameters": {
            "chart_type": {"type": "string", "enum": ["line", "bar", "pie"]},
            "data": {"type": "array"},
            "title": {"type": "string"}
        }
    },
    {
        "name": "calculate_statistics",
        "description": "Calculate statistical measures",
        "parameters": {
            "data": {"type": "array"},
            "metrics": {"type": "array", "items": {"enum": ["mean", "median", "std_dev"]}}
        }
    }
]

# User: "Show me sales trends for the last quarter"
# 1. Agent uses: query_database to get sales data
# 2. Agent uses: calculate_statistics to analyze
# 3. Agent uses: create_visualization to create chart
</code></pre>
<h3 id="example-3-code-review-assistant"><a class="header" href="#example-3-code-review-assistant">Example 3: Code Review Assistant</a></h3>
<pre><code class="language-python">tools = [
    {
        "name": "get_file_content",
        "description": "Read file from repository",
        "parameters": {
            "file_path": {"type": "string"}
        }
    },
    {
        "name": "run_linter",
        "description": "Run code linter",
        "parameters": {
            "file_path": {"type": "string"},
            "linter": {"type": "string", "enum": ["eslint", "pylint", "rustfmt"]}
        }
    },
    {
        "name": "run_tests",
        "description": "Execute test suite",
        "parameters": {
            "test_path": {"type": "string"}
        }
    },
    {
        "name": "create_review_comment",
        "description": "Add review comment to PR",
        "parameters": {
            "file": {"type": "string"},
            "line": {"type": "number"},
            "comment": {"type": "string"}
        }
    }
]

# Workflow: Review pull request
# 1. get_file_content for changed files
# 2. run_linter to check code style
# 3. run_tests to verify functionality
# 4. create_review_comment for issues found
</code></pre>
<h2 id="resources"><a class="header" href="#resources">Resources</a></h2>
<h3 id="documentation"><a class="header" href="#documentation">Documentation</a></h3>
<ul>
<li><a href="https://platform.openai.com/docs/guides/function-calling">OpenAI Function Calling Guide</a></li>
<li><a href="https://docs.anthropic.com/claude/docs/tool-use">Anthropic Tool Use Guide</a></li>
<li><a href="https://python.langchain.com/docs/modules/agents/">LangChain Agents</a></li>
</ul>
<h3 id="best-practices-1"><a class="header" href="#best-practices-1">Best Practices</a></h3>
<ul>
<li><a href="https://www.promptingguide.ai/techniques/tool-use">Prompt Engineering Guide - Tool Use</a></li>
<li><a href="https://www.anthropic.com/research/building-effective-agents">Building Reliable AI Agents</a></li>
</ul>
<h3 id="examples--templates"><a class="header" href="#examples--templates">Examples &amp; Templates</a></h3>
<ul>
<li><a href="https://cookbook.openai.com/examples/how_to_call_functions_with_chat_models">OpenAI Cookbook - Function Calling</a></li>
<li><a href="https://github.com/langchain-ai/langchain/tree/master/libs/langchain/langchain/tools">LangChain Tool Examples</a></li>
</ul>
<h2 id="conclusion"><a class="header" href="#conclusion">Conclusion</a></h2>
<p>Tool use transforms LLMs from text generators into capable agents that can interact with systems, access real-time information, and perform actions. Success requires:</p>
<ol>
<li><strong>Clear tool definitions</strong> with comprehensive descriptions</li>
<li><strong>Robust error handling</strong> for reliable operation</li>
<li><strong>Security measures</strong> to prevent misuse</li>
<li><strong>Performance optimization</strong> for responsive experiences</li>
<li><strong>Thorough testing</strong> to ensure reliability</li>
</ol>
<p>The key is finding the right balance between giving the model enough tools to be useful while maintaining security and performance. Start with a small set of well-designed tools and expand based on real usage patterns.</p>
<p>Remember: Good tool use is about <strong>empowering the model</strong> to help users accomplish tasks, not just adding features for the sake of it.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../ai/agent_frameworks.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../cloud/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../ai/agent_frameworks.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../cloud/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-c2a407aa.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>

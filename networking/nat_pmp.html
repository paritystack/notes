<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>NAT-PMP - My Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-9dfbd86b.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex-a2260ca8.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-ccdcd5e9.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">My Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="nat-pmp-nat-port-mapping-protocol"><a class="header" href="#nat-pmp-nat-port-mapping-protocol">NAT-PMP (NAT Port Mapping Protocol)</a></h1>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>NAT-PMP (NAT Port Mapping Protocol) is a network protocol for establishing port forwarding rules in a NAT gateway automatically. It provides a simple, lightweight mechanism for applications to request port mappings without manual configuration. NAT-PMP was developed by Apple and later standardized as RFC 6886.</p>
<h2 id="key-characteristics"><a class="header" href="#key-characteristics">Key Characteristics</a></h2>
<pre><code>Protocol: UDP
Port: 5351
RFC: 6886 (2013)
Developed by: Apple Inc.
Successor: PCP (Port Control Protocol)

Features:
✓ Automatic port mapping
✓ Simple protocol (easy to implement)
✓ UDP-based (low overhead)
✓ Time-limited mappings
✓ Gateway discovery
✓ External address discovery
✓ Lightweight

Limitations:
✗ IPv4 only
✗ Single NAT only
✗ No authentication
✗ Limited features vs PCP
</code></pre>
<h2 id="why-nat-pmp"><a class="header" href="#why-nat-pmp">Why NAT-PMP?</a></h2>
<h3 id="the-problem"><a class="header" href="#the-problem">The Problem</a></h3>
<pre><code>Traditional Port Forwarding:
1. User manually logs into router
2. Navigates to port forwarding settings
3. Adds rule: External Port → Internal IP:Port
4. Application must document this for users
5. Users often configure incorrectly
6. Ports left open indefinitely

Issues:
- Not user-friendly
- Security risk (forgotten mappings)
- Doesn't work for non-technical users
- Can't be automated by applications
</code></pre>
<h3 id="nat-pmp-solution"><a class="header" href="#nat-pmp-solution">NAT-PMP Solution</a></h3>
<pre><code>Automatic Approach:
1. Application requests mapping via NAT-PMP
2. Router creates mapping automatically
3. Mapping has expiration time
4. Application renews as needed
5. Mapping removed when no longer needed

Benefits:
✓ Zero user configuration
✓ Automatic cleanup
✓ Application-controlled
✓ Simple to implement
✓ Secure (time-limited)
</code></pre>
<h2 id="nat-pmp-vs-alternatives"><a class="header" href="#nat-pmp-vs-alternatives">NAT-PMP vs Alternatives</a></h2>
<pre><code>Feature             NAT-PMP    UPnP-IGD    PCP
Protocol            UDP        HTTP/SOAP   UDP
Complexity          Low        High        Medium
IPv6 Support        No         Partial     Yes
Port              5351       Variable    5351
Packet Size         12 bytes   KB+         24+ bytes
Overhead            Minimal    High        Low
Deployment          Apple      Wide        Growing
Year Introduced     2005       2000        2013

Use NAT-PMP when:
- IPv4 only network
- Simple requirements
- Apple ecosystem
- Lightweight solution
- Easy implementation

Use PCP when:
- Need IPv6
- Modern deployment
- Advanced features
- Multiple NATs

Use UPnP when:
- Legacy compatibility
- Already deployed
- Complex scenarios
</code></pre>
<h2 id="protocol-design"><a class="header" href="#protocol-design">Protocol Design</a></h2>
<h3 id="message-types"><a class="header" href="#message-types">Message Types</a></h3>
<pre><code>Request Types (Client → NAT Gateway):
- Opcode 0: Determine external IP address
- Opcode 1: Map UDP port
- Opcode 2: Map TCP port

Response Types (NAT Gateway → Client):
- Opcode 128: External IP address response
- Opcode 129: UDP port mapping response
- Opcode 130: TCP port mapping response

All opcodes in responses have bit 7 set (add 128)
</code></pre>
<h3 id="packet-format"><a class="header" href="#packet-format">Packet Format</a></h3>
<pre><code>All NAT-PMP packets start with:

 0                   1
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Version = 0  |    Opcode     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Version: Always 0
Opcode: Request or response type
</code></pre>
<h2 id="external-ip-address-request"><a class="header" href="#external-ip-address-request">External IP Address Request</a></h2>
<h3 id="request-format"><a class="header" href="#request-format">Request Format</a></h3>
<pre><code> 0                   1
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Version = 0  |  Opcode = 0   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Total: 2 bytes

Purpose:
- Discover NAT gateway's external IP
- Check if NAT-PMP is supported
- Verify connectivity to gateway
</code></pre>
<h3 id="response-format"><a class="header" href="#response-format">Response Format</a></h3>
<pre><code> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Version = 0  | Opcode = 128  |        Result Code            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                  Seconds Since Start of Epoch                 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     External IP Address                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Total: 12 bytes

Result Code:
0: Success
1: Unsupported Version
2: Not Authorized/Refused
3: Network Failure
4: Out of Resources
5: Unsupported Opcode

Seconds Since Start of Epoch:
- Time since gateway booted/restarted
- Used to detect gateway reboots
- Incremented every second

External IP Address:
- Gateway's public IP address
- 32-bit IPv4 address
</code></pre>
<h2 id="port-mapping-request"><a class="header" href="#port-mapping-request">Port Mapping Request</a></h2>
<h3 id="request-format-1"><a class="header" href="#request-format-1">Request Format</a></h3>
<pre><code> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Version = 0  | Opcode (1/2)  |          Reserved (0)         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|        Internal Port          |     Suggested External Port   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|              Requested Port Mapping Lifetime                  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Total: 12 bytes

Opcode:
- 1 = UDP port mapping
- 2 = TCP port mapping

Reserved: Must be 0

Internal Port:
- Port on the client machine
- Port application is listening on

Suggested External Port:
- Preferred external port
- 0 = gateway chooses
- Non-zero = client preference

Requested Lifetime:
- Duration in seconds
- 0 = delete mapping
- Recommended: 3600 (1 hour)
- Maximum: 2^32 - 1 seconds
</code></pre>
<h3 id="response-format-1"><a class="header" href="#response-format-1">Response Format</a></h3>
<pre><code> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Version = 0  | Opcode (129/130) |        Result Code         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                  Seconds Since Start of Epoch                 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|        Internal Port          |      Mapped External Port     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                Port Mapping Lifetime (seconds)                |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Total: 16 bytes

Opcode:
- 129 = UDP port mapping response
- 130 = TCP port mapping response

Mapped External Port:
- Actual external port assigned
- May differ from suggested port
- 0 = mapping failed or deleted

Port Mapping Lifetime:
- Actual lifetime granted
- May be less than requested
- Gateway may reduce based on policy
</code></pre>
<h2 id="gateway-discovery"><a class="header" href="#gateway-discovery">Gateway Discovery</a></h2>
<h3 id="how-to-find-nat-gateway"><a class="header" href="#how-to-find-nat-gateway">How to Find NAT Gateway</a></h3>
<pre><code>Method 1: Default Gateway (Recommended)
- Use system's default gateway
- Most common case
- Works in 99% of deployments

import socket
import struct

def get_default_gateway():
    """Get default gateway IP (Linux)."""
    with open('/proc/net/route') as f:
        for line in f:
            fields = line.strip().split()
            if fields[1] == '00000000':  # Default route
                gateway_hex = fields[2]
                # Convert hex to IP
                gateway_int = int(gateway_hex, 16)
                return socket.inet_ntoa(struct.pack('&lt;I', gateway_int))
    return None

# Or use netifaces library
import netifaces
gws = netifaces.gateways()
gateway = gws['default'][netifaces.AF_INET][0]

Method 2: DHCP Option
- DHCP Option 120 (NAT-PMP Gateway)
- Rarely used in practice

Method 3: Multicast (Legacy)
- Send to 224.0.0.1 (all hosts)
- Gateway responds
- Not recommended

Best Practice:
Always try default gateway first
</code></pre>
<h2 id="client-implementation"><a class="header" href="#client-implementation">Client Implementation</a></h2>
<h3 id="python-example"><a class="header" href="#python-example">Python Example</a></h3>
<pre><code class="language-python">import socket
import struct
import time

class NATPMPClient:
    def __init__(self, gateway_ip):
        self.gateway_ip = gateway_ip
        self.gateway_port = 5351
        self.sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        self.sock.settimeout(3.0)

    def get_external_ip(self):
        """
        Get NAT gateway's external IP address.

        Returns:
            (external_ip, epoch_seconds)
        """
        # Build request
        request = struct.pack('!BB', 0, 0)  # Version 0, Opcode 0

        # Send request
        self.sock.sendto(request, (self.gateway_ip, self.gateway_port))

        try:
            # Receive response
            response, addr = self.sock.recvfrom(1024)

            # Parse response
            if len(response) &lt; 12:
                raise Exception("Invalid response length")

            version, opcode, result_code, epoch, ext_ip = \
                struct.unpack('!BBHII', response)

            if result_code != 0:
                raise Exception(f"Error: result code {result_code}")

            # Convert IP to string
            external_ip = socket.inet_ntoa(struct.pack('!I', ext_ip))

            return (external_ip, epoch)

        except socket.timeout:
            raise Exception("Request timeout - NAT-PMP not supported?")

    def add_port_mapping(self, internal_port, external_port=0,
                        protocol='tcp', lifetime=3600):
        """
        Add a port mapping.

        Args:
            internal_port: Port on local machine
            external_port: Desired external port (0 = any)
            protocol: 'tcp' or 'udp'
            lifetime: Mapping duration in seconds (0 = delete)

        Returns:
            (mapped_external_port, actual_lifetime, epoch)
        """
        # Build request
        opcode = 1 if protocol == 'udp' else 2
        request = struct.pack(
            '!BBHHHI',
            0,              # Version
            opcode,         # 1=UDP, 2=TCP
            0,              # Reserved
            internal_port,
            external_port,
            lifetime
        )

        # Send request
        self.sock.sendto(request, (self.gateway_ip, self.gateway_port))

        try:
            # Receive response
            response, addr = self.sock.recvfrom(1024)

            # Parse response
            if len(response) &lt; 16:
                raise Exception("Invalid response length")

            version, resp_opcode, result_code, epoch, \
                int_port, ext_port, actual_lifetime = \
                struct.unpack('!BBHIHHI', response)

            if result_code != 0:
                raise Exception(f"Error: result code {result_code}")

            return (ext_port, actual_lifetime, epoch)

        except socket.timeout:
            raise Exception("Request timeout")

    def delete_port_mapping(self, internal_port, protocol='tcp'):
        """Delete a port mapping by setting lifetime to 0."""
        return self.add_port_mapping(
            internal_port,
            external_port=0,
            protocol=protocol,
            lifetime=0
        )

    def close(self):
        self.sock.close()


# Usage example
if __name__ == '__main__':
    # Get gateway from system
    import netifaces
    gws = netifaces.gateways()
    gateway = gws['default'][netifaces.AF_INET][0]

    print(f"Using gateway: {gateway}")

    client = NATPMPClient(gateway)

    try:
        # Get external IP
        external_ip, epoch = client.get_external_ip()
        print(f"External IP: {external_ip}")
        print(f"Gateway uptime: {epoch} seconds")

        # Add port mapping
        print("\nCreating port mapping...")
        external_port, lifetime, epoch = client.add_port_mapping(
            internal_port=8080,
            external_port=8080,  # Prefer 8080
            protocol='tcp',
            lifetime=3600  # 1 hour
        )

        print(f"Mapping created:")
        print(f"  Internal: localhost:8080")
        print(f"  External: {external_ip}:{external_port}")
        print(f"  Lifetime: {lifetime} seconds")

        # Keep mapping alive
        print("\nMapping active. Press Ctrl+C to delete...")
        try:
            last_epoch = epoch
            while True:
                time.sleep(1800)  # Renew every 30 minutes

                # Renew mapping
                external_port, lifetime, epoch = client.add_port_mapping(
                    internal_port=8080,
                    protocol='tcp',
                    lifetime=3600
                )

                # Check for gateway reboot
                if epoch &lt; last_epoch:
                    print("Warning: Gateway rebooted! Mapping recreated.")

                last_epoch = epoch
                print(f"Mapping renewed: {lifetime}s remaining")

        except KeyboardInterrupt:
            pass

        # Delete mapping
        print("\nDeleting mapping...")
        client.delete_port_mapping(8080, 'tcp')
        print("Mapping deleted")

    except Exception as e:
        print(f"Error: {e}")

    finally:
        client.close()
</code></pre>
<h3 id="javascriptnodejs-example"><a class="header" href="#javascriptnodejs-example">JavaScript/Node.js Example</a></h3>
<pre><code class="language-javascript">const dgram = require('dgram');

class NATPMPClient {
  constructor(gatewayIP) {
    this.gatewayIP = gatewayIP;
    this.gatewayPort = 5351;
    this.socket = dgram.createSocket('udp4');
  }

  getExternalIP() {
    return new Promise((resolve, reject) =&gt; {
      // Build request
      const request = Buffer.alloc(2);
      request.writeUInt8(0, 0);  // Version
      request.writeUInt8(0, 1);  // Opcode

      const timeout = setTimeout(() =&gt; {
        reject(new Error('Request timeout'));
      }, 3000);

      this.socket.once('message', (response) =&gt; {
        clearTimeout(timeout);

        try {
          const version = response.readUInt8(0);
          const opcode = response.readUInt8(1);
          const resultCode = response.readUInt16BE(2);

          if (resultCode !== 0) {
            throw new Error(`Error: result code ${resultCode}`);
          }

          const epoch = response.readUInt32BE(4);
          const ipBytes = [
            response.readUInt8(8),
            response.readUInt8(9),
            response.readUInt8(10),
            response.readUInt8(11)
          ];
          const externalIP = ipBytes.join('.');

          resolve({ externalIP, epoch });
        } catch (error) {
          reject(error);
        }
      });

      this.socket.send(request, this.gatewayPort, this.gatewayIP);
    });
  }

  addPortMapping(internalPort, externalPort = 0, protocol = 'tcp', lifetime = 3600) {
    return new Promise((resolve, reject) =&gt; {
      // Build request
      const request = Buffer.alloc(12);
      request.writeUInt8(0, 0);  // Version
      request.writeUInt8(protocol === 'udp' ? 1 : 2, 1);  // Opcode
      request.writeUInt16BE(0, 2);  // Reserved
      request.writeUInt16BE(internalPort, 4);
      request.writeUInt16BE(externalPort, 6);
      request.writeUInt32BE(lifetime, 8);

      const timeout = setTimeout(() =&gt; {
        reject(new Error('Request timeout'));
      }, 3000);

      this.socket.once('message', (response) =&gt; {
        clearTimeout(timeout);

        try {
          const resultCode = response.readUInt16BE(2);

          if (resultCode !== 0) {
            throw new Error(`Error: result code ${resultCode}`);
          }

          const epoch = response.readUInt32BE(4);
          const mappedPort = response.readUInt16BE(10);
          const actualLifetime = response.readUInt32BE(12);

          resolve({
            externalPort: mappedPort,
            lifetime: actualLifetime,
            epoch
          });
        } catch (error) {
          reject(error);
        }
      });

      this.socket.send(request, this.gatewayPort, this.gatewayIP);
    });
  }

  deletePortMapping(internalPort, protocol = 'tcp') {
    return this.addPortMapping(internalPort, 0, protocol, 0);
  }

  close() {
    this.socket.close();
  }
}

// Usage
const os = require('os');

function getDefaultGateway() {
  // Simple gateway detection (platform-specific)
  const interfaces = os.networkInterfaces();
  // This is simplified - use proper gateway detection in production
  return '192.168.1.1';
}

const gateway = getDefaultGateway();
const client = new NATPMPClient(gateway);

async function main() {
  try {
    // Get external IP
    const { externalIP, epoch } = await client.getExternalIP();
    console.log(`External IP: ${externalIP}`);
    console.log(`Gateway uptime: ${epoch}s`);

    // Add port mapping
    const mapping = await client.addPortMapping(8080, 8080, 'tcp', 3600);
    console.log('Mapping created:');
    console.log(`  External: ${externalIP}:${mapping.externalPort}`);
    console.log(`  Lifetime: ${mapping.lifetime}s`);

    // Renew periodically
    setInterval(async () =&gt; {
      const renewed = await client.addPortMapping(8080, 8080, 'tcp', 3600);
      console.log(`Mapping renewed: ${renewed.lifetime}s`);
    }, 30 * 60 * 1000);  // Every 30 minutes

  } catch (error) {
    console.error('Error:', error.message);
  }
}

main();
</code></pre>
<h2 id="mapping-lifetime-management"><a class="header" href="#mapping-lifetime-management">Mapping Lifetime Management</a></h2>
<h3 id="recommended-practices"><a class="header" href="#recommended-practices">Recommended Practices</a></h3>
<pre><code>1. Initial Lifetime
   - Request 3600 seconds (1 hour)
   - Gateway may grant less
   - Never request &gt; 1 day

2. Renewal Strategy
   - Renew at 50% of lifetime
   - If lifetime is 3600s, renew at 1800s
   - Provides safety margin

3. Exponential Backoff
   - If renewal fails, retry with backoff
   - 1s, 2s, 4s, 8s, 16s, 32s
   - Eventually recreate mapping

4. Epoch Monitoring
   - Check epoch in each response
   - If epoch &lt; last_epoch: gateway rebooted
   - Recreate all mappings

5. Cleanup
   - Always delete mappings when done
   - Set lifetime=0 to delete
   - Graceful shutdown
</code></pre>
<h3 id="example-lifetime-management"><a class="header" href="#example-lifetime-management">Example: Lifetime Management</a></h3>
<pre><code class="language-python">class MappingManager:
    def __init__(self, client, internal_port, protocol='tcp'):
        self.client = client
        self.internal_port = internal_port
        self.protocol = protocol
        self.external_port = None
        self.lifetime = None
        self.last_epoch = None
        self.running = False

    def start(self):
        """Create and maintain mapping."""
        self.running = True

        # Create initial mapping
        self._create_mapping()

        # Renewal loop
        while self.running:
            # Sleep for half of lifetime
            sleep_time = self.lifetime / 2
            time.sleep(sleep_time)

            if not self.running:
                break

            try:
                # Renew mapping
                ext_port, lifetime, epoch = self.client.add_port_mapping(
                    self.internal_port,
                    self.external_port,  # Request same port
                    self.protocol,
                    3600
                )

                # Check for gateway reboot
                if epoch &lt; self.last_epoch:
                    print("Gateway rebooted - mapping recreated")

                self.external_port = ext_port
                self.lifetime = lifetime
                self.last_epoch = epoch

                print(f"Mapping renewed: {lifetime}s")

            except Exception as e:
                print(f"Renewal failed: {e}")
                # Retry with backoff
                self._retry_with_backoff()

    def _create_mapping(self):
        """Create initial mapping."""
        ext_port, lifetime, epoch = self.client.add_port_mapping(
            self.internal_port,
            0,  # Any port
            self.protocol,
            3600
        )

        self.external_port = ext_port
        self.lifetime = lifetime
        self.last_epoch = epoch

        print(f"Mapping created: :{ext_port} -&gt; localhost:{self.internal_port}")

    def _retry_with_backoff(self):
        """Retry with exponential backoff."""
        delays = [1, 2, 4, 8, 16, 32]

        for delay in delays:
            time.sleep(delay)
            try:
                self._create_mapping()
                return
            except Exception as e:
                print(f"Retry failed: {e}")

        print("All retries failed")
        self.running = False

    def stop(self):
        """Stop and delete mapping."""
        self.running = False

        try:
            self.client.delete_port_mapping(self.internal_port, self.protocol)
            print("Mapping deleted")
        except Exception as e:
            print(f"Failed to delete mapping: {e}")


# Usage
client = NATPMPClient(gateway)
manager = MappingManager(client, 8080, 'tcp')

# Start in background thread
import threading
thread = threading.Thread(target=manager.start)
thread.start()

# Application runs...

# Cleanup on exit
manager.stop()
thread.join()
client.close()
</code></pre>
<h2 id="security-considerations"><a class="header" href="#security-considerations">Security Considerations</a></h2>
<pre><code>Threats:

1. Unauthorized Mappings
   - Malware can open ports
   - No authentication in protocol
   - Mitigation: Monitor gateway logs

2. Resource Exhaustion
   - Many mappings consume gateway resources
   - DoS via mapping requests
   - Mitigation: Gateway enforces limits

3. Information Disclosure
   - External IP revealed
   - Internal topology visible
   - Mitigation: Minimal, inherent to NAT

4. Spoofing
   - Off-path attacker sends fake responses
   - Mitigation: Check source IP/port

Best Practices:

1. Only request needed mappings
2. Use shortest lifetime necessary
3. Delete mappings when done
4. Monitor for unexpected mappings
5. Validate response source
6. Handle errors gracefully
</code></pre>
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<pre><code class="language-bash"># Test if gateway supports NAT-PMP
nc -u 192.168.1.1 5351

# Send external IP request (hex)
echo -n "\x00\x00" | nc -u 192.168.1.1 5351

# Expected response (hex):
# 00 80 00 00 SSSS SSSS EE EE EE EE
# 00: Version
# 80: Opcode (128 = external IP response)
# 00 00: Result (success)
# SSSS SSSS: Epoch seconds
# EE EE EE EE: External IP

# tcpdump NAT-PMP traffic
sudo tcpdump -i any -n udp port 5351 -X

# Check if gateway has NAT-PMP enabled
# Router admin interface → Port Forwarding → NAT-PMP

# Common issues:
# - Gateway doesn't support NAT-PMP
# - NAT-PMP disabled in gateway
# - Firewall blocks UDP 5351
# - Wrong gateway address
# - Gateway behind another NAT

# Test with real client
pip install nat-pmp
natpmpc -g 192.168.1.1 -a 8080 8080 tcp 3600
</code></pre>
<h2 id="comparison-with-other-protocols"><a class="header" href="#comparison-with-other-protocols">Comparison with Other Protocols</a></h2>
<h3 id="nat-pmp-vs-pcp"><a class="header" href="#nat-pmp-vs-pcp">NAT-PMP vs PCP</a></h3>
<pre><code>NAT-PMP:
+ Simple, easy to implement
+ Low overhead (12-16 bytes)
+ Widely supported (Apple devices)
+ Battle-tested (since 2005)
- IPv4 only
- Single NAT only
- Limited features

PCP:
+ IPv4 and IPv6
+ Multiple NATs
+ More features (PEER, filters)
+ Modern design
- More complex
- Less deployed
- Larger packets

Migration Path:
- PCP designed as NAT-PMP successor
- PCP port (5351) intentionally same
- Clients can try both
</code></pre>
<h3 id="feature-comparison"><a class="header" href="#feature-comparison">Feature Comparison</a></h3>
<pre><code>Feature                  NAT-PMP    PCP       UPnP-IGD
Packet Size              12-16B     24+B      KB+
Round Trips              1          1         Multiple
IPv6                     No         Yes       Partial
Lifetime Management      Yes        Yes       No
Third-party Mapping      No         Yes       No
Firewall Control         No         Yes       No
Authentication           No         No        No
Complexity               Low        Medium    High
Apple Support            Native     Native    Emulated
Linux Support            Good       Good      Good
</code></pre>
<h2 id="common-use-cases"><a class="header" href="#common-use-cases">Common Use Cases</a></h2>
<h3 id="1-bittorrent-client"><a class="header" href="#1-bittorrent-client">1. BitTorrent Client</a></h3>
<pre><code class="language-python"># BitTorrent client
client = NATPMPClient(gateway)

# Map port for incoming connections
port = 6881
ext_port, lifetime, _ = client.add_port_mapping(
    internal_port=port,
    external_port=port,
    protocol='tcp',
    lifetime=7200  # 2 hours
)

print(f"Listening on port {ext_port}")

# Announce to tracker with external port
announce_to_tracker(ext_port)

# Maintain mapping while downloading
while downloading:
    time.sleep(3600)
    client.add_port_mapping(port, protocol='tcp', lifetime=7200)

# Cleanup
client.delete_port_mapping(port, 'tcp')
</code></pre>
<h3 id="2-voip-application"><a class="header" href="#2-voip-application">2. VoIP Application</a></h3>
<pre><code class="language-python"># VoIP client
client = NATPMPClient(gateway)

# Map SIP and RTP ports
sip_port = 5060
rtp_port = 16384

# SIP (TCP)
sip_ext, _, _ = client.add_port_mapping(
    sip_port, sip_port, 'tcp', 3600
)

# RTP (UDP)
rtp_ext, _, _ = client.add_port_mapping(
    rtp_port, rtp_port, 'udp', 3600
)

# Register with external address
external_ip, _ = client.get_external_ip()
register_with_server(external_ip, sip_ext, rtp_ext)
</code></pre>
<h3 id="3-game-server"><a class="header" href="#3-game-server">3. Game Server</a></h3>
<pre><code class="language-python"># Game server
client = NATPMPClient(gateway)

# Map game port
game_port = 27015
ext_port, lifetime, _ = client.add_port_mapping(
    game_port, game_port, 'udp', 7200
)

external_ip, _ = client.get_external_ip()

# Advertise server
advertise_server(f"{external_ip}:{ext_port}")

print(f"Server accessible at {external_ip}:{ext_port}")
</code></pre>
<h2 id="eli10-nat-pmp-explained-simply"><a class="header" href="#eli10-nat-pmp-explained-simply">ELI10: NAT-PMP Explained Simply</a></h2>
<p>NAT-PMP is like asking your house to automatically open a window:</p>
<h3 id="without-nat-pmp"><a class="header" href="#without-nat-pmp">Without NAT-PMP</a></h3>
<pre><code>You: Want friend to visit
Problem: Door is locked
Solution: Ask parent to unlock door manually
Issue: Parent must remember, manual work
</code></pre>
<h3 id="with-nat-pmp"><a class="header" href="#with-nat-pmp">With NAT-PMP</a></h3>
<pre><code>You: "Please open door for 1 hour"
Smart House: Opens door automatically
Friend: Can enter for 1 hour
Smart House: Locks door after 1 hour

Automatic + Safe!
</code></pre>
<h3 id="in-computer-terms"><a class="header" href="#in-computer-terms">In Computer Terms</a></h3>
<pre><code>Your App: "Need port 8080 open for 1 hour"
Router: Opens port 8080 automatically
Internet: Can now reach your app on port 8080
Router: Closes port after 1 hour

Benefits:
- No manual configuration
- Automatic cleanup
- Time-limited (secure)
- Application controls it
</code></pre>
<h2 id="further-resources"><a class="header" href="#further-resources">Further Resources</a></h2>
<h3 id="specifications"><a class="header" href="#specifications">Specifications</a></h3>
<ul>
<li><a href="https://tools.ietf.org/html/rfc6886">RFC 6886 - NAT-PMP</a></li>
<li><a href="https://tools.ietf.org/html/rfc6887">RFC 6887 - PCP</a> (Successor)</li>
</ul>
<h3 id="implementations"><a class="header" href="#implementations">Implementations</a></h3>
<ul>
<li><a href="https://github.com/miniupnp/libnatpmp">libnatpmp</a> - C library</li>
<li><a href="https://pypi.org/project/nat-pmp/">nat-pmp</a> - Python</li>
<li><a href="https://www.npmjs.com/package/nat-upnp">nat-upnp</a> - Node.js</li>
</ul>
<h3 id="tools"><a class="header" href="#tools">Tools</a></h3>
<ul>
<li>natpmpc - Command-line client</li>
<li><a href="https://en.wikipedia.org/wiki/NAT_Port_Mapping_Protocol">NAT Port Mapping Protocol</a></li>
</ul>
<h3 id="apple-documentation"><a class="header" href="#apple-documentation">Apple Documentation</a></h3>
<ul>
<li><a href="https://developer.apple.com/library/archive/qa/qa1458/_index.html">NAT-PMP on macOS</a></li>
<li>Bonjour implementation includes NAT-PMP</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../networking/pcp.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../networking/upnp.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../networking/pcp.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../networking/upnp.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-c2a407aa.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>

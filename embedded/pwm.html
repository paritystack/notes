<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>PWM - My Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-ae938929.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex-4bbf961e.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-e85e57c5.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">My Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="pwm-pulse-width-modulation"><a class="header" href="#pwm-pulse-width-modulation">PWM (Pulse Width Modulation)</a></h1>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>Pulse Width Modulation (PWM) is a technique for controlling power delivery to electrical devices by rapidly switching between ON and OFF states. By varying the ratio of ON time to OFF time (duty cycle), you can control the average power delivered without actually changing the voltage level. This makes PWM highly efficient and versatile for applications ranging from LED dimming to motor control.</p>
<h2 id="key-concepts"><a class="header" href="#key-concepts">Key Concepts</a></h2>
<h3 id="duty-cycle"><a class="header" href="#duty-cycle">Duty Cycle</a></h3>
<p>The <strong>duty cycle</strong> is the percentage of time the signal is HIGH during one complete cycle.</p>
<pre><code>Duty Cycle (%) = (Ton / (Ton + Toff)) × 100

Where:
- Ton = Time the signal is HIGH
- Toff = Time the signal is LOW
- Period = Ton + Toff
</code></pre>
<p><strong>Examples</strong>:</p>
<ul>
<li><strong>0% duty cycle</strong>: Always LOW (0V average)</li>
<li><strong>25% duty cycle</strong>: HIGH for 1/4 of the period</li>
<li><strong>50% duty cycle</strong>: HIGH for half the period</li>
<li><strong>75% duty cycle</strong>: HIGH for 3/4 of the period</li>
<li><strong>100% duty cycle</strong>: Always HIGH (full voltage)</li>
</ul>
<h3 id="frequency"><a class="header" href="#frequency">Frequency</a></h3>
<p>The <strong>frequency</strong> determines how many ON/OFF cycles occur per second, measured in Hertz (Hz).</p>
<pre><code>Frequency = 1 / Period
Period = 1 / Frequency
</code></pre>
<p><strong>Typical Frequencies</strong>:</p>
<ul>
<li><strong>LED Dimming</strong>: 500 Hz - 20 kHz (above flicker perception ~60 Hz)</li>
<li><strong>Motor Control</strong>: 1 kHz - 40 kHz</li>
<li><strong>Audio</strong>: 40 kHz+ (above human hearing)</li>
<li><strong>Servo Motors</strong>: 50 Hz (20ms period)</li>
</ul>
<h3 id="average-voltage"><a class="header" href="#average-voltage">Average Voltage</a></h3>
<p>The average voltage delivered by PWM:</p>
<pre><code>Average Voltage = Supply Voltage × (Duty Cycle / 100)

Example (5V supply):
- 0% duty → 0V average
- 25% duty → 1.25V average
- 50% duty → 2.5V average
- 100% duty → 5V average
</code></pre>
<h3 id="visual-representation"><a class="header" href="#visual-representation">Visual Representation</a></h3>
<pre><code>100% Duty Cycle (Always ON):
█████████████████████████████

75% Duty Cycle:
██████████████████░░░░░░░

50% Duty Cycle:
█████████████░░░░░░░░░░░░

25% Duty Cycle:
██████░░░░░░░░░░░░░░░░░░░

0% Duty Cycle (Always OFF):
░░░░░░░░░░░░░░░░░░░░░░░░░
</code></pre>
<h2 id="how-it-works"><a class="header" href="#how-it-works">How It Works</a></h2>
<h3 id="hardware-pwm-vs-software-pwm"><a class="header" href="#hardware-pwm-vs-software-pwm">Hardware PWM vs Software PWM</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Feature</th><th>Hardware PWM</th><th>Software PWM</th></tr>
</thead>
<tbody>
<tr><td><strong>Precision</strong></td><td>Very precise, timer-based</td><td>Can jitter with interrupts</td></tr>
<tr><td><strong>CPU Load</strong></td><td>Zero (handled by hardware)</td><td>High (CPU must toggle pin)</td></tr>
<tr><td><strong>Pins</strong></td><td>Limited (specific pins only)</td><td>Any digital pin</td></tr>
<tr><td><strong>Frequency</strong></td><td>High (up to MHz)</td><td>Low (few kHz max)</td></tr>
<tr><td><strong>Recommended</strong></td><td>Motors, audio, servos</td><td>Simple LED control</td></tr>
</tbody>
</table>
</div>
<h3 id="pwm-resolution"><a class="header" href="#pwm-resolution">PWM Resolution</a></h3>
<p>Resolution is the number of distinct duty cycle levels available:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Resolution</th><th>Levels</th><th>Step Size (at 5V)</th></tr>
</thead>
<tbody>
<tr><td>8-bit</td><td>256</td><td>19.5 mV</td></tr>
<tr><td>10-bit</td><td>1024</td><td>4.88 mV</td></tr>
<tr><td>12-bit</td><td>4096</td><td>1.22 mV</td></tr>
<tr><td>16-bit</td><td>65536</td><td>76 μV</td></tr>
</tbody>
</table>
</div>
<p><strong>Note</strong>: Higher resolution requires lower maximum frequency:</p>
<pre><code>Max Frequency = Clock Frequency / (2^Resolution)
</code></pre>
<h2 id="code-examples"><a class="header" href="#code-examples">Code Examples</a></h2>
<h3 id="arduino-pwm-hardware"><a class="header" href="#arduino-pwm-hardware">Arduino PWM (Hardware)</a></h3>
<pre><code class="language-cpp">// Arduino Uno PWM pins: 3, 5, 6, 9, 10, 11
// Default frequency: ~490 Hz (pins 3,9,10,11) and ~980 Hz (pins 5,6)

const int ledPin = 9;
const int motorPin = 10;

void setup() {
  pinMode(ledPin, OUTPUT);
  pinMode(motorPin, OUTPUT);
}

void loop() {
  // analogWrite uses 8-bit resolution (0-255)

  // LED at 25% brightness
  analogWrite(ledPin, 64);  // 64/255 = 25%
  delay(1000);

  // LED at 50% brightness
  analogWrite(ledPin, 128);  // 128/255 = 50%
  delay(1000);

  // LED at 75% brightness
  analogWrite(ledPin, 192);  // 192/255 = 75%
  delay(1000);

  // LED at 100% brightness
  analogWrite(ledPin, 255);  // 255/255 = 100%
  delay(1000);
}

// Smooth fade effect
void fadeLED() {
  // Fade in
  for (int brightness = 0; brightness &lt;= 255; brightness++) {
    analogWrite(ledPin, brightness);
    delay(5);
  }

  // Fade out
  for (int brightness = 255; brightness &gt;= 0; brightness--) {
    analogWrite(ledPin, brightness);
    delay(5);
  }
}

// Change PWM frequency (Arduino Uno)
void setPWMFrequency(int pin, int divisor) {
  byte mode;

  if (pin == 5 || pin == 6 || pin == 9 || pin == 10) {
    switch(divisor) {
      case 1: mode = 0x01; break;    // 31.25 kHz
      case 8: mode = 0x02; break;    // 3.9 kHz
      case 64: mode = 0x03; break;   // 490 Hz (default for 9,10)
      case 256: mode = 0x04; break;  // 122 Hz
      case 1024: mode = 0x05; break; // 30 Hz
      default: return;
    }

    if (pin == 5 || pin == 6) {
      TCCR0B = (TCCR0B &amp; 0b11111000) | mode;
    } else {
      TCCR1B = (TCCR1B &amp; 0b11111000) | mode;
    }
  }
}

void setup() {
  pinMode(9, OUTPUT);
  setPWMFrequency(9, 1);  // Set pin 9 to 31.25 kHz
}
</code></pre>
<h3 id="esp32-pwm-ledc"><a class="header" href="#esp32-pwm-ledc">ESP32 PWM (LEDC)</a></h3>
<pre><code class="language-cpp">// ESP32 uses LEDC (LED Control) for PWM
// 16 independent channels, configurable frequency and resolution

const int ledPin = 25;
const int pwmChannel = 0;      // Channel 0-15
const int pwmFrequency = 5000; // 5 kHz
const int pwmResolution = 8;   // 8-bit (0-255)

void setup() {
  // Configure PWM channel
  ledcSetup(pwmChannel, pwmFrequency, pwmResolution);

  // Attach pin to PWM channel
  ledcAttachPin(ledPin, pwmChannel);
}

void loop() {
  // Set duty cycle (0-255 for 8-bit)
  ledcWrite(pwmChannel, 128);  // 50% duty cycle
  delay(1000);

  ledcWrite(pwmChannel, 64);   // 25% duty cycle
  delay(1000);
}

// High resolution PWM (16-bit)
void setupHighResPWM() {
  const int pwmChannel = 0;
  const int pwmFreq = 1000;    // Lower freq for higher resolution
  const int pwmRes = 16;       // 16-bit (0-65535)

  ledcSetup(pwmChannel, pwmFreq, pwmRes);
  ledcAttachPin(ledPin, pwmChannel);

  // Set to 50% with 16-bit precision
  ledcWrite(pwmChannel, 32768);
}

// Multiple PWM channels for RGB LED
const int redPin = 25;
const int greenPin = 26;
const int bluePin = 27;

void setupRGB() {
  ledcSetup(0, 5000, 8);  // Red channel
  ledcSetup(1, 5000, 8);  // Green channel
  ledcSetup(2, 5000, 8);  // Blue channel

  ledcAttachPin(redPin, 0);
  ledcAttachPin(greenPin, 1);
  ledcAttachPin(bluePin, 2);
}

void setRGBColor(uint8_t r, uint8_t g, uint8_t b) {
  ledcWrite(0, r);
  ledcWrite(1, g);
  ledcWrite(2, b);
}

void loop() {
  setRGBColor(255, 0, 0);    // Red
  delay(1000);
  setRGBColor(0, 255, 0);    // Green
  delay(1000);
  setRGBColor(0, 0, 255);    // Blue
  delay(1000);
  setRGBColor(255, 255, 0);  // Yellow
  delay(1000);
}
</code></pre>
<h3 id="stm32-hal-pwm"><a class="header" href="#stm32-hal-pwm">STM32 HAL PWM</a></h3>
<pre><code class="language-c">#include "stm32f4xx_hal.h"

TIM_HandleTypeDef htim3;

void PWM_Init(void) {
    TIM_OC_InitTypeDef sConfigOC = {0};

    // Timer 3 configuration for PWM
    htim3.Instance = TIM3;
    htim3.Init.Prescaler = 84 - 1;       // 84 MHz / 84 = 1 MHz
    htim3.Init.CounterMode = TIM_COUNTERMODE_UP;
    htim3.Init.Period = 1000 - 1;        // 1 MHz / 1000 = 1 kHz PWM
    htim3.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;
    HAL_TIM_PWM_Init(&amp;htim3);

    // Configure PWM channel 1
    sConfigOC.OCMode = TIM_OCMODE_PWM1;
    sConfigOC.Pulse = 500;               // 50% duty cycle
    sConfigOC.OCPolarity = TIM_OCPOLARITY_HIGH;
    sConfigOC.OCFastMode = TIM_OCFAST_DISABLE;
    HAL_TIM_PWM_ConfigChannel(&amp;htim3, &amp;sConfigOC, TIM_CHANNEL_1);

    // Start PWM
    HAL_TIM_PWM_Start(&amp;htim3, TIM_CHANNEL_1);
}

void PWM_SetDutyCycle(uint16_t dutyCycle) {
    // dutyCycle: 0-1000 (0-100%)
    __HAL_TIM_SET_COMPARE(&amp;htim3, TIM_CHANNEL_1, dutyCycle);
}

void PWM_SetPercent(uint8_t percent) {
    // percent: 0-100
    uint16_t pulse = (percent * 1000) / 100;
    PWM_SetDutyCycle(pulse);
}
</code></pre>
<h3 id="servo-control-with-pwm"><a class="header" href="#servo-control-with-pwm">Servo Control with PWM</a></h3>
<pre><code class="language-cpp">// Standard servo: 50 Hz (20ms period)
// Pulse width: 1ms (0°) to 2ms (180°)

const int servoPin = 9;

void setup() {
  pinMode(servoPin, OUTPUT);
}

void setServoAngle(int angle) {
  // Map angle (0-180) to pulse width (1000-2000 μs)
  int pulseWidth = map(angle, 0, 180, 1000, 2000);

  // Generate 50 Hz PWM signal
  digitalWrite(servoPin, HIGH);
  delayMicroseconds(pulseWidth);
  digitalWrite(servoPin, LOW);
  delayMicroseconds(20000 - pulseWidth);  // Complete 20ms period
}

void loop() {
  setServoAngle(0);      // 0 degrees
  delay(1000);
  setServoAngle(90);     // 90 degrees
  delay(1000);
  setServoAngle(180);    // 180 degrees
  delay(1000);
}

// Using Servo library (easier)
#include &lt;Servo.h&gt;

Servo myServo;

void setup() {
  myServo.attach(9);     // Attach servo to pin 9
}

void loop() {
  myServo.write(0);      // 0 degrees
  delay(1000);
  myServo.write(90);     // 90 degrees
  delay(1000);
  myServo.write(180);    // 180 degrees
  delay(1000);
}
</code></pre>
<h3 id="motor-control-h-bridge"><a class="header" href="#motor-control-h-bridge">Motor Control (H-Bridge)</a></h3>
<pre><code class="language-cpp">// Control DC motor speed and direction with L298N H-Bridge

const int motorPWM = 9;    // Speed control (PWM)
const int motorIN1 = 7;    // Direction control
const int motorIN2 = 8;    // Direction control

void setup() {
  pinMode(motorPWM, OUTPUT);
  pinMode(motorIN1, OUTPUT);
  pinMode(motorIN2, OUTPUT);
}

void setMotorSpeed(int speed) {
  // speed: -255 (full reverse) to +255 (full forward)

  if (speed &gt; 0) {
    // Forward
    digitalWrite(motorIN1, HIGH);
    digitalWrite(motorIN2, LOW);
    analogWrite(motorPWM, speed);
  } else if (speed &lt; 0) {
    // Reverse
    digitalWrite(motorIN1, LOW);
    digitalWrite(motorIN2, HIGH);
    analogWrite(motorPWM, -speed);
  } else {
    // Stop
    digitalWrite(motorIN1, LOW);
    digitalWrite(motorIN2, LOW);
    analogWrite(motorPWM, 0);
  }
}

void loop() {
  setMotorSpeed(128);    // 50% forward
  delay(2000);
  setMotorSpeed(255);    // 100% forward
  delay(2000);
  setMotorSpeed(0);      // Stop
  delay(1000);
  setMotorSpeed(-128);   // 50% reverse
  delay(2000);
}
</code></pre>
<h2 id="common-applications"><a class="header" href="#common-applications">Common Applications</a></h2>
<h3 id="1-led-dimming"><a class="header" href="#1-led-dimming">1. LED Dimming</a></h3>
<pre><code class="language-cpp">// Smooth breathing effect
void breathingLED(int pin) {
  const int maxBrightness = 255;
  const int minBrightness = 0;
  const int step = 5;
  const int delayTime = 30;

  // Breathe in
  for (int brightness = minBrightness; brightness &lt;= maxBrightness; brightness += step) {
    analogWrite(pin, brightness);
    delay(delayTime);
  }

  // Breathe out
  for (int brightness = maxBrightness; brightness &gt;= minBrightness; brightness -= step) {
    analogWrite(pin, brightness);
    delay(delayTime);
  }
}
</code></pre>
<h3 id="2-rgb-color-mixing"><a class="header" href="#2-rgb-color-mixing">2. RGB Color Mixing</a></h3>
<pre><code class="language-cpp">void setColorHSV(float h, float s, float v) {
  // Convert HSV to RGB
  float c = v * s;
  float x = c * (1 - abs(fmod(h / 60.0, 2) - 1));
  float m = v - c;

  float r, g, b;
  if (h &lt; 60) { r = c; g = x; b = 0; }
  else if (h &lt; 120) { r = x; g = c; b = 0; }
  else if (h &lt; 180) { r = 0; g = c; b = x; }
  else if (h &lt; 240) { r = 0; g = x; b = c; }
  else if (h &lt; 300) { r = x; g = 0; b = c; }
  else { r = c; g = 0; b = x; }

  analogWrite(redPin, (r + m) * 255);
  analogWrite(greenPin, (g + m) * 255);
  analogWrite(bluePin, (b + m) * 255);
}

// Rainbow effect
void rainbow() {
  for (int hue = 0; hue &lt; 360; hue++) {
    setColorHSV(hue, 1.0, 1.0);
    delay(10);
  }
}
</code></pre>
<h3 id="3-speakerbuzzer-tone-generation"><a class="header" href="#3-speakerbuzzer-tone-generation">3. Speaker/Buzzer Tone Generation</a></h3>
<pre><code class="language-cpp">void playTone(int pin, int frequency, int duration) {
  int period = 1000000 / frequency;  // Period in microseconds
  int halfPeriod = period / 2;

  long cycles = ((long)frequency * duration) / 1000;

  for (long i = 0; i &lt; cycles; i++) {
    digitalWrite(pin, HIGH);
    delayMicroseconds(halfPeriod);
    digitalWrite(pin, LOW);
    delayMicroseconds(halfPeriod);
  }
}

void playMelody() {
  playTone(buzzerPin, 262, 500);  // C4
  playTone(buzzerPin, 294, 500);  // D4
  playTone(buzzerPin, 330, 500);  // E4
  playTone(buzzerPin, 349, 500);  // F4
}

// Using tone() function (easier)
void playNote(int frequency) {
  tone(buzzerPin, frequency);
  delay(500);
  noTone(buzzerPin);
}
</code></pre>
<h3 id="4-fan-speed-control"><a class="header" href="#4-fan-speed-control">4. Fan Speed Control</a></h3>
<pre><code class="language-cpp">int targetTemp = 25;    // Target temperature
int currentTemp = 30;   // Read from sensor

void controlFan() {
  int tempDiff = currentTemp - targetTemp;

  int fanSpeed;
  if (tempDiff &lt;= 0) {
    fanSpeed = 0;  // Too cold, fan off
  } else if (tempDiff &gt;= 10) {
    fanSpeed = 255;  // Very hot, max speed
  } else {
    // Proportional control
    fanSpeed = map(tempDiff, 0, 10, 50, 255);
  }

  analogWrite(fanPin, fanSpeed);
}
</code></pre>
<h3 id="5-power-supply-buck-converter"><a class="header" href="#5-power-supply-buck-converter">5. Power Supply (Buck Converter)</a></h3>
<p>PWM is used in switching power supplies to efficiently convert voltage:</p>
<ul>
<li>High frequency (20-100 kHz) minimizes inductor size</li>
<li>Duty cycle controls output voltage</li>
<li>Feedback loop maintains regulation</li>
</ul>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<h3 id="1-choose-appropriate-frequency"><a class="header" href="#1-choose-appropriate-frequency">1. Choose Appropriate Frequency</a></h3>
<pre><code class="language-cpp">// LED dimming: Use higher frequency to avoid flicker
// Human eye perceives flicker below ~60 Hz
setPWMFrequency(ledPin, 1);  // 31 kHz - no visible flicker

// Motor control: Balance between smoothness and efficiency
// Too high: Increased switching losses
// Too low: Audible noise, torque ripple
// Optimal: 10-25 kHz

// Audio: Must be above hearing range
// Humans hear up to ~20 kHz
// Use 40+ kHz for audio PWM
</code></pre>
<h3 id="2-filter-pwm-for-analog-output"><a class="header" href="#2-filter-pwm-for-analog-output">2. Filter PWM for Analog Output</a></h3>
<pre><code>PWM Pin ─── R ───┬─── Analog Output
                 │
                 C
                 │
                GND

Cutoff Frequency = 1 / (2π × R × C)

Example: R=1kΩ, C=10μF
fc = 1 / (2π × 1000 × 0.00001) ≈ 16 Hz
</code></pre>
<h3 id="3-protect-inductive-loads"><a class="header" href="#3-protect-inductive-loads">3. Protect Inductive Loads</a></h3>
<pre><code class="language-cpp">// Motors and solenoids are inductive
// Add flyback diode across load!

//        Motor
//    ┌────┴────┐
// PWM│         │GND
//    │   ▼─    │
//    └─────────┘
//    Flyback Diode
</code></pre>
<h3 id="4-avoid-pwm-on-critical-pins"><a class="header" href="#4-avoid-pwm-on-critical-pins">4. Avoid PWM on Critical Pins</a></h3>
<pre><code class="language-cpp">// Some Arduino pins share timers
// Changing frequency on one affects others!

// Pins 5 &amp; 6 share Timer 0 (also used by millis/delay!)
// Pins 9 &amp; 10 share Timer 1
// Pins 3 &amp; 11 share Timer 2

// Changing Timer 0 frequency breaks millis() and delay()!
</code></pre>
<h2 id="common-issues-and-debugging"><a class="header" href="#common-issues-and-debugging">Common Issues and Debugging</a></h2>
<h3 id="problem-led-flickering"><a class="header" href="#problem-led-flickering">Problem: LED Flickering</a></h3>
<p><strong>Causes</strong>: PWM frequency too low
<strong>Solution</strong>: Increase frequency above 60 Hz (ideally 500 Hz+)</p>
<h3 id="problem-motor-whiningbuzzing"><a class="header" href="#problem-motor-whiningbuzzing">Problem: Motor Whining/Buzzing</a></h3>
<p><strong>Causes</strong>: PWM frequency in audible range
<strong>Solution</strong>: Increase frequency to 20+ kHz</p>
<h3 id="problem-servo-jittering"><a class="header" href="#problem-servo-jittering">Problem: Servo Jittering</a></h3>
<p><strong>Causes</strong>: Incorrect pulse width or timing
<strong>Solution</strong>: Use dedicated Servo library, ensure 50 Hz signal</p>
<h3 id="problem-pwm-not-working-after-changing-frequency"><a class="header" href="#problem-pwm-not-working-after-changing-frequency">Problem: PWM Not Working After Changing Frequency</a></h3>
<p><strong>Causes</strong>: Modified Timer 0 which breaks delay() and millis()
<strong>Solution</strong>: Use different timer, or use external library</p>
<h2 id="eli10-explain-like-im-10"><a class="header" href="#eli10-explain-like-im-10">ELI10 (Explain Like I’m 10)</a></h2>
<p>Imagine you have a light switch that you can flick on and off really, really fast - so fast that your eyes can’t see it blinking!</p>
<p><strong>PWM is like that super-fast blinking:</strong></p>
<ul>
<li>If the light is ON for half the time and OFF for half the time, it looks 50% bright</li>
<li>If it’s ON for most of the time and OFF for a tiny bit, it looks almost fully bright</li>
<li>If it’s ON for only a tiny bit and OFF most of the time, it looks dim</li>
</ul>
<p><strong>This works because</strong>:</p>
<ul>
<li>Your eyes can’t see things blinking faster than about 60 times per second</li>
<li>So when we blink the light 500 or 1000 times per second, your brain sees a steady dimmed light!</li>
</ul>
<p><strong>The cool part?</strong></p>
<ul>
<li>We’re not actually reducing the voltage (which wastes energy as heat)</li>
<li>We’re just turning it on and off really fast (very efficient!)</li>
<li>It’s like running at full speed for short bursts vs. walking slowly all the time</li>
</ul>
<p><strong>Duty cycle</strong> is the percentage of time it’s ON:</p>
<ul>
<li>100% = always on (full brightness)</li>
<li>50% = on half the time (half brightness)</li>
<li>0% = always off (no light)</li>
</ul>
<p>We use this same trick for controlling motor speeds, speakers, and lots of other things!</p>
<h2 id="further-resources"><a class="header" href="#further-resources">Further Resources</a></h2>
<ul>
<li><a href="https://docs.arduino.cc/learn/microcontrollers/analog-output">Arduino PWM Guide</a></li>
<li><a href="https://www.arduino.cc/en/Tutorial/SecretsOfArduinoPWM">Secrets of Arduino PWM</a></li>
<li><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/peripherals/ledc.html">ESP32 LEDC Documentation</a></li>
<li><a href="https://en.wikipedia.org/wiki/Pulse-width_modulation">PWM Wikipedia</a></li>
<li><a href="https://www.ti.com/lit/an/slva505/slva505.pdf">Motor Control with PWM</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../embedded/ethernet.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../embedded/adc.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../embedded/ethernet.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../embedded/adc.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-c2a407aa.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>

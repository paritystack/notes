<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>SSL/TLS - My Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">My Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="ssltls-secure-sockets-layer--transport-layer-security"><a class="header" href="#ssltls-secure-sockets-layer--transport-layer-security">SSL/TLS (Secure Sockets Layer / Transport Layer Security)</a></h1>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>TLS (Transport Layer Security) is a cryptographic protocol that provides secure communication over networks. SSL is the predecessor to TLS (now deprecated).</p>
<p><strong>Key Features:</strong></p>
<ul>
<li><strong>Confidentiality</strong>: Encryption prevents eavesdropping</li>
<li><strong>Integrity</strong>: Detects message tampering</li>
<li><strong>Authentication</strong>: Verifies server (and optionally client) identity</li>
</ul>
<h2 id="ssltls-history"><a class="header" href="#ssltls-history">SSL/TLS History</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Version</th><th>Year</th><th>Status</th><th>Notes</th></tr></thead><tbody>
<tr><td><strong>SSL 1.0</strong></td><td>-</td><td>Never released</td><td>Internal Netscape protocol</td></tr>
<tr><td><strong>SSL 2.0</strong></td><td>1995</td><td>Deprecated</td><td>Serious security flaws</td></tr>
<tr><td><strong>SSL 3.0</strong></td><td>1996</td><td>Deprecated</td><td>POODLE attack (2014)</td></tr>
<tr><td><strong>TLS 1.0</strong></td><td>1999</td><td>Deprecated</td><td>Similar to SSL 3.0</td></tr>
<tr><td><strong>TLS 1.1</strong></td><td>2006</td><td>Deprecated</td><td>Minor improvements</td></tr>
<tr><td><strong>TLS 1.2</strong></td><td>2008</td><td>Secure</td><td>Currently widely used</td></tr>
<tr><td><strong>TLS 1.3</strong></td><td>2018</td><td>Secure</td><td>Modern, fastest, most secure</td></tr>
</tbody></table>
</div>
<h2 id="tls-handshake-tls-12"><a class="header" href="#tls-handshake-tls-12">TLS Handshake (TLS 1.2)</a></h2>
<h3 id="full-handshake-process"><a class="header" href="#full-handshake-process">Full Handshake Process</a></h3>
<pre><code>Client                                Server

1. ClientHello              --------&gt;
   - TLS version
   - Cipher suites
   - Random bytes
   - Extensions

                            &lt;--------  2. ServerHello
                                          - Chosen cipher suite
                                          - Random bytes
                                          - Session ID
                                       
                                       3. Certificate
                                          - Server certificate chain
                                       
                                       4. ServerKeyExchange
                                          - Key exchange parameters
                                       
                                       5. ServerHelloDone

6. ClientKeyExchange        --------&gt;
   - Pre-master secret (encrypted)

7. ChangeCipherSpec         --------&gt;
   - Switch to encrypted communication

8. Finished                 --------&gt;
   - Verification message (encrypted)

                            &lt;--------  9. ChangeCipherSpec

                            &lt;--------  10. Finished

11. Encrypted Application Data &lt;---&gt; Encrypted Application Data
</code></pre>
<h3 id="detailed-steps"><a class="header" href="#detailed-steps">Detailed Steps</a></h3>
<h4 id="1-clienthello"><a class="header" href="#1-clienthello">1. ClientHello</a></h4>
<pre><code>Client → Server:

TLS Version: 1.2
Cipher Suites:
  - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
  - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
  - TLS_RSA_WITH_AES_128_CBC_SHA256
Random: [28 bytes client random]
Session ID: [empty for new session]
Extensions:
  - server_name: example.com
  - supported_groups: P-256, P-384
  - signature_algorithms: RSA-PSS-SHA256, ECDSA-SHA256
</code></pre>
<h4 id="2-serverhello"><a class="header" href="#2-serverhello">2. ServerHello</a></h4>
<pre><code>Server → Client:

TLS Version: 1.2
Cipher Suite: TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
Random: [28 bytes server random]
Session ID: [32 bytes for session resumption]
Extensions:
  - renegotiation_info
  - extended_master_secret
</code></pre>
<h4 id="3-certificate"><a class="header" href="#3-certificate">3. Certificate</a></h4>
<pre><code>Server → Client:

Certificate Chain:
  1. Server certificate (example.com)
  2. Intermediate CA certificate
  [Root CA not sent - client has it]
</code></pre>
<h4 id="4-serverkeyexchange-for-ecdhe"><a class="header" href="#4-serverkeyexchange-for-ecdhe">4. ServerKeyExchange (for ECDHE)</a></h4>
<pre><code>Server → Client:

Curve: P-256
Public Key: [server's ephemeral ECDH public key]
Signature: [signed with server's private key]
</code></pre>
<h4 id="5-clientkeyexchange"><a class="header" href="#5-clientkeyexchange">5. ClientKeyExchange</a></h4>
<pre><code>Client → Server:

Pre-master Secret:
  [Encrypted with server's public key (RSA) OR
   Client's ephemeral ECDH public key (ECDHE)]
</code></pre>
<h4 id="6-master-secret-derivation"><a class="header" href="#6-master-secret-derivation">6. Master Secret Derivation</a></h4>
<pre><code>Both compute:

Master Secret = PRF(
  pre-master secret,
  "master secret",
  ClientHello.random + ServerHello.random
)

Then derive:
  - Client write MAC key
  - Server write MAC key
  - Client write encryption key
  - Server write encryption key
  - Client write IV
  - Server write IV
</code></pre>
<h3 id="visual-tls-12-handshake"><a class="header" href="#visual-tls-12-handshake">Visual TLS 1.2 Handshake</a></h3>
<pre><code>┌────────┐                           ┌────────┐
│ Client │                           │ Server │
└───┬────┘                           └───┬────┘
    │                                    │
    │ ClientHello                        │
    │ (ciphers, random, SNI)             │
    ├───────────────────────────────────&gt;│
    │                                    │
    │                   ServerHello      │
    │              (chosen cipher, random)│
    │&lt;───────────────────────────────────┤
    │                                    │
    │                 Certificate        │
    │         (server cert chain)        │
    │&lt;───────────────────────────────────┤
    │                                    │
    │            ServerKeyExchange       │
    │        (DH params, signature)      │
    │&lt;───────────────────────────────────┤
    │                                    │
    │            ServerHelloDone         │
    │&lt;───────────────────────────────────┤
    │                                    │
    │ ClientKeyExchange                  │
    │ (pre-master secret)                │
    ├───────────────────────────────────&gt;│
    │                                    │
    │ ChangeCipherSpec                   │
    ├───────────────────────────────────&gt;│
    │                                    │
    │ Finished (encrypted)               │
    ├───────────────────────────────────&gt;│
    │                                    │
    │            ChangeCipherSpec        │
    │&lt;───────────────────────────────────┤
    │                                    │
    │         Finished (encrypted)       │
    │&lt;───────────────────────────────────┤
    │                                    │
    │ Application Data (encrypted)       │
    │&lt;──────────────────────────────────&gt;│
    │                                    │
</code></pre>
<h2 id="tls-13-handshake"><a class="header" href="#tls-13-handshake">TLS 1.3 Handshake</a></h2>
<p>TLS 1.3 is <strong>faster</strong> - only 1 round-trip (vs 2 in TLS 1.2):</p>
<pre><code>Client                                Server

1. ClientHello              --------&gt;
   - Key share (DH)
   - Supported versions
   - Cipher suites

                            &lt;--------  2. ServerHello
                                          - Key share (DH)
                                          - Chosen cipher
                                       
                                       {Certificate}*
                                       {CertificateVerify}*
                                       {Finished}
                                       [Application Data]

{Finished}                  --------&gt;

[Application Data]          &lt;-------&gt;  [Application Data]

* Encrypted with handshake traffic keys
[] Encrypted with application traffic keys
</code></pre>
<h3 id="key-differences-tls-13-vs-12"><a class="header" href="#key-differences-tls-13-vs-12">Key Differences TLS 1.3 vs 1.2</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Feature</th><th>TLS 1.2</th><th>TLS 1.3</th></tr></thead><tbody>
<tr><td><strong>Round trips</strong></td><td>2-RTT</td><td>1-RTT</td></tr>
<tr><td><strong>0-RTT mode</strong></td><td>No</td><td>Yes (with risks)</td></tr>
<tr><td><strong>Cipher suites</strong></td><td>Many (weak ones)</td><td>Only 5 strong ones</td></tr>
<tr><td><strong>Key exchange</strong></td><td>RSA, DHE, ECDHE</td><td>Only (EC)DHE</td></tr>
<tr><td><strong>Encryption</strong></td><td>After handshake</td><td>Most of handshake encrypted</td></tr>
<tr><td><strong>Performance</strong></td><td>Slower</td><td>Faster</td></tr>
<tr><td><strong>Security</strong></td><td>Vulnerable configs</td><td>Secure by default</td></tr>
</tbody></table>
</div>
<h3 id="tls-13-improvements"><a class="header" href="#tls-13-improvements">TLS 1.3 Improvements</a></h3>
<ol>
<li><strong>Faster handshake</strong> (1-RTT instead of 2-RTT)</li>
<li><strong>0-RTT mode</strong> (resume with no round trips)</li>
<li><strong>Removed weak crypto</strong> (RC4, MD5, SHA-1, RSA key exchange)</li>
<li><strong>Forward secrecy</strong> (mandatory ECDHE)</li>
<li><strong>Encrypted handshake</strong> (server certificate encrypted)</li>
<li><strong>Simplified cipher suites</strong></li>
</ol>
<h2 id="cipher-suites"><a class="header" href="#cipher-suites">Cipher Suites</a></h2>
<h3 id="cipher-suite-format-tls-12"><a class="header" href="#cipher-suite-format-tls-12">Cipher Suite Format (TLS 1.2)</a></h3>
<pre><code>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
|   |     |   |    |       |   |
|   |     |   |    |       |   +-- MAC algorithm (SHA-256)
|   |     |   |    |       +------ AEAD mode (GCM)
|   |     |   |    +-------------- Encryption (AES-128)
|   |     |   +------------------- "WITH"
|   |     +----------------------- Authentication (RSA)
|   +----------------------------- Key exchange (ECDHE)
+--------------------------------- Protocol (TLS)
</code></pre>
<h3 id="common-cipher-suites-tls-12"><a class="header" href="#common-cipher-suites-tls-12">Common Cipher Suites (TLS 1.2)</a></h3>
<h4 id="strong--recommended"><a class="header" href="#strong--recommended">Strong &amp; Recommended</a></h4>
<pre><code>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256
TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
</code></pre>
<h4 id="weak-avoid"><a class="header" href="#weak-avoid">Weak (Avoid)</a></h4>
<pre><code>TLS_RSA_WITH_RC4_128_SHA                    # RC4 broken
TLS_RSA_WITH_3DES_EDE_CBC_SHA               # 3DES weak
TLS_RSA_WITH_AES_128_CBC_SHA                # CBC mode, no forward secrecy
TLS_DHE_RSA_WITH_AES_128_CBC_SHA256         # CBC mode
</code></pre>
<h3 id="cipher-suite-components"><a class="header" href="#cipher-suite-components">Cipher Suite Components</a></h3>
<h4 id="1-key-exchange"><a class="header" href="#1-key-exchange">1. Key Exchange</a></h4>
<pre><code>RSA:     No forward secrecy (deprecated)
DHE:     Diffie-Hellman Ephemeral (slow)
ECDHE:   Elliptic Curve DHE (fast, forward secrecy) ✓
</code></pre>
<h4 id="2-authentication"><a class="header" href="#2-authentication">2. Authentication</a></h4>
<pre><code>RSA:     RSA certificate
ECDSA:   Elliptic Curve certificate (smaller, faster)
DSA:     Digital Signature Algorithm (obsolete)
</code></pre>
<h4 id="3-encryption"><a class="header" href="#3-encryption">3. Encryption</a></h4>
<pre><code>AES-128-GCM:      Fast, secure, hardware accelerated ✓
AES-256-GCM:      Higher security ✓
ChaCha20-Poly1305: Fast on mobile (no AES hardware) ✓
AES-CBC:          Vulnerable to padding oracles (avoid)
3DES:             Obsolete (avoid)
RC4:              Broken (never use)
</code></pre>
<h4 id="4-mac-message-authentication-code"><a class="header" href="#4-mac-message-authentication-code">4. MAC (Message Authentication Code)</a></h4>
<pre><code>SHA-256:  Secure ✓
SHA-384:  Secure ✓
SHA-1:    Weak (avoid)
MD5:      Broken (never use)

Note: AEAD modes (GCM, ChaCha20-Poly1305) don't need separate MAC
</code></pre>
<h3 id="tls-13-cipher-suites-simplified"><a class="header" href="#tls-13-cipher-suites-simplified">TLS 1.3 Cipher Suites (Simplified)</a></h3>
<pre><code>TLS_AES_128_GCM_SHA256
TLS_AES_256_GCM_SHA384
TLS_CHACHA20_POLY1305_SHA256
TLS_AES_128_CCM_SHA256
TLS_AES_128_CCM_8_SHA256
</code></pre>
<p>Only 5 cipher suites! Key exchange and auth determined separately.</p>
<h2 id="configuring-tls"><a class="header" href="#configuring-tls">Configuring TLS</a></h2>
<h3 id="nginx-configuration"><a class="header" href="#nginx-configuration">Nginx Configuration</a></h3>
<pre><code class="language-nginx">server {
    listen 443 ssl http2;
    server_name example.com;

    # Certificates
    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;

    # TLS versions
    ssl_protocols TLSv1.2 TLSv1.3;

    # Cipher suites (TLS 1.2)
    ssl_ciphers 'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-CHACHA20-POLY1305';
    ssl_prefer_server_ciphers on;

    # DH parameters (for DHE cipher suites)
    ssl_dhparam /etc/nginx/dhparam.pem;

    # OCSP Stapling
    ssl_stapling on;
    ssl_stapling_verify on;
    ssl_trusted_certificate /etc/letsencrypt/live/example.com/chain.pem;

    # Session tickets
    ssl_session_timeout 1d;
    ssl_session_cache shared:SSL:50m;
    ssl_session_tickets off;

    # HSTS (HTTP Strict Transport Security)
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

    location / {
        root /var/www/html;
    }
}

# Redirect HTTP to HTTPS
server {
    listen 80;
    server_name example.com;
    return 301 https://$server_name$request_uri;
}
</code></pre>
<h3 id="apache-configuration"><a class="header" href="#apache-configuration">Apache Configuration</a></h3>
<pre><code class="language-apache">&lt;VirtualHost *:443&gt;
    ServerName example.com
    
    # Certificates
    SSLCertificateFile /etc/letsencrypt/live/example.com/cert.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/example.com/privkey.pem
    SSLCertificateChainFile /etc/letsencrypt/live/example.com/chain.pem
    
    # TLS versions
    SSLProtocol -all +TLSv1.2 +TLSv1.3
    
    # Cipher suites
    SSLCipherSuite ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-CHACHA20-POLY1305
    SSLHonorCipherOrder on
    
    # OCSP Stapling
    SSLUseStapling on
    SSLStaplingCache "shmcb:logs/ssl_stapling(32768)"
    
    # HSTS
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    
    DocumentRoot /var/www/html
&lt;/VirtualHost&gt;

# Redirect HTTP to HTTPS
&lt;VirtualHost *:80&gt;
    ServerName example.com
    Redirect permanent / https://example.com/
&lt;/VirtualHost&gt;
</code></pre>
<h3 id="python-https-server"><a class="header" href="#python-https-server">Python HTTPS Server</a></h3>
<pre><code class="language-python">import http.server
import ssl

# Simple HTTPS server
server_address = ('0.0.0.0', 4443)
httpd = http.server.HTTPServer(server_address, http.server.SimpleHTTPRequestHandler)

# Create SSL context
context = ssl.SSLContext(ssl.PROTOCOL_TLS_SERVER)
context.load_cert_chain('cert.pem', 'key.pem')

# Optional: Configure cipher suites
context.set_ciphers('ECDHE+AESGCM:ECDHE+CHACHA20:DHE+AESGCM:DHE+CHACHA20:!aNULL:!MD5:!DSS')

# Wrap socket with TLS
httpd.socket = context.wrap_socket(httpd.socket, server_side=True)

print("Server running on https://localhost:4443")
httpd.serve_forever()
</code></pre>
<h3 id="python-client-with-tls"><a class="header" href="#python-client-with-tls">Python Client with TLS</a></h3>
<pre><code class="language-python">import ssl
import socket

def https_request(hostname, path='/'):
    # Create SSL context
    context = ssl.create_default_context()
    
    # Optional: Verify certificate
    # context.check_hostname = True
    # context.verify_mode = ssl.CERT_REQUIRED
    
    # Optional: Pin certificate
    # context.load_verify_locations('ca-bundle.crt')
    
    # Connect
    with socket.create_connection((hostname, 443)) as sock:
        with context.wrap_socket(sock, server_hostname=hostname) as ssock:
            # Send HTTP request
            request = f"GET {path} HTTP/1.1\r\nHost: {hostname}\r\nConnection: close\r\n\r\n"
            ssock.send(request.encode())
            
            # Receive response
            response = b''
            while True:
                data = ssock.recv(4096)
                if not data:
                    break
                response += data
            
            return response.decode()

# Usage
response = https_request('example.com', '/')
print(response)
</code></pre>
<h3 id="using-python-requests-library"><a class="header" href="#using-python-requests-library">Using Python Requests Library</a></h3>
<pre><code class="language-python">import requests

# Basic HTTPS request (verifies certificates by default)
response = requests.get('https://example.com')

# Disable certificate verification (not recommended!)
response = requests.get('https://example.com', verify=False)

# Use custom CA bundle
response = requests.get('https://example.com', verify='/path/to/ca-bundle.crt')

# Client certificate authentication
response = requests.get('https://example.com', 
                       cert=('client.crt', 'client.key'))

# Specify TLS version
import ssl
from requests.adapters import HTTPAdapter
from urllib3.util.ssl_ import create_urllib3_context

class TLSAdapter(HTTPAdapter):
    def init_poolmanager(self, *args, **kwargs):
        ctx = create_urllib3_context()
        ctx.minimum_version = ssl.TLSVersion.TLSv1_2
        ctx.maximum_version = ssl.TLSVersion.TLSv1_3
        kwargs['ssl_context'] = ctx
        return super().init_poolmanager(*args, **kwargs)

session = requests.Session()
session.mount('https://', TLSAdapter())
response = session.get('https://example.com')
</code></pre>
<h2 id="testing-tls-configuration"><a class="header" href="#testing-tls-configuration">Testing TLS Configuration</a></h2>
<h3 id="openssl-command-line-tests"><a class="header" href="#openssl-command-line-tests">OpenSSL Command-Line Tests</a></h3>
<pre><code class="language-bash"># Connect to server and show TLS info
openssl s_client -connect example.com:443 -servername example.com

# Test specific TLS version
openssl s_client -connect example.com:443 -tls1_2
openssl s_client -connect example.com:443 -tls1_3

# Test if old protocols are disabled
openssl s_client -connect example.com:443 -ssl3  # Should fail
openssl s_client -connect example.com:443 -tls1  # Should fail
openssl s_client -connect example.com:443 -tls1_1  # Should fail

# Test specific cipher suite
openssl s_client -connect example.com:443 -cipher 'ECDHE-RSA-AES128-GCM-SHA256'

# Show certificate chain
openssl s_client -connect example.com:443 -showcerts

# Check OCSP stapling
openssl s_client -connect example.com:443 -status

# Check certificate expiration
echo | openssl s_client -connect example.com:443 2&gt;/dev/null | openssl x509 -noout -dates

# Full connection info
openssl s_client -connect example.com:443 -servername example.com &lt;/dev/null | grep -E 'Protocol|Cipher'
</code></pre>
<h3 id="testing-tools"><a class="header" href="#testing-tools">Testing Tools</a></h3>
<h4 id="nmap"><a class="header" href="#nmap">nmap</a></h4>
<pre><code class="language-bash"># Scan TLS versions
nmap --script ssl-enum-ciphers -p 443 example.com

# Check for vulnerabilities
nmap --script ssl-* -p 443 example.com
</code></pre>
<h4 id="testsslsh"><a class="header" href="#testsslsh">testssl.sh</a></h4>
<pre><code class="language-bash"># Install
git clone https://github.com/drwetter/testssl.sh.git
cd testssl.sh

# Run comprehensive test
./testssl.sh https://example.com

# Test specific features
./testssl.sh --protocols https://example.com
./testssl.sh --ciphers https://example.com
./testssl.sh --vulnerabilities https://example.com
</code></pre>
<h4 id="ssl-labs"><a class="header" href="#ssl-labs">SSL Labs</a></h4>
<pre><code class="language-bash"># Online tool (web interface)
# https://www.ssllabs.com/ssltest/

# API
curl "https://api.ssllabs.com/api/v3/analyze?host=example.com"
</code></pre>
<h3 id="python-tls-testing"><a class="header" href="#python-tls-testing">Python TLS Testing</a></h3>
<pre><code class="language-python">import ssl
import socket

def test_tls_version(hostname, port=443):
    """Test TLS versions supported by server"""
    versions = {
        'TLS 1.0': ssl.PROTOCOL_TLSv1,
        'TLS 1.1': ssl.PROTOCOL_TLSv1_1,
        'TLS 1.2': ssl.PROTOCOL_TLSv1_2,
        'TLS 1.3': ssl.PROTOCOL_TLS,  # Tries highest available
    }
    
    for version_name, protocol in versions.items():
        try:
            context = ssl.SSLContext(protocol)
            with socket.create_connection((hostname, port), timeout=5) as sock:
                with context.wrap_socket(sock, server_hostname=hostname) as ssock:
                    print(f"✓ {version_name}: Supported (cipher: {ssock.cipher()[0]})")
        except Exception as e:
            print(f"✗ {version_name}: Not supported")

def get_certificate_info(hostname, port=443):
    """Get server certificate information"""
    context = ssl.create_default_context()
    
    with socket.create_connection((hostname, port)) as sock:
        with context.wrap_socket(sock, server_hostname=hostname) as ssock:
            cert = ssock.getpeercert()
            
            print(f"Subject: {dict(x[0] for x in cert['subject'])}")
            print(f"Issuer: {dict(x[0] for x in cert['issuer'])}")
            print(f"Version: {cert['version']}")
            print(f"Serial: {cert['serialNumber']}")
            print(f"Not Before: {cert['notBefore']}")
            print(f"Not After: {cert['notAfter']}")
            print(f"SANs: {', '.join([x[1] for x in cert.get('subjectAltName', [])])}")
            print(f"TLS Version: {ssock.version()}")
            print(f"Cipher: {ssock.cipher()}")

# Usage
test_tls_version('example.com')
print()
get_certificate_info('example.com')
</code></pre>
<h2 id="common-tls-vulnerabilities"><a class="header" href="#common-tls-vulnerabilities">Common TLS Vulnerabilities</a></h2>
<h3 id="1-poodle-padding-oracle-on-downgraded-legacy-encryption"><a class="header" href="#1-poodle-padding-oracle-on-downgraded-legacy-encryption">1. POODLE (Padding Oracle On Downgraded Legacy Encryption)</a></h3>
<p><strong>Attack</strong>: Forces downgrade to SSL 3.0, exploits CBC padding</p>
<p><strong>Mitigation</strong>:</p>
<pre><code class="language-nginx"># Disable SSL 3.0
ssl_protocols TLSv1.2 TLSv1.3;
</code></pre>
<h3 id="2-beast-browser-exploit-against-ssltls"><a class="header" href="#2-beast-browser-exploit-against-ssltls">2. BEAST (Browser Exploit Against SSL/TLS)</a></h3>
<p><strong>Attack</strong>: Exploits CBC mode in TLS 1.0</p>
<p><strong>Mitigation</strong>:</p>
<pre><code class="language-nginx"># Disable TLS 1.0, use modern cipher suites
ssl_protocols TLSv1.2 TLSv1.3;
ssl_ciphers 'ECDHE-RSA-AES128-GCM-SHA256:...';
</code></pre>
<h3 id="3-crime-compression-ratio-info-leak-made-easy"><a class="header" href="#3-crime-compression-ratio-info-leak-made-easy">3. CRIME (Compression Ratio Info-leak Made Easy)</a></h3>
<p><strong>Attack</strong>: Exploits TLS compression</p>
<p><strong>Mitigation</strong>:</p>
<pre><code class="language-nginx"># Disable TLS compression (usually disabled by default)
ssl_compression off;
</code></pre>
<h3 id="4-heartbleed"><a class="header" href="#4-heartbleed">4. Heartbleed</a></h3>
<p><strong>Attack</strong>: Buffer over-read in OpenSSL heartbeat extension</p>
<p><strong>Mitigation</strong>:</p>
<pre><code class="language-bash"># Update OpenSSL
sudo apt-get update
sudo apt-get upgrade openssl

# Check version (must be &gt; 1.0.1g)
openssl version
</code></pre>
<h3 id="5-logjam"><a class="header" href="#5-logjam">5. Logjam</a></h3>
<p><strong>Attack</strong>: Weakness in DHE key exchange with small primes</p>
<p><strong>Mitigation</strong>:</p>
<pre><code class="language-bash"># Generate strong DH parameters
openssl dhparam -out /etc/nginx/dhparam.pem 2048

# Configure nginx
ssl_dhparam /etc/nginx/dhparam.pem;
</code></pre>
<h3 id="6-freak-factoring-rsa-export-keys"><a class="header" href="#6-freak-factoring-rsa-export-keys">6. FREAK (Factoring RSA Export Keys)</a></h3>
<p><strong>Attack</strong>: Forces use of weak export-grade encryption</p>
<p><strong>Mitigation</strong>:</p>
<pre><code class="language-nginx"># Disable export ciphers
ssl_ciphers 'ECDHE-RSA-AES128-GCM-SHA256:...';  # No EXPORT
</code></pre>
<h3 id="7-drown-decrypting-rsa-with-obsolete-and-weakened-encryption"><a class="header" href="#7-drown-decrypting-rsa-with-obsolete-and-weakened-encryption">7. DROWN (Decrypting RSA with Obsolete and Weakened eNcryption)</a></h3>
<p><strong>Attack</strong>: Exploits SSLv2 to break TLS</p>
<p><strong>Mitigation</strong>:</p>
<pre><code class="language-bash"># Ensure SSLv2 is disabled everywhere
# Check with:
nmap --script ssl-enum-ciphers -p 443 example.com
</code></pre>
<h3 id="checking-for-vulnerabilities"><a class="header" href="#checking-for-vulnerabilities">Checking for Vulnerabilities</a></h3>
<pre><code class="language-bash"># Using testssl.sh
./testssl.sh --vulnerabilities https://example.com

# Using nmap
nmap --script ssl-heartbleed,ssl-poodle,ssl-dh-params -p 443 example.com
</code></pre>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<h3 id="1-protocol-configuration"><a class="header" href="#1-protocol-configuration">1. Protocol Configuration</a></h3>
<pre><code class="language-nginx"># ✓ GOOD - Only modern protocols
ssl_protocols TLSv1.2 TLSv1.3;

# ✗ BAD - Includes old protocols
ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
</code></pre>
<h3 id="2-cipher-suite-selection"><a class="header" href="#2-cipher-suite-selection">2. Cipher Suite Selection</a></h3>
<pre><code class="language-nginx"># ✓ GOOD - Strong, forward-secret ciphers
ssl_ciphers 'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-CHACHA20-POLY1305';

# ✗ BAD - Includes weak ciphers
ssl_ciphers 'ALL:!aNULL:!MD5';
</code></pre>
<h3 id="3-certificate-management"><a class="header" href="#3-certificate-management">3. Certificate Management</a></h3>
<pre><code class="language-bash"># ✓ Use certificates from trusted CA (Let's Encrypt)
# ✓ Automate renewal
# ✓ Monitor expiration
# ✓ Include full certificate chain
# ✗ Don't use self-signed in production
# ✗ Don't let certificates expire
</code></pre>
<h3 id="4-hsts-http-strict-transport-security"><a class="header" href="#4-hsts-http-strict-transport-security">4. HSTS (HTTP Strict Transport Security)</a></h3>
<pre><code class="language-nginx"># Enforce HTTPS for all subdomains
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;
</code></pre>
<h3 id="5-ocsp-stapling"><a class="header" href="#5-ocsp-stapling">5. OCSP Stapling</a></h3>
<pre><code class="language-nginx"># Enable OCSP stapling for faster certificate validation
ssl_stapling on;
ssl_stapling_verify on;
ssl_trusted_certificate /path/to/chain.pem;
</code></pre>
<h3 id="6-session-management"><a class="header" href="#6-session-management">6. Session Management</a></h3>
<pre><code class="language-nginx"># Session resumption (performance)
ssl_session_timeout 1d;
ssl_session_cache shared:SSL:50m;

# Disable session tickets (forward secrecy)
ssl_session_tickets off;
</code></pre>
<h3 id="7-perfect-forward-secrecy"><a class="header" href="#7-perfect-forward-secrecy">7. Perfect Forward Secrecy</a></h3>
<pre><code>Use ECDHE or DHE key exchange:
- ECDHE: Fast, modern
- DHE: Slower, but compatible

Avoid RSA key exchange (no forward secrecy)
</code></pre>
<h3 id="8-regular-updates"><a class="header" href="#8-regular-updates">8. Regular Updates</a></h3>
<pre><code class="language-bash"># Keep OpenSSL updated
sudo apt-get update
sudo apt-get upgrade openssl libssl-dev

# Keep web server updated
sudo apt-get upgrade nginx  # or apache2
</code></pre>
<h3 id="9-monitoring-and-testing"><a class="header" href="#9-monitoring-and-testing">9. Monitoring and Testing</a></h3>
<pre><code class="language-bash"># Regular security scans
./testssl.sh https://example.com

# Monitor certificate expiration
curl https://crt.sh/?q=example.com

# Check SSL Labs rating
curl "https://api.ssllabs.com/api/v3/analyze?host=example.com"
</code></pre>
<h2 id="security-checklist"><a class="header" href="#security-checklist">Security Checklist</a></h2>
<pre><code>Certificate:
  [✓] Valid and not expired
  [✓] From trusted CA
  [✓] Matches domain name
  [✓] Includes full chain
  [✓] Strong key (RSA 2048+ or ECDSA P-256+)

Protocol:
  [✓] TLS 1.2 minimum
  [✓] TLS 1.3 enabled
  [✓] SSL 3.0 disabled
  [✓] TLS 1.0/1.1 disabled

Cipher Suites:
  [✓] Only strong ciphers
  [✓] Forward secrecy (ECDHE)
  [✓] AEAD modes (GCM, ChaCha20-Poly1305)
  [✓] No weak ciphers (RC4, 3DES, etc.)

Headers:
  [✓] HSTS enabled
  [✓] Secure cookie flags

Features:
  [✓] OCSP stapling enabled
  [✓] Session tickets disabled
  [✓] HTTP → HTTPS redirect

Vulnerabilities:
  [✓] Not vulnerable to POODLE
  [✓] Not vulnerable to BEAST
  [✓] Not vulnerable to Heartbleed
  [✓] Not vulnerable to Logjam
  [✓] Not vulnerable to FREAK
  [✓] Not vulnerable to DROWN
</code></pre>
<h2 id="common-mistakes"><a class="header" href="#common-mistakes">Common Mistakes</a></h2>
<h3 id="1-mixed-content"><a class="header" href="#1-mixed-content">1. Mixed Content</a></h3>
<pre><code class="language-html">&lt;!-- BAD - Loading HTTP resource on HTTPS page --&gt;
&lt;script src="http://example.com/script.js"&gt;&lt;/script&gt;

&lt;!-- GOOD - Use HTTPS --&gt;
&lt;script src="https://example.com/script.js"&gt;&lt;/script&gt;

&lt;!-- BETTER - Protocol-relative URL --&gt;
&lt;script src="//example.com/script.js"&gt;&lt;/script&gt;
</code></pre>
<h3 id="2-weak-cipher-configuration"><a class="header" href="#2-weak-cipher-configuration">2. Weak Cipher Configuration</a></h3>
<pre><code class="language-nginx"># BAD - Allows weak ciphers
ssl_ciphers 'ALL:!aNULL:!MD5';

# GOOD - Only strong ciphers
ssl_ciphers 'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384';
</code></pre>
<h3 id="3-missing-certificate-chain"><a class="header" href="#3-missing-certificate-chain">3. Missing Certificate Chain</a></h3>
<pre><code class="language-nginx"># BAD - Only server certificate
ssl_certificate /path/to/cert.pem;

# GOOD - Full chain (server + intermediate)
ssl_certificate /path/to/fullchain.pem;
</code></pre>
<h3 id="4-expired-certificates"><a class="header" href="#4-expired-certificates">4. Expired Certificates</a></h3>
<pre><code class="language-bash"># Check expiration regularly
echo | openssl s_client -connect example.com:443 2&gt;/dev/null | openssl x509 -noout -dates

# Automate renewal
certbot renew
</code></pre>
<h3 id="5-not-redirecting-http-to-https"><a class="header" href="#5-not-redirecting-http-to-https">5. Not Redirecting HTTP to HTTPS</a></h3>
<pre><code class="language-nginx"># Missing HTTP → HTTPS redirect leaves users vulnerable

# GOOD - Redirect all HTTP to HTTPS
server {
    listen 80;
    server_name example.com;
    return 301 https://$server_name$request_uri;
}
</code></pre>
<h2 id="eli10"><a class="header" href="#eli10">ELI10</a></h2>
<p>TLS is like a secure tunnel for internet communication:</p>
<p><strong>Without TLS (HTTP):</strong></p>
<pre><code>You: "My password is abc123"
  ↓ (anyone can read this!)
Server: "OK, logged in"
</code></pre>
<p>Bad guys can see everything!</p>
<p><strong>With TLS (HTTPS):</strong></p>
<pre><code>Step 1: Build a secure tunnel
  You: "Let's talk securely!"
  Server: "Here's my ID card" (certificate)
  You: "OK, I trust you"
  Both: [Create secret code together]

Step 2: Talk through tunnel
  You: "xf9#k2@..." (encrypted password)
  ↓ (looks like gibberish to bad guys!)
  Server: "p8#nz..." (encrypted response)
</code></pre>
<p><strong>The Handshake (making friends):</strong></p>
<ol>
<li><strong>You</strong>: "Hi! I speak TLS 1.2 and TLS 1.3"</li>
<li><strong>Server</strong>: "Great! Let's use TLS 1.3. Here's my ID card"</li>
<li><strong>You</strong>: "ID looks good! Here's a secret number"</li>
<li><strong>Server</strong>: "Got it! Here's my secret number"</li>
<li><strong>Both</strong>: "Let's mix our secrets to make a key!"</li>
<li><strong>Both</strong>: "Tunnel ready! Let's talk!"</li>
</ol>
<p><strong>Why it's secure:</strong></p>
<ul>
<li><strong>Encryption</strong>: Messages look like random gibberish</li>
<li><strong>Authentication</strong>: Server proves it's really who it claims to be</li>
<li><strong>Integrity</strong>: Detect if someone changes messages</li>
</ul>
<p><strong>TLS 1.3 is better:</strong></p>
<ul>
<li>Faster (1 handshake step instead of 2)</li>
<li>More secure (removed old, weak options)</li>
<li>Simpler (fewer choices = fewer mistakes)</li>
</ul>
<p><strong>Real-world analogy:</strong></p>
<ul>
<li>HTTP = Postcard (anyone can read it)</li>
<li>HTTPS = Sealed letter with signature (secure and verified)</li>
</ul>
<h2 id="further-resources"><a class="header" href="#further-resources">Further Resources</a></h2>
<ul>
<li><a href="https://tools.ietf.org/html/rfc8446">TLS 1.3 RFC 8446</a></li>
<li><a href="https://tools.ietf.org/html/rfc5246">TLS 1.2 RFC 5246</a></li>
<li><a href="https://ssl-config.mozilla.org/">Mozilla SSL Configuration Generator</a></li>
<li><a href="https://www.ssllabs.com/ssltest/">SSL Labs Server Test</a></li>
<li><a href="https://github.com/drwetter/testssl.sh">testssl.sh GitHub</a></li>
<li><a href="https://cheatsheetseries.owasp.org/cheatsheets/Transport_Layer_Protection_Cheat_Sheet.html">OWASP TLS Cheat Sheet</a></li>
<li><a href="https://hpbn.co/">High Performance Browser Networking (Book)</a></li>
<li><a href="https://tls.ulfheim.net/">TLS Illustrated</a></li>
<li><a href="https://blog.cloudflare.com/rfc-8446-aka-tls-1-3/">Cloudflare TLS 1.3 Guide</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../security/certificates.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../security/hmac.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../security/certificates.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../security/hmac.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
